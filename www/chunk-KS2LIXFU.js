import{a as dt}from"./chunk-RVUXLX2V.js";import{a as on}from"./chunk-L7R4HPYP.js";import{a as xe}from"./chunk-SSUFQVT3.js";import{a as $n}from"./chunk-X25QJQMB.js";import{a as lt}from"./chunk-GHBUOQFG.js";import"./chunk-A2M65ZYR.js";import{a as be}from"./chunk-52VVF7TW.js";import{a as Re}from"./chunk-JNUN2KTT.js";import"./chunk-3NJZR3TT.js";import{a as Ge}from"./chunk-HQWX4VYX.js";import"./chunk-N4FKO75N.js";import{$ as qe,A as Zn,B as Xn,Ba as it,C as te,Da as rt,E as Jn,Ea as Z,Ga as ct,H as Qn,Ha as st,J as Ce,K as Be,N as se,P as Ee,Qa as Me,R as Kn,S as et,Sa as pe,U as Ue,Va as Oe,X as nt,_ as tt,a as W,aa as ot,b as Hn,c as Ln,d as Bn,f as Un,ga as cn,h as an,ha as at,ia as sn,j as qn,la as ln,m as Gn,o as He,q as Le,r as rn,ra as ze,ta as dn,va as Pe,w as ce,x as Yn,y as Wn}from"./chunk-CPCGS7XX.js";import"./chunk-FK6H3RFT.js";import"./chunk-DKQ7PFJV.js";import"./chunk-7FW4253V.js";import{a as $e}from"./chunk-ZLE3SS2Y.js";import{h as Te,i as De,j as Ve,r as Ne,s as re,w as ne,x as Nn}from"./chunk-7RXHQH5K.js";import{a as de,b as Rn}from"./chunk-ZFUZ5UD4.js";import{$a as K,A as oe,Aa as ye,Ac as Vn,Ca as s,Da as h,E as me,Ea as U,Fa as le,H as X,Ha as Qe,Ia as Ke,Ja as en,L as w,M as E,Ma as Cn,Na as nn,Q as bn,Ra as B,Sa as tn,Ta as we,Ua as ae,V as J,X as d,Y as N,Za as _e,_ as Q,_a as ie,bb as Pn,c as Ae,ca as k,cb as Mn,cc as hn,db as On,eb as je,ec as Y,f as V,fb as ee,fc as vn,gc as yn,ha as m,i as _n,ia as Ie,j as $,ja as Fe,kc as wn,la as o,lc as En,m as ue,ma as a,mc as zn,na as _,ob as xn,pc as Sn,qc as kn,r as q,ra as j,rb as fe,rc as An,sa as C,sc as In,ta as f,tc as Fn,u as fn,vc as jn,wa as Je,y as H,ya as he,yc as Tn,z as G,za as ve,zc as Dn}from"./chunk-QQQKELKR.js";import"./chunk-FMBN6UXO.js";import"./chunk-QUJFQN2Y.js";import"./chunk-T4LV2MRW.js";import"./chunk-QZ7DKK3O.js";import"./chunk-7NXYYB6M.js";import"./chunk-G2E2NLL6.js";import"./chunk-HZSDEEV2.js";import"./chunk-AO65UGJX.js";import"./chunk-MYMWTHTI.js";import"./chunk-YNWT2DLU.js";import"./chunk-ULLEADC5.js";import"./chunk-2ELISCRH.js";import"./chunk-BV4CTHEE.js";import"./chunk-XPQFWPU3.js";import"./chunk-6SS6CZRK.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-CGQGPWKF.js";import"./chunk-CKP3SGE2.js";import"./chunk-FAIKFHLE.js";import"./chunk-NBD2MYJO.js";import"./chunk-3SBX7V6R.js";import"./chunk-SQKDQBOS.js";import"./chunk-SWRJZAEI.js";import"./chunk-JCSW2JUV.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-36KMLI7A.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as Se,b as ke,d as mn,k as L}from"./chunk-CRC5ZNR6.js";var pt=[{valor:"Finalizado",label:"Finalizado",descripcion:"Trabajo completado, listo para facturar"},{valor:"Presupuesto pendiente",label:"Presupuesto pendiente",descripcion:"Se requiere presupuesto adicional"},{valor:"Otra visita",label:"Otra visita",descripcion:"Se necesita realizar otra visita"}];var Ye=(()=>{let p=class p{constructor(e,n){this.supabaseClientService=e,this.inventarioService=n}getSupabaseClient(){return console.log("\u{1F4CB} AlbaranesService: Obteniendo cliente Supabase actualizado..."),this.supabaseClientService.getClient()}crearAlbaran(e){console.log("\u{1F4CB} Creando albar\xE1n con datos:",e);let r=e,{repuestos_utilizados:n}=r,t=mn(r,["repuestos_utilizados"]);return V(this.getSupabaseClient().from("albaranes").insert([t]).select().single()).pipe(H(({data:g,error:l})=>{if(l)throw l;if(console.log("\u2705 Albar\xE1n b\xE1sico creado:",g.id),!n||n.length===0)return console.log("\u{1F4CB} Sin repuestos que procesar"),V([g]);let M=n.map(b=>({albaran_id:g.id,nombre:b.nombre,cantidad:b.cantidad,precio_neto:b.precio_neto||0,precio_pvp:b.precio_pvp||0,unidad:b.unidad||"unidad",codigo:b.codigo||""}));return console.log("\u{1F4CB} Insertando repuestos en tabla repuestos_albaran:",M),V(this.getSupabaseClient().from("repuestos_albaran").insert(M).select()).pipe(H(({data:b,error:u})=>{if(u)throw console.error("\u274C Error al insertar repuestos:",u),u;if(console.log("\u2705 Repuestos insertados correctamente:",(b==null?void 0:b.length)||0,"repuestos"),b&&b.length>0){console.log("\u{1F4E6} Actualizando stock del inventario...");let I=b.map(x=>this.actualizarStockInventario(x));return ue(I).pipe($(()=>(console.log("\u2705 Stock del inventario actualizado correctamente"),ke(Se({},g),{repuestos:b||[]}))))}return V([ke(Se({},g),{repuestos:b||[]})])}))}),q(g=>{throw console.error("\u274C Error al crear albar\xE1n:",g),g}))}getAlbaran(e){return V(this.getSupabaseClient().from("albaranes").select(`
          *,
          aviso:avisos(*),
          repuestos:repuestos_albaran(*)
        `).eq("id",e).single()).pipe($(({data:n,error:t})=>{if(t)throw t;return console.log("\u{1F4CB} Albar\xE1n obtenido con repuestos:",n),n}),q(n=>{throw console.error("Error al obtener albar\xE1n:",n),n}))}actualizarStockInventario(e){console.log("\u{1F4E6} Actualizando stock para repuesto:",e);let n=this.getSupabaseClient().from("inventario").select("*");return e.codigo?n=n.eq("codigo",e.codigo):n=n.eq("nombre",e.nombre),V(n.single()).pipe(H(({data:t,error:r})=>{if(r)return console.warn("\u26A0\uFE0F Producto no encontrado en inventario:",e.nombre||e.codigo),V([void 0]);let g=t,l=g.cantidad_disponible||0,M=e.cantidad||1,b=Math.max(0,l-M);return console.log(`\u{1F4E6} Stock actual: ${l}, Cantidad usada: ${M}, Nueva cantidad: ${b}`),V(this.getSupabaseClient().from("inventario").update({cantidad_disponible:b,fecha_actualizacion:new Date().toISOString()}).eq("id",g.id)).pipe($(({error:u})=>{if(u)throw console.error("\u274C Error al actualizar stock:",u),u;console.log(`\u2705 Stock actualizado: ${g.nombre} - ${l} \u2192 ${b}`),this.inventarioService.getInventario().subscribe()}))}),q(t=>(console.error("\u274C Error en actualizarStockInventario:",t),V([void 0]))))}getAlbaranesAviso(e){return V(this.getSupabaseClient().from("albaranes").select(`
          *,
          repuestos:repuestos_albaran(*)
        `).eq("aviso_id",e).order("fecha_trabajo",{ascending:!1})).pipe($(({data:n,error:t})=>{if(t)throw t;return console.log("\u{1F4CB} Albaranes obtenidos con repuestos:",(n==null?void 0:n.length)||0,"albaranes"),n}),q(n=>{throw console.error("Error al obtener albaranes del aviso:",n),n}))}actualizarAlbaran(e,n){return V(this.getSupabaseClient().from("albaranes").update(ke(Se({},n),{fecha_actualizacion:new Date})).eq("id",e).select().single()).pipe($(({data:t,error:r})=>{if(r)throw r;return t}),q(t=>{throw console.error("Error al actualizar albar\xE1n:",t),t}))}eliminarAlbaran(e){return console.log("\u{1F50D} eliminarAlbaran llamado con ID:",e),this.getAlbaran(e).pipe(H(n=>{if(console.log("\u{1F4CB} Albar\xE1n obtenido para eliminaci\xF3n:",n),n.repuestos&&n.repuestos.length>0){console.log("\u{1F4E6} Devolviendo repuestos al inventario:",n.repuestos.length,"repuestos");let t=n.repuestos.map(r=>this.restaurarStockInventario(r));return ue(t).pipe(H(()=>(console.log("\u2705 Stock del inventario restaurado correctamente"),this.eliminarAlbaranDeBD(e))))}else return console.log("\u{1F4CB} Sin repuestos que devolver al inventario"),this.eliminarAlbaranDeBD(e)}),q(n=>{throw console.error("\u274C Error en eliminarAlbaran:",n),n}))}eliminarAlbaranDeBD(e){return V(this.getSupabaseClient().from("albaranes").delete().eq("id",e)).pipe($(({data:n,error:t})=>{if(console.log("\u{1F50D} Respuesta de Supabase:",{data:n,error:t}),t)throw console.error("\u274C Error de Supabase:",t),t;console.log("\u2705 Albar\xE1n eliminado exitosamente de la BD")}))}restaurarStockInventario(e){console.log("\u{1F4E6} Restaurando stock para repuesto:",e);let n=this.getSupabaseClient().from("inventario").select("*");return e.codigo?n=n.eq("codigo",e.codigo):n=n.eq("nombre",e.nombre),V(n.single()).pipe(H(({data:t,error:r})=>{if(r)return console.warn("\u26A0\uFE0F Producto no encontrado en inventario para restaurar:",e.nombre||e.codigo),V([void 0]);let g=t,l=g.cantidad_disponible||0,M=e.cantidad||1,b=l+M;return console.log(`\u{1F4E6} Stock actual: ${l}, Cantidad a restaurar: ${M}, Nueva cantidad: ${b}`),V(this.getSupabaseClient().from("inventario").update({cantidad_disponible:b,fecha_actualizacion:new Date().toISOString()}).eq("id",g.id)).pipe($(({error:u})=>{if(u)throw console.error("\u274C Error al restaurar stock:",u),u;console.log(`\u2705 Stock restaurado: ${g.nombre} - ${l} \u2192 ${b}`),this.inventarioService.getInventario().subscribe()}))}),q(t=>(console.error("\u274C Error en restaurarStockInventario:",t),V([void 0]))))}getEstadisticasAlbaranes(e){return V(this.getSupabaseClient().from("albaranes").select("estado_cierre").eq("aviso_id",e)).pipe($(({data:n,error:t})=>{if(t)throw t;let r=n;return{total:r.length,finalizados:r.filter(l=>l.estado_cierre==="Finalizado").length,presupuestoPendiente:r.filter(l=>l.estado_cierre==="Presupuesto pendiente").length,otraVisita:r.filter(l=>l.estado_cierre==="Otra visita").length}}),q(n=>{throw console.error("Error al obtener estad\xEDsticas de albaranes:",n),n}))}eliminarAlbaranDirect(e){return console.log("\u{1F680} AlbaranesService: Usando FETCH DIRECTO para eliminar albar\xE1n..."),V(this.fetchEliminarAlbaranDirect(e)).pipe($(()=>{console.log("\u2705 AlbaranesService: FETCH DIRECTO completado, albar\xE1n eliminado")}),q(n=>{throw console.error("\u274C AlbaranesService: Error en FETCH DIRECTO:",n),n}))}fetchEliminarAlbaranDirect(e){return L(this,null,function*(){console.log("\u{1F680} AlbaranesService: Ejecutando fetch directo para eliminar albar\xE1n:",e);try{let n=`${de.supabaseUrl}/rest/v1/albaranes?select=*,repuestos:repuestos_albaran(*)&id=eq.${e}`,t={apikey:de.supabaseServiceKey,Authorization:`Bearer ${de.supabaseServiceKey}`,"Content-Type":"application/json"};console.log("\u{1F680} Obteniendo albar\xE1n para eliminar:",n);let r=yield fetch(n,{method:"GET",headers:t});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);let g=yield r.json();if(!g||g.length===0)throw new Error("Albar\xE1n no encontrado");let l=g[0];if(console.log("\u{1F680} Albar\xE1n obtenido:",l),l.repuestos&&l.repuestos.length>0){console.log("\u{1F4E6} Devolviendo repuestos al inventario:",l.repuestos.length,"repuestos");for(let x of l.repuestos)try{let O=`${de.supabaseUrl}/rest/v1/inventario?id=eq.${x.material_id}`,T={stock_disponible:x.cantidad_utilizada};(yield fetch(O,{method:"PATCH",headers:t,body:JSON.stringify(T)})).ok?console.log("\u2705 Repuesto devuelto al inventario:",x.material_id):console.warn("\u26A0\uFE0F Error al devolver repuesto al inventario:",x.material_id)}catch(O){console.warn("\u26A0\uFE0F Error al devolver repuesto:",O)}}let M=`${de.supabaseUrl}/rest/v1/repuestos_albaran?albaran_id=eq.${e}`;(yield fetch(M,{method:"DELETE",headers:t})).ok||console.warn("\u26A0\uFE0F Error al eliminar repuestos del albar\xE1n");let u=`${de.supabaseUrl}/rest/v1/albaranes?id=eq.${e}`,I=yield fetch(u,{method:"DELETE",headers:t});if(!I.ok)throw new Error(`HTTP ${I.status}: ${I.statusText}`);console.log("\u2705 Albar\xE1n eliminado exitosamente")}catch(n){throw console.error("\u{1F680} Error en fetch directo:",n),n}})}};p.\u0275fac=function(n){return new(n||p)(X(Rn),X(Ge))},p.\u0275prov=me({token:p,factory:p.\u0275fac,providedIn:"root"});let c=p;return c})();var yt=["signaturePad"],wt=(c,p)=>({"stock-bajo":c,"stock-critico":p});function Et(c,p){if(c&1){let i=j();o(0,"div",51)(1,"div",52)(2,"h4"),s(3,"Agregar Repuesto"),a(),o(4,"button",53),C("click",function(){w(i);let n=f();return E(n.cerrarFormularioManual())}),_(5,"ion-icon",54),a()(),o(6,"div",55)(7,"div",56),_(8,"input",57),a(),o(9,"div",58),_(10,"input",59),a(),o(11,"div",60),_(12,"input",61),a(),o(13,"button",62),C("click",function(){w(i);let n=f();return E(n.agregarRepuestoDesdeFormulario())}),_(14,"ion-icon",63),a()()()}if(c&2){let i=f();d(6),m("formGroup",i.repuestoManualForm)}}function zt(c,p){if(c&1&&(o(0,"span",78),s(1),a()),c&2){let i=f().$implicit;d(),U(" ",i.cantidad_disponible===0?" (Sin stock)":" (Stock bajo)"," ")}}function St(c,p){if(c&1){let i=j();o(0,"div",71),C("click",function(){let n=w(i).$implicit,t=f(2);return E(t.agregarRepuesto(n))}),o(1,"div",72)(2,"span",73),s(3),a(),o(4,"div",74)(5,"span",75),s(6),k(7,zt,2,1,"span",76),a()()(),_(8,"ion-icon",77),a()}if(c&2){let i=p.$implicit;d(3),h(i.nombre),d(2),m("ngClass",Cn(5,wt,i.cantidad_disponible<=2,i.cantidad_disponible===0)),d(),le(" Stock: ",i.cantidad_disponible," ",i.unidad," "),d(),m("ngIf",i.cantidad_disponible<=2)}}function kt(c,p){if(c&1){let i=j();o(0,"div",64)(1,"div",65)(2,"h4"),s(3,"Seleccionar Repuestos"),a(),o(4,"button",53),C("click",function(){w(i);let n=f();return E(n.cerrarSelectorRepuestos())}),_(5,"ion-icon",54),a()(),o(6,"div",66)(7,"ion-input",67),en("ngModelChange",function(n){w(i);let t=f();return Ke(t.busquedaRepuesto,n)||(t.busquedaRepuesto=n),E(n)}),C("ionInput",function(n){w(i);let t=f();return E(t.filtrarProductos(n))}),a(),_(8,"ion-icon",68),a(),o(9,"div",69),k(10,St,9,8,"div",70),a()()}if(c&2){let i=f();d(7),Qe("ngModel",i.busquedaRepuesto),d(3),m("ngForOf",i.productosFiltrados)}}function At(c,p){if(c&1){let i=j();o(0,"div",81)(1,"span",82),s(2),a(),o(3,"input",83),C("change",function(n){let t=w(i).$implicit,r=f(2);return E(r.actualizarCantidadRepuesto(t,n.target.value))}),a(),o(4,"button",84),C("click",function(){let n=w(i).$implicit,t=f(2);return E(t.eliminarRepuesto(n))}),_(5,"ion-icon",85),a()()}if(c&2){let i=p.$implicit;d(2),h(i.nombre),d(),m("value",i.cantidad)("min",1)}}function It(c,p){if(c&1&&(o(0,"div",79)(1,"h4"),s(2,"Repuestos Seleccionados:"),a(),k(3,At,6,3,"div",80),a()),c&2){let i=f();d(3),m("ngForOf",i.repuestosSeleccionados)}}function Ft(c,p){c&1&&(o(0,"div",86),_(1,"ion-icon",25),o(2,"p"),s(3,"No hay repuestos seleccionados"),a(),o(4,"small"),s(5,"Selecciona repuestos del inventario o agrega manualmente"),a()())}function jt(c,p){if(c&1&&(o(0,"option",87),s(1),a()),c&2){let i=p.$implicit;m("value",i.valor),d(),le(" ",i.label," - ",i.descripcion," ")}}function Tt(c,p){c&1&&(o(0,"div",88)(1,"h3"),s(2,"Presupuesto Pendiente"),a(),o(3,"div",89),_(4,"ion-icon",90),o(5,"div",91)(6,"p"),s(7,"Se crear\xE1 autom\xE1ticamente un presupuesto para este trabajo."),a(),o(8,"small"),s(9,"Podr\xE1s editarlo despu\xE9s desde la secci\xF3n de presupuestos."),a()()()())}function Dt(c,p){if(c&1){let i=j();o(0,"div",92),_(1,"ion-icon",93),o(2,"span"),s(3,"\xC1rea de firma digital"),a(),o(4,"small"),s(5,"Haz clic para comenzar a firmar"),a(),o(6,"button",94),C("click",function(){w(i);let n=f();return E(n.iniciarFirma())}),_(7,"ion-icon",93),s(8," Comenzar Firma "),a()()}}function Vt(c,p){if(c&1){let i=j();o(0,"div",95),_(1,"canvas",96,0),o(3,"div",97)(4,"button",98),C("click",function(){w(i);let n=f();return E(n.limpiarFirma())}),_(5,"ion-icon",85),s(6," Limpiar "),a(),o(7,"button",99),C("click",function(){w(i);let n=f();return E(n.guardarFirma())}),_(8,"ion-icon",63),s(9," Guardar Firma "),a()()()}}function Nt(c,p){if(c&1){let i=j();o(0,"div",100),_(1,"img",101),o(2,"div",102)(3,"button",103),C("click",function(){w(i);let n=f();return E(n.editarFirma())}),_(4,"ion-icon",93),s(5," Editar "),a(),o(6,"button",104),C("click",function(){w(i);let n=f();return E(n.eliminarFirma())}),_(7,"ion-icon",85),s(8," Eliminar "),a()()()}if(c&2){let i=f();d(),m("src",i.firmaDataUrl,J)}}function Rt(c,p){if(c&1){let i=j();o(0,"div",51)(1,"div",52)(2,"h4"),s(3,"Agregar Repuesto"),a(),o(4,"button",53),C("click",function(){w(i);let n=f();return E(n.cerrarFormularioManual())}),_(5,"ion-icon",54),a()(),o(6,"div",55)(7,"div",56),_(8,"input",57),a(),o(9,"div",58),_(10,"input",105),a(),o(11,"div",60),_(12,"input",61),a(),o(13,"button",62),C("click",function(){w(i);let n=f();return E(n.agregarRepuestoDesdeFormulario())}),_(14,"ion-icon",63),a()()()}if(c&2){let i=f();d(6),m("formGroup",i.repuestoManualForm)}}function $t(c,p){if(c&1){let i=j();o(0,"div",71),C("click",function(){let n=w(i).$implicit,t=f(2);return E(t.agregarRepuesto(n))}),o(1,"div",72)(2,"div",106)(3,"span",107),s(4),B(5,"currency"),a()(),o(6,"span",73),s(7),a(),o(8,"div",74)(9,"span",108),s(10),a()()(),_(11,"ion-icon",77),a()}if(c&2){let i=p.$implicit;d(4),h(ae(5,4,i.precio_neto,"EUR","symbol","1.2-2")),d(3),h(i.nombre),d(3),le("Stock: ",i.cantidad_disponible," ",i.unidad,"")}}function Ht(c,p){if(c&1){let i=j();o(0,"div",64)(1,"div",65)(2,"h4"),s(3,"Seleccionar Repuestos"),a(),o(4,"button",53),C("click",function(){w(i);let n=f();return E(n.cerrarSelectorRepuestos())}),_(5,"ion-icon",54),a()(),o(6,"div",66)(7,"ion-input",67),en("ngModelChange",function(n){w(i);let t=f();return Ke(t.busquedaRepuesto,n)||(t.busquedaRepuesto=n),E(n)}),C("ionInput",function(n){w(i);let t=f();return E(t.filtrarProductos(n))}),a(),_(8,"ion-icon",68),a(),o(9,"div",69),k(10,$t,12,9,"div",70),a()()}if(c&2){let i=f();d(7),Qe("ngModel",i.busquedaRepuesto),d(3),m("ngForOf",i.productosFiltrados)}}function Lt(c,p){if(c&1&&(o(0,"div",110)(1,"strong"),s(2),B(3,"currency"),a()()),c&2){let i=f(2);d(2),U("Precio Total: ",ae(3,1,i.calcularPrecioTotalRepuestos(),"EUR","symbol","1.2-2"),"")}}function Bt(c,p){if(c&1){let i=j();o(0,"div",81)(1,"span",82),s(2),a(),o(3,"input",83),C("change",function(n){let t=w(i).$implicit,r=f(2);return E(r.actualizarCantidadRepuesto(t,n.target.value))}),a(),o(4,"button",84),C("click",function(){let n=w(i).$implicit,t=f(2);return E(t.eliminarRepuesto(n))}),_(5,"ion-icon",85),a()()}if(c&2){let i=p.$implicit;d(2),h(i.nombre),d(),m("value",i.cantidad)("min",1)}}function Ut(c,p){if(c&1&&(o(0,"div",79)(1,"h4"),s(2,"Repuestos Seleccionados:"),a(),k(3,Lt,4,6,"div",109)(4,Bt,6,3,"div",80),a()),c&2){let i=f();d(3),m("ngIf",i.repuestosSeleccionados.length>0),d(),m("ngForOf",i.repuestosSeleccionados)}}function qt(c,p){c&1&&(o(0,"div",86),_(1,"ion-icon",25),o(2,"p"),s(3,"No hay repuestos seleccionados"),a(),o(4,"small"),s(5,"Selecciona repuestos del inventario o agrega manualmente"),a()())}function Gt(c,p){if(c&1){let i=j();o(0,"button",114),C("click",function(){w(i);let n=f(2);return E(n.reintentarOperacion())}),_(1,"ion-icon",115),s(2," Reintentar "),a()}}function Yt(c,p){if(c&1&&(o(0,"div",111),_(1,"ion-icon",112),o(2,"span"),s(3),a(),k(4,Gt,3,0,"button",113),a()),c&2){let i=f();d(3),h(i.error),d(),m("ngIf",i.error.includes("conexi\xF3n")||i.error.includes("Sesi\xF3n expirada"))}}function Wt(c,p){c&1&&_(0,"ion-icon",116)}function Zt(c,p){c&1&&_(0,"ion-icon",117)}var ft=(()=>{let p=class p{constructor(e,n,t,r,g,l,M,b){this.fb=e,this.modalController=n,this.inventarioService=t,this.albaranesService=r,this.avisosService=g,this.presupuestosService=l,this.router=M,this.unifiedReconnectionService=b,this.loading=!1,this.error=null,this.productosInventario=[],this.productosFiltrados=[],this.busquedaRepuesto="",this.mostrarSelectorRepuestos=!1,this.repuestosSeleccionados=[],this.mostrarFormularioRepuesto=!1,this.firmaCapturada=!1,this.firmaDataUrl="",this.mostrarCanvas=!1,this.fechaActualFormateada="",this.estadosCierre=pt,this.isComponentActive=!0,console.log("HacerAlbaranComponent constructor called"),W({closeOutline:Jn,timeOutline:Me,cubeOutline:Be,addCircleOutline:Bn,close:te,searchOutline:st,trashOutline:pe,informationCircleOutline:qe,createOutline:Ce,checkmarkOutline:Yn,warningOutline:Oe,saveOutline:ct,refreshOutline:Z,checkmarkCircleOutline:ce,calendarOutline:Le,personOutline:Pe,pencilOutline:ze,documentTextOutline:se}),this.albaranForm=this.fb.group({fecha_trabajo:["",Y.required],fecha_cierre:["",Y.required],hora_entrada:["",Y.required],hora_salida:["",Y.required],descripcion_trabajo_realizado:["",Y.required],repuestos_utilizados:[[]],estado_cierre:["",Y.required],dni_cliente:[""],nombre_firma:[""],firma_cliente:[""],observaciones:[""]}),this.repuestoManualForm=this.fb.group({denominacion:["",Y.required],cantidad:["",[Y.required,Y.min(1)]],precio:["",[Y.required,Y.min(0)]]})}ngOnInit(){return L(this,null,function*(){console.log("\u{1F3AF} HacerAlbaranComponent ngOnInit - Aviso:",this.aviso),console.log("\u{1F3AF} Formulario inicializado:",this.albaranForm),this.setupReconnectionHandling(),this.establecerFechaActual(),this.establecerFechaTrabajo();try{yield this.cargarProductosInventario(),this.inicializarFormulario()}catch(e){console.error("Error al inicializar componente:",e)}})}ngAfterViewInit(){setTimeout(()=>{var e,n;(e=this.albaranForm.get("fecha_cierre"))!=null&&e.value||this.establecerFechaActual(),(n=this.albaranForm.get("fecha_trabajo"))!=null&&n.value||this.establecerFechaTrabajo()},100)}ngOnDestroy(){console.log("\u{1F9F9} HacerAlbaranComponent ngOnDestroy - Limpiando suscripciones"),this.isComponentActive=!1,this.reconnectionSubscription&&this.reconnectionSubscription.unsubscribe()}inicializarFormulario(){let e=this.generarHoraActual();this.albaranForm.patchValue({hora_entrada:e,hora_salida:e,repuestos_utilizados:[]}),this.repuestosSeleccionados=[],console.log("\u{1F50D} Formulario inicializado con valores por defecto")}cargarProductosInventario(){return new Promise((e,n)=>{this.inventarioService.getInventario(1,1e3,"","nombre","asc",!1).subscribe({next:t=>{this.productosInventario=t.inventario,this.productosFiltrados=[...this.productosInventario],console.log(" Inventario cargado:",this.productosInventario.length,"productos"),e()},error:t=>{console.error("Error al cargar productos del inventario:",t),n(t)}})})}filtrarProductos(e){var t;let n=((t=e==null?void 0:e.target)==null?void 0:t.value)||e||"";this.busquedaRepuesto=n,n.trim()?this.productosFiltrados=this.productosInventario.filter(r=>{var g;return r.nombre.toLowerCase().includes(n.toLowerCase())||r.codigo.toLowerCase().includes(n.toLowerCase())||(((g=r.descripcion)==null?void 0:g.toLowerCase())||"").includes(n.toLowerCase())}):this.productosFiltrados=[...this.productosInventario]}abrirSelectorRepuestos(){this.mostrarSelectorRepuestos=!0,this.productosFiltrados=[...this.productosInventario],this.busquedaRepuesto=""}cerrarSelectorRepuestos(){this.mostrarSelectorRepuestos=!1}agregarRepuesto(e){console.log("\u{1F50D} agregarRepuesto - Producto recibido:",e);let n=e.cantidad_disponible||0;if(n<=0){alert(`\u26A0\uFE0F No hay stock disponible para ${e.nombre}`);return}let t=this.repuestosSeleccionados.find(r=>r.nombre===e.nombre);if(t){let r=t.cantidad+1;if(r>n){alert(`\u26A0\uFE0F No hay suficiente stock. Disponible: ${n} ${e.unidad}, Solicitado: ${r} ${e.unidad}`);return}t.cantidad+=1,console.log("\u{1F50D} agregarRepuesto - Repuesto existente, cantidad aumentada a:",t.cantidad)}else{let r={nombre:e.nombre,cantidad:1,precio_neto:e.precio_neto||0,precio_pvp:e.pvp||e.precio_neto||0,unidad:e.unidad||"unidad",codigo:e.codigo||""};console.log("\u{1F50D} agregarRepuesto - Nuevo repuesto creado:",r),this.repuestosSeleccionados.push(r)}this.albaranForm.patchValue({repuestos_utilizados:this.repuestosSeleccionados}),console.log("\u{1F50D} agregarRepuesto - Repuestos seleccionados actualizados:",this.repuestosSeleccionados),this.cerrarSelectorRepuestos()}eliminarRepuesto(e){this.repuestosSeleccionados=this.repuestosSeleccionados.filter(n=>n!==e),this.albaranForm.patchValue({repuestos_utilizados:this.repuestosSeleccionados})}actualizarCantidadRepuesto(e,n){n>0&&(e.cantidad=n,this.albaranForm.patchValue({repuestos_utilizados:this.repuestosSeleccionados}))}mostrarFormularioManual(){this.mostrarFormularioRepuesto=!0,this.repuestoManualForm.reset({denominacion:"",cantidad:1,precio:0})}cerrarFormularioManual(){this.mostrarFormularioRepuesto=!1,this.repuestoManualForm.reset({denominacion:"",cantidad:1,precio:0})}agregarRepuestoDesdeFormulario(){var t,r,g;if(console.log("\u{1F50D} Debug - repuestoManualForm value:",this.repuestoManualForm.value),console.log("\u{1F50D} Debug - repuestoManualForm valid:",this.repuestoManualForm.valid),this.repuestoManualForm.invalid){if(this.repuestoManualForm.markAllAsTouched(),(t=this.repuestoManualForm.get("denominacion"))!=null&&t.invalid){alert("Por favor, introduce la denominaci\xF3n del repuesto");return}if((r=this.repuestoManualForm.get("cantidad"))!=null&&r.invalid){alert("La cantidad debe ser mayor a 0");return}if((g=this.repuestoManualForm.get("precio"))!=null&&g.invalid){alert("El precio debe ser mayor o igual a 0");return}return}let e=this.repuestoManualForm.value,n={nombre:e.denominacion.trim(),cantidad:e.cantidad,precio_neto:e.precio||0,precio_pvp:e.precio||0,unidad:"unidad",codigo:""};console.log("\u{1F50D} agregarRepuestoDesdeFormulario - Repuesto manual creado:",n),this.repuestosSeleccionados.push(n),this.albaranForm.patchValue({repuestos_utilizados:this.repuestosSeleccionados}),this.cerrarFormularioManual()}generarHoraActual(){let e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}establecerHoraActual(){let e=this.generarHoraActual();this.albaranForm.patchValue({hora_salida:e})}formatearFechaParaInput(e){let n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${n}-${t}-${r}`}establecerFechaActual(){let e=new Date,n=this.formatearFechaParaInput(e);this.albaranForm.patchValue({fecha_cierre:n}),this.fechaActualFormateada=n,console.log("\u{1F4C5} Fecha de cierre establecida:",n)}establecerFechaTrabajo(){let e=new Date,n=this.formatearFechaParaInput(e);this.albaranForm.patchValue({fecha_trabajo:n}),console.log("\u{1F4C5} Fecha de trabajo establecida:",n)}guardarAlbaran(){if(this.albaranForm.valid){this.loading=!0,this.error=null;let e={aviso_id:this.aviso.id,fecha_trabajo:this.albaranForm.value.fecha_trabajo,fecha_cierre:this.albaranForm.value.fecha_cierre,hora_entrada:this.albaranForm.value.hora_entrada,hora_salida:this.albaranForm.value.hora_salida,descripcion_trabajo_realizado:this.albaranForm.value.descripcion_trabajo_realizado,repuestos_utilizados:this.albaranForm.value.repuestos_utilizados,estado_cierre:this.albaranForm.value.estado_cierre,presupuesto_necesario:0,dni_cliente:this.albaranForm.value.dni_cliente,nombre_firma:this.albaranForm.value.nombre_firma,firma_cliente:this.albaranForm.value.firma_cliente,observaciones:this.albaranForm.value.observaciones};console.log("Datos del albar\xE1n:",e),this.albaranesService.crearAlbaran(e).subscribe({next:n=>{console.log("Albar\xE1n guardado exitosamente:",n),e.estado_cierre==="Presupuesto pendiente"?this.manejarPresupuestoPendiente(n):this.finalizarGuardadoAlbaran(n)},error:n=>{this.loading=!1,n.status===0||n.status===408||n.name==="TimeoutError"?(this.error="Error de conexi\xF3n. Verifica tu conexi\xF3n a internet e intenta de nuevo.",console.error("Error de conexi\xF3n al guardar albar\xE1n:",n)):n.status===401?(this.error="Sesi\xF3n expirada. Por favor, recarga la p\xE1gina e intenta de nuevo.",console.error("Error de autenticaci\xF3n al guardar albar\xE1n:",n)):(this.error="Error al guardar el albar\xE1n: "+(n.message||"Error desconocido"),console.error("Error al guardar albar\xE1n:",n))}})}else this.error="Por favor, complete todos los campos requeridos",this.marcarCamposComoTocados()}marcarCamposComoTocados(){Object.keys(this.albaranForm.controls).forEach(e=>{let n=this.albaranForm.get(e);n==null||n.markAsTouched()})}cancelar(){this.modalController.dismiss()}reintentarOperacion(){console.log("\u{1F504} Reintentando operaci\xF3n..."),this.error=null,this.albaranForm.valid?this.guardarAlbaran():this.error="Por favor, complete todos los campos requeridos antes de reintentar"}requierePresupuesto(){var e;return((e=this.albaranForm.get("estado_cierre"))==null?void 0:e.value)==="Presupuesto pendiente"}requiereOtraVisita(){var e;return((e=this.albaranForm.get("estado_cierre"))==null?void 0:e.value)==="Otra visita"}calcularPrecioTotalRepuestos(){return this.repuestosSeleccionados.reduce((e,n)=>e+n.precio_pvp*n.cantidad,0)}debugAlbaran(){console.log("Albar\xE1n en progreso:",this.albaranForm.value),console.log("Repuestos seleccionados:",this.repuestosSeleccionados),console.log("Precio total repuestos:",this.calcularPrecioTotalRepuestos())}iniciarFirma(){this.mostrarCanvas=!0,this.firmaCapturada=!1,this.firmaDataUrl="",setTimeout(()=>{this.inicializarSignaturePad()},100)}inicializarSignaturePad(){var n;if(!((n=this.signaturePadElement)!=null&&n.nativeElement)){console.warn("Canvas no encontrado");return}let e=this.signaturePadElement.nativeElement;import("./chunk-PGY3UNFJ.js").then(({default:t})=>{this.signaturePad=new t(e,{backgroundColor:"white",penColor:"black",minWidth:1,maxWidth:2.5,throttle:16,velocityFilterWeight:.7,dotSize:1}),this.ajustarCanvas(),window.addEventListener("resize",()=>this.ajustarCanvas())})}ajustarCanvas(){var l;if(!((l=this.signaturePadElement)!=null&&l.nativeElement)||!this.signaturePad)return;let e=this.signaturePadElement.nativeElement,n=e.parentElement;if(!n)return;let t=n.getBoundingClientRect(),r=Math.max(t.width-40,300),g=200;e.width=r,e.height=g,this.signaturePad.resizeCanvas()}limpiarFirma(){this.signaturePad&&this.signaturePad.clear()}guardarFirma(){this.signaturePad&&!this.signaturePad.isEmpty()?(this.firmaDataUrl=this.signaturePad.toDataURL(),this.firmaCapturada=!0,this.mostrarCanvas=!1,this.albaranForm.patchValue({firma_cliente:this.firmaDataUrl}),console.log("Firma guardada exitosamente")):console.warn("No hay firma para guardar")}editarFirma(){this.mostrarCanvas=!0,this.firmaCapturada=!1,setTimeout(()=>{this.signaturePad?this.signaturePad.clear():this.inicializarSignaturePad()},100)}eliminarFirma(){this.firmaCapturada=!1,this.firmaDataUrl="",this.mostrarCanvas=!1,this.signaturePad&&this.signaturePad.clear(),this.albaranForm.patchValue({firma_cliente:""}),console.log("Firma eliminada")}manejarPresupuestoPendiente(e){console.log("\u{1F504} Manejando albar\xE1n con presupuesto pendiente:",e),this.crearPresupuestoDesdeAlbaran(e)}crearPresupuestoDesdeAlbaran(e){console.log("\u{1F3AF} Creando presupuesto desde albar\xE1n:",e);let n=this.prepararMaterialesParaPresupuesto(),t={aviso_id:this.aviso.id,albaran_id:e.id,horas_estimadas:this.calcularHorasEstimadas(),total_estimado:this.calcularTotalEstimado(),materiales:n};console.log("\u{1F4CB} Datos para el presupuesto:",t),this.presupuestosService.crearPresupuesto(t).subscribe({next:r=>{console.log("\u2705 Presupuesto creado exitosamente:",r),this.loading=!1,this.modalController.dismiss({success:!0,albaran:e,presupuesto:r,mensaje:"Albar\xE1n guardado y presupuesto creado exitosamente",accion_realizada:"presupuesto_creado"},"confirm")},error:r=>{console.error("\u274C Error al crear presupuesto:",r),alert(`\u26A0\uFE0F El albar\xE1n se guard\xF3 correctamente, pero hubo un error al crear el presupuesto autom\xE1ticamente.

Puedes crear el presupuesto manualmente desde la secci\xF3n de presupuestos.`),this.finalizarGuardadoAlbaran(e)}})}prepararMaterialesParaPresupuesto(){return this.repuestosSeleccionados.map(e=>({material_id:e.codigo||this.generarIdTemporal(),cantidad_estimada:e.cantidad,precio_neto_al_momento:e.precio_neto,producto:{id:e.codigo||this.generarIdTemporal(),nombre:e.nombre,precio_neto:e.precio_neto,unidad:e.unidad}}))}calcularHorasEstimadas(){let e=this.albaranForm.value.hora_entrada,n=this.albaranForm.value.hora_salida;if(e&&n){let[t,r]=e.split(":").map(Number),[g,l]=n.split(":").map(Number),M=t*60+r,I=(g*60+l-M)/60;return Math.max(I,1)}return 2}calcularTotalEstimado(){let e=this.calcularPrecioTotalRepuestos(),r=this.calcularHorasEstimadas()*50;return e+r}generarIdTemporal(){return"temp_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}finalizarGuardadoAlbaran(e){this.avisosService.actualizarEstadoAutomatico(this.aviso.id).subscribe({next:n=>{this.loading=!1,console.log("Estado del aviso actualizado autom\xE1ticamente:",n),this.modalController.dismiss({success:!0,albaran:e,aviso:n,mensaje:"Albar\xE1n guardado exitosamente"},"confirm")},error:n=>{console.error("Error al actualizar estado del aviso:",n),this.loading=!1,this.modalController.dismiss({success:!0,albaran:e,mensaje:"Albar\xE1n guardado exitosamente"},"confirm")}})}setupReconnectionHandling(){console.log("\u{1F504} Configurando manejo de reconexi\xF3n en HacerAlbaranComponent"),this.reconnectionSubscription=this.unifiedReconnectionService.appResumed.subscribe({next:e=>{e&&this.isComponentActive&&(console.log("\u{1F504} App reanudada - verificando estado del componente"),this.handleAppResume())},error:e=>{console.error("\u274C Error en suscripci\xF3n de reconexi\xF3n:",e)}})}handleAppResume(){return L(this,null,function*(){if(!this.isComponentActive){console.log("\u{1F504} Componente no activo, saltando manejo de reconexi\xF3n");return}try{console.log("\u{1F504} HacerAlbaranComponent: App reanudada, verificando conexi\xF3n...");let e=this.albaranForm.value;Object.values(e).some(t=>t!=null&&t!==""&&(Array.isArray(t)?t.length>0:!0))&&(console.log("\u{1F504} Formulario tiene datos, evitando navegaci\xF3n autom\xE1tica"),this.loading&&(this.loading=!1,this.error="Conexi\xF3n restablecida. Puedes continuar con el albar\xE1n.",setTimeout(()=>{this.isComponentActive&&(this.error=null)},3e3)))}catch(e){console.error("\u274C Error en handleAppResume:",e)}})}shouldKeepComponentActive(){var t;let e=this.albaranForm.value;return e.descripcion_trabajo_realizado||((t=e.repuestos_utilizados)==null?void 0:t.length)>0||e.firma_cliente||e.observaciones}};p.\u0275fac=function(n){return new(n||p)(N(Tn),N(re),N(Ge),N(Ye),N(be),N(xe),N(fe),N($e))},p.\u0275cmp=Q({type:p,selectors:[["app-hacer-albaran"]],viewQuery:function(n,t){if(n&1&&he(yt,5),n&2){let r;ve(r=ye())&&(t.signaturePadElement=r.first)}},inputs:{aviso:"aviso"},decls:133,vars:19,consts:[["signaturePad",""],[1,"header-content"],[1,"close-button",3,"click"],["name","close-outline"],[1,"subtitle"],[1,"modal-body",2,"--padding-top","0","--padding-bottom","0"],[1,"modal-content",3,"ngSubmit","formGroup"],[1,"modal-grid"],[1,"form-section"],[1,"form-group"],[1,"required"],["type","date","formControlName","fecha_trabajo",1,"form-control",3,"click"],[1,"help-text"],["type","date","formControlName","fecha_cierre",1,"form-control",3,"click"],[1,"form-row"],[1,"form-group","half"],["type","time","formControlName","hora_entrada",1,"form-control"],[1,"input-with-button"],["type","time","formControlName","hora_salida",1,"form-control",3,"click"],["type","button",1,"add-button",3,"click"],["name","time-outline"],["formControlName","descripcion_trabajo_realizado","placeholder","Describe detalladamente el trabajo realizado...","rows","3",1,"form-control"],[1,"repuestos-section","mobile-only"],[1,"repuestos-actions"],["type","button",1,"btn-select-inventory",3,"click"],["name","cube-outline"],["type","button",1,"btn-add-manual",3,"click"],["name","add-circle-outline"],["class","formulario-repuesto-manual",4,"ngIf"],["class","inventory-selector",4,"ngIf"],["class","repuestos-list",4,"ngIf"],["class","repuestos-empty",4,"ngIf"],["formControlName","estado_cierre",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","presupuesto-info",4,"ngIf"],["formControlName","observaciones","placeholder","Observaciones adicionales...","rows","2",1,"form-control"],["type","text","formControlName","dni_cliente","placeholder","DNI del cliente",1,"form-control"],["type","text","formControlName","nombre_firma","placeholder","Nombre de la persona que firma",1,"form-control"],[1,"signature-area"],["class","signature-placeholder",4,"ngIf"],["class","signature-canvas-container",4,"ngIf"],["class","signature-preview",4,"ngIf"],[1,"images-section"],[1,"repuestos-container","desktop-only"],["class","error-message",4,"ngIf"],[1,"button-group"],["type","button",1,"btn","btn-outline",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["name","save-outline",4,"ngIf"],["name","refresh-outline","class","spinning",4,"ngIf"],[1,"formulario-repuesto-manual"],[1,"formulario-header"],["type","button",1,"btn-close",3,"click"],["name","close"],[1,"formulario-campos",3,"formGroup"],[1,"campo-input"],["type","text","formControlName","denominacion","placeholder","Denominaci\xF3n del repuesto",1,"input-denominacion"],[1,"campo-cantidad"],["type","number","formControlName","cantidad","placeholder","Cantidad","min","1",1,"input-cantidad"],[1,"campo-precio"],["type","number","formControlName","precio","placeholder","Precio \u20AC","min","0","step","0.01",1,"input-precio"],["type","button",1,"btn-agregar",3,"click"],["name","checkmark-outline"],[1,"inventory-selector"],[1,"selector-header"],[1,"search-container"],["type","text","placeholder","Buscar repuestos...",1,"search-input",3,"ngModelChange","ionInput","ngModel"],["name","search-outline"],[1,"products-list"],["class","product-item",3,"click",4,"ngFor","ngForOf"],[1,"product-item",3,"click"],[1,"product-info"],[1,"product-name"],[1,"product-details"],[1,"product-stock",3,"ngClass"],["class","stock-indicador",4,"ngIf"],["name","add-circle-outline",1,"add-icon"],[1,"stock-indicador"],[1,"repuestos-list"],["class","repuesto-item-compacto",4,"ngFor","ngForOf"],[1,"repuesto-item-compacto"],[1,"repuesto-denominacion"],["type","number",1,"cantidad-input-compacto",3,"change","value","min"],["type","button",1,"btn-remove-compacto",3,"click"],["name","trash-outline"],[1,"repuestos-empty"],[3,"value"],[1,"presupuesto-info"],[1,"info-box"],["name","information-circle-outline"],[1,"info-content"],[1,"signature-placeholder"],["name","create-outline"],["type","button",1,"btn-start-signature",3,"click"],[1,"signature-canvas-container"],[1,"signature-canvas"],[1,"signature-controls"],["type","button",1,"btn-clear",3,"click"],["type","button",1,"btn-save",3,"click"],[1,"signature-preview"],["alt","Firma del cliente",1,"firma-image",3,"src"],[1,"signature-actions"],["type","button",1,"btn-edit",3,"click"],["type","button",1,"btn-remove",3,"click"],["type","number","formControlName","cantidad","placeholder","Cantidad","min","0",1,"input-cantidad"],[1,"product-header"],[1,"product-price"],[1,"product-stock"],["class","precio-total",4,"ngIf"],[1,"precio-total"],[1,"error-message"],["name","warning-outline"],["type","button","class","btn-retry",3,"click",4,"ngIf"],["type","button",1,"btn-retry",3,"click"],["name","refresh-outline"],["name","save-outline"],["name","refresh-outline",1,"spinning"]],template:function(n,t){n&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"div",1)(3,"h2"),s(4,"Crear Albar\xE1n"),a(),o(5,"button",2),C("click",function(){return t.cancelar()}),_(6,"ion-icon",3),a()(),o(7,"p",4),s(8,"Crear albar\xE1n para el trabajo realizado"),a()()(),o(9,"ion-content",5)(10,"form",6),C("ngSubmit",function(){return t.guardarAlbaran()}),o(11,"div",7)(12,"div",8)(13,"h3"),s(14,"Fecha y Horarios"),a(),o(15,"div",9)(16,"label"),s(17,"Fecha del Trabajo "),o(18,"span",10),s(19,"*"),a()(),o(20,"input",11),C("click",function(){return t.establecerFechaTrabajo()}),a(),o(21,"small",12),s(22,"Fecha en que se realiz\xF3 el trabajo"),a()(),o(23,"div",9)(24,"label"),s(25,"Fecha de Cierre "),o(26,"span",10),s(27,"*"),a()(),o(28,"input",13),C("click",function(){return t.establecerFechaActual()}),a(),o(29,"small",12),s(30,"Fecha de cierre del albar\xE1n (autom\xE1tica)"),a()(),o(31,"div",14)(32,"div",15)(33,"label"),s(34,"Hora Entrada "),o(35,"span",10),s(36,"*"),a()(),_(37,"input",16),a(),o(38,"div",15)(39,"label"),s(40,"Hora Salida "),o(41,"span",10),s(42,"*"),a()(),o(43,"div",17)(44,"input",18),C("click",function(){return t.establecerHoraActual()}),a(),o(45,"button",19),C("click",function(){return t.establecerHoraActual()}),_(46,"ion-icon",20),s(47," Ahora "),a()()()(),o(48,"h3"),s(49,"Descripci\xF3n del Trabajo Realizado"),a(),o(50,"div",9)(51,"label"),s(52,"Descripci\xF3n "),o(53,"span",10),s(54,"*"),a()(),o(55,"textarea",21),s(56,"            "),a()(),o(57,"div",22)(58,"h3"),s(59,"Repuestos Utilizados"),a(),o(60,"div",23)(61,"button",24),C("click",function(){return t.abrirSelectorRepuestos()}),_(62,"ion-icon",25),s(63," Seleccionar del Inventario "),a(),o(64,"button",26),C("click",function(){return t.mostrarFormularioManual()}),_(65,"ion-icon",27),s(66," Agregar Manualmente "),a()(),k(67,Et,15,1,"div",28)(68,kt,11,2,"div",29)(69,It,4,1,"div",30)(70,Ft,6,0,"div",31),a(),o(71,"h3"),s(72,"Estado de Cierre"),a(),o(73,"div",9)(74,"label"),s(75,"Estado "),o(76,"span",10),s(77,"*"),a()(),o(78,"select",32)(79,"option",33),s(80,"Selecciona el estado"),a(),k(81,jt,2,3,"option",34),a()(),k(82,Tt,10,0,"div",35),o(83,"h3"),s(84,"Observaciones Adicionales"),a(),o(85,"div",9)(86,"label"),s(87,"Observaciones"),a(),o(88,"textarea",36),s(89,"            "),a()(),o(90,"h3"),s(91,"Identificaci\xF3n y Firma"),a(),o(92,"div",14)(93,"div",15)(94,"label"),s(95,"DNI Cliente"),a(),_(96,"input",37),a(),o(97,"div",15)(98,"label"),s(99,"Nombre Firma"),a(),_(100,"input",38),a()(),o(101,"div",9)(102,"label"),s(103,"Firma Digital"),a(),o(104,"div",39),k(105,Dt,9,0,"div",40)(106,Vt,10,0,"div",41)(107,Nt,9,1,"div",42),a()()()(),o(108,"div",43)(109,"div",44)(110,"h3"),s(111,"Repuestos Utilizados"),a(),o(112,"div",23)(113,"button",24),C("click",function(){return t.abrirSelectorRepuestos()}),_(114,"ion-icon",25),s(115," Seleccionar del Inventario "),a(),o(116,"button",26),C("click",function(){return t.mostrarFormularioManual()}),_(117,"ion-icon",27),s(118," Agregar Manualmente "),a()(),k(119,Rt,15,1,"div",28)(120,Ht,11,2,"div",29)(121,Ut,5,2,"div",30)(122,qt,6,0,"div",31),a()()()(),o(123,"ion-footer")(124,"ion-toolbar"),k(125,Yt,5,2,"div",45),o(126,"div",46)(127,"button",47),C("click",function(){return t.cancelar()}),s(128," Cancelar "),a(),o(129,"button",48),C("click",function(){return t.guardarAlbaran()}),k(130,Wt,1,0,"ion-icon",49)(131,Zt,1,0,"ion-icon",50),s(132),a()()()()),n&2&&(d(10),m("formGroup",t.albaranForm),d(57),m("ngIf",t.mostrarFormularioRepuesto),d(),m("ngIf",t.mostrarSelectorRepuestos),d(),m("ngIf",t.repuestosSeleccionados.length>0),d(),m("ngIf",t.repuestosSeleccionados.length===0&&!t.mostrarSelectorRepuestos),d(11),m("ngForOf",t.estadosCierre),d(),m("ngIf",t.requierePresupuesto()),d(23),m("ngIf",!t.firmaCapturada&&!t.mostrarCanvas),d(),m("ngIf",t.mostrarCanvas&&!t.firmaCapturada),d(),m("ngIf",t.firmaCapturada),d(12),m("ngIf",t.mostrarFormularioRepuesto),d(),m("ngIf",t.mostrarSelectorRepuestos),d(),m("ngIf",t.repuestosSeleccionados.length>0),d(),m("ngIf",t.repuestosSeleccionados.length===0&&!t.mostrarSelectorRepuestos),d(3),m("ngIf",t.error),d(4),m("disabled",!t.albaranForm.valid||t.loading),d(),m("ngIf",!t.loading),d(),m("ngIf",t.loading),d(),U(" ",t.loading?"Guardando...":"Guardar Albar\xE1n"," "))},dependencies:[ee,_e,ie,K,je,Vn,En,In,Fn,hn,zn,An,vn,yn,jn,Sn,kn,Dn,wn,ne,Nn,Te,Ve,Ne,De],styles:[`@charset "UTF-8";ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #fff;--border-color: #e5e7eb;--color: #111827}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;color:#111827}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#6b7280;margin-top:0;font-size:14px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;color:#6b7280;display:flex;align-items:center;justify-content:center}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]:hover{color:#111827}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}ion-content[_ngcontent-%COMP%]{--background: #fff;--padding-top: 0;--padding-bottom: 0;--padding-start: 0;--padding-end: 0;overflow-x:hidden}ion-content[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{flex:1;overflow:hidden;display:flex;flex-direction:column;min-height:0;overflow-x:hidden}ion-content[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{flex:1;overflow:auto;overflow-x:hidden;position:relative;min-height:0;height:100%}ion-content[_ngcontent-%COMP%]   .modal-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:0;height:100%;overflow:hidden;overflow-x:hidden}@media (max-width: 768px){ion-content[_ngcontent-%COMP%]   .modal-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:auto auto;height:auto;overflow:visible}}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #fff;--border-color: #e5e7eb}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 16px;background:#fef2f2;border:1px solid #FECACA;border-radius:6px;color:#dc2626;margin-bottom:20px;font-size:14px}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;color:#dc2626;flex-shrink:0}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;font-weight:500;flex:1}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:6px 12px;background:#dc2626;color:#fff;border:none;border-radius:4px;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s;margin-left:8px}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]:hover{background:#b91c1c}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px;color:#fff}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-size:14px;font-weight:500;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-outline[_ngcontent-%COMP%]{background:none;border:1px solid #d1d5db;color:#374151}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f8fafc;border-color:#9ca3af}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background-color:#2563eb;border:1px solid #2563eb;color:#fff}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1d4ed8;border-color:#1d4ed8}.form-section[_ngcontent-%COMP%]{padding:24px;border-right:1px solid #e5e7eb;overflow-y:auto;height:100%;max-height:100%}@media (max-width: 768px){.form-section[_ngcontent-%COMP%]{border-right:none;border-bottom:1px solid #e5e7eb;height:auto;max-height:none;overflow:visible;padding-bottom:30px}}.form-section[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:#d1d5db #f3f4f6}.form-section[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.form-section[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f3f4f6;border-radius:3px}.form-section[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:3px}.form-section[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}.images-section[_ngcontent-%COMP%]{padding:24px;background-color:#f9fafb;overflow-y:auto;height:100%;max-height:100%}@media (max-width: 768px){.images-section[_ngcontent-%COMP%]{height:auto;max-height:none;overflow:visible;min-height:300px;padding-bottom:80px}}.images-section[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:#d1d5db #f3f4f6}.images-section[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.images-section[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f3f4f6;border-radius:3px}.images-section[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:3px}.images-section[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}.images-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 20px;font-size:16px;color:#374151;font-weight:600}.form-group[_ngcontent-%COMP%]{position:relative;margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-size:14px;font-weight:500;color:#374151}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:#dc2626}.form-group.half[_ngcontent-%COMP%]{flex:1}.form-control[_ngcontent-%COMP%]{position:relative;width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;color:#111827;background-color:#fff;transition:border-color .2s}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 2px #2563eb1a}.form-control[_ngcontent-%COMP%]:disabled{background-color:#f9fafb;color:#6b7280;cursor:not-allowed}select.form-control[_ngcontent-%COMP%]{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:16px;padding-right:40px}select.form-control[_ngcontent-%COMP%]:disabled{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")}select.form-control[_ngcontent-%COMP%]::placeholder{color:#9ca3af}select.form-control[_ngcontent-%COMP%]   option[value=""][_ngcontent-%COMP%]{color:#9ca3af}select.form-control[_ngcontent-%COMP%]{padding-right:40px;background-color:#fafafb;border:1px solid transparent;padding-top:10px;padding-bottom:10px;border-radius:6px;font-size:14px;color:#111827;transition:border-color .2s}select.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb}input.form-control[_ngcontent-%COMP%]{padding-right:40px;background-color:#fafafb;border:1px solid transparent;padding-top:10px;padding-bottom:10px;border-radius:6px;font-size:14px;color:#111827;transition:border-color .2s}input.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb}textarea.form-control[_ngcontent-%COMP%]{position:relative;padding-right:40px;background-color:#fafafb;border:1px solid transparent;padding-top:10px;padding-bottom:10px;border-radius:6px;font-size:14px;color:#111827;transition:border-color .2s;resize:vertical;min-height:80px}textarea.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb}.character-count[_ngcontent-%COMP%]{margin-top:4px;text-align:right;font-size:12px;color:#6b7280;position:absolute;bottom:13px;right:13px}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:0;flex:1}.input-with-button[_ngcontent-%COMP%]{position:relative;display:flex;gap:8px}.input-with-button[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1}.input-with-button[_ngcontent-%COMP%]   .add-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:6px 10px;background:none;border:none;color:#4f46e5;font-size:14px;cursor:pointer;white-space:nowrap;border:1px solid #d2d2d2;position:absolute;right:8px;top:6px;border-radius:8px;font-weight:500}.input-with-button[_ngcontent-%COMP%]   .add-button[_ngcontent-%COMP%]:hover{color:#1d4ed8}.input-with-button[_ngcontent-%COMP%]   .add-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.help-text[_ngcontent-%COMP%]{display:block;font-size:11px;color:#6b7280;margin-top:4px;font-style:italic;line-height:1.4}.checkbox-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.checkbox-group[_ngcontent-%COMP%]   .checkbox-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer}.checkbox-group[_ngcontent-%COMP%]   .checkbox-container[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:16px;height:16px;margin:0}.checkbox-group[_ngcontent-%COMP%]   .checkbox-container[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]{font-size:14px;color:#374151}.checkbox-group[_ngcontent-%COMP%]   .helper-text[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;margin-left:24px}.imagen-upload-container[_ngcontent-%COMP%]{margin-bottom:24px}.imagen-upload-container[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]{border:2px dashed #d1d5db;border-radius:8px;padding:32px;text-align:center;cursor:pointer;transition:all .2s;background-color:#fff}.imagen-upload-container[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]:hover{border-color:#2563eb;background-color:#f8fafc}.imagen-upload-container[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#6b7280}.imagen-upload-container[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;font-size:16px;color:#374151}.imagen-upload-container[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#6b7280}.uploaded-files[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;font-size:16px;color:#374151}.file-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.file-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px;background-color:#fff;border-radius:6px;border:1px solid #e5e7eb}.file-item[_ngcontent-%COMP%]   .file-preview[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:4px;overflow:hidden;background-color:#f3f4f6}.file-item[_ngcontent-%COMP%]   .file-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.file-item[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{flex:1;min-width:0}.file-item[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{display:block;font-size:14px;color:#374151;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-item[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .file-size[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.file-item[_ngcontent-%COMP%]   .remove-file[_ngcontent-%COMP%]{background:none;border:none;padding:8px;color:#dc2626;cursor:pointer;display:flex;align-items:center;justify-content:center}.file-item[_ngcontent-%COMP%]   .remove-file[_ngcontent-%COMP%]:hover{color:#b91c1c}.file-item[_ngcontent-%COMP%]   .remove-file[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}@media (max-width: 768px){.modal-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:auto auto;height:auto;overflow:visible}.form-section[_ngcontent-%COMP%]{border-right:none;border-bottom:1px solid #e5e7eb;height:auto;max-height:none;overflow:visible;padding-bottom:30px}.images-section[_ngcontent-%COMP%]{display:none;height:auto;max-height:none;overflow:visible;min-height:300px;padding-bottom:80px}.form-control[_ngcontent-%COMP%]{font-size:16px;padding:12px}textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{font-size:14px!important;padding:12px}.input-with-button[_ngcontent-%COMP%]{flex-direction:column}.input-with-button[_ngcontent-%COMP%]   .add-button[_ngcontent-%COMP%]{position:static;margin-top:8px;width:100%;justify-content:center}}.loading-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:8px;font-size:12px;color:#6b7280}.loading-indicator[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-message[_ngcontent-%COMP%]{margin-top:8px;font-size:12px;color:#dc2626;display:flex;align-items:center;gap:4px}.error-message[_ngcontent-%COMP%]:before{content:"\\26a0";font-size:14px}.repuestos-section[_ngcontent-%COMP%], .repuestos-container[_ngcontent-%COMP%]{position:sticky;top:20px}.repuestos-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .repuestos-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{border-bottom:2px solid #10B981;padding-bottom:8px}@media (max-width: 1199px){.repuestos-section[_ngcontent-%COMP%]{position:static;top:auto}}.repuestos-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}.repuestos-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;width:100%}.repuestos-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.repuestos-actions[_ngcontent-%COMP%]   .btn-select-inventory[_ngcontent-%COMP%]{background:#2563eb;color:#fff}.repuestos-actions[_ngcontent-%COMP%]   .btn-select-inventory[_ngcontent-%COMP%]:hover{background:#1d4ed8}.repuestos-actions[_ngcontent-%COMP%]   .btn-add-manual[_ngcontent-%COMP%]{background:#10b981;color:#fff}.repuestos-actions[_ngcontent-%COMP%]   .btn-add-manual[_ngcontent-%COMP%]:hover{background:#059669}.repuestos-empty[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#9ca3af}.repuestos-empty[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:16px;opacity:.5}.repuestos-empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 8px;font-size:16px;font-weight:500;color:#6b7280}.repuestos-empty[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:13px;color:#9ca3af;line-height:1.4}.inventory-selector[_ngcontent-%COMP%]{background:#fff;padding:0;margin-bottom:15px;max-height:400px;overflow:hidden;display:flex;flex-direction:column}.inventory-selector[_ngcontent-%COMP%]   .selector-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}.inventory-selector[_ngcontent-%COMP%]   .selector-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#1f2937;font-size:16px;font-weight:600}.inventory-selector[_ngcontent-%COMP%]   .selector-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{background:none;border:none;color:#6b7280;font-size:20px;cursor:pointer;padding:4px;border-radius:4px;transition:all .2s}.inventory-selector[_ngcontent-%COMP%]   .selector-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#374151}.inventory-selector[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{position:relative;margin-bottom:5px}.inventory-selector[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{--background: #FAFAFB;--border-radius: 6px;--border-width: 1px;--border-color: transparent;--padding-start: 40px 12px 12px;--padding-end: 12px;--padding-top: 10px;--padding-left: 12px;--padding-bottom: 10px;--color: #111827;--placeholder-color: #9CA3AF;font-size:14px;transition:border-color .2s}.inventory-selector[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus-within{--border-color: #2563eb;--background: #fff;box-shadow:0 0 0 2px #2563eb1a}.inventory-selector[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#9ca3af;font-size:18px}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]{flex:1;max-height:250px;overflow-y:auto;border:1px solid #E5E7EB;border-radius:6px;background:#f9fafb}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid #E5E7EB;cursor:pointer;transition:all .2s}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]:hover{background:#f3f4f6}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-price[_ngcontent-%COMP%]{font-weight:600;color:#059669;font-size:13px}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]{flex:1}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-header[_ngcontent-%COMP%]   .product-code[_ngcontent-%COMP%]{font-size:11px;color:#6b7280;background:#e5e7eb;padding:2px 6px;border-radius:4px;font-weight:500}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-header[_ngcontent-%COMP%]   .product-price[_ngcontent-%COMP%]{font-weight:600;color:#059669;font-size:13px}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-weight:600;color:#1f2937;font-size:13px;margin-bottom:4px;display:block}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .product-stock[_ngcontent-%COMP%]{font-size:11px;color:#6b7280}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .product-stock.stock-bajo[_ngcontent-%COMP%]{color:#f59e0b;font-weight:600}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .product-stock.stock-critico[_ngcontent-%COMP%]{color:#ef4444;font-weight:700}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .product-stock[_ngcontent-%COMP%]   .stock-indicador[_ngcontent-%COMP%]{font-size:10px;font-style:italic;margin-left:4px}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .product-description[_ngcontent-%COMP%]{font-size:11px;color:#9ca3af;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.inventory-selector[_ngcontent-%COMP%]   .products-list[_ngcontent-%COMP%]   .product-item[_ngcontent-%COMP%]   .add-icon[_ngcontent-%COMP%]{color:#3b82f6;font-size:18px;margin-left:8px}.repuestos-list[_ngcontent-%COMP%]{margin-top:20px}.repuestos-list[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;color:#1f2937;font-size:16px;font-weight:600}.repuestos-list[_ngcontent-%COMP%]   .precio-total[_ngcontent-%COMP%]{background:#f0fdf4;border:1px solid #BBF7D0;border-radius:6px;padding:12px 16px;margin-bottom:16px;text-align:center}.repuestos-list[_ngcontent-%COMP%]   .precio-total[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#059669;font-size:16px}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 12px;background:#f0f9ff;border:1px solid #BAE6FD;border-radius:6px;margin-bottom:6px;width:100%}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .repuesto-denominacion[_ngcontent-%COMP%]{flex:1;font-weight:500;color:#0369a1;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .cantidad-input-compacto[_ngcontent-%COMP%]{width:50px;padding:4px 6px;border:1px solid #D1D5DB;border-radius:4px;font-size:12px;text-align:center;background-color:#fafafb;color:#111827}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .btn-remove-compacto[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626;border:none;padding:4px;border-radius:4px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;width:28px;height:28px}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .btn-remove-compacto[_ngcontent-%COMP%]:hover{background:#fecaca}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .btn-remove-compacto[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}.formulario-repuesto-manual[_ngcontent-%COMP%]{background:#fff;border:1px solid #E2E8F0;border-radius:8px;padding:16px;margin-bottom:16px;box-shadow:0 1px 3px #0000001a}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#1f2937;font-size:14px;font-weight:600}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{background:none;border:none;color:#6b7280;font-size:16px;cursor:pointer;padding:2px;border-radius:4px;transition:all .2s}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#374151}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-input[_ngcontent-%COMP%]{flex:1}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-input[_ngcontent-%COMP%]   .input-denominacion[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #D1D5DB;border-radius:6px;font-size:14px;background-color:#fafafb;color:#111827;transition:border-color .2s}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-input[_ngcontent-%COMP%]   .input-denominacion[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-input[_ngcontent-%COMP%]   .input-denominacion[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-cantidad[_ngcontent-%COMP%]   .input-cantidad[_ngcontent-%COMP%]{width:60px;padding:8px 6px;border:1px solid #D1D5DB;border-radius:6px;font-size:14px;text-align:center;background-color:#fafafb;color:#111827;transition:border-color .2s}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-cantidad[_ngcontent-%COMP%]   .input-cantidad[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-cantidad[_ngcontent-%COMP%]   .input-cantidad[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-precio[_ngcontent-%COMP%]   .input-precio[_ngcontent-%COMP%]{width:70px;padding:8px 6px;border:1px solid #D1D5DB;border-radius:6px;font-size:14px;text-align:center;background-color:#fafafb;color:#111827;transition:border-color .2s}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-precio[_ngcontent-%COMP%]   .input-precio[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-precio[_ngcontent-%COMP%]   .input-precio[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .btn-agregar[_ngcontent-%COMP%]{background:#10b981;color:#fff;border:none;padding:8px;border-radius:6px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;width:36px;height:36px}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .btn-agregar[_ngcontent-%COMP%]:hover{background:#059669}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .btn-agregar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.estados-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}@media (min-width: 1200px){.estados-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr);gap:20px}}.estado-option[_ngcontent-%COMP%]{border:2px solid #E5E7EB;border-radius:8px;padding:20px;cursor:pointer;transition:all .2s ease;position:relative;background:#fff}.estado-option[_ngcontent-%COMP%]:hover{border-color:#2563eb;transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.estado-option.selected[_ngcontent-%COMP%]{border-color:#2563eb;background:#eff6ff}.estado-option.selected[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#2563eb}.estado-option[_ngcontent-%COMP%]   .estado-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;font-size:16px;font-weight:600;color:#111827}.estado-option[_ngcontent-%COMP%]   .estado-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:13px;color:#6b7280;line-height:1.4}.estado-option[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;font-size:20px;color:#9ca3af}.signature-area[_ngcontent-%COMP%]{border:2px dashed #D1D5DB;border-radius:8px;padding:20px;text-align:center;background:#f9fafb;transition:all .2s ease;min-height:200px;display:flex;align-items:center;justify-content:center;position:relative}.signature-area[_ngcontent-%COMP%]:hover{border-color:#2563eb;background:#eff6ff}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;gap:16px}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-canvas[_ngcontent-%COMP%]{border:1px solid #E5E7EB;border-radius:6px;background:#fff;cursor:crosshair;touch-action:none}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   .btn-clear[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   .btn-clear[_ngcontent-%COMP%]:hover{background:#fecaca}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   .btn-save[_ngcontent-%COMP%]{background:#10b981;color:#fff}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   .btn-save[_ngcontent-%COMP%]:hover{background:#059669}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:16px}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .firma-image[_ngcontent-%COMP%]{max-width:100%;max-height:120px;border:1px solid #E5E7EB;border-radius:6px;background:#fff}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   .btn-edit[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   .btn-edit[_ngcontent-%COMP%]:hover{background:#bfdbfe}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]:hover{background:#fecaca}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px;color:#6b7280;margin-top:15px}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#9ca3af}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px;color:#9ca3af}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   .btn-start-signature[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 20px;background:#2563eb;color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;margin-top:8px}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   .btn-start-signature[_ngcontent-%COMP%]:hover{background:#1d4ed8}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   .btn-start-signature[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.mobile-only[_ngcontent-%COMP%]{display:block}.desktop-only[_ngcontent-%COMP%]{display:none}@media (min-width: 1200px){.mobile-only[_ngcontent-%COMP%]{display:none}.desktop-only[_ngcontent-%COMP%]{display:block}}@media (max-width: 768px){.modal-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:auto auto;height:auto;overflow:visible}.form-section[_ngcontent-%COMP%]{border-right:none;border-bottom:1px solid #e5e7eb;height:auto;max-height:none;overflow:visible;padding-bottom:30px}.images-section[_ngcontent-%COMP%]{height:auto;max-height:none;overflow:visible;min-height:300px;padding-bottom:80px}.form-control[_ngcontent-%COMP%]{font-size:16px;padding:12px}textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{font-size:14px!important;padding:12px}.input-with-button[_ngcontent-%COMP%]{flex-direction:column}.input-with-button[_ngcontent-%COMP%]   .add-button[_ngcontent-%COMP%]{position:static;margin-top:8px;width:100%;justify-content:center}.estados-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.estado-option[_ngcontent-%COMP%]{padding:16px}.estado-option[_ngcontent-%COMP%]   .estado-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:15px}.estado-option[_ngcontent-%COMP%]   .estado-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}.estado-option[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;top:12px;right:12px}.repuestos-actions[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.repuestos-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;justify-content:center}.repuestos-list[_ngcontent-%COMP%]{width:100%;overflow:hidden}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]{padding:6px 8px;gap:8px}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .repuesto-denominacion[_ngcontent-%COMP%]{font-size:13px}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .cantidad-input-compacto[_ngcontent-%COMP%]{width:45px;font-size:12px}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .btn-remove-compacto[_ngcontent-%COMP%]{width:24px;height:24px}.repuestos-list[_ngcontent-%COMP%]   .repuesto-item-compacto[_ngcontent-%COMP%]   .btn-remove-compacto[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:10px}.formulario-repuesto-manual[_ngcontent-%COMP%]{padding:12px;margin-bottom:12px}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]{flex-direction:row;gap:8px}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-input[_ngcontent-%COMP%]{width:100%}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-input[_ngcontent-%COMP%]   .input-denominacion[_ngcontent-%COMP%]{font-size:16px;padding:10px 12px}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-cantidad[_ngcontent-%COMP%]{align-self:flex-start}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-cantidad[_ngcontent-%COMP%]   .input-cantidad[_ngcontent-%COMP%]{width:60px;font-size:16px;padding:10px 6px}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-precio[_ngcontent-%COMP%]{align-self:flex-start}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .campo-precio[_ngcontent-%COMP%]   .input-precio[_ngcontent-%COMP%]{width:60px;font-size:16px;padding:10px 6px}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .btn-agregar[_ngcontent-%COMP%]{align-self:flex-end;width:40px;height:43px}.formulario-repuesto-manual[_ngcontent-%COMP%]   .formulario-campos[_ngcontent-%COMP%]   .btn-agregar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.signature-area[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px 10px;min-height:200px;border:2px dashed #D1D5DB;border-radius:8px;background:#f9fafb;transition:all .2s ease}.signature-area[_ngcontent-%COMP%]:hover{border-color:#2563eb;background:#eff6ff}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px;color:#6b7280;text-align:center}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#9ca3af}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px;color:#9ca3af}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   .btn-start-signature[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 20px;background:#2563eb;color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;margin-top:8px}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   .btn-start-signature[_ngcontent-%COMP%]:hover{background:#1d4ed8}.signature-area[_ngcontent-%COMP%]   .signature-placeholder[_ngcontent-%COMP%]   .btn-start-signature[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;gap:16px}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-canvas[_ngcontent-%COMP%]{border:1px solid #E5E7EB;border-radius:6px;background:#fff;cursor:crosshair;touch-action:none;width:100%;max-width:400px;height:200px}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   .btn-clear[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   .btn-clear[_ngcontent-%COMP%]:hover{background:#fecaca}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   .btn-save[_ngcontent-%COMP%]{background:#10b981;color:#fff}.signature-area[_ngcontent-%COMP%]   .signature-canvas-container[_ngcontent-%COMP%]   .signature-controls[_ngcontent-%COMP%]   .btn-save[_ngcontent-%COMP%]:hover{background:#059669}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;gap:16px}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .firma-image[_ngcontent-%COMP%]{max-width:100%;max-height:120px;border:1px solid #E5E7EB;border-radius:6px;background:#fff}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   .btn-edit[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   .btn-edit[_ngcontent-%COMP%]:hover{background:#bfdbfe}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626}.signature-area[_ngcontent-%COMP%]   .signature-preview[_ngcontent-%COMP%]   .signature-actions[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]:hover{background:#fecaca}}@media all and (display-mode: standalone){ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{padding-top:calc(16px + var(--ion-safe-area-top, 0px))}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{padding-bottom:calc(16px + var(--ion-safe-area-bottom, 0px))}}@supports (-webkit-touch-callout: none){@media all and (display-mode: standalone){ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{padding-top:calc(16px + var(--ion-safe-area-top, 0px))}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{padding-bottom:calc(16px + var(--ion-safe-area-bottom, 0px))}}}@supports not (-webkit-touch-callout: none){ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{padding-bottom:calc(16px + var(--ion-safe-area-bottom, 16px))}}.presupuesto-info[_ngcontent-%COMP%]{margin-bottom:20px}.presupuesto-info[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]{background:#f0f9ff;border:1px solid #BAE6FD;border-radius:8px;padding:16px;display:flex;align-items:flex-start;gap:12px;width:100%;box-sizing:border-box;overflow:hidden;word-wrap:break-word}.presupuesto-info[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#0ea5e9;font-size:20px;margin-top:1px;flex-shrink:0}.presupuesto-info[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]   .info-content[_ngcontent-%COMP%]{flex:1;min-width:0;overflow:hidden}.presupuesto-info[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 4px;color:#0c4a6e;font-size:14px;font-weight:500;line-height:1.4;word-wrap:break-word;overflow-wrap:break-word}.presupuesto-info[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#0369a1;font-size:12px;margin:0;display:block;line-height:1.3;word-wrap:break-word;overflow-wrap:break-word}`]});let c=p;return c})();var Ze=(()=>{let p=class p{constructor(e,n,t,r){this.avisosService=e,this.facturasService=n,this.presupuestosService=t,this.configuracionService=r}obtenerEstadoFlujo(e){return this.avisosService.getResumenCompletoAvisoDirect(e).pipe($(n=>({avisoId:e,estadoActual:n.estado,puedeCrearPresupuesto:this.puedeCrearPresupuesto(n),puedeAprobarPresupuesto:this.puedeAprobarPresupuesto(n),puedeFacturarPresupuesto:this.puedeFacturarPresupuesto(n),puedeFacturarTrabajos:this.puedeFacturarTrabajos(n),puedeCompletarAviso:this.puedeCompletarAviso(n),resumen:n})))}actualizarEstadoConFacturaAutomatica(e){return console.log("\u{1F504} Iniciando actualizaci\xF3n de estado con verificaci\xF3n de factura autom\xE1tica para aviso:",e),this.avisosService.actualizarEstadoAutomatico(e).pipe(H(n=>(console.log("\u{1F4CA} Estado del aviso actualizado:",{avisoId:n.id,estadoNuevo:n.estado}),n.estado==="Listo para facturar"?(console.log('\u{1F4B0} Estado "Listo para facturar" detectado, verificando si se debe generar factura autom\xE1ticamente...'),this.generarFacturaAutomatica(e).pipe($(t=>({aviso:n,facturaGenerada:t})),q(t=>(console.error("\u274C Error al generar factura autom\xE1tica:",t),V([{aviso:n,facturaGenerada:null,error:t.message}]))))):(console.log('\u2139\uFE0F Estado del aviso no es "Listo para facturar", no se genera factura autom\xE1tica'),V([{aviso:n,facturaGenerada:null}])))))}generarFacturaAutomatica(e){return console.log("\u{1F4B0} Iniciando generaci\xF3n autom\xE1tica de factura para aviso:",e),this.avisosService.getResumenCompletoAvisoDirect(e).pipe(H(n=>(console.log("\u{1F50D} Verificando condiciones para facturaci\xF3n autom\xE1tica:",{albaranesFinalizados:n.estadisticas.albaranesFinalizados,facturasPendientes:n.estadisticas.facturasPendientes,totalFacturas:n.estadisticas.totalFacturas,estado:n.estado}),!n.estadisticas.albaranesFinalizados||n.estadisticas.albaranesFinalizados===0?(console.log("\u26A0\uFE0F No hay albaranes finalizados para facturar autom\xE1ticamente"),V([{mensaje:"No hay albaranes finalizados para facturar"}])):n.estadisticas.facturasPendientes>0?(console.log("\u26A0\uFE0F Ya hay facturas pendientes, no se genera nueva factura autom\xE1tica"),V([{mensaje:"Ya existen facturas pendientes"}])):(console.log("\u2705 Condiciones cumplidas, procediendo a generar factura autom\xE1ticamente..."),this.facturarTrabajos(e).pipe(oe(()=>console.log("\u2705 Factura generada autom\xE1ticamente")),$(t=>(console.log("\u{1F4B0} Factura generada autom\xE1ticamente:",t),{mensaje:"Factura generada autom\xE1ticamente",factura:t,avisoId:e})),q(t=>(console.error("\u274C Error en generaci\xF3n autom\xE1tica de factura:",t),V([{mensaje:"Error al generar factura autom\xE1ticamente: "+t.message,error:!0}]))))))))}ejecutarFlujoCompleto(e,n=!0){return n?this.flujoConPresupuesto(e):this.flujoDirectoSinPresupuesto(e)}flujoDirectoSinPresupuesto(e){return this.avisosService.actualizarAvisoDirect(e,{estado:"En curso",requiere_presupuesto:!1}).pipe(oe(()=>console.log("\u2705 Aviso actualizado para trabajo directo")),H(()=>this.avisosService.getResumenCompletoAvisoDirect(e)),$(n=>({paso:"flujo_directo_iniciado",avisoId:e,mensaje:"Flujo directo iniciado. El t\xE9cnico puede comenzar a trabajar.",resumen:n})))}flujoConPresupuesto(e){return this.avisosService.actualizarAvisoDirect(e,{estado:"Pendiente de presupuesto",requiere_presupuesto:!0}).pipe(oe(()=>console.log("\u2705 Aviso marcado como requiere presupuesto")),H(()=>this.presupuestosService.crearPresupuesto({aviso_id:e,horas_estimadas:2,total_estimado:0})),oe(()=>console.log("\u2705 Presupuesto creado")),$(n=>({paso:"presupuesto_creado",avisoId:e,presupuestoId:n.id,mensaje:"Presupuesto creado. Pendiente de evaluaci\xF3n y aprobaci\xF3n.",presupuesto:n})))}aprobarPresupuesto(e){return this.presupuestosService.cambiarEstado(e,"Completado").pipe(H(n=>this.avisosService.actualizarAvisoDirect(n.aviso_id,{estado:"En curso"})),oe(()=>console.log("\u2705 Presupuesto aprobado y aviso en curso")),$(n=>({paso:"presupuesto_aprobado",avisoId:n.id,mensaje:"Presupuesto aprobado. El t\xE9cnico puede comenzar a trabajar.",aviso:n})))}facturarPresupuesto(e){return this.facturasService.crearFacturaDesdePresupuesto(e).pipe(oe(()=>console.log("\u2705 Factura creada desde presupuesto")),H(n=>this.avisosService.actualizarEstadoAutomatico(n.factura.aviso_id).pipe($(()=>n))),$(n=>({paso:"factura_desde_presupuesto",avisoId:n.factura.aviso_id,facturaId:n.factura.id,mensaje:"Factura generada autom\xE1ticamente desde presupuesto aprobado.",factura:n})))}facturarTrabajos(e){return console.log("\u{1F527} Iniciando facturaci\xF3n de trabajos para aviso:",e),this.avisosService.getResumenCompletoAvisoDirect(e).pipe(H(n=>{var g;if(console.log("\u{1F527} Resumen completo obtenido:",n),!n.estadisticas.albaranesFinalizados)throw new Error('No hay albaranes finalizados para facturar. Solo los albaranes marcados como "Finalizado" se pueden facturar autom\xE1ticamente.');let t=((g=n.trabajos)==null?void 0:g.filter(l=>{var M;return!l.albaran_id||!((M=l.albaran)!=null&&M.estado_cierre)||l.albaran.estado_cierre!=="Finalizado"}))||[];if(t.length>0){let l=t.map(M=>{var b,u;return`Trabajo #${(b=M.id)==null?void 0:b.substring(0,8)} (${M.descripcion}) - Estado: ${((u=M.albaran)==null?void 0:u.estado_cierre)||"Sin cerrar"}`}).join(", ");throw new Error(`No se puede facturar. Solo se pueden facturar trabajos con albaranes marcados como "Finalizado". Trabajos pendientes: ${l}`)}console.log("\u{1F527} Cliente del resumen:",n.cliente);let r=this.convertirDatosAFactura({avisoId:e,cliente:n.cliente,resumen:n});return this.facturasService.getSiguienteNumero().pipe(H(l=>(r.numero_factura=l,console.log("\u{1F527} N\xFAmero de factura generado:",l),this.facturasService.crearFactura(r))))}),oe(()=>console.log("\u2705 Factura creada desde trabajos realizados")),H(()=>this.avisosService.getResumenCompletoAvisoDirect(e)),$(n=>({paso:"factura_creada_desde_trabajos",avisoId:e,mensaje:"Factura creada exitosamente desde trabajos realizados",resumen:n})))}verificarEstadoFactura(e,n){return this.avisosService.getResumenCompletoAvisoDirect(n).pipe(H(t=>t.estado==="Completado"?this.facturasService.cambiarEstado(e,"Completado"):t.estado==="Listo para facturar"?this.facturasService.cambiarEstado(e,"En curso"):V([{id:e,estado:"Pendiente"}])))}sincronizarEstadosFacturas(e){return this.avisosService.getResumenCompletoAvisoDirect(e).pipe(H(n=>{if(!n.facturas||n.facturas.length===0)return V([{mensaje:"No hay facturas para sincronizar"}]);let t;n.estado==="Completado"?t="Completado":n.estado==="Listo para facturar"?t="En curso":t="Pendiente";let r=n.facturas.map(g=>this.facturasService.cambiarEstado(g.id,t));return ue(r).pipe($(()=>({mensaje:`Estados de ${n.facturas.length} factura(s) sincronizados a "${t}"`,avisoId:e,nuevoEstado:t})))}))}completarAviso(e){return this.avisosService.getResumenCompletoAvisoDirect(e).pipe(H(n=>{var r;if(!this.puedeCompletarAviso(n))throw new Error("No se puede completar el aviso. Verifica que haya trabajos finalizados y facturas generadas.");let t=((r=n.trabajos)==null?void 0:r.filter(g=>{var l;return!g.albaran_id||!((l=g.albaran)!=null&&l.estado_cierre)||g.albaran.estado_cierre==="Otra visita"}))||[];if(t.length>0){let g=t.map(l=>{var M,b;return`Trabajo #${(M=l.id)==null?void 0:M.substring(0,8)} (${l.descripcion}) - Estado: ${((b=l.albaran)==null?void 0:b.estado_cierre)||"Sin cerrar"}`}).join(", ");throw new Error(`No se puede completar el aviso. Los siguientes trabajos necesitan albaranes cerrados (Finalizado o Presupuesto pendiente): ${g}`)}return this.avisosService.actualizarAvisoDirect(e,{estado:"Completado",fecha_finalizacion:new Date}).pipe(H(g=>{if(n.facturas&&n.facturas.length>0){let l=n.facturas.map(M=>this.facturasService.cambiarEstado(M.id,"Completado"));return ue(l).pipe($(()=>g))}return V([g])}))}),oe(()=>console.log("\u2705 Aviso completado exitosamente")),H(()=>this.avisosService.getResumenCompletoAvisoDirect(e)),$(n=>({paso:"aviso_completado",avisoId:e,mensaje:"Aviso marcado como completado",resumen:n})))}obtenerAccionesDisponibles(e){return this.obtenerEstadoFlujo(e).pipe($(n=>{let t=[];return n.puedeFacturarTrabajos&&t.push("facturar_trabajos"),n.puedeCompletarAviso&&t.push("completar_aviso"),t}))}puedeCrearPresupuesto(e){return!1}puedeAprobarPresupuesto(e){return!1}puedeFacturarPresupuesto(e){return!1}puedeFacturarTrabajos(e){return e.estadisticas.albaranesFinalizados>0&&e.estadisticas.facturasPendientes===0}puedeCompletarAviso(e){let n=e.estadisticas.albaranesFinalizados>0&&e.estadisticas.totalFacturas>0,t=e.estadisticas.albaranesPresupuestoPendiente>0;return e.estadisticas.albaranesOtraVisita>0?!1:n||t}convertirDatosAFactura(e){var u,I,x;if(console.log("\u{1F527} Datos de factura recibidos:",e),!e.cliente||!e.cliente.id)throw new Error("Datos de cliente incompletos para crear factura");let n=[],t=0;if(e.resumen.albaranes&&e.resumen.albaranes.length>0&&(console.log("\u{1F527} Calculando horas totales de todos los albaranes:",e.resumen.albaranes.length,"albaranes"),e.resumen.albaranes.forEach((O,T)=>{if(O.hora_entrada&&O.hora_salida){let z=new Date(`2000-01-01T${O.hora_entrada}`),S=(new Date(`2000-01-01T${O.hora_salida}`).getTime()-z.getTime())/(1e3*60*60),A=Math.max(0,S);console.log(`\u{1F527} Albar\xE1n #${T+1}: ${O.hora_entrada} - ${O.hora_salida} = ${A.toFixed(2)} horas`),t+=A}}),console.log("\u{1F527} Horas totales acumuladas:",t.toFixed(2),"horas")),t>0){let O=this.configuracionService.getPrecioHoraManoObraSync();n.push({tipo:"mano_obra",nombre:"Mano de obra",cantidad:t,precio_neto:O,precio_pvp:O,descripcion:`Trabajo realizado: ${t.toFixed(2)} horas (${((u=e.resumen.albaranes)==null?void 0:u.length)||0} albaranes)`})}let r=new Map;e.resumen.albaranes&&e.resumen.albaranes.length>0&&(console.log("\u{1F527} Consolidando repuestos de todos los albaranes..."),e.resumen.albaranes.forEach((O,T)=>{console.log(`\u{1F527} Procesando albar\xE1n #${T+1}:`,O.id),O.repuestos&&O.repuestos.length>0&&O.repuestos.forEach(z=>{if(z&&z.cantidad&&z.cantidad>0){let v=z.nombre||"Repuesto sin nombre",S=v.toLowerCase();if(r.has(S)){let A=r.get(S);A.cantidad_total+=parseFloat(z.cantidad),A.precio_total+=parseFloat(z.precio_pvp||0)*parseFloat(z.cantidad),A.albaranes.push(T+1),console.log(`\u{1F527} Repuesto consolidado: ${v} - Cantidad total: ${A.cantidad_total}`)}else r.set(S,{nombre:v,cantidad_total:parseFloat(z.cantidad),precio_unitario:parseFloat(z.precio_neto||0),precio_total:parseFloat(z.precio_pvp||0)*parseFloat(z.cantidad),unidad:z.unidad||"unidad",albaranes:[T+1]}),console.log(`\u{1F527} Nuevo repuesto: ${v} - Cantidad: ${z.cantidad}`)}}),(!O.repuestos||O.repuestos.length===0)&&O.repuestos_utilizados&&Array.isArray(O.repuestos_utilizados)&&(console.log(`\u{1F527} Procesando repuestos_utilizados legacy para albar\xE1n #${T+1}`),O.repuestos_utilizados.forEach(z=>{if(z){let v,S=1,A=0;if(typeof z=="string")v=z;else if(typeof z=="object"&&z.nombre)v=z.nombre,S=Number(z.cantidad)||1,A=Number(z.precio_pvp)||Number(z.precio_neto)||0;else try{let P=typeof z=="string"?JSON.parse(z):z;v=P.nombre||"Repuesto sin nombre",S=Number(P.cantidad)||1,A=Number(P.precio_pvp)||Number(P.precio_neto)||0}catch{console.warn("\u26A0\uFE0F Repuesto mal formateado, ignorando:",z);return}let y=v.toLowerCase();if(r.has(y)){let P=r.get(y);P.cantidad_total+=S,P.precio_total+=A*S,P.albaranes.push(T+1),console.log(`\u{1F527} Repuesto legacy consolidado: ${v} - Cantidad total: ${P.cantidad_total}`)}else r.set(y,{nombre:v,cantidad_total:S,precio_unitario:A,precio_total:A*S,unidad:"unidad",albaranes:[T+1]}),console.log(`\u{1F527} Nuevo repuesto legacy: ${v} - Cantidad: ${S}`)}}))})),r.forEach((O,T)=>{let z=O.cantidad_total>0?O.precio_total/O.cantidad_total:O.precio_unitario;n.push({tipo:"repuesto",nombre:O.nombre,cantidad:O.cantidad_total,precio_neto:O.precio_unitario||0,precio_pvp:z||O.precio_unitario||0,descripcion:`${O.nombre} - ${O.cantidad_total} ${O.unidad} (usado en albaranes: ${O.albaranes.join(", ")})`}),console.log(`\u{1F527} L\xEDnea de factura creada: ${O.nombre} x${O.cantidad_total} = \u20AC${(z*O.cantidad_total).toFixed(2)}`)});let g=n.reduce((O,T)=>{let z=(T.precio_pvp||0)*(T.cantidad||0);return O+z},0),l=((x=(I=this.configuracionService.getConfiguracionActual())==null?void 0:I.facturacion)==null?void 0:x.iva_por_defecto)||21,M=+(g*(l/100)).toFixed(2),b=+(g+M).toFixed(2);return console.log("\u{1F527} L\xEDneas de factura consolidadas:",n.length,"l\xEDneas"),console.log("\u{1F527} Subtotal consolidado:",g.toFixed(2),"\u20AC"),console.log("\u{1F527} IVA:",M.toFixed(2),"\u20AC"),console.log("\u{1F527} Total consolidado:",b.toFixed(2),"\u20AC"),n.forEach((O,T)=>{console.log(`\u{1F527} L\xEDnea ${T+1}:`,{tipo:O.tipo,nombre:O.nombre,cantidad:O.cantidad,precio_neto:O.precio_neto,precio_pvp:O.precio_pvp,descripcion:O.descripcion})}),{cliente_id:e.cliente.id,nombre_cliente:e.cliente.nombre_completo,direccion_cliente:e.cliente.direccion||"",cif_cliente:e.cliente.cif||"",email_cliente:e.cliente.email||"",aviso_id:e.avisoId,fecha_emision:new Date().toISOString().split("T")[0],estado:"Pendiente",subtotal:g,iva:M,total:b,lineas:n}}};p.\u0275fac=function(n){return new(n||p)(X(be),X($n),X(xe),X(Re))},p.\u0275prov=me({token:p,factory:p.\u0275fac,providedIn:"root"});let c=p;return c})();function Jt(c,p){c&1&&(o(0,"div",4),_(1,"ion-icon",5),o(2,"span",6),s(3,"Cargando estado del flujo..."),a(),o(4,"span",7),s(5,"Cargando..."),a()())}function Qt(c,p){if(c&1){let i=j();o(0,"div",8),_(1,"ion-icon",9),o(2,"span",10),s(3),a(),o(4,"button",11),C("click",function(){w(i);let n=f();return E(n.recargar())}),_(5,"ion-icon",12),o(6,"span",6),s(7,"Reintentar"),a(),o(8,"span",7),s(9,"Reintentar"),a()()()}if(c&2){let i=f();d(3),h(i.error)}}function Kt(c,p){if(c&1){let i=j();o(0,"div",19)(1,"div",20),_(2,"ion-icon",21),o(3,"span",22),s(4),a()(),o(5,"button",23),C("click",function(){w(i);let n=f(2);return E(n.recargar())}),_(6,"ion-icon",12),a()()}if(c&2){let i=f(2);d(),m("ngClass",i.getEstadoClass()),d(),m("name",i.getEstadoIcon()),d(2),h(i.estadoFlujo.estadoActual)}}function eo(c,p){if(c&1){let i=j();o(0,"button",28),C("click",function(){let n=w(i).$implicit,t=f(3);return E(t.ejecutarAccion(n))}),_(1,"ion-icon",21),o(2,"span",29),s(3),a()()}if(c&2){let i=p.$implicit,e=f(3);m("disabled",e.loading)("title",e.getAccionTexto(i)),d(),m("name",e.getAccionIcon(i)),d(2),h(e.getAccionTexto(i))}}function no(c,p){if(c&1&&(o(0,"div",24)(1,"h4",25),s(2,"Acciones disponibles:"),a(),o(3,"div",26),k(4,eo,4,4,"button",27),a()()),c&2){let i=f(2);d(4),m("ngForOf",i.accionesDisponibles)}}function to(c,p){c&1&&(o(0,"div",30),_(1,"ion-icon",31),o(2,"span",32),s(3,"Aviso completado"),a()())}function oo(c,p){c&1&&(o(0,"div",35),_(1,"ion-icon",36),o(2,"span",37),s(3,"Esperando cierre de albaranes o facturaci\xF3n"),a()())}function ao(c,p){if(c&1&&(o(0,"div",33),k(1,oo,4,0,"div",34),a()),c&2){let i=f(2);d(),m("ngIf",i.accionesDisponibles.length===0&&!i.estadoFlujo.puedeCrearPresupuesto&&i.estadoFlujo.estadoActual!=="Completado")}}function io(c,p){if(c&1&&(o(0,"div",13)(1,"div",14),k(2,Kt,7,3,"div",15),a(),k(3,no,5,1,"div",16)(4,to,4,0,"div",17)(5,ao,2,1,"div",18),a()),c&2){let i=f();d(2),m("ngIf",i.estadoFlujo.estadoActual!=="Completado"),d(),m("ngIf",i.accionesDisponibles.length>0&&i.estadoFlujo.estadoActual!=="Completado"),d(),m("ngIf",i.estadoFlujo.estadoActual==="Completado"),d(),m("ngIf",i.estadoFlujo.estadoActual==="No visitado"||i.estadoFlujo.estadoActual==="Visitado pendiente")}}var gn=(()=>{let p=class p{constructor(e){this.flujoService=e,this.accionEjecutada=new bn,this.estadoFlujo=null,this.accionesDisponibles=[],this.loading=!1,this.error=null,this.destroy$=new Ae,W({documentTextOutline:se,checkmarkCircleOutline:ce,timeOutline:Me,receiptOutline:rt,createOutline:Ce,eyeOutline:Ue,arrowForwardOutline:qn,warningOutline:Oe,refreshOutline:Z})}ngOnInit(){this.avisoId&&this.cargarEstadoFlujo()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarEstadoFlujo(){this.loading=!0,this.error=null,this.flujoService.obtenerEstadoFlujo(this.avisoId).pipe(G(this.destroy$)).subscribe({next:e=>{this.estadoFlujo=e,this.cargarAccionesDisponibles(),this.loading=!1},error:e=>{console.error("Error al cargar estado del flujo:",e),this.error="Error al cargar el estado del flujo",this.loading=!1}})}cargarAccionesDisponibles(){this.flujoService.obtenerAccionesDisponibles(this.avisoId).pipe(G(this.destroy$)).subscribe({next:e=>{this.accionesDisponibles=e},error:e=>{console.error("Error al cargar acciones:",e)}})}recargarFlujo(){console.log("\u{1F504} Recargando flujo desde componente padre..."),this.cargarEstadoFlujo()}ejecutarAccion(e){var t,r,g,l,M,b;this.loading=!0,this.error=null;let n;switch(e){case"crear_presupuesto":n=this.flujoService.ejecutarFlujoCompleto(this.avisoId,!0);break;case"aprobar_presupuesto":let u=(g=(r=(t=this.estadoFlujo)==null?void 0:t.resumen)==null?void 0:r.presupuesto)==null?void 0:g.id;u&&(n=this.flujoService.aprobarPresupuesto(u));break;case"facturar_presupuesto":let I=(b=(M=(l=this.estadoFlujo)==null?void 0:l.resumen)==null?void 0:M.presupuesto)==null?void 0:b.id;I&&(n=this.flujoService.facturarPresupuesto(I));break;case"facturar_trabajos":n=this.flujoService.facturarTrabajos(this.avisoId);break;case"completar_aviso":this.completarAviso();break;default:this.loading=!1;return}n&&n.pipe(G(this.destroy$)).subscribe({next:u=>{console.log("Acci\xF3n ejecutada:",u),this.accionEjecutada.emit(u),this.cargarEstadoFlujo(),this.cargarAccionesDisponibles(),this.loading=!1},error:u=>{console.error("Error al ejecutar acci\xF3n:",u),this.error=`Error al ejecutar ${e}: ${u.message}`,this.loading=!1}})}iniciarFlujoDirecto(){this.loading=!0,this.flujoService.ejecutarFlujoCompleto(this.avisoId,!1).pipe(G(this.destroy$)).subscribe({next:e=>{console.log("Flujo directo iniciado:",e),this.accionEjecutada.emit(e),this.cargarEstadoFlujo(),this.cargarAccionesDisponibles(),this.loading=!1},error:e=>{console.error("Error al iniciar flujo directo:",e),this.error=`Error al iniciar flujo directo: ${e.message}`,this.loading=!1}})}completarAviso(){if(!this.avisoId){console.error("No hay aviso seleccionado para completar");return}console.log("\u{1F504} Completando aviso:",this.avisoId),this.loading=!0,this.flujoService.completarAviso(this.avisoId).subscribe({next:e=>{console.log("\u2705 Aviso completado exitosamente:",e),this.loading=!1,this.mostrarMensaje("Aviso completado exitosamente","success"),this.cargarEstadoFlujo(),this.cargarAccionesDisponibles(),this.accionEjecutada.emit(e)},error:e=>{console.error("\u274C Error al completar aviso:",e),this.loading=!1,this.mostrarMensaje(e.message||"Error al completar el aviso. Verifica que haya trabajos realizados y facturas generadas.","error")}})}mostrarMensaje(e,n="info"){console.log(`[${n.toUpperCase()}] ${e}`)}getEstadoIcon(){if(!this.estadoFlujo)return"time-outline";switch(this.estadoFlujo.estadoActual){case"No visitado":return"time-outline";case"Visitado pendiente":return"eye-outline";case"Pendiente de presupuesto":return"document-text-outline";case"En curso":return"create-outline";case"Completado":return"checkmark-circle-outline";default:return"time-outline"}}getEstadoClass(){if(!this.estadoFlujo)return"pendiente";switch(this.estadoFlujo.estadoActual){case"Pendiente":return"pendiente";case"Pendiente de presupuesto":return"presupuesto";case"En curso":return"en-curso";case"Listo para facturar":return"listo-facturar";case"Completado":return"completado";case"Cancelado":return"cancelado";default:return"pendiente"}}getAccionTexto(e){switch(e){case"crear_presupuesto":return"Crear Presupuesto";case"aprobar_presupuesto":return"Aprobar Presupuesto";case"facturar_presupuesto":return"Generar Factura desde Presupuesto";case"facturar_trabajos":return"Facturar Trabajos Realizados";case"completar_aviso":return"Completar Aviso";default:return e}}getAccionIcon(e){switch(e){case"crear_presupuesto":return"document-text-outline";case"aprobar_presupuesto":return"checkmark-circle-outline";case"facturar_presupuesto":case"facturar_trabajos":return"receipt-outline";case"completar_aviso":return"checkmark-circle-outline";default:return"arrow-forward-outline"}}recargar(){this.cargarEstadoFlujo()}};p.\u0275fac=function(n){return new(n||p)(N(Ze))},p.\u0275cmp=Q({type:p,selectors:[["app-flujo-estado"]],inputs:{avisoId:"avisoId"},outputs:{accionEjecutada:"accionEjecutada"},decls:4,vars:3,consts:[[1,"flujo-estado-container"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","flujo-content",4,"ngIf"],[1,"loading-state"],["name","refresh-outline",1,"spinning"],[1,"desktop-only"],[1,"mobile-only"],[1,"error-state"],["name","warning-outline"],[1,"error-text"],[1,"btn-retry",3,"click"],["name","refresh-outline"],[1,"flujo-content"],[1,"estado-actual"],["class","estado-header",4,"ngIf"],["class","acciones-disponibles",4,"ngIf"],["class","aviso-completado",4,"ngIf"],["class","flujo-inicial",4,"ngIf"],[1,"estado-header"],[1,"estado-badge",3,"ngClass"],[3,"name"],[1,"estado-text"],["title","Actualizar estado",1,"btn-refresh",3,"click"],[1,"acciones-disponibles"],[1,"section-title"],[1,"acciones-grid"],["class","btn-accion",3,"disabled","title","click",4,"ngFor","ngForOf"],[1,"btn-accion",3,"click","disabled","title"],[1,"accion-text"],[1,"aviso-completado"],["name","checkmark-circle-outline",1,"complete-icon"],[1,"complete-text"],[1,"flujo-inicial"],["class","sin-acciones",4,"ngIf"],[1,"sin-acciones"],["name","time-outline",1,"waiting-icon"],[1,"waiting-text"]],template:function(n,t){n&1&&(o(0,"div",0),k(1,Jt,6,0,"div",1)(2,Qt,10,1,"div",2)(3,io,6,4,"div",3),a()),n&2&&(d(),m("ngIf",t.loading),d(),m("ngIf",t.error&&!t.loading),d(),m("ngIf",t.estadoFlujo&&!t.loading&&!t.error))},dependencies:[ee,_e,ie,K,ne],styles:[".flujo-estado-container[_ngcontent-%COMP%]{background:#fff;border-radius:12px;border:1px solid #E2E8F0;overflow:hidden;box-shadow:0 1px 3px #0000001a}.desktop-only[_ngcontent-%COMP%]{display:inline}.mobile-only[_ngcontent-%COMP%]{display:none}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:24px;text-align:center;color:#64748b;font-size:14px}.loading-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#4f46e5}.loading-state.error-state[_ngcontent-%COMP%], .error-state.error-state[_ngcontent-%COMP%]{color:#dc2626}.loading-state.error-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state.error-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#dc2626}.error-text[_ngcontent-%COMP%]{word-break:break-word;line-height:1.4}.btn-retry[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#f1f5f9;border:1px solid #CBD5E1;border-radius:8px;font-size:12px;color:#475569;cursor:pointer;transition:all .2s ease}.btn-retry[_ngcontent-%COMP%]:hover{background:#e2e8f0;border-color:#94a3b8}.btn-retry[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.flujo-content[_ngcontent-%COMP%]{padding:20px}.estado-actual[_ngcontent-%COMP%]   .estado-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.estado-actual[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;border-radius:20px;font-size:14px;font-weight:500}.estado-actual[_ngcontent-%COMP%]   .estado-badge.pendiente[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.estado-actual[_ngcontent-%COMP%]   .estado-badge.pendiente[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#d97706}.estado-actual[_ngcontent-%COMP%]   .estado-badge.presupuesto[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.estado-actual[_ngcontent-%COMP%]   .estado-badge.presupuesto[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#3b82f6}.estado-actual[_ngcontent-%COMP%]   .estado-badge.en-curso[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.estado-actual[_ngcontent-%COMP%]   .estado-badge.en-curso[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#22c55e}.estado-actual[_ngcontent-%COMP%]   .estado-badge.completado[_ngcontent-%COMP%]{background:#ecfdf5;color:#14532d}.estado-actual[_ngcontent-%COMP%]   .estado-badge.completado[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#10b981}.estado-actual[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.estado-actual[_ngcontent-%COMP%]   .estado-text[_ngcontent-%COMP%]{font-weight:500}.estado-actual[_ngcontent-%COMP%]   .btn-refresh[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;background:#f8fafc;border:1px solid #E2E8F0;border-radius:8px;cursor:pointer;transition:all .2s ease}.estado-actual[_ngcontent-%COMP%]   .btn-refresh[_ngcontent-%COMP%]:hover{background:#f1f5f9;border-color:#cbd5e1}.estado-actual[_ngcontent-%COMP%]   .btn-refresh[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;color:#64748b}.resumen-info[_ngcontent-%COMP%]{background:#f8fafc;border-radius:8px;padding:16px}.resumen-info[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}.resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:13px;color:#64748b;font-weight:500}.resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:13px;color:#1e293b;font-weight:600}.resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .value.si[_ngcontent-%COMP%]{color:#059669}.resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .value.no[_ngcontent-%COMP%]{color:#dc2626}.acciones-disponibles[_ngcontent-%COMP%]{margin-bottom:24px}.acciones-disponibles[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin:0 0 12px;font-size:16px;color:#1e293b;font-weight:600}.acciones-disponibles[_ngcontent-%COMP%]   .acciones-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:12px 16px;background:#4f46e5;color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;text-align:left}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]:hover:not(:disabled){background:#4338ca;transform:translateY(-1px);box-shadow:0 4px 8px #4f46e54d}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;flex-shrink:0}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]   .accion-text[_ngcontent-%COMP%]{flex:1}.flujo-inicial[_ngcontent-%COMP%]{margin-bottom:24px}.flujo-inicial[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin:0 0 16px;font-size:16px;color:#1e293b;font-weight:600}.flujo-inicial[_ngcontent-%COMP%]   .flujo-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:20px;background:#f8fafc;border:1px solid #E2E8F0;border-radius:12px;transition:all .2s ease}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]:hover{background:#f0f9ff;border-color:#4f46e5;transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:28px;color:#4f46e5;flex-shrink:0;background:#eef2ff;padding:12px;border-radius:50%}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;flex:1}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#1e293b}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]   .step-description[_ngcontent-%COMP%]{font-size:14px;color:#64748b;line-height:1.4}.sin-acciones[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:20px;color:#64748b;font-size:14px;text-align:center}.sin-acciones[_ngcontent-%COMP%]   .waiting-icon[_ngcontent-%COMP%]{font-size:20px;color:#f59e0b}.sin-acciones[_ngcontent-%COMP%]   .waiting-text[_ngcontent-%COMP%]{font-weight:500}.aviso-completado[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:15px;color:#10b981;background:#ecfdf5;font-size:14px;text-align:center;border-radius:12px;border:1px solid #D1FAE5}.aviso-completado[_ngcontent-%COMP%]   .complete-icon[_ngcontent-%COMP%]{font-size:20px;color:#10b981}.aviso-completado[_ngcontent-%COMP%]   .complete-text[_ngcontent-%COMP%]{font-weight:500}@media (max-width: 768px){.desktop-only[_ngcontent-%COMP%]{display:none}.mobile-only[_ngcontent-%COMP%]{display:inline}.flujo-content[_ngcontent-%COMP%]{padding:16px}.estado-actual[_ngcontent-%COMP%]   .estado-header[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;margin-bottom:12px}.estado-actual[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.estado-actual[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.estado-actual[_ngcontent-%COMP%]   .btn-refresh[_ngcontent-%COMP%]{width:28px;height:28px}.estado-actual[_ngcontent-%COMP%]   .btn-refresh[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.resumen-info[_ngcontent-%COMP%]{padding:12px}.resumen-info[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:8px}.resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%], .resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:12px}.acciones-disponibles[_ngcontent-%COMP%]{margin-bottom:20px}.acciones-disponibles[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:15px;margin-bottom:10px}.acciones-disponibles[_ngcontent-%COMP%]   .acciones-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:8px}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]{padding:10px 12px;font-size:13px}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.flujo-inicial[_ngcontent-%COMP%]{margin-bottom:20px}.flujo-inicial[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:15px;margin-bottom:10px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-info[_ngcontent-%COMP%]{gap:12px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]{padding:16px;gap:12px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;padding:10px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{font-size:14px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]   .step-description[_ngcontent-%COMP%]{font-size:12px}.sin-acciones[_ngcontent-%COMP%]{padding:16px}.sin-acciones[_ngcontent-%COMP%]   .complete-icon[_ngcontent-%COMP%]{font-size:18px}.sin-acciones[_ngcontent-%COMP%]   .complete-text[_ngcontent-%COMP%]{font-size:13px}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{padding:20px;font-size:13px}.loading-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.btn-retry[_ngcontent-%COMP%]{padding:6px 12px;font-size:11px}.btn-retry[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}}@media (max-width: 480px){.flujo-content[_ngcontent-%COMP%]{padding:12px}.estado-actual[_ngcontent-%COMP%]   .estado-header[_ngcontent-%COMP%]{flex-direction:row;align-items:center;justify-content:space-between;gap:8px}.estado-actual[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]{justify-content:center;padding:4px 10px;font-size:12px}.estado-actual[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}.estado-actual[_ngcontent-%COMP%]   .btn-refresh[_ngcontent-%COMP%]{align-self:center;width:26px;height:26px}.estado-actual[_ngcontent-%COMP%]   .btn-refresh[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.resumen-info[_ngcontent-%COMP%]{padding:10px}.resumen-info[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{gap:6px}.resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%], .resumen-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:11px}.acciones-disponibles[_ngcontent-%COMP%]{margin-bottom:16px}.acciones-disponibles[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.acciones-disponibles[_ngcontent-%COMP%]   .acciones-grid[_ngcontent-%COMP%]{gap:6px}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]{padding:8px 10px;font-size:12px}.acciones-disponibles[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.flujo-inicial[_ngcontent-%COMP%]{margin-bottom:16px}.flujo-inicial[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-info[_ngcontent-%COMP%]{gap:8px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]{padding:12px;gap:8px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;padding:8px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{font-size:13px}.flujo-inicial[_ngcontent-%COMP%]   .flujo-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]   .step-description[_ngcontent-%COMP%]{font-size:11px}.sin-acciones[_ngcontent-%COMP%]{padding:12px;gap:8px}.sin-acciones[_ngcontent-%COMP%]   .complete-icon[_ngcontent-%COMP%]{font-size:16px}.sin-acciones[_ngcontent-%COMP%]   .complete-text[_ngcontent-%COMP%]{font-size:12px}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{padding:16px;font-size:12px;gap:8px}.loading-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.btn-retry[_ngcontent-%COMP%]{padding:4px 8px;font-size:10px}.btn-retry[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:10px}}"]});let c=p;return c})();var Ct=(()=>{let p=class p{constructor(e){this.configuracionService=e}generarPdfAlbaranBlob(e,n="albaran.pdf"){return L(this,null,function*(){var t,r;try{console.log("\u{1F527} Generando PDF de albar\xE1n como Blob...");let g=new on,l=20,M=[0,0,0],b=[64,64,64],u=[32,32,32],I=[128,128,128],x=(y,P,F,D={})=>{if(typeof P!="number"||isNaN(P)||typeof F!="number"||isNaN(F)){console.warn("Coordenadas inv\xE1lidas para addText:",{x:P,y:F,text:y});return}g.setFontSize(D.fontSize||10);let R=D.color||u;Array.isArray(R)&&R.length===3&&typeof R[0]=="number"&&typeof R[1]=="number"&&typeof R[2]=="number"?g.setTextColor(R[0],R[1],R[2]):g.setTextColor(u[0],u[1],u[2]),g.setFont(D.font||"helvetica",D.style||"normal"),g.text(y,P,F)},O=(y,P,F,D,R=[229,231,235])=>{if(typeof y!="number"||isNaN(y)||typeof P!="number"||isNaN(P)||typeof F!="number"||isNaN(F)||typeof D!="number"||isNaN(D)){console.warn("Coordenadas inv\xE1lidas para drawLine:",{x1:y,y1:P,x2:F,y2:D});return}g.setDrawColor(R[0],R[1],R[2]),g.setLineWidth(.5),g.line(y,P,F,D)},T=(y,P,F,D,R)=>{if(typeof y!="number"||isNaN(y)||typeof P!="number"||isNaN(P)||typeof F!="number"||isNaN(F)||typeof D!="number"||isNaN(D)){console.warn("Coordenadas inv\xE1lidas para drawRect:",{x:y,y:P,w:F,h:D});return}R&&Array.isArray(R)&&R.length===3?(g.setFillColor(R[0],R[1],R[2]),g.rect(y,P,F,D,"F")):g.rect(y,P,F,D)},z=(y=10)=>l+y>250?(g.addPage(),l=20,!0):!1,v=(y,P,F=50)=>{l+F>250&&(g.addPage(),l=20),x(y,20,l,{fontSize:14,style:"bold",color:b}),l+=8,O(20,l,190,l,b),l+=8,P(),l+=10};x("ALBAR\xC1N DE TRABAJO",105,l,{fontSize:18,style:"bold",color:M}),l+=15,x("T\xC9CNICOS CLIMATIZACI\xD3N S.L.",20,l,{fontSize:12,style:"bold",color:b}),l+=6,x("Calle de la Tecnolog\xEDa, 123",20,l,{fontSize:10,color:u}),l+=5,x("28001 Madrid, Espa\xF1a",20,l,{fontSize:10,color:u}),l+=5,x("CIF: B12345678",20,l,{fontSize:10,color:u}),l+=5,x("Tel: +34 91 123 45 67",20,l,{fontSize:10,color:u});let S=120;x(`N\xBA ALBAR\xC1N: ${((t=e.id)==null?void 0:t.substring(0,8))||"N/A"}`,S,35,{fontSize:12,style:"bold",color:b}),x(`FECHA: ${this.formatearFecha(e.fecha_cierre)}`,S,45,{fontSize:10,color:u}),x(`AVISO ID: ${((r=e.aviso_id)==null?void 0:r.substring(0,8))||"N/A"}`,S,55,{fontSize:10,color:u}),l+=20,O(20,l,190,l,b),l+=10,e.aviso&&v("INFORMACI\xD3N DEL CLIENTE",()=>{x(`Cliente: ${e.aviso.nombre_cliente_aviso||"No especificado"}`,25,l,{fontSize:10,color:u}),l+=6,x(`Direcci\xF3n: ${e.aviso.direccion_cliente_aviso||"No especificada"}`,25,l,{fontSize:10,color:u}),l+=6,x(`Estado del aviso: ${e.aviso.estado||"No especificado"}`,25,l,{fontSize:10,color:u})},30),v("FECHAS Y HORARIOS",()=>{x(`Fecha de cierre: ${this.formatearFecha(e.fecha_cierre)}`,25,l,{fontSize:10,color:u}),l+=6,x(`Hora de entrada: ${e.hora_entrada||"No especificada"}`,25,l,{fontSize:10,color:u}),l+=6,x(`Hora de salida: ${e.hora_salida||"No especificada"}`,25,l,{fontSize:10,color:u})},25),e.descripcion_trabajo_realizado&&v("DESCRIPCI\xD3N DEL TRABAJO REALIZADO",()=>{let y=e.descripcion_trabajo_realizado;g.splitTextToSize(y,150).forEach(D=>{z(8),x(D,25,l,{fontSize:10,color:u}),l+=6})},40),e.materialesUtilizados&&e.materialesUtilizados.length>0&&v("MATERIALES UTILIZADOS",()=>{x("C\xF3digo",25,l,{fontSize:9,style:"bold",color:b}),x("Material",60,l,{fontSize:9,style:"bold",color:b}),x("Cant.",110,l,{fontSize:9,style:"bold",color:b}),x("Unidad",125,l,{fontSize:9,style:"bold",color:b}),x("Precio",145,l,{fontSize:9,style:"bold",color:b}),x("Total",170,l,{fontSize:9,style:"bold",color:b}),l+=8,O(25,l,190,l,I),l+=5;let y=0;e.materialesUtilizados.forEach(P=>{var D;z(8),x(P.codigo||"-",25,l,{fontSize:8,color:u}),x(P.nombre||"Sin nombre",60,l,{fontSize:8,color:u}),x(((D=P.cantidad)==null?void 0:D.toString())||"0",110,l,{fontSize:8,color:u}),x(P.unidad||"unidad",125,l,{fontSize:8,color:u}),x(`\u20AC${(P.precio_pvp||0).toFixed(2)}`,145,l,{fontSize:8,color:u});let F=(P.cantidad||0)*(P.precio_pvp||0);y+=F,x(`\u20AC${F.toFixed(2)}`,170,l,{fontSize:8,color:u}),l+=6}),l+=5,O(25,l,190,l,I),l+=8,x("TOTAL MATERIALES:",125,l,{fontSize:10,style:"bold",color:b}),x(`\u20AC${y.toFixed(2)}`,170,l,{fontSize:10,style:"bold",color:b})},50),e.estado_cierre&&v("ESTADO DEL CIERRE",()=>{x(`Estado: ${e.estado_cierre}`,25,l,{fontSize:10,color:u}),l+=6,e.estado_cierre==="Presupuesto pendiente"&&e.presupuesto_necesario>0&&(x(`Monto estimado: \u20AC${e.presupuesto_necesario.toFixed(2)}`,25,l,{fontSize:10,style:"bold",color:b}),l+=6)},20),(e.dni_cliente||e.nombre_firma)&&v("INFORMACI\xD3N DEL CLIENTE",()=>{e.dni_cliente&&(x(`DNI: ${e.dni_cliente}`,25,l,{fontSize:10,color:u}),l+=6),e.nombre_firma&&x(`Firmado por: ${e.nombre_firma}`,25,l,{fontSize:10,color:u})},20),e.observaciones&&v("OBSERVACIONES",()=>{let y=e.observaciones;g.splitTextToSize(y,150).forEach(D=>{z(8),x(D,25,l,{fontSize:10,color:u}),l+=6})},30),l=270,O(20,l,190,l,I),l+=8,x("T\xC9CNICOS CLIMATIZACI\xD3N S.L.",20,l,{fontSize:8,style:"bold",color:b}),x("+34 91 123 45 67",105,l,{fontSize:8,color:I}),x("info@tecnicosclimatizacion.es",150,l,{fontSize:8,color:I});let A=g.output("blob");return console.log("\u2705 PDF de albar\xE1n generado como Blob exitosamente"),A}catch(g){throw console.error("\u274C Error al generar PDF de albar\xE1n como Blob:",g),g}})}generarPdfAlbaran(e,n="albaran.pdf"){var z;let t=new on,r=20,g=[0,0,0],l=[64,64,64],M=[32,32,32],b=[128,128,128],u=(v,S,A,y={})=>{if(typeof S!="number"||isNaN(S)||typeof A!="number"||isNaN(A)){console.warn("Coordenadas inv\xE1lidas para addText:",{x:S,y:A,text:v});return}t.setFontSize(y.fontSize||10);let P=y.color||M;Array.isArray(P)&&P.length===3&&typeof P[0]=="number"&&typeof P[1]=="number"&&typeof P[2]=="number"?t.setTextColor(P[0],P[1],P[2]):t.setTextColor(M[0],M[1],M[2]),t.setFont(y.font||"helvetica",y.style||"normal"),t.text(v,S,A)},I=(v,S,A,y,P=[229,231,235])=>{if(typeof v!="number"||isNaN(v)||typeof S!="number"||isNaN(S)||typeof A!="number"||isNaN(A)||typeof y!="number"||isNaN(y)){console.warn("Coordenadas inv\xE1lidas para drawLine:",{x1:v,y1:S,x2:A,y2:y});return}t.setDrawColor(P[0],P[1],P[2]),t.setLineWidth(.5),t.line(v,S,A,y)},x=(v,S,A,y,P)=>{if(typeof v!="number"||isNaN(v)||typeof S!="number"||isNaN(S)||typeof A!="number"||isNaN(A)||typeof y!="number"||isNaN(y)){console.warn("Coordenadas inv\xE1lidas para drawRect:",{x:v,y:S,w:A,h:y});return}P&&Array.isArray(P)&&P.length===3?(t.setFillColor(P[0],P[1],P[2]),t.rect(v,S,A,y,"F")):t.rect(v,S,A,y)},O=(v=10)=>r+v>250?(t.addPage(),r=20,!0):!1,T=(v,S,A=50)=>{r+A>250&&(t.addPage(),r=20),u(v,20,r,{fontSize:14,style:"bold",color:l}),r+=8,I(20,r,190,r,b),r+=10,S(),r+=15};(typeof r!="number"||isNaN(r))&&(r=20),u("ALBAR\xC1N DE TRABAJO",20,r,{fontSize:18,style:"bold",color:g}),r+=8,I(20,r,190,r,b),r+=10,u(`N\xBA ${((z=e.id)==null?void 0:z.substring(0,8))||"N/A"}`,20,r,{fontSize:12,color:b}),u(`Fecha: ${this.formatearFecha(new Date)}`,120,r,{fontSize:12,color:b}),r+=15,e.aviso&&T("INFORMACI\xD3N DEL AVISO",()=>{u(`Cliente: ${e.aviso.nombre_cliente_aviso||"No especificado"}`,20,r),r+=6,u(`Direcci\xF3n: ${e.aviso.direccion_cliente_aviso||"No especificada"}`,20,r),r+=6,u(`Estado: ${e.aviso.estado||"No especificado"}`,20,r),r+=6,u(`Fecha de creaci\xF3n: ${this.formatearFecha(e.aviso.fecha_creacion)}`,20,r),r+=6},30),T("FECHAS Y HORARIOS",()=>{u(`Fecha de cierre: ${this.formatearFecha(e.fecha_cierre)}`,20,r),r+=6,u(`Hora de entrada: ${e.hora_entrada||"No especificada"}`,20,r),r+=6,u(`Hora de salida: ${e.hora_salida||"No especificada"}`,20,r),r+=6},25),e.descripcion_trabajo_realizado&&T("DESCRIPCI\xD3N DEL TRABAJO REALIZADO",()=>{let v=e.descripcion_trabajo_realizado,S=170,A=6;t.splitTextToSize(v,S).forEach(P=>{O(A),u(P,20,r),r+=A})},40),e.materialesUtilizados&&e.materialesUtilizados.length>0&&T("MATERIALES UTILIZADOS",()=>{let v=[["C\xF3digo","Material","Cantidad","Unidad","Precio Unit.","Total"]],S=0;e.materialesUtilizados.forEach(F=>{let D=F.precio_pvp*F.cantidad;S+=D,v.push([F.codigo||"-",F.nombre,F.cantidad.toString(),F.unidad,this.formatearMoneda(F.precio_pvp),this.formatearMoneda(D)])}),v.push(["","","","","TOTAL:",this.formatearMoneda(S)]);let A=20,y=[25,60,20,20,30,30],P=8;v.forEach((F,D)=>{O(P);let R=A;F.forEach((Xe,un)=>{let Ot=D===0,xt=D===v.length-1;Ot?(x(R,r-5,y[un],P,[243,244,246]),u(Xe,R+2,r,{fontSize:8,style:"bold",color:[55,65,81]})):xt?u(Xe,R+2,r,{fontSize:9,style:"bold",color:l}):u(Xe,R+2,r,{fontSize:8}),R+=y[un]}),r+=P})},60),e.estado_cierre==="Presupuesto pendiente"&&T("INFORMACI\xD3N DE PRESUPUESTO",()=>{x(15,r-5,180,25),u("Este albar\xE1n requiere presupuesto",20,r,{style:"bold"}),r+=6,e.presupuesto_necesario>0&&(u(`Monto estimado: ${this.formatearMoneda(e.presupuesto_necesario)}`,20,r,{style:"bold"}),r+=6)},35),T("INFORMACI\xD3N DEL CLIENTE",()=>{e.dni_cliente&&(u(`DNI: ${e.dni_cliente}`,20,r),r+=6),e.nombre_firma&&(u(`Firmado por: ${e.nombre_firma}`,20,r),r+=6)},20),T("FIRMA DEL CLIENTE",()=>{x(20,r,170,40),u("Firma:",25,r+8,{fontSize:10,color:b}),e.firma_url?u("\u2713 Firma digital registrada",25,r+20,{fontSize:10,style:"bold"}):e.nombre_firma?u(`Firmado por: ${e.nombre_firma}`,25,r+20,{fontSize:10}):u("_________________________",25,r+20,{fontSize:10}),r+=50},60),e.observaciones&&T("OBSERVACIONES",()=>{let v=e.observaciones,S=170,A=6;t.splitTextToSize(v,S).forEach(P=>{O(A),u(P,20,r,{style:"italic"}),r+=A})},30),T("INFORMACI\xD3N ADICIONAL",()=>{var v,S;u(`ID del trabajo: ${((v=e.trabajo_id)==null?void 0:v.substring(0,8))||"N/A"}`,20,r),r+=6,u(`ID del aviso: ${((S=e.aviso_id)==null?void 0:S.substring(0,8))||"N/A"}`,20,r),r+=6,e.fecha_creacion&&(u(`Fecha de creaci\xF3n: ${this.formatearFecha(e.fecha_creacion)}`,20,r),r+=6)},25),r>200&&(t.addPage(),r=20),I(20,r,190,r,b),r+=10,u("EMPRESA DE SERVICIOS T\xC9CNICOS",20,r,{fontSize:10,style:"bold",color:l}),r+=6,u("CIF: 12345678A | Tel: 900 123 456 | Email: info@empresa.com",20,r,{fontSize:8,color:b}),r+=6,u("Direcci\xF3n: Calle Principal 123, 28001 Madrid",20,r,{fontSize:8,color:b}),r+=10,u("Este albar\xE1n ha sido generado autom\xE1ticamente por el sistema de gesti\xF3n",20,r,{fontSize:8,color:b}),r+=4,u(`Generado el: ${this.formatearFecha(new Date)} | P\xE1gina ${t.getCurrentPageInfo().pageNumber} de ${t.getNumberOfPages()}`,20,r,{fontSize:8,color:b}),t.save(n)}generarPdfHtml(e,n="albaran.pdf"){var l;let t=this.generarHtmlAlbaran(e),r=this.obtenerEstilosCss(),g=window.open("","_blank");g&&(g.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Albar\xE1n ${((l=e.id)==null?void 0:l.substring(0,8))||"N/A"}</title>
          <style>${r}</style>
        </head>
        <body>
          ${t}
        </body>
        </html>
      `),g.document.close(),g.focus(),setTimeout(()=>{g.print()},500))}generarHtmlAlbaran(e){var r,g,l;let n=e.materialesUtilizados||[],t=n.reduce((M,b)=>M+b.precio_pvp*b.cantidad,0);return`
      <div class="albaran-container">
        <!-- Header -->
        <div class="albaran-header">
          <h1>ALBAR\xC1N DE TRABAJO</h1>
          <div class="albaran-info">
            <span class="albaran-numero">N\xBA ${((r=e.id)==null?void 0:r.substring(0,8))||"N/A"}</span>
            <span class="fecha-emision">${this.formatearFecha(new Date)}</span>
          </div>
        </div>

        <!-- Informaci\xF3n del aviso -->
        ${e.aviso?`
        <div class="section">
          <h2>INFORMACI\xD3N DEL AVISO</h2>
          <div class="info-grid">
            <div class="info-item">
              <label>Cliente:</label>
              <span>${e.aviso.nombre_cliente_aviso||"No especificado"}</span>
            </div>
            <div class="info-item">
              <label>Direcci\xF3n:</label>
              <span>${e.aviso.direccion_cliente_aviso||"No especificada"}</span>
            </div>
            <div class="info-item">
              <label>Estado:</label>
              <span>${e.aviso.estado||"No especificado"}</span>
            </div>
            <div class="info-item">
              <label>Fecha de creaci\xF3n:</label>
              <span>${this.formatearFecha(e.aviso.fecha_creacion)}</span>
            </div>
          </div>
        </div>
        `:""}

        <!-- Fechas y horarios -->
        <div class="section">
          <h2>FECHAS Y HORARIOS</h2>
          <div class="info-grid">
            <div class="info-item">
              <label>Fecha de cierre:</label>
              <span>${this.formatearFecha(e.fecha_cierre)}</span>
            </div>
            <div class="info-item">
              <label>Hora de entrada:</label>
              <span>${e.hora_entrada||"No especificada"}</span>
            </div>
            <div class="info-item">
              <label>Hora de salida:</label>
              <span>${e.hora_salida||"No especificada"}</span>
            </div>
          </div>
        </div>

        <!-- Descripci\xF3n del trabajo -->
        ${e.descripcion_trabajo_realizado?`
        <div class="section">
          <h2>DESCRIPCI\xD3N DEL TRABAJO REALIZADO</h2>
          <div class="descripcion">
            <p>${e.descripcion_trabajo_realizado}</p>
          </div>
        </div>
        `:""}

        <!-- Materiales utilizados -->
        ${n.length>0?`
        <div class="section">
          <h2>MATERIALES UTILIZADOS</h2>
          <table class="materiales-table">
            <thead>
              <tr>
                <th>C\xF3digo</th>
                <th>Material</th>
                <th>Cantidad</th>
                <th>Unidad</th>
                <th>Precio Unit.</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              ${n.map(M=>`
                <tr>
                  <td>${M.codigo||"-"}</td>
                  <td>${M.nombre}</td>
                  <td>${M.cantidad}</td>
                  <td>${M.unidad}</td>
                  <td>${this.formatearMoneda(M.precio_pvp)}</td>
                  <td>${this.formatearMoneda(M.precio_pvp*M.cantidad)}</td>
                </tr>
              `).join("")}
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="5"><strong>TOTAL MATERIALES:</strong></td>
                <td><strong>${this.formatearMoneda(t)}</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>
        `:""}

        <!-- Presupuesto -->
        ${e.estado_cierre==="Presupuesto pendiente"?`
        <div class="section presupuesto-section">
          <h2>INFORMACI\xD3N DE PRESUPUESTO</h2>
          <div class="presupuesto-warning">
            <p>Este albar\xE1n requiere presupuesto</p>
            ${e.presupuesto_necesario>0?`
              <p><strong>Monto estimado: ${this.formatearMoneda(e.presupuesto_necesario)}</strong></p>
            `:""}
          </div>
        </div>
        `:""}

        <!-- Informaci\xF3n del cliente -->
        <div class="section">
          <h2>INFORMACI\xD3N DEL CLIENTE</h2>
          <div class="info-grid">
            ${e.dni_cliente?`
              <div class="info-item">
                <label>DNI:</label>
                <span>${e.dni_cliente}</span>
              </div>
            `:""}
            ${e.nombre_firma?`
              <div class="info-item">
                <label>Firmado por:</label>
                <span>${e.nombre_firma}</span>
              </div>
            `:""}
          </div>
        </div>

        <!-- Secci\xF3n de firma -->
        <div class="section">
          <h2>FIRMA DEL CLIENTE</h2>
          <div class="firma-section">
            <div class="firma-box">
              <label>Firma:</label>
              ${e.firma_url?`
                <div class="firma-digital">
                  <p>\u2713 Firma digital registrada</p>
                  <img src="${e.firma_url}" alt="Firma del cliente" class="firma-imagen" />
                </div>
              `:e.nombre_firma?`
                <div class="firma-texto">
                  <p>Firmado por: ${e.nombre_firma}</p>
                </div>
              `:`
                <div class="firma-lugar">
                  <p>_________________________</p>
                </div>
              `}
            </div>
          </div>
        </div>

        <!-- Observaciones -->
        ${e.observaciones?`
        <div class="section">
          <h2>OBSERVACIONES</h2>
          <div class="observaciones">
            <p>${e.observaciones}</p>
          </div>
        </div>
        `:""}

        <!-- Informaci\xF3n adicional -->
        <div class="section">
          <h2>INFORMACI\xD3N ADICIONAL</h2>
          <div class="info-grid">
            <div class="info-item">
              <label>ID del trabajo:</label>
              <span>${((g=e.trabajo_id)==null?void 0:g.substring(0,8))||"N/A"}</span>
            </div>
            <div class="info-item">
              <label>ID del aviso:</label>
              <span>${((l=e.aviso_id)==null?void 0:l.substring(0,8))||"N/A"}</span>
            </div>
            ${e.fecha_creacion?`
              <div class="info-item">
                <label>Fecha de creaci\xF3n:</label>
                <span>${this.formatearFecha(e.fecha_creacion)}</span>
              </div>
            `:""}
          </div>
        </div>

        <!-- Footer -->
        <div class="albaran-footer">
          <p>Este albar\xE1n ha sido generado autom\xE1ticamente por el sistema de gesti\xF3n de avisos</p>
          <p>Generado el: ${this.formatearFecha(new Date)}</p>
        </div>
      </div>
    `}obtenerEstilosCss(){return`
      @media print {
        body { margin: 0; padding: 0; }
        .no-print { display: none !important; }
      }

      .albaran-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        font-family: 'Arial', sans-serif;
        color: #111827;
        background: white;
      }

      .albaran-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #000;
      }

      .albaran-header h1 {
        font-size: 24px;
        font-weight: bold;
        color: #000;
        margin: 0 0 10px 0;
      }

      .albaran-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
      }

      .albaran-numero {
        font-size: 16px;
        font-weight: bold;
        color: #000;
      }

      .fecha-emision {
        font-size: 14px;
        color: #6B7280;
      }

      .section {
        margin-bottom: 25px;
        padding: 20px;
        background: #f9fafb;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }

      .section h2 {
        font-size: 16px;
        font-weight: bold;
        color: #000;
        margin: 0 0 15px 0;
        padding-bottom: 8px;
        border-bottom: 1px solid #666;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
      }

      .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
        padding: 12px;
        background: white;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }

      .info-item label {
        font-size: 12px;
        font-weight: bold;
        color: #6B7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .info-item span {
        font-size: 14px;
        color: #1F2937;
        font-weight: 500;
      }

      .descripcion, .observaciones {
        background: white;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }

      .descripcion p, .observaciones p {
        margin: 0;
        line-height: 1.6;
        color: #374151;
      }

      .observaciones p {
        font-style: italic;
      }

      .materiales-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 6px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
      }

      .materiales-table th,
      .materiales-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }

      .materiales-table th {
        background: #f3f4f6;
        font-weight: bold;
        color: #374151;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .materiales-table td {
        font-size: 13px;
        color: #1F2937;
      }

      .materiales-table .total-row {
        background: #f0f9ff;
        font-weight: bold;
      }

      .materiales-table .total-row td {
        color: #1e40af;
        font-size: 14px;
      }

      .presupuesto-section {
        background: #fef3c7;
        border: 1px solid #f59e0b;
      }

      .presupuesto-warning {
        background: white;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }

      .presupuesto-warning p {
        margin: 0 0 8px 0;
        color: #92400e;
        font-weight: 500;
      }

      .albaran-footer {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid #10B981;
        text-align: center;
        color: #6B7280;
        font-size: 12px;
      }

      .albaran-footer p {
        margin: 5px 0;
      }

      .firma-section {
        margin-top: 20px;
      }

      .firma-box {
        border: 2px solid #000;
        padding: 20px;
        min-height: 100px;
        background: white;
      }

      .firma-box label {
        font-weight: bold;
        color: #000;
        margin-bottom: 10px;
        display: block;
      }

      .firma-digital p {
        color: #000;
        font-weight: bold;
        margin: 10px 0;
      }

      .firma-imagen {
        max-width: 200px;
        max-height: 80px;
        border: 1px solid #ccc;
        margin-top: 10px;
      }

      .firma-texto p {
        color: #000;
        font-style: italic;
        margin: 20px 0;
      }

      .firma-lugar p {
        color: #000;
        font-size: 16px;
        margin: 20px 0;
      }
    `}formatearFecha(e){return e?new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"No especificada"}formatearMoneda(e){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e)}};p.\u0275fac=function(n){return new(n||p)(X(Re))},p.\u0275prov=me({token:p,factory:p.\u0275fac,providedIn:"root"});let c=p;return c})();function co(c,p){c&1&&_(0,"ion-icon",29)}function so(c,p){c&1&&_(0,"ion-icon",30)}function lo(c,p){if(c&1&&(o(0,"tr")(1,"td"),s(2),a(),o(3,"td"),s(4),a(),o(5,"td"),s(6),a(),o(7,"td"),s(8),a(),o(9,"td"),s(10),B(11,"currency"),a(),o(12,"td"),s(13),B(14,"currency"),a()()),c&2){let i=p.$implicit;d(2),h(i.codigo||"-"),d(2),h(i.nombre),d(2),h(i.cantidad),d(2),h(i.unidad),d(2),h(ae(11,6,i.precio_pvp,"EUR","symbol","1.2-2")),d(3),h(ae(14,11,i.precio_pvp*i.cantidad,"EUR","symbol","1.2-2"))}}function po(c,p){if(c&1&&(o(0,"div",31)(1,"table",32)(2,"thead")(3,"tr")(4,"th"),s(5,"C\xF3digo"),a(),o(6,"th"),s(7,"Material"),a(),o(8,"th"),s(9,"Cantidad"),a(),o(10,"th"),s(11,"Unidad"),a(),o(12,"th"),s(13,"Precio Unit."),a(),o(14,"th"),s(15,"Total"),a()()(),o(16,"tbody"),k(17,lo,15,16,"tr",33),a(),o(18,"tfoot")(19,"tr",34)(20,"td",35)(21,"strong"),s(22,"Total Materiales:"),a()(),o(23,"td")(24,"strong"),s(25),B(26,"currency"),a()()()()()()),c&2){let i=f();d(17),m("ngForOf",i.materialesUtilizados),d(8),h(ae(26,2,i.calcularTotalMateriales(),"EUR","symbol","1.2-2"))}}function go(c,p){if(c&1&&(o(0,"li"),s(1),a()),c&2){let i=p.$implicit;d(),h(i.nombre)}}function uo(c,p){if(c&1&&(o(0,"div",36)(1,"ul",37),k(2,go,2,1,"li",33),a()()),c&2){let i=f();d(2),m("ngForOf",i.materialesUtilizados)}}function mo(c,p){c&1&&(o(0,"div",38)(1,"p"),s(2,"No se utilizaron materiales en este trabajo"),a()())}function _o(c,p){if(c&1&&(o(0,"div",45)(1,"span",46),s(2,"Monto estimado:"),a(),o(3,"span",47),s(4),B(5,"currency"),a()()),c&2){let i=f(2);d(4),h(ae(5,1,i.albaran.presupuesto_necesario,"EUR","symbol","1.2-2"))}}function fo(c,p){if(c&1){let i=j();o(0,"div",48)(1,"p",49),s(2," Puedes crear un presupuesto basado en este albar\xE1n con los materiales y tiempo ya registrados. "),a(),o(3,"button",50),C("click",function(){w(i);let n=f(2);return E(n.crearPresupuestoDesdeAlbaran())}),_(4,"ion-icon",51),s(5," Crear Presupuesto "),a()()}}function bo(c,p){if(c&1&&(o(0,"div",14)(1,"h3"),s(2,"Presupuesto"),a(),o(3,"div",39)(4,"div",40),_(5,"ion-icon",41),o(6,"span",42),s(7,"Este albar\xE1n requiere presupuesto"),a()(),k(8,_o,6,6,"div",43)(9,fo,6,0,"div",44),a()()),c&2){let i=f();d(8),m("ngIf",i.albaran.presupuesto_necesario>0),d(),m("ngIf",i.puedeCrearPresupuesto())}}function Co(c,p){if(c&1&&(o(0,"div",16)(1,"label"),s(2,"DNI:"),a(),o(3,"span"),s(4),a()()),c&2){let i=f(2);d(4),h(i.albaran.dni_cliente)}}function Po(c,p){if(c&1&&(o(0,"div",16)(1,"label"),s(2,"Firmado por:"),a(),o(3,"span"),s(4),a()()),c&2){let i=f(2);d(4),h(i.albaran.nombre_firma)}}function Mo(c,p){if(c&1&&(o(0,"div",14)(1,"h3"),s(2,"Informaci\xF3n del Cliente"),a(),o(3,"div",15),k(4,Co,5,1,"div",25)(5,Po,5,1,"div",25),a()()),c&2){let i=f();d(4),m("ngIf",i.albaran.dni_cliente),d(),m("ngIf",i.albaran.nombre_firma)}}function Oo(c,p){if(c&1&&(o(0,"div",55),_(1,"img",56),o(2,"p",57),s(3,"Firma digital del cliente"),a()()),c&2){let i=f(2);d(),m("src",i.albaran.firma_url,J)}}function xo(c,p){if(c&1&&(o(0,"div",58)(1,"p"),s(2,"El cliente ha firmado este albar\xE1n"),a(),o(3,"div",59),_(4,"ion-icon",60),o(5,"span"),s(6),a()()()),c&2){let i=f(2);d(6),h(i.albaran.nombre_firma)}}function ho(c,p){if(c&1&&(o(0,"div",14)(1,"h3"),s(2,"Firma del Cliente"),a(),o(3,"div",52),k(4,Oo,4,1,"div",53)(5,xo,7,1,"div",54),a()()),c&2){let i=f();d(4),m("ngIf",i.albaran.firma_url),d(),m("ngIf",!i.albaran.firma_url&&i.albaran.nombre_firma)}}function vo(c,p){if(c&1&&(o(0,"div",14)(1,"h3"),s(2,"Observaciones"),a(),o(3,"div",61)(4,"p"),s(5),a()()()),c&2){let i=f();d(5),h(i.albaran.observaciones)}}function yo(c,p){if(c&1&&(o(0,"div",16)(1,"label"),s(2,"Fecha de creaci\xF3n:"),a(),o(3,"span"),s(4),a()()),c&2){let i=f();d(4),h(i.formatearFecha(i.albaran.fecha_creacion))}}var Pt=(()=>{let p=class p{constructor(e,n,t,r,g){this.modalController=e,this.router=n,this.presupuestosService=t,this.albaranPdfService=r,this.emailService=g,this.enviandoCorreo=!1,W({close:te,documentTextOutline:se,personOutline:Pe,timeOutline:Me,calendarOutline:Le,cubeOutline:Be,checkmarkCircleOutline:ce,warningOutline:Oe,refreshOutline:Z,downloadOutline:Ee,printOutline:it,createOutline:Ce,calculator:He,mailOutline:at})}ngOnInit(){console.log("Modal de albar\xE1n cargado:",this.albaran)}cerrarModal(){this.modalController.dismiss()}descargarPDF(){var e;if(!this.albaran){console.error("No hay albar\xE1n para descargar");return}try{console.log("\u{1F527} Iniciando descarga de albar\xE1n...");let t=`albaran_${((e=this.albaran.id)==null?void 0:e.substring(0,8))||"albaran"}.pdf`,r={id:this.albaran.id,trabajo_id:this.albaran.trabajo_id,aviso_id:this.albaran.aviso_id,fecha_cierre:this.albaran.fecha_cierre,hora_entrada:this.albaran.hora_entrada,hora_salida:this.albaran.hora_salida,descripcion_trabajo_realizado:this.albaran.descripcion_trabajo_realizado,materialesUtilizados:this.materialesUtilizados,estado_cierre:this.albaran.estado_cierre,presupuesto_necesario:this.albaran.presupuesto_necesario,dni_cliente:this.albaran.dni_cliente,nombre_firma:this.albaran.nombre_firma,firma_url:this.albaran.firma_url,observaciones:this.albaran.observaciones,fecha_creacion:this.albaran.fecha_creacion,aviso:this.aviso};this.albaranPdfService.generarPdfAlbaran(r,t),console.log("\u2705 Albar\xE1n descargado exitosamente")}catch(n){console.error("\u274C Error al descargar albar\xE1n:",n),alert("Error al generar el PDF del albar\xE1n: "+n.message)}}imprimirAlbaran(){if(!this.albaran){console.error("No hay albar\xE1n para imprimir");return}try{console.log("\u{1F5A8}\uFE0F Iniciando impresi\xF3n de albar\xE1n...");let e={id:this.albaran.id,trabajo_id:this.albaran.trabajo_id,aviso_id:this.albaran.aviso_id,fecha_cierre:this.albaran.fecha_cierre,hora_entrada:this.albaran.hora_entrada,hora_salida:this.albaran.hora_salida,descripcion_trabajo_realizado:this.albaran.descripcion_trabajo_realizado,materialesUtilizados:this.materialesUtilizados,estado_cierre:this.albaran.estado_cierre,presupuesto_necesario:this.albaran.presupuesto_necesario,dni_cliente:this.albaran.dni_cliente,nombre_firma:this.albaran.nombre_firma,firma_url:this.albaran.firma_url,observaciones:this.albaran.observaciones,fecha_creacion:this.albaran.fecha_creacion,aviso:this.aviso};this.albaranPdfService.generarPdfHtml(e,"albaran_imprimir.pdf"),console.log("\u2705 Albar\xE1n enviado a impresi\xF3n")}catch(e){console.error("\u274C Error al imprimir albar\xE1n:",e),window.print()}}tieneFirma(){return!!(this.albaran.firma_url||this.albaran.nombre_firma)}getEstadoClass(e){return"badge-"+e.toLowerCase().replace(/ /g,"-")}get materialesUtilizados(){return this.albaran.repuestos&&this.albaran.repuestos.length>0?(console.log("\u{1F4CB} Usando repuestos de tabla repuestos_albaran:",this.albaran.repuestos),this.albaran.repuestos):this.albaran.repuestos_utilizados&&this.albaran.repuestos_utilizados.length>0?(console.log("\u{1F4CB} Usando repuestos_utilizados legacy:",this.albaran.repuestos_utilizados),typeof this.albaran.repuestos_utilizados[0]=="object"?this.albaran.repuestos_utilizados:this.albaran.repuestos_utilizados.map(e=>{if(typeof e=="string")try{let n=JSON.parse(e);return{nombre:n.nombre||e,cantidad:Number(n.cantidad)||1,precio_neto:Number(n.precio_neto)||0,precio_pvp:Number(n.precio_pvp)||0,unidad:n.unidad||"unidad",codigo:n.codigo||""}}catch{return{nombre:e,cantidad:1,precio_neto:0,precio_pvp:0,unidad:"unidad",codigo:""}}return e})):[]}repuestosCompletos(){let e=this.materialesUtilizados;return e.length>0&&e[0].precio_pvp!==void 0}calcularTotalMateriales(){return this.materialesUtilizados.reduce((e,n)=>e+n.precio_pvp*n.cantidad,0)}formatearFecha(e){return e?new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"No especificada"}formatearHora(e){return e||"No especificada"}getEstadoColor(e){switch(e){case"Finalizado":return"#10B981";case"Presupuesto pendiente":return"#F59E0B";case"Otra visita":return"#EF4444";default:return"#6B7280"}}getEstadoAvisoColor(e){if(!e)return"#6B7280";switch(e.toLowerCase()){case"pendiente":return"#F59E0B";case"en_progreso":case"en progreso":return"#3B82F6";case"completado":case"finalizado":return"#10B981";case"cancelado":return"#EF4444";case"pausado":return"#8B5CF6";case"reagendado":return"#F97316";default:return"#6B7280"}}puedeCrearPresupuesto(){var e;return this.albaran.estado_cierre==="Presupuesto pendiente"&&((e=this.aviso)==null?void 0:e.id)}crearPresupuestoDesdeAlbaran(){if(!this.puedeCrearPresupuesto()){console.warn("No se puede crear presupuesto desde este albar\xE1n");return}console.log("\u{1F3AF} Creando presupuesto desde albar\xE1n:",this.albaran);let e=this.prepararMaterialesParaPresupuesto(),n={aviso_id:this.aviso.id,albaran_id:this.albaran.id,horas_estimadas:this.calcularHorasEstimadas(),total_estimado:this.calcularTotalEstimado(),materiales:e};console.log("\u{1F4CB} Datos para el presupuesto:",n),this.presupuestosService.crearPresupuesto(n).subscribe({next:t=>{console.log("\u2705 Presupuesto creado exitosamente:",t),confirm(`\u2705 Presupuesto creado exitosamente.

\xBFDeseas ir a editarlo ahora para ajustar detalles?`)?(this.modalController.dismiss({accion_realizada:"presupuesto_creado",presupuesto:t},"confirm"),this.router.navigate(["/presupuestos/crear"],{queryParams:{id:t.id,edit:"true"}})):this.modalController.dismiss({accion_realizada:"presupuesto_creado",presupuesto:t,mensaje:"Presupuesto creado exitosamente"},"confirm")},error:t=>{console.error("\u274C Error al crear presupuesto:",t),alert("Error al crear el presupuesto: "+(t.message||"Error desconocido"))}})}prepararMaterialesParaPresupuesto(){return this.materialesUtilizados.map(n=>({material_id:n.codigo||this.generarIdTemporal(),cantidad_estimada:n.cantidad,precio_neto_al_momento:n.precio_neto||n.precio_pvp,producto:{id:n.codigo||this.generarIdTemporal(),nombre:n.nombre,precio_neto:n.precio_neto||n.precio_pvp,unidad:n.unidad||"unidad"}}))}calcularHorasEstimadas(){let e=this.albaran.hora_entrada,n=this.albaran.hora_salida;if(e&&n){let[t,r]=e.split(":").map(Number),[g,l]=n.split(":").map(Number),M=t*60+r,I=(g*60+l-M)/60;return Math.max(I,1)}return 2}calcularTotalEstimado(){let e=this.calcularTotalMateriales(),r=this.calcularHorasEstimadas()*50;return e+r}generarIdTemporal(){return"temp_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}enviarAlbaranPorCorreo(){return L(this,null,function*(){var r,g,l,M,b,u,I,x;if(!this.albaran){console.error("No hay albar\xE1n para enviar");return}let e=((g=(r=this.aviso)==null?void 0:r.cliente)==null?void 0:g.email)||((l=this.aviso)==null?void 0:l.email_cliente_aviso),n=(M=this.aviso)==null?void 0:M.nombre_cliente_aviso;if(!e){console.error("No hay email del cliente"),alert("Error: No se encontr\xF3 email del cliente en el aviso. Por favor, verifica que el aviso tenga un email v\xE1lido.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){console.error("Email del cliente no es v\xE1lido:",e),alert("Error: El email del cliente no tiene un formato v\xE1lido.");return}try{this.enviandoCorreo=!0,console.log("\u{1F4E7} Iniciando env\xEDo de albar\xE1n por correo..."),console.log("\u{1F4E7} Datos del albar\xE1n:",{email_cliente:e,nombre_cliente:n,numero_albaran:(b=this.albaran.id)==null?void 0:b.substring(0,8),total_materiales:this.calcularTotalMateriales()});let O={id:this.albaran.id,trabajo_id:this.albaran.trabajo_id,aviso_id:this.albaran.aviso_id,fecha_cierre:this.albaran.fecha_cierre,hora_entrada:this.albaran.hora_entrada,hora_salida:this.albaran.hora_salida,descripcion_trabajo_realizado:this.albaran.descripcion_trabajo_realizado,materialesUtilizados:this.materialesUtilizados,estado_cierre:this.albaran.estado_cierre,presupuesto_necesario:this.albaran.presupuesto_necesario,dni_cliente:this.albaran.dni_cliente,nombre_firma:this.albaran.nombre_firma,firma_url:this.albaran.firma_url,observaciones:this.albaran.observaciones,fecha_creacion:this.albaran.fecha_creacion,aviso:this.aviso},T=yield this.albaranPdfService.generarPdfAlbaranBlob(O,`albaran_${(u=this.albaran.id)==null?void 0:u.substring(0,8)}.pdf`);console.log("\u{1F4E7} Enviando correo con datos:",{emailCliente:e,nombreCliente:n,numeroAlbaran:(I=this.albaran.id)==null?void 0:I.substring(0,8),totalAlbaran:this.calcularTotalMateriales()});let z=yield this.emailService.enviarAlbaranPorCorreo(e,n||"Cliente",((x=this.albaran.id)==null?void 0:x.substring(0,8))||"N/A",T,this.calcularTotalMateriales());z.success?(console.log("\u2705 Albar\xE1n enviado exitosamente"),alert("\u2705 Albar\xE1n enviado correctamente al cliente")):(console.error("\u274C Error al enviar albar\xE1n:",z.message),alert("\u274C Error al enviar el albar\xE1n: "+z.message))}catch(O){console.error("\u274C Error al enviar albar\xE1n por correo:",O),alert("\u274C Error inesperado al enviar el albar\xE1n. Por favor, int\xE9ntelo de nuevo.")}finally{this.enviandoCorreo=!1}})}puedeEnviarPorCorreo(){var r,g,l,M,b,u,I;let e=((g=(r=this.aviso)==null?void 0:r.cliente)==null?void 0:g.email)||((l=this.aviso)==null?void 0:l.email_cliente_aviso),n=!!e,t=!!this.albaran;return console.log("\u{1F50D} Debug - Puede enviar por correo:",{tieneEmail:n,tieneAlbaran:t,emailCliente:e,emailClienteDesdeRelacion:(b=(M=this.aviso)==null?void 0:M.cliente)==null?void 0:b.email,emailClienteDesdeAviso:(u=this.aviso)==null?void 0:u.email_cliente_aviso,albaranId:(I=this.albaran)==null?void 0:I.id,avisoCompleto:this.aviso}),!!(n&&t)}getTituloBotonCorreo(){var n,t,r;return this.enviandoCorreo?"Enviando correo...":this.albaran?((t=(n=this.aviso)==null?void 0:n.cliente)==null?void 0:t.email)||((r=this.aviso)==null?void 0:r.email_cliente_aviso)?"Enviar albar\xE1n por correo":"No hay email del cliente en el aviso":"No hay albar\xE1n para enviar"}};p.\u0275fac=function(n){return new(n||p)(N(re),N(fe),N(xe),N(Ct),N(dt))},p.\u0275cmp=Q({type:p,selectors:[["app-ver-albaran-modal"]],inputs:{albaran:"albaran",aviso:"aviso"},decls:107,vars:28,consts:[[1,"header-content"],[1,"header-actions"],["title","Descargar PDF",1,"btn-secondary",3,"click"],["name","download-outline"],[1,"desktop-only"],["title","Imprimir",1,"btn-secondary",3,"click"],["name","print-outline"],[1,"btn-email",3,"click","disabled","title"],["name","mail-outline",4,"ngIf"],["name","refresh-outline","class","spinning",4,"ngIf"],["title","Cerrar",1,"btn-cerrar",3,"click"],["name","close"],[1,"modal-body"],[1,"modal-content"],[1,"info-section"],[1,"info-grid"],[1,"info-item"],[1,"estado-aviso"],["name","checkmark-circle-outline"],[1,"descripcion-content"],[1,"materiales-content"],["class","materiales-tabla",4,"ngIf"],["class","materiales-lista",4,"ngIf"],["class","no-materiales",4,"ngIf"],["class","info-section",4,"ngIf"],["class","info-item",4,"ngIf"],[1,"button-group"],["type","button",1,"btn","btn-outline",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["name","mail-outline"],["name","refresh-outline",1,"spinning"],[1,"materiales-tabla"],[1,"materiales-table"],[4,"ngFor","ngForOf"],[1,"total-row"],["colspan","5"],[1,"materiales-lista"],[1,"repuestos-list"],[1,"no-materiales"],[1,"presupuesto-content"],[1,"presupuesto-status"],["name","warning-outline",1,"warning-icon"],[1,"status-text"],["class","presupuesto-amount",4,"ngIf"],["class","presupuesto-actions",4,"ngIf"],[1,"presupuesto-amount"],[1,"amount-label"],[1,"amount-value"],[1,"presupuesto-actions"],[1,"action-description"],[1,"btn-crear-presupuesto",3,"click"],["name","calculator"],[1,"firma-content"],["class","firma-imagen",4,"ngIf"],["class","firma-texto",4,"ngIf"],[1,"firma-imagen"],["alt","Firma del cliente",1,"firma-img",3,"src"],[1,"firma-caption"],[1,"firma-texto"],[1,"firma-nombre"],["name","person-outline"],[1,"observaciones-content"]],template:function(n,t){n&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"div",0)(3,"h2"),s(4),a(),o(5,"div",1)(6,"button",2),C("click",function(){return t.descargarPDF()}),_(7,"ion-icon",3),o(8,"span",4),s(9,"PDF"),a()(),o(10,"button",5),C("click",function(){return t.imprimirAlbaran()}),_(11,"ion-icon",6),o(12,"span",4),s(13,"Imprimir"),a()(),o(14,"button",7),C("click",function(){return t.enviarAlbaranPorCorreo()}),k(15,co,1,0,"ion-icon",8)(16,so,1,0,"ion-icon",9),o(17,"span",4),s(18),a()(),o(19,"button",10),C("click",function(){return t.cerrarModal()}),_(20,"ion-icon",11),a()()()()(),o(21,"ion-content",12)(22,"div",13)(23,"div",14)(24,"h3"),s(25,"Informaci\xF3n del Aviso"),a(),o(26,"div",15)(27,"div",16)(28,"label"),s(29,"Cliente:"),a(),o(30,"span"),s(31),a()(),o(32,"div",16)(33,"label"),s(34,"Direcci\xF3n:"),a(),o(35,"span"),s(36),a()(),o(37,"div",16)(38,"label"),s(39,"Estado:"),a(),o(40,"span",17),_(41,"ion-icon",18),s(42),a()(),o(43,"div",16)(44,"label"),s(45,"Fecha de creaci\xF3n:"),a(),o(46,"span"),s(47),a()()()(),o(48,"div",14)(49,"h3"),s(50,"Fechas y Horarios"),a(),o(51,"div",15)(52,"div",16)(53,"label"),s(54,"Fecha de cierre:"),a(),o(55,"span"),s(56),a()(),o(57,"div",16)(58,"label"),s(59,"Hora de entrada:"),a(),o(60,"span"),s(61),a()(),o(62,"div",16)(63,"label"),s(64,"Hora de salida:"),a(),o(65,"span"),s(66),a()()()(),o(67,"div",14)(68,"h3"),s(69,"Descripci\xF3n del Trabajo Realizado"),a(),o(70,"div",19)(71,"p"),s(72),a()()(),o(73,"div",14)(74,"h3"),s(75,"Materiales Utilizados"),a(),o(76,"div",20),k(77,po,27,7,"div",21)(78,uo,3,1,"div",22)(79,mo,3,0,"div",23),a()(),k(80,bo,10,2,"div",24)(81,Mo,6,2,"div",24)(82,ho,6,2,"div",24)(83,vo,6,1,"div",24),o(84,"div",14)(85,"h3"),s(86,"Informaci\xF3n Adicional"),a(),o(87,"div",15)(88,"div",16)(89,"label"),s(90,"ID del trabajo:"),a(),o(91,"span"),s(92),a()(),o(93,"div",16)(94,"label"),s(95,"ID del aviso:"),a(),o(96,"span"),s(97),a()(),k(98,yo,5,1,"div",25),a()()(),o(99,"ion-footer")(100,"ion-toolbar")(101,"div",26)(102,"button",27),C("click",function(){return t.cerrarModal()}),s(103," Cerrar "),a(),o(104,"button",28),C("click",function(){return t.imprimirAlbaran()}),_(105,"ion-icon",6),s(106," Imprimir Albar\xE1n "),a()()()()()),n&2&&(d(4),U(" Albar\xE1n #",t.albaran.id==null?null:t.albaran.id.substring(0,8)," "),d(10),Fe("loading",t.enviandoCorreo),m("disabled",t.enviandoCorreo||!t.puedeEnviarPorCorreo())("title",t.getTituloBotonCorreo()),d(),m("ngIf",!t.enviandoCorreo),d(),m("ngIf",t.enviandoCorreo),d(2),h(t.enviandoCorreo?"Enviando...":"Email"),d(13),h((t.aviso==null?null:t.aviso.nombre_cliente_aviso)||"No especificado"),d(5),h((t.aviso==null?null:t.aviso.direccion_cliente_aviso)||"No especificada"),d(4),Ie("color",t.getEstadoAvisoColor(t.aviso==null?null:t.aviso.estado)),d(2),U(" ",(t.aviso==null?null:t.aviso.estado)||"No especificado"," "),d(5),h(t.formatearFecha(t.aviso==null?null:t.aviso.fecha_creacion)),d(9),h(t.formatearFecha(t.albaran.fecha_cierre)),d(5),h(t.formatearHora(t.albaran.hora_entrada)),d(5),h(t.formatearHora(t.albaran.hora_salida)),d(6),h(t.albaran.descripcion_trabajo_realizado),d(5),m("ngIf",t.repuestosCompletos()&&t.materialesUtilizados.length>0),d(),m("ngIf",!t.repuestosCompletos()&&t.materialesUtilizados.length>0),d(),m("ngIf",t.materialesUtilizados.length===0),d(),m("ngIf",t.albaran.estado_cierre==="Presupuesto pendiente"),d(),m("ngIf",t.albaran.dni_cliente||t.albaran.nombre_firma),d(),m("ngIf",t.tieneFirma()),d(),m("ngIf",t.albaran.observaciones),d(9),h(t.albaran.trabajo_id==null?null:t.albaran.trabajo_id.substring(0,8)),d(5),h(t.albaran.aviso_id==null?null:t.albaran.aviso_id.substring(0,8)),d(),m("ngIf",t.albaran.fecha_creacion))},dependencies:[ee,ie,K,je,ne,Ve,Ne,Te,De],styles:['@charset "UTF-8";ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #fff;--border-color: #e5e7eb;--color: #111827}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:16px!important;font-weight:600;color:#111827;display:flex;align-items:center;gap:12px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#10b981}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#6b7280;margin-top:0;font-size:14px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{background:#2563eb1a;color:#2563eb;border:1px solid rgba(37,99,235,.2);padding:8px 16px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s ease;display:flex;align-items:center;gap:8px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]:hover{background:#2563eb26;border-color:#2563eb4d;transform:translateY(-1px)}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]   .desktop-only[_ngcontent-%COMP%]{display:none}}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-email[_ngcontent-%COMP%]{background:#10b9811a;color:#10b981;border:1px solid rgba(16,185,129,.2);padding:8px 16px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s ease;display:flex;align-items:center;gap:8px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-email[_ngcontent-%COMP%]:hover:not(:disabled){background:#10b98126;border-color:#10b9814d;transform:translateY(-1px)}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-email[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;transform:none}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-email.loading[_ngcontent-%COMP%]{background:#10b98133;color:#059669}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-email[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-email[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%]{animation:spin 1s linear infinite}@media (max-width: 768px){ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-email[_ngcontent-%COMP%]   .desktop-only[_ngcontent-%COMP%]{display:none}}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-cerrar[_ngcontent-%COMP%]{width:36px;height:36px;border:none;background:#f8fafc;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;border:1px solid #E2E8F0}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-cerrar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#6b7280}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-cerrar[_ngcontent-%COMP%]:hover{background:#f1f5f9;border-color:#cbd5e1;transform:scale(1.05)}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-cerrar[_ngcontent-%COMP%]:hover   ion-icon[_ngcontent-%COMP%]{color:#374151}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-cerrar[_ngcontent-%COMP%]:active{transform:scale(.95)}ion-content[_ngcontent-%COMP%]{--background: #fff;--padding-top: 0;--padding-bottom: 0;--padding-start: 0;--padding-end: 0}ion-content[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{flex:1;overflow:hidden;display:flex;flex-direction:column;min-height:0}ion-content[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{flex:1;overflow:auto;position:relative;min-height:0;height:100%;padding:24px}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #fff;--border-color: #e5e7eb}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-size:14px;font-weight:500;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-outline[_ngcontent-%COMP%]{background:none;border:1px solid #d1d5db;color:#374151}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f8fafc;border-color:#9ca3af}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background-color:#2563eb;border:1px solid #2563eb;color:#fff}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1d4ed8;border-color:#1d4ed8}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:disabled{background-color:#9ca3af;border-color:#9ca3af;cursor:not-allowed;opacity:.6}.estado-section[_ngcontent-%COMP%]{text-align:center;margin-bottom:32px}.estado-section[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;border-radius:50px;color:#fff;font-size:16px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;box-shadow:0 4px 12px #00000026}.estado-section[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.info-section[_ngcontent-%COMP%]{margin-bottom:24px;padding:24px;background-color:#f9fafb;border-radius:8px;border:1px solid #e5e7eb}@media (max-width: 768px){.info-section[_ngcontent-%COMP%]{padding:20px;margin-bottom:20px}}@media (max-width: 480px){.info-section[_ngcontent-%COMP%]{padding:16px;margin-bottom:16px}}.info-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 20px;font-size:16px;color:#374151;font-weight:600;border-bottom:2px solid #10B981;padding-bottom:8px}@media (max-width: 768px){.info-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:15px;margin-bottom:16px}}@media (max-width: 480px){.info-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px}}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}@media (max-width: 768px){.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:16px}}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding:16px;background:#fff;border-radius:6px;border:1px solid #e5e7eb;transition:all .2s ease}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]:hover{border-color:#10b981;box-shadow:0 2px 8px #10b9811a}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:.5px}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:#1f2937;font-weight:500}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   span.estado-aviso[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600;text-transform:capitalize}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   span.estado-aviso[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.info-section[_ngcontent-%COMP%]   .descripcion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.6;color:#374151;background:#fff;padding:16px;border-radius:6px;border:1px solid #e5e7eb}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]{overflow-x:auto;background:#fff;border-radius:6px;border:1px solid #e5e7eb}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border-radius:6px;overflow:hidden}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid #e5e7eb}@media (max-width: 768px){.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px}}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f3f4f6;font-weight:600;color:#374151;font-size:12px;text-transform:uppercase;letter-spacing:.5px}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:14px;color:#1f2937;font-weight:500}@media (max-width: 768px){.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px}}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{background:#f0f9ff;font-weight:600}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-tabla[_ngcontent-%COMP%]   .materiales-table[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:#1e40af;font-size:14px}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-lista[_ngcontent-%COMP%]   .repuestos-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:flex;flex-wrap:wrap;gap:8px}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .materiales-lista[_ngcontent-%COMP%]   .repuestos-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{background:#e0f2fe;color:#0c4a6e;padding:8px 16px;border-radius:20px;font-size:12px;font-weight:500;border:1px solid #bae6fd}.info-section[_ngcontent-%COMP%]   .materiales-content[_ngcontent-%COMP%]   .no-materiales[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#6b7280;font-style:italic;background:#fff;border-radius:6px;border:2px dashed #e5e7eb}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px;background:#fef3c7;border:1px solid #f59e0b;border-radius:6px;margin-bottom:16px}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-status[_ngcontent-%COMP%]   .warning-icon[_ngcontent-%COMP%]{font-size:20px;color:#f59e0b}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-status[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{font-weight:600;color:#92400e;font-size:14px}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-amount[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;background:#f0f9ff;padding:16px;border-radius:6px;border:1px solid #bae6fd;margin-bottom:16px}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-amount[_ngcontent-%COMP%]   .amount-label[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#0369a1}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-amount[_ngcontent-%COMP%]   .amount-value[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#0369a1}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-actions[_ngcontent-%COMP%]   .action-description[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;margin:0 0 16px;line-height:1.5;padding:12px;background:#fff;border-radius:6px;border:1px solid #e5e7eb}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-actions[_ngcontent-%COMP%]   .btn-crear-presupuesto[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 16px;background:#10b981;color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s ease;width:100%;justify-content:center}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-actions[_ngcontent-%COMP%]   .btn-crear-presupuesto[_ngcontent-%COMP%]:hover{background:#059669;transform:translateY(-1px)}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-actions[_ngcontent-%COMP%]   .btn-crear-presupuesto[_ngcontent-%COMP%]:active{transform:translateY(0)}.info-section[_ngcontent-%COMP%]   .presupuesto-content[_ngcontent-%COMP%]   .presupuesto-actions[_ngcontent-%COMP%]   .btn-crear-presupuesto[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.info-section[_ngcontent-%COMP%]   .firma-content[_ngcontent-%COMP%]   .firma-imagen[_ngcontent-%COMP%]{text-align:center}.info-section[_ngcontent-%COMP%]   .firma-content[_ngcontent-%COMP%]   .firma-imagen[_ngcontent-%COMP%]   .firma-img[_ngcontent-%COMP%]{max-width:100%;max-height:200px;border:1px solid #e5e7eb;border-radius:6px;box-shadow:0 2px 8px #0000001a}.info-section[_ngcontent-%COMP%]   .firma-content[_ngcontent-%COMP%]   .firma-imagen[_ngcontent-%COMP%]   .firma-caption[_ngcontent-%COMP%]{margin-top:12px;font-size:12px;color:#6b7280;font-style:italic}.info-section[_ngcontent-%COMP%]   .firma-content[_ngcontent-%COMP%]   .firma-texto[_ngcontent-%COMP%]{text-align:center;padding:16px;background:#fff;border-radius:6px;border:1px solid #e5e7eb}.info-section[_ngcontent-%COMP%]   .firma-content[_ngcontent-%COMP%]   .firma-texto[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 12px;font-size:14px;color:#374151;font-weight:500}.info-section[_ngcontent-%COMP%]   .firma-content[_ngcontent-%COMP%]   .firma-texto[_ngcontent-%COMP%]   .firma-nombre[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;font-size:16px;font-weight:600;color:#059669}.info-section[_ngcontent-%COMP%]   .firma-content[_ngcontent-%COMP%]   .firma-texto[_ngcontent-%COMP%]   .firma-nombre[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.info-section[_ngcontent-%COMP%]   .observaciones-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.6;color:#374151;background:#fff;padding:16px;border-radius:6px;border:1px solid #e5e7eb;font-style:italic}@media (max-width: 768px){.modal-content[_ngcontent-%COMP%]{padding:10px}.info-section[_ngcontent-%COMP%]{padding:16px;margin-bottom:16px}.info-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;margin-bottom:12px}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{gap:12px}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{padding:12px}}@media (max-width: 480px){.modal-content[_ngcontent-%COMP%]{padding:12px!important}.info-section[_ngcontent-%COMP%]{padding:12px;margin-bottom:12px}.info-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:13px;margin-bottom:10px}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{gap:10px}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{padding:10px}}@media print{ion-header[_ngcontent-%COMP%], ion-footer[_ngcontent-%COMP%]{display:none}ion-content[_ngcontent-%COMP%]{--background: white}ion-content[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{padding:0;max-height:none;overflow:visible}.info-section[_ngcontent-%COMP%]{background:#fff!important;border:1px solid #e5e7eb!important;margin-bottom:20px!important;page-break-inside:avoid}.info-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#4f46e5!important;border-bottom:2px solid #10B981!important}.materiales-table[_ngcontent-%COMP%]{width:100%!important;border-collapse:collapse!important}.materiales-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .materiales-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e5e7eb!important;padding:8px!important}.materiales-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f3f4f6!important;font-weight:700!important}.presupuesto-content[_ngcontent-%COMP%]{background:#fef3c7!important;border:1px solid #f59e0b!important}.firma-content[_ngcontent-%COMP%]   .firma-img[_ngcontent-%COMP%]{max-width:200px!important;max-height:150px!important}.btn-crear-presupuesto[_ngcontent-%COMP%], .header-actions[_ngcontent-%COMP%], .button-group[_ngcontent-%COMP%]{display:none!important}.modal-content[_ngcontent-%COMP%]{font-size:12px!important;line-height:1.4!important}.info-item[_ngcontent-%COMP%]{padding:8px!important;margin-bottom:8px!important}.descripcion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .observaciones-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px!important;line-height:1.4!important}}']});let c=p;return c})();function wo(c,p){if(c&1&&(o(0,"div",17)(1,"p",18),s(2),a()()),c&2){let i=f(2);d(2),h(i.imagen.descripcion)}}function Eo(c,p){if(c&1){let i=j();o(0,"div",14)(1,"img",15),C("mousedown",function(n){w(i);let t=f();return E(t.onMouseDown(n))}),a(),k(2,wo,3,1,"div",16),a()}if(c&2){let i=f();d(),Ie("transform",i.getImageTransform())("cursor",i.zoomLevel>1?i.isDragging?"grabbing":"grab":"zoom-in"),m("src",i.imagen.url,J)("alt",i.imagen.descripcion||"Imagen del aviso"),d(),m("ngIf",i.imagen.descripcion)}}W({close:te,downloadOutline:Ee,trashOutline:pe,chevronBackOutline:Wn,chevronForwardOutline:Xn,refreshOutline:Z});var Mt=(()=>{let p=class p{constructor(e){this.modalController=e,this.imagen=null,this.zoomLevel=1,this.minZoom=.5,this.maxZoom=3,this.isDragging=!1,this.startX=0,this.startY=0,this.translateX=0,this.translateY=0,this.lastDistance=0,W({refreshOutline:Z,downloadOutline:Ee,trashOutline:pe,close:te})}cerrarModal(){this.modalController.dismiss()}descargarImagen(){var n;if(!((n=this.imagen)!=null&&n.url))return;let e=document.createElement("a");e.href=this.imagen.url,e.download=this.imagen.descripcion||`imagen-${this.imagen.id}`,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)}eliminarImagen(){confirm("\xBFEst\xE1s seguro de que quieres eliminar esta imagen?")&&this.modalController.dismiss({accion:"eliminar",imagen:this.imagen})}onWheel(e){e.preventDefault();let n=e.deltaY>0?-.1:.1,t=Math.max(this.minZoom,Math.min(this.maxZoom,this.zoomLevel+n));t!==this.zoomLevel&&(this.zoomLevel=t,this.zoomLevel===1&&(this.translateX=0,this.translateY=0))}onMouseDown(e){this.zoomLevel>1&&(this.isDragging=!0,this.startX=e.clientX-this.translateX,this.startY=e.clientY-this.translateY,e.preventDefault())}onMouseMove(e){this.isDragging&&this.zoomLevel>1&&(this.translateX=e.clientX-this.startX,this.translateY=e.clientY-this.startY)}onMouseUp(){this.isDragging=!1}onTouchStart(e){e.touches.length===2&&e.preventDefault()}onTouchMove(e){if(e.touches.length===2){e.preventDefault();let n=e.touches[0],t=e.touches[1],r=Math.sqrt(Math.pow(t.clientX-n.clientX,2)+Math.pow(t.clientY-n.clientY,2));if(this.lastDistance&&r!==this.lastDistance){let g=r/this.lastDistance,l=Math.max(this.minZoom,Math.min(this.maxZoom,this.zoomLevel*g));this.zoomLevel=l}this.lastDistance=r}}onTouchEnd(){this.lastDistance=0}resetZoom(){this.zoomLevel=1,this.translateX=0,this.translateY=0}getImageTransform(){return`scale(${this.zoomLevel}) translate(${this.translateX/this.zoomLevel}px, ${this.translateY/this.zoomLevel}px)`}};p.\u0275fac=function(n){return new(n||p)(N(re))},p.\u0275cmp=Q({type:p,selectors:[["app-ver-imagen-modal"]],inputs:{imagen:"imagen"},decls:15,vars:2,consts:[[1,"modal-header"],[1,"zoom-controls"],[1,"zoom-level"],["title","Resetear zoom",1,"btn-action",3,"click"],["name","refresh-outline"],[1,"header-actions"],["title","Descargar imagen",1,"btn-action",3,"click"],["name","download-outline"],["title","Eliminar imagen",1,"btn-action",3,"click"],["name","trash-outline"],["title","Cerrar",1,"btn-close",3,"click"],["name","close"],[1,"modal-content",3,"wheel","mousemove","mouseup","touchstart","touchmove","touchend"],["class","image-container",4,"ngIf"],[1,"image-container"],[1,"full-image",3,"mousedown","src","alt"],["class","image-info",4,"ngIf"],[1,"image-info"],[1,"image-description"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"span",2),s(3),a(),o(4,"button",3),C("click",function(){return t.resetZoom()}),_(5,"ion-icon",4),a()(),o(6,"div",5)(7,"button",6),C("click",function(){return t.descargarImagen()}),_(8,"ion-icon",7),a(),o(9,"button",8),C("click",function(){return t.eliminarImagen()}),_(10,"ion-icon",9),a(),o(11,"button",10),C("click",function(){return t.cerrarModal()}),_(12,"ion-icon",11),a()()(),o(13,"div",12),C("wheel",function(g){return t.onWheel(g)})("mousemove",function(g){return t.onMouseMove(g)})("mouseup",function(){return t.onMouseUp()})("touchstart",function(g){return t.onTouchStart(g)})("touchmove",function(g){return t.onTouchMove(g)})("touchend",function(){return t.onTouchEnd()}),k(14,Eo,3,7,"div",13),a()),n&2&&(d(3),U("",(t.zoomLevel*100).toFixed(0),"%"),d(11),m("ngIf",t.imagen))},dependencies:[ee,K,ne],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh;background:#000;color:#fff}.modal-header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1000;background:#000c;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:16px 20px;display:flex;justify-content:space-between;align-items:center}.zoom-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.zoom-controls[_ngcontent-%COMP%]   .zoom-level[_ngcontent-%COMP%]{color:#fff;font-size:14px;font-weight:500;background:#ffffff1a;padding:4px 8px;border-radius:6px;min-width:50px;text-align:center}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.btn-action[_ngcontent-%COMP%], .btn-close[_ngcontent-%COMP%], .btn-zoom[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:44px;height:44px;border:none;border-radius:50%;background:#ffffff1a;color:#fff;cursor:pointer;transition:all .2s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.btn-action[_ngcontent-%COMP%]:hover, .btn-close[_ngcontent-%COMP%]:hover, .btn-zoom[_ngcontent-%COMP%]:hover{background:#fff3;transform:scale(1.05)}.btn-action[_ngcontent-%COMP%]:active, .btn-close[_ngcontent-%COMP%]:active, .btn-zoom[_ngcontent-%COMP%]:active{transform:scale(.95)}.btn-action[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .btn-close[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .btn-zoom[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.btn-close[_ngcontent-%COMP%]{background:#ef4444cc}.btn-close[_ngcontent-%COMP%]:hover{background:#ef4444}.modal-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:80px 20px 20px;overflow:hidden}.image-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;max-width:100vw;max-height:100vh}.full-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;width:auto;height:auto;object-fit:contain;border-radius:8px;box-shadow:0 8px 32px #0000004d;cursor:zoom-in;transition:transform .1s ease;transform-origin:center center;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.full-image[_ngcontent-%COMP%]:hover:not([style*=scale]){transform:scale(1.02)}.image-info[_ngcontent-%COMP%]{margin-top:20px;text-align:center;max-width:600px;padding:16px 20px;background:#ffffff1a;border-radius:12px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}.image-description[_ngcontent-%COMP%]{margin:0;font-size:16px;line-height:1.5;color:#ffffffe6;font-weight:400}@media (max-width: 768px){.modal-header[_ngcontent-%COMP%]{padding:12px 16px}.zoom-controls[_ngcontent-%COMP%]   .zoom-level[_ngcontent-%COMP%]{font-size:12px;padding:3px 6px;min-width:40px}.btn-action[_ngcontent-%COMP%], .btn-close[_ngcontent-%COMP%], .btn-zoom[_ngcontent-%COMP%]{width:40px;height:40px}.btn-action[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .btn-close[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .btn-zoom[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.modal-content[_ngcontent-%COMP%]{padding:70px 16px 16px}.image-info[_ngcontent-%COMP%]{margin-top:16px;padding:12px 16px}.image-info[_ngcontent-%COMP%]   .image-description[_ngcontent-%COMP%]{font-size:14px}}@media (max-width: 480px){.modal-header[_ngcontent-%COMP%]{padding:50px 12px 10px}.btn-action[_ngcontent-%COMP%], .btn-close[_ngcontent-%COMP%]{width:36px;height:36px}.btn-action[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .btn-close[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.modal-content[_ngcontent-%COMP%]{padding:60px 12px 12px}.image-info[_ngcontent-%COMP%]{margin-top:12px;padding:10px 12px}.image-info[_ngcontent-%COMP%]   .image-description[_ngcontent-%COMP%]{font-size:13px}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}.full-image[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.image-container[_ngcontent-%COMP%]{overflow:auto;scroll-behavior:smooth}.full-image[_ngcontent-%COMP%]{cursor:grab}.full-image[_ngcontent-%COMP%]:active{cursor:grabbing}"]});let c=p;return c})();var zo=["fileInput"],So=(c,p,i)=>({finalizado:c,"presupuesto-pendiente":p,"otra-visita":i}),ko=(c,p,i)=>({green:c,yellow:p,blue:i});function Ao(c,p){c&1&&(o(0,"div",25)(1,"div",26),_(2,"ion-icon",27),o(3,"p"),s(4,"Cargando aviso..."),a()()())}function Io(c,p){if(c&1){let i=j();o(0,"div",28)(1,"div",29),_(2,"ion-icon",30),o(3,"p"),s(4),a(),o(5,"button",31),C("click",function(){w(i);let n=f();return E(n.cargarAviso())}),_(6,"ion-icon",32),s(7," Reintentar "),a()()()}if(c&2){let i=f();d(4),h(i.error)}}function Fo(c,p){if(c&1){let i=j();o(0,"button",65),C("click",function(){w(i);let n=f(2);return E(n.completarAviso())}),_(1,"ion-icon",66),o(2,"span",18),s(3,"Completar Aviso"),a(),o(4,"span",19),s(5,"Completar"),a()()}}function jo(c,p){if(c&1){let i=j();o(0,"button",67),C("click",function(){w(i);let n=f(2);return E(n.editarAviso())}),_(1,"ion-icon",68),o(2,"span",18),s(3,"Editar aviso"),a(),o(4,"span",19),s(5,"Editar"),a()()}}function To(c,p){c&1&&(o(0,"div",69),_(1,"ion-icon",70),o(2,"span"),s(3,"Aviso completado"),a()())}function Do(c,p){c&1&&(o(0,"div",71),_(1,"ion-icon",72),o(2,"span"),s(3,"Factura generada autom\xE1ticamente"),a()())}function Vo(c,p){if(c&1&&(o(0,"div",73),_(1,"ion-icon",74),o(2,"span"),s(3),a()()),c&2){let i=f(2);d(3),h(i.aviso.nombre_contacto)}}function No(c,p){if(c&1&&(o(0,"div",75),_(1,"ion-icon",76),o(2,"a",77),s(3),a()()),c&2){let i=f(2);d(2),Je("href","tel:",i.aviso.telefono_cliente_aviso,"",J),d(),h(i.aviso.telefono_cliente_aviso)}}function Ro(c,p){if(c&1&&(o(0,"div",75),_(1,"ion-icon",78),o(2,"a",77),s(3),a()()),c&2){let i=f(2);d(2),Je("href","mailto:",i.aviso.cliente==null?null:i.aviso.cliente.email,"",J),d(),h(i.aviso.cliente==null?null:i.aviso.cliente.email)}}function $o(c,p){if(c&1){let i=j();o(0,"div",4)(1,"div",5)(2,"div",33)(3,"div",34)(4,"button",35),C("click",function(){w(i);let n=f();return E(n.volverALista())}),_(5,"ion-icon",36),o(6,"span",18),s(7,"Volver"),a(),o(8,"span",19),s(9,"Volver"),a()()()(),o(10,"div",37)(11,"button",38),C("click",function(){w(i);let n=f();return E(n.forzarRecargaDatos())}),_(12,"ion-icon",32),o(13,"span",18),s(14,"Recargar"),a(),o(15,"span",19),s(16,"Recargar"),a()(),k(17,Fo,6,0,"button",39)(18,jo,6,0,"button",40)(19,To,4,0,"div",41)(20,Do,4,0,"div",42),a(),o(21,"span",43),s(22),B(23,"titlecase"),a()(),o(24,"h2",44)(25,"span",18),s(26),B(27,"titlecase"),a()(),o(28,"div",45)(29,"div",46)(30,"div",47)(31,"label"),s(32,"Estado"),a(),o(33,"span",48),s(34),a()(),o(35,"div",47)(36,"label"),s(37,"Urgente"),a(),o(38,"span",49),s(39),a()(),o(40,"div",47)(41,"label"),s(42,"Fecha de creaci\xF3n"),a(),o(43,"span"),s(44),B(45,"date"),a()()(),o(46,"div",50)(47,"div",47)(48,"label"),s(49,"Descripci\xF3n Detallada del Problema/Petici\xF3n"),a(),o(50,"p",51),s(51),a()()(),o(52,"div",52)(53,"label"),s(54,"Cliente"),a(),o(55,"div",53)(56,"span",54),s(57),a(),o(58,"a",55),C("click",function(){w(i);let n=f();return E(n.verCliente())}),o(59,"span",18),s(60,"Ver cliente"),a()()()(),o(61,"div",56)(62,"label"),s(63,"Direcci\xF3n"),a(),o(64,"div",57)(65,"span",58),s(66),a(),o(67,"button",59),C("click",function(){w(i);let n=f();return E(n.verMapa())}),_(68,"ion-icon",60),a()()(),o(69,"div",61)(70,"label"),s(71,"Contacto Cliente"),a(),o(72,"div",62),k(73,Vo,4,1,"div",63)(74,No,4,3,"div",64)(75,Ro,4,3,"div",64),a()()()()}if(c&2){let i=f();d(17),m("ngIf",(i.aviso==null?null:i.aviso.estado)!=="Completado"),d(),m("ngIf",(i.aviso==null?null:i.aviso.estado)!=="Completado"),d(),m("ngIf",(i.aviso==null?null:i.aviso.estado)==="Completado"),d(),m("ngIf",(i.aviso==null?null:i.aviso.estado)==="Listo para facturar"&&(i.aviso==null?null:i.aviso.facturas)&&(i.aviso==null?null:i.aviso.facturas.length)>0),d(2),le("Aviso ",i.aviso.numero_secuencial||i.aviso.id," - ",tn(23,20,(i.aviso==null?null:i.aviso.tipo)||"No especificado"),""),d(4),le("Aviso ",i.aviso.numero_secuencial||i.aviso.id," - ",tn(27,22,(i.aviso==null?null:i.aviso.tipo)||"No especificado"),""),d(7),m("ngClass",i.getEstadoClass(i.aviso.estado)),d(),h(i.aviso.estado),d(4),Fe("urgent",i.aviso.urgencia==="Alta"||i.aviso.es_urgente),d(),U(" ",i.aviso.urgencia==="Alta"||i.aviso.es_urgente?"S\xED":"No"," "),d(5),h(we(45,24,i.aviso.fecha_creacion,"dd/MM/yyyy")),d(7),h(i.aviso==null?null:i.aviso.descripcion_problema),d(6),h(i.aviso.nombre_cliente_aviso),d(9),h(i.aviso.direccion_cliente_aviso),d(7),m("ngIf",i.aviso.nombre_contacto),d(),m("ngIf",i.aviso.telefono_cliente_aviso),d(),m("ngIf",i.aviso.cliente==null?null:i.aviso.cliente.email)}}function Ho(c,p){if(c&1){let i=j();o(0,"div",79)(1,"button",67),C("click",function(){w(i);let n=f();return E(n.crearAlbaran())}),_(2,"ion-icon",17),o(3,"span",18),s(4,"Crear Albar\xE1n"),a(),o(5,"span",19),s(6,"Crear Albar\xE1n"),a()()()}}function Lo(c,p){if(c&1){let i=j();o(0,"div",80)(1,"div",81)(2,"app-flujo-estado",82),C("accionEjecutada",function(n){w(i);let t=f();return E(t.onAccionFlujoEjecutada(n))}),a()()()}if(c&2){let i=f();d(2),m("avisoId",(i.aviso==null?null:i.aviso.id)||"")}}function Bo(c,p){c&1&&(o(0,"div",83),_(1,"ion-icon",72),o(2,"p"),s(3,"No hay albaranes cerrados para este aviso"),a(),o(4,"p",84),s(5,"Los albaranes aparecer\xE1n aqu\xED una vez que se cierren los trabajos realizados"),a()())}function Uo(c,p){c&1&&(o(0,"span",108),_(1,"ion-icon",109),a())}function qo(c,p){if(c&1&&(o(0,"div",110)(1,"span",111),s(2),a(),o(3,"span",112),s(4,"repuestos"),a()()),c&2){let i=f().$implicit;d(2),U(" ",i.repuestos&&i.repuestos.length>0?i.repuestos.length:i.repuestos_utilizados.length," ")}}function Go(c,p){c&1&&(o(0,"div",113),s(1," Sin repuestos "),a())}function Yo(c,p){if(c&1&&(o(0,"div",114)(1,"span",115),s(2),B(3,"number"),a()()),c&2){let i=f().$implicit;d(2),U(" \u20AC",we(3,1,i.presupuesto_necesario,"1.2-2")," ")}}function Wo(c,p){if(c&1){let i=j();o(0,"div",92)(1,"div",93),s(2),a(),o(3,"div",94)(4,"div",95)(5,"span",96),s(6),a(),k(7,Uo,2,0,"span",97),a()(),o(8,"div",98),s(9),B(10,"date"),a(),o(11,"div",99),k(12,qo,5,1,"div",100)(13,Go,2,0,"div",101),a(),o(14,"div",102)(15,"button",103),C("click",function(){let n=w(i).$implicit,t=f(2);return E(t.verAlbaran(n))}),_(16,"ion-icon",104),a(),o(17,"button",105),C("click",function(){let n=w(i).$implicit,t=f(2);return E(t.eliminarAlbaran(n))}),_(18,"ion-icon",106),a(),k(19,Yo,4,4,"div",107),a()()}if(c&2){let i=p.$implicit,e=p.index,n=f(2);m("ngClass",nn(12,So,i.estado_cierre==="Finalizado",i.estado_cierre==="Presupuesto pendiente",i.estado_cierre==="Otra visita")),d(2),h(e+1),d(3),m("ngClass",nn(16,ko,i.estado_cierre==="Finalizado",i.estado_cierre==="Presupuesto pendiente",i.estado_cierre==="Otra visita")),d(),U(" ",i.estado_cierre," "),d(),m("ngIf",n.tienePresupuestoAsociado(i)),d(2),h(we(10,9,i.fecha_cierre,"dd/MM/yyyy")),d(3),m("ngIf",i.repuestos&&i.repuestos.length>0||i.repuestos_utilizados&&i.repuestos_utilizados.length>0),d(),m("ngIf",(!i.repuestos||i.repuestos.length===0)&&(!i.repuestos_utilizados||i.repuestos_utilizados.length===0)),d(6),m("ngIf",i.presupuesto_necesario>0)}}function Zo(c,p){if(c&1&&(o(0,"div",85)(1,"div",86)(2,"div",87)(3,"div",88)(4,"div",89),s(5,"N\xFAmero"),a(),o(6,"div",89),s(7,"Estado"),a(),o(8,"div",89),s(9,"Fecha"),a(),o(10,"div",89),s(11,"Repuestos"),a(),o(12,"div",89),s(13,"Acciones"),a()()(),o(14,"div",90),k(15,Wo,20,20,"div",91),a()()()),c&2){let i=f();d(15),m("ngForOf",i.aviso==null?null:i.aviso.albaranes)}}function Xo(c,p){c&1&&(o(0,"div",116),_(1,"ion-icon",27),o(2,"p"),s(3,"Subiendo im\xE1genes..."),a()())}function Jo(c,p){c&1&&(o(0,"div",117),_(1,"ion-icon",118),o(2,"p"),s(3,"No hay im\xE1genes disponibles para este aviso"),a()())}function Qo(c,p){if(c&1){let i=j();o(0,"div",119)(1,"img",120),C("click",function(){let n=w(i).$implicit,t=f();return E(t.verImagenCompleta(n))}),a(),o(2,"div",121)(3,"span",122),s(4),a(),o(5,"span",123),s(6),B(7,"date"),a()(),o(8,"button",124),C("click",function(){let n=w(i).$implicit,t=f();return E(t.eliminarFoto(n))}),_(9,"ion-icon",106),a()()}if(c&2){let i=p.$implicit;d(),m("src",i.url,J)("alt",i.descripcion||"Imagen del aviso"),d(3),h(i.descripcion||"Imagen del aviso"),d(2),h(we(7,4,i.fecha_subida,"dd/MM/yyyy HH:mm"))}}W({close:te,pencilOutline:ze,navigate:ln,person:dn,call:rn,mail:cn,mapOutline:sn,arrowBackOutline:an});var Ja=(()=>{let p=class p{constructor(e,n,t,r,g,l,M){this.route=e,this.router=n,this.avisosService=t,this.albaranesService=r,this.modalController=g,this.flujoAvisosService=l,this.unifiedReconnectionService=M,this.vistaGaleria="grid",this.aviso=null,this.loading=!1,this.error=null,this.subiendoImagenes=!1,this.estadoClassCache="estado-pendiente",this.ultimoEstado=void 0,this.destroy$=new Ae,W({refreshOutline:Z,alertCircleOutline:Un,arrowBackOutline:an,close:te,pencilOutline:ze,checkmarkCircleOutline:ce,navigate:ln,person:dn,call:rn,mail:cn,addCircle:Ln,documentTextOutline:se,calculator:He,eyeOutline:Ue,imagesOutline:tt,trashOutline:pe,informationCircleOutline:qe,constructOutline:Qn,bugOutline:Gn,personOutline:Pe,gridOutline:nt,listOutline:ot,chevronDownOutline:Zn,ellipsisVerticalOutline:et,ellipsisVertical:Kn,add:Hn,mapOutline:sn})}ngOnInit(){this.unifiedReconnectionService.appResumed.pipe(G(this.destroy$),fn()).subscribe(e=>{e&&(console.log("\u{1F504} VerAvisosComponent: App reanudada, recargando aviso..."),this.cargarAviso())}),this.unifiedReconnectionService.connectionState.pipe(G(this.destroy$)).subscribe(e=>{console.log("\u{1F504} VerAvisosComponent: Estado de conexi\xF3n:",e),e==="connected"&&this.error&&this.cargarAviso()}),this.cargarAviso()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarAviso(){console.log("\u{1F504} cargarAviso() ejecut\xE1ndose..."),this.loading=!0,this.error=null,this.route.params.pipe(G(this.destroy$)).subscribe(e=>{let n=e["id-aviso"];console.log("\u{1F50D} ID de aviso obtenido de la URL:",n),n?this.avisosService.getResumenCompletoAvisoDirect(n).pipe(G(this.destroy$)).subscribe({next:t=>{var r,g;console.log("\u2705 Aviso cargado exitosamente:",t.id,"Estado:",t.estado),console.log("\u{1F4CA} Albaranes cargados:",((r=t.albaranes)==null?void 0:r.length)||0),console.log("\u{1F4CA} Facturas cargadas:",((g=t.facturas)==null?void 0:g.length)||0),this.aviso=t,this.loading=!1,this.getEstadoClass(t.estado),this.verificarEstadoRealAviso(t),setTimeout(()=>{this.flujoComponent&&this.flujoComponent.recargarFlujo()},100)},error:t=>{console.error("\u274C Error al cargar el aviso:",t),this.error="Error al cargar el aviso. Por favor, int\xE9ntalo de nuevo.",this.loading=!1}}):(this.error="ID de aviso no v\xE1lido",this.loading=!1)})}cambiarVistaGaleria(e){this.vistaGaleria=e.detail.value}verificarGeneracionFacturaAutomatica(e){console.log("\u{1F50D} Verificando generaci\xF3n autom\xE1tica de factura para aviso:",e);let n=setTimeout(()=>{console.log("\u23F0 Timeout en verificaci\xF3n de factura autom\xE1tica - cancelando")},1e4);this.flujoAvisosService.actualizarEstadoConFacturaAutomatica(e).subscribe({next:t=>{clearTimeout(n),console.log("\u{1F50D} Resultado de verificaci\xF3n autom\xE1tica:",t),t.facturaGenerada?(console.log("\u{1F4B0} Factura generada autom\xE1ticamente al cargar aviso:",t.facturaGenerada),this.mostrarMensaje("Factura generada autom\xE1ticamente para el aviso.","success"),this.cargarAviso()):console.log("\u2139\uFE0F No se gener\xF3 factura autom\xE1tica - condiciones no cumplidas")},error:t=>{clearTimeout(n),console.error("\u274C Error al verificar generaci\xF3n autom\xE1tica:",t)}})}verificarEstadoRealAviso(e){var r,g,l,M,b;console.log("\u{1F50D} Verificando estado real del aviso bas\xE1ndose en facturas:",{avisoId:e.id,estadoActual:e.estado,facturas:((r=e.facturas)==null?void 0:r.length)||0,albaranes:((g=e.albaranes)==null?void 0:g.length)||0,albaranesDetalle:((l=e.albaranes)==null?void 0:l.map(u=>({id:u.id,estado:u.estado_cierre})))||[]});let n=e.albaranes&&e.albaranes.length>0,t=e.facturas&&e.facturas.length>0;if(!n&&!t){console.log("\u2139\uFE0F Aviso sin albaranes ni facturas - no se requieren verificaciones de estado");return}if(e.estado==="Listo para facturar"&&t)console.log('\u26A0\uFE0F Aviso en estado "Listo para facturar" pero tiene facturas - actualizando a "En curso"'),this.avisosService.actualizarAvisoDirect(e.id,{estado:"En curso"}).subscribe({next:u=>{console.log('\u2705 Estado del aviso actualizado a "En curso"'),this.aviso=u},error:u=>{console.error("\u274C Error al actualizar estado del aviso:",u)}});else if(e.estado==="Listo para facturar"&&!t&&n){console.log('\u{1F4B0} Aviso en estado "Listo para facturar" sin facturas - verificando generaci\xF3n autom\xE1tica');let u=((M=e.albaranes)==null?void 0:M.filter(I=>I.estado_cierre==="Finalizado"))||[];console.log("\u{1F50D} Albaranes finalizados encontrados:",u.length),u.length>0?(console.log("\u2705 Aviso tiene albaranes finalizados sin facturas - generando factura autom\xE1ticamente"),this.verificarGeneracionFacturaAutomatica(e.id)):console.log('\u26A0\uFE0F Aviso en "Listo para facturar" pero no tiene albaranes finalizados')}else e.estado==="En curso"&&!t&&n&&(console.log('\u{1F50D} Aviso en estado "En curso" sin facturas - verificando si deber\xEDa estar "Listo para facturar"'),(((b=e.albaranes)==null?void 0:b.filter(I=>I.estado_cierre==="Finalizado"))||[]).length>0&&(console.log('\u{1F4B0} Aviso tiene albaranes finalizados sin facturas - actualizando a "Listo para facturar"'),this.avisosService.actualizarAvisoDirect(e.id,{estado:"Listo para facturar"}).subscribe({next:I=>{console.log('\u2705 Estado del aviso actualizado a "Listo para facturar"'),this.aviso=I,this.verificarGeneracionFacturaAutomatica(e.id)},error:I=>{console.error("\u274C Error al actualizar estado del aviso:",I)}})))}forzarRecargaDatos(){this.error=null,this.cargarAviso(),setTimeout(()=>{this.flujoComponent&&this.flujoComponent.recargarFlujo()},200)}recargarAlbaranes(){var e;(e=this.aviso)!=null&&e.id&&(console.log("\u{1F504} Recargando albaranes del aviso:",this.aviso.id),this.avisosService.getResumenCompletoAvisoDirect(this.aviso.id).pipe(G(this.destroy$)).subscribe({next:n=>{var t;console.log("\u2705 Albaranes recargados:",((t=n.albaranes)==null?void 0:t.length)||0),this.aviso=n},error:n=>{console.error("\u274C Error al recargar albaranes:",n)}}))}volverALista(){let e=document.referrer;e&&e.includes("/historial")?this.router.navigate(["/historial"]):this.router.navigate(["/avisos"])}verCliente(){var e,n;(n=(e=this.aviso)==null?void 0:e.cliente)!=null&&n.id&&console.log("Navegar al cliente:",this.aviso.cliente.id)}verMapa(){var e;if((e=this.aviso)!=null&&e.direccion_cliente_aviso){let n=encodeURIComponent(this.aviso.direccion_cliente_aviso);window.open(`https://www.google.com/maps/search/?api=1&query=${n}`,"_blank")}}editarAviso(){var e;(e=this.aviso)!=null&&e.id&&this.abrirModalEditarAviso()}abrirModalEditarAviso(){return L(this,null,function*(){var r;if(!((r=this.aviso)!=null&&r.id))return;let e=yield this.modalController.create({component:lt,cssClass:"modal-crear-aviso",componentProps:{modoEdicion:!0,avisoExistente:this.aviso}});yield e.present();let{data:n,role:t}=yield e.onWillDismiss();if(t==="confirm"&&n)try{console.log("Datos del formulario de edici\xF3n:",n);let g={tipo:n.tipo,nombre_cliente_aviso:n.nombreContacto,direccion_cliente_aviso:n.direccionLocal,telefono_cliente_aviso:n.telefono,nombre_contacto:n.nombreContacto,descripcion_problema:n.descripcion,es_urgente:n.esUrgente,urgencia:n.esUrgente?"Alta":"Normal"};this.loading=!0,this.avisosService.actualizarAvisoDirect(this.aviso.id,g).pipe(G(this.destroy$)).subscribe({next:l=>{console.log("Aviso actualizado exitosamente:",l),this.loading=!1,this.mostrarMensaje("Aviso actualizado exitosamente","success"),this.cargarAviso()},error:l=>{console.error("Error al actualizar aviso:",l),this.loading=!1,this.mostrarMensaje(l.message||"Error al actualizar el aviso. Por favor, int\xE9ntalo de nuevo.","error")}})}catch(g){console.error("Error al procesar la edici\xF3n:",g),this.mostrarMensaje("Error al procesar la edici\xF3n. Por favor, int\xE9ntalo de nuevo.","error")}})}cerrarAlbaran(){var e;(e=this.aviso)!=null&&e.id&&console.log("Cerrar albar\xE1n para aviso:",this.aviso.id)}seleccionarImagenes(){this.fileInput&&this.fileInput.nativeElement.click()}onFileSelected(e){var t;let n=e.target.files;n.length>0&&((t=this.aviso)!=null&&t.id)&&this.subirImagenes(Array.from(n)),e.target.value=""}subirImagenes(e){return L(this,null,function*(){var n;if(!((n=this.aviso)!=null&&n.id)){console.error("No se puede subir im\xE1genes: aviso no v\xE1lido");return}this.subiendoImagenes=!0,this.error=null;try{yield new Promise(r=>{let g=0,l=e.length;e.forEach(M=>{this.avisosService.subirFotoDirect(this.aviso.id,M).pipe(G(this.destroy$)).subscribe({next:b=>{console.log("Foto subida:",b),g++,g===l&&r()},error:b=>{console.error("Error al subir foto:",b),g++,g===l&&r()}})})}),this.cargarAviso()}catch(t){console.error("Error al subir im\xE1genes:",t),this.error="Error al subir las im\xE1genes. Por favor, int\xE9ntalo de nuevo."}finally{this.subiendoImagenes=!1}})}crearAlbaran(){return L(this,null,function*(){var r;if(!((r=this.aviso)!=null&&r.id))return;let e=yield this.modalController.create({component:ft,componentProps:{aviso:this.aviso},backdropDismiss:!1,showBackdrop:!0});yield e.present();let{data:n,role:t}=yield e.onWillDismiss();if(t==="confirm"&&(n!=null&&n.success))try{console.log("\u2705 Albar\xE1n creado exitosamente:",n.albaran),n.presupuesto&&n.accion==="presupuesto_creado"&&(console.log("\u2705 Presupuesto creado junto con el albar\xE1n:",n.presupuesto),alert(n.mensaje||"Albar\xE1n y presupuesto creados exitosamente. Puedes editarlo desde la secci\xF3n de presupuestos.")),alert(n.mensaje||"Albar\xE1n creado exitosamente"),this.cargarAviso()}catch(g){console.error("Error al procesar albar\xE1n:",g),alert("Error al procesar el albar\xE1n. Por favor, int\xE9ntalo de nuevo.")}})}verImagenCompleta(e){return L(this,null,function*(){if(!(e!=null&&e.url)){console.error("No se puede mostrar la imagen: URL no v\xE1lida");return}let n=yield this.modalController.create({component:Mt,componentProps:{imagen:e},cssClass:"modal-imagen-completa",backdropDismiss:!0,showBackdrop:!0});yield n.present();let{data:t,role:r}=yield n.onWillDismiss();r==="confirm"&&(t==null?void 0:t.accion)==="eliminar"&&(console.log("Imagen eliminada desde el modal"),this.cargarAviso())})}eliminarFoto(e){return L(this,null,function*(){var t;if(!((t=this.aviso)!=null&&t.id)||!(e!=null&&e.id)){console.error("No se puede eliminar la foto: faltan datos");return}if(confirm(`\xBFEst\xE1s seguro de que quieres eliminar esta imagen?

Esta acci\xF3n no se puede deshacer.`))try{yield _n(this.avisosService.eliminarFotoDirect(e.id)),console.log("Foto eliminada exitosamente"),this.cargarAviso()}catch(r){console.error("Error al eliminar la foto:",r),alert("Error al eliminar la imagen. Por favor, int\xE9ntalo de nuevo.")}})}getEstadoClass(e){if(!e)return this.ultimoEstado!==void 0&&(this.ultimoEstado=void 0,this.estadoClassCache="estado-pendiente"),this.estadoClassCache;if(this.ultimoEstado!==e){this.ultimoEstado=e;let n=e.toLowerCase().replace(/ /g,"-");this.estadoClassCache=`estado-${n}`}return this.estadoClassCache}onAccionFlujoEjecutada(e){var n;console.log("Acci\xF3n de flujo ejecutada:",e),this.cargarAviso(),(n=this.aviso)!=null&&n.id&&this.flujoAvisosService.actualizarEstadoConFacturaAutomatica(this.aviso.id).subscribe({next:t=>{console.log("Estado del aviso actualizado autom\xE1ticamente:",t.aviso.estado),t.facturaGenerada?(console.log("\u{1F4B0} Factura generada autom\xE1ticamente:",t.facturaGenerada),this.mostrarMensaje("Factura generada autom\xE1ticamente para el aviso.","success")):t.aviso.estado==="Listo para facturar"&&(console.log("\u{1F4B0} Aviso listo para facturar - verificando si se gener\xF3 factura autom\xE1ticamente..."),setTimeout(()=>{this.mostrarMensaje("El aviso est\xE1 listo para facturar. Se generar\xE1 la factura autom\xE1ticamente si hay albaranes finalizados.","info")},1e3)),this.cargarAviso()},error:t=>{console.error("Error al actualizar estado autom\xE1tico:",t)}}),e.mensaje&&(console.log("Mensaje de \xE9xito:",e.mensaje),alert(e.mensaje)),e.facturaId&&confirm("Se ha generado una factura. \xBFDeseas ver la factura creada?")&&this.router.navigate(["/facturas",e.facturaId])}completarAviso(){var e;(e=this.aviso)!=null&&e.id?(console.log("\u{1F504} Completando aviso:",this.aviso.id),confirm("\xBFEst\xE1s seguro de que quieres marcar este aviso como completado? Esta acci\xF3n no se puede deshacer.")&&(this.loading=!0,this.error=null,this.flujoAvisosService.completarAviso(this.aviso.id).subscribe({next:n=>{console.log("\u2705 Aviso completado exitosamente:",n),this.loading=!1,this.mostrarMensaje("Aviso completado exitosamente","success"),this.cargarAviso()},error:n=>{console.error("\u274C Error al completar aviso:",n),this.loading=!1;let t=n.message||"Error al completar el aviso. Verifica que haya trabajos realizados y facturas generadas.";this.mostrarMensaje(t,"error"),this.error=t}}))):(console.error("No hay aviso seleccionado para completar"),this.mostrarMensaje("No hay aviso seleccionado para completar","error"))}verAlbaran(e){return L(this,null,function*(){var n;if(!(e!=null&&e.id)){console.error("No se puede abrir el albar\xE1n: ID no v\xE1lido");return}try{console.log("Abriendo modal de albar\xE1n:",e);let t=yield this.modalController.create({component:Pt,componentProps:{albaran:e,aviso:this.aviso},cssClass:"modal-ver-albaran modal-fullscreen",backdropDismiss:!0});yield t.present();let{data:r,role:g}=yield t.onWillDismiss();if(g==="confirm"&&r&&(console.log("Modal de albar\xE1n cerrado con datos:",r),r.accion==="presupuesto_creado")){console.log("\u2705 Presupuesto creado desde el modal del albar\xE1n:",r.presupuesto),r.mensaje&&alert(r.mensaje),r.navegoAPresupuesto||this.cargarAviso();return}console.log("Modal de albar\xE1n cerrado. Recargando datos..."),this.cargarAviso(),(n=this.aviso)!=null&&n.id&&this.flujoAvisosService.actualizarEstadoConFacturaAutomatica(this.aviso.id).subscribe({next:l=>{console.log("Estado del aviso actualizado autom\xE1ticamente despu\xE9s de cerrar albar\xE1n:",l.aviso.estado),l.facturaGenerada&&(console.log("\u{1F4B0} Factura generada autom\xE1ticamente despu\xE9s de cerrar albar\xE1n:",l.facturaGenerada),this.mostrarMensaje("Factura generada autom\xE1ticamente despu\xE9s de cerrar el albar\xE1n.","success")),this.cargarAviso()},error:l=>{console.error("Error al actualizar estado autom\xE1tico despu\xE9s de cerrar albar\xE1n:",l)}})}catch(t){console.error("Error al abrir el modal del albar\xE1n:",t),this.mostrarMensaje("Error al abrir el albar\xE1n. Por favor, int\xE9ntalo de nuevo.","error")}})}tienePresupuestoAsociado(e){var n;return!((n=this.aviso)!=null&&n.presupuestos)||this.aviso.presupuestos.length===0?!1:this.aviso.presupuestos.some(t=>t.albaran_id===e.id)}eliminarAlbaran(e){var t;if(!(e!=null&&e.id)){console.error("No se puede eliminar el albar\xE1n: ID no v\xE1lido");return}if(this.tienePresupuestoAsociado(e)){alert(`\u26A0\uFE0F No se puede eliminar este albar\xE1n porque tiene un presupuesto asociado.

Primero debes eliminar el presupuesto.`);return}confirm(`\xBFEst\xE1s seguro de que quieres eliminar el albar\xE1n #${(t=e.id)==null?void 0:t.substring(0,8)}?

Los repuestos utilizados se devolver\xE1n autom\xE1ticamente al inventario.

Esta acci\xF3n no se puede deshacer.`)&&(this.loading=!0,this.albaranesService.eliminarAlbaranDirect(e.id).subscribe({next:()=>{console.log("Albar\xE1n eliminado exitosamente y repuestos devueltos al inventario"),this.loading=!1,alert(`\u2705 Albar\xE1n eliminado exitosamente.

Los repuestos utilizados han sido devueltos autom\xE1ticamente al inventario.`),this.cargarAviso()},error:r=>{console.error("Error al eliminar albar\xE1n:",r),this.loading=!1,alert("Error al eliminar el albar\xE1n: "+(r.message||"Error desconocido"))}}))}mostrarMensaje(e,n="info"){console.log(`[${n.toUpperCase()}] ${e}`),n==="error"?alert(`ERROR: ${e}`):n==="success"?console.log(`\u2705 ${e}`):n==="info"?(console.log(`\u2139\uFE0F ${e}`),alert(`\u2139\uFE0F ${e}`)):console.log(`\u2139\uFE0F ${e}`)}};p.\u0275fac=function(n){return new(n||p)(N(xn),N(fe),N(be),N(Ye),N(re),N(Ze),N($e))},p.\u0275cmp=Q({type:p,selectors:[["app-ver-avisos"]],viewQuery:function(n,t){if(n&1&&(he(zo,5),he(gn,5)),n&2){let r;ve(r=ye())&&(t.fileInput=r.first),ve(r=ye())&&(t.flujoComponent=r.first)}},decls:34,vars:13,consts:[["fileInput",""],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","info-card",4,"ngIf"],[1,"info-card"],[1,"card-header"],[2,"text-wrap","nowrap"],["class","header-actions-jobs",4,"ngIf"],["class","flujo-section",4,"ngIf"],[1,"section-divider"],[1,"albaranes-section"],[1,"albaranes-container"],["class","no-albaranes",4,"ngIf"],["class","compact-albaranes-table",4,"ngIf"],[1,"card-header",2,"justify-content","space-between!important"],[1,"gallery-actions"],[1,"btn-primary",3,"click","disabled"],["name","add-circle"],[1,"desktop-only"],[1,"mobile-only"],["type","file","multiple","","accept","image/*",2,"display","none",3,"change"],[1,"gallery-items"],["class","uploading-indicator",4,"ngIf"],["class","no-images",4,"ngIf"],["class","gallery-item",4,"ngFor","ngForOf"],[1,"loading-state"],[1,"loading-spinner"],["name","refresh-outline",1,"spinning"],[1,"error-state"],[1,"error-message"],["name","alert-circle-outline"],[1,"btn-retry",3,"click"],["name","refresh-outline"],[1,"header-container"],[1,"back-button"],[1,"btn-back",3,"click"],["name","arrow-back-outline"],[1,"header-actions"],["title","Recargar datos",1,"btn-secondary",3,"click"],["class","btn-secondary",3,"click",4,"ngIf"],["class","btn-primary",3,"click",4,"ngIf"],["class","aviso-completado-message",4,"ngIf"],["class","factura-generada-message",4,"ngIf"],[1,"mobile-only","title"],[1,"title"],[1,"info-grid"],[1,"info-row"],[1,"info-item"],[1,"estado-aviso",3,"ngClass"],[1,"urgent-badge"],[1,"descripcion-content"],[1,"descripcion-texto"],[1,"info-item","cliente-section"],[1,"cliente-info"],[1,"cliente-nombre"],[1,"ver-cliente",3,"click"],[1,"info-item","direccion-section"],[1,"direccion-info"],[1,"direccion-texto"],["title","Ver en mapa",1,"btn-map",3,"click"],["name","navigate"],[1,"contacto-section"],[1,"contacto-items"],["class","contacto-item nombre-contacto",4,"ngIf"],["class","contacto-item",4,"ngIf"],[1,"btn-secondary",3,"click"],["name","close"],[1,"btn-primary",3,"click"],["name","pencil-outline"],[1,"aviso-completado-message"],["name","checkmark-circle-outline"],[1,"factura-generada-message"],["name","document-text-outline"],[1,"contacto-item","nombre-contacto"],["name","person"],[1,"contacto-item"],["name","call"],[1,"contacto-link",3,"href"],["name","mail"],[1,"header-actions-jobs"],[1,"flujo-section"],[1,"flujo-container"],[3,"accionEjecutada","avisoId"],[1,"no-albaranes"],[1,"info-text"],[1,"compact-albaranes-table"],[1,"albaranes-table"],[1,"table-header"],[1,"header-row"],[1,"header-cell"],[1,"table-body"],["class","albaran-row",3,"ngClass",4,"ngFor","ngForOf"],[1,"albaran-row",3,"ngClass"],[1,"albaran-cell","numero-albaran"],[1,"albaran-cell","estado-albaran"],[1,"estado-container"],[1,"badge",3,"ngClass"],["class","badge badge-presupuesto","title","Presupuesto creado",4,"ngIf"],[1,"albaran-cell","fecha-albaran"],[1,"albaran-cell","repuestos-albaran"],["class","repuestos-info",4,"ngIf"],["class","repuestos-vacio",4,"ngIf"],[1,"albaran-cell","acciones"],["title","Ver albar\xE1n completo",1,"btn-ver",3,"click"],["name","eye-outline"],["title","Eliminar albar\xE1n",1,"btn-eliminar",3,"click"],["name","trash-outline"],["class","mobile-info",4,"ngIf"],["title","Presupuesto creado",1,"badge","badge-presupuesto"],["name","calculator"],[1,"repuestos-info"],[1,"repuestos-count"],[1,"repuestos-label"],[1,"repuestos-vacio"],[1,"mobile-info"],[1,"presupuesto-mobile"],[1,"uploading-indicator"],[1,"no-images"],["name","images-outline"],[1,"gallery-item"],[1,"clickable-image",3,"click","src","alt"],[1,"image-info"],[1,"image-title"],[1,"file-info"],["title","Eliminar imagen",1,"btn-delete",3,"click"]],template:function(n,t){if(n&1){let r=j();k(0,Ao,5,0,"div",1)(1,Io,8,1,"div",2)(2,$o,76,27,"div",3),o(3,"div",4)(4,"div",5)(5,"h2",6),s(6,"Gesti\xF3n de Albaranes"),a(),k(7,Ho,7,0,"div",7),a(),k(8,Lo,3,1,"div",8),o(9,"div",9),_(10,"hr"),o(11,"span"),s(12,"Albaranes Cerrados"),a()(),o(13,"div",10)(14,"div",11),k(15,Bo,6,0,"div",12)(16,Zo,16,1,"div",13),a()()(),o(17,"div",4)(18,"div",14)(19,"h2"),s(20,"Galer\xEDa de im\xE1genes"),a(),o(21,"div",15)(22,"button",16),C("click",function(){return w(r),E(t.seleccionarImagenes())}),_(23,"ion-icon",17),o(24,"span",18),s(25),a(),o(26,"span",19),s(27),a()(),o(28,"input",20,0),C("change",function(l){return w(r),E(t.onFileSelected(l))}),a()()(),o(30,"div",21),k(31,Xo,4,0,"div",22)(32,Jo,4,0,"div",23)(33,Qo,10,7,"div",24),a()()}n&2&&(m("ngIf",t.loading),d(),m("ngIf",t.error&&!t.loading),d(),m("ngIf",t.aviso&&!t.loading),d(5),m("ngIf",(t.aviso==null?null:t.aviso.estado)!=="Completado"),d(),m("ngIf",t.aviso==null?null:t.aviso.id),d(7),m("ngIf",!(t.aviso!=null&&t.aviso.albaranes)||(t.aviso==null||t.aviso.albaranes==null?null:t.aviso.albaranes.length)===0),d(),m("ngIf",(t.aviso==null?null:t.aviso.albaranes)&&(t.aviso==null?null:t.aviso.albaranes.length)>0),d(6),m("disabled",t.subiendoImagenes),d(3),h(t.subiendoImagenes?"Subiendo...":"A\xF1adir im\xE1genes"),d(2),h(t.subiendoImagenes?"Subiendo...":"A\xF1adir"),d(4),m("ngIf",t.subiendoImagenes),d(),m("ngIf",!(t.aviso!=null&&t.aviso.fotos)||(t.aviso==null||t.aviso.fotos==null?null:t.aviso.fotos.length)===0),d(),m("ngForOf",t.aviso==null?null:t.aviso.fotos))},dependencies:[ee,_e,ie,K,On,Pn,Mn,ne,gn],styles:['[_nghost-%COMP%]{display:block;padding:24px}.back-button[_ngcontent-%COMP%]{margin-bottom:0}.back-button[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 16px;background-color:#fff;color:#4f46e5;border:1px solid #E5E7EB;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s ease}.back-button[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#4f46e5}.back-button[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px;text-align:center}.loading-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px}.loading-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#4f46e5}.loading-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#6b7280;margin:0}.loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#ef4444}.loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 20px;background-color:#4f46e5;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:background-color .2s ease}.loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]:hover, .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]:hover{background-color:#3a30e2}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.aviso-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.aviso-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#111827}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.btn-primary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:10px 15px;background-color:#4f46e5;color:#fff;border:none;border-radius:.5rem;cursor:pointer;font-size:15px;font-weight:500}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#3a30e2}.btn-secondary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:10px 15px;background-color:#fff;color:#26262a;border:none;border-radius:.5rem;cursor:pointer;font-size:15px;font-weight:500;border:1px solid rgba(125,131,152,.2431372549)}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.btn-danger[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:10px 15px;background-color:#ef4444;color:#fff;border:none;border-radius:.5rem;cursor:pointer;font-size:15px;font-weight:500}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#dc2626}.btn-danger.btn-small[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.info-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;box-shadow:0 2px 8px #e0e7ef33;margin-bottom:24px;overflow:hidden}.info-card[_ngcontent-%COMP%]   h2.title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;color:#111827;margin:0;padding:25px}.info-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;font-weight:500;color:#111827;margin:0}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:25px 25px 0}.info-card[_ngcontent-%COMP%]   .descripcion-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.info-card[_ngcontent-%COMP%]   .descripcion-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#6b7280;font-size:14px;margin-bottom:4px}.info-card[_ngcontent-%COMP%]   .descripcion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#111827;font-size:16px}.badge-pendiente[_ngcontent-%COMP%]{background-color:#f59e0b1a;color:#f59e0b;padding:4px 12px;border-radius:16px;font-size:14px;font-weight:500}.badge-estado-aviso[_ngcontent-%COMP%]{padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.badge-estado-aviso.badge-en-curso[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.badge-estado-aviso.badge-pendiente[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.badge-estado-aviso.badge-completado[_ngcontent-%COMP%]{background:#10b981;color:#fff}.badge-estado-aviso.badge-pendiente-de-presupuesto[_ngcontent-%COMP%]{background:#fcd34d;color:#92400e}.badge-estado-aviso.badge-listo-para-facturar[_ngcontent-%COMP%]{background:#d1fae5;color:#059669}.info-grid[_ngcontent-%COMP%]{padding:25px;padding-top:0!important;display:grid;gap:24px}.info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#6b7280;font-size:14px;margin-bottom:4px}.info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#111827;font-size:16px}.info-grid[_ngcontent-%COMP%]   .descripcion-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;padding:0!important}.info-grid[_ngcontent-%COMP%]   .descripcion-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#6b7280;font-size:14px;margin-bottom:4px}.info-grid[_ngcontent-%COMP%]   .descripcion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#111827;font-size:16px}.info-grid[_ngcontent-%COMP%]   .direccion-section[_ngcontent-%COMP%]   .btn-map[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background:none;border:none;padding:8px;cursor:pointer;color:#fff;background-color:#4f46e5;font-size:16px;border-radius:50%}.info-grid[_ngcontent-%COMP%]   .contacto-section[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#6b7280;font-size:14px;margin-bottom:4px}.info-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:24px}.cliente-info[_ngcontent-%COMP%], .direccion-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.cliente-info[_ngcontent-%COMP%]   .ver-cliente[_ngcontent-%COMP%], .direccion-info[_ngcontent-%COMP%]   .ver-cliente[_ngcontent-%COMP%]{color:#4f46e5;text-decoration:none;font-size:14px;cursor:pointer}.cliente-info[_ngcontent-%COMP%]   .ver-cliente[_ngcontent-%COMP%]:hover, .direccion-info[_ngcontent-%COMP%]   .ver-cliente[_ngcontent-%COMP%]:hover{text-decoration:underline}.contacto-items[_ngcontent-%COMP%]{display:flex;gap:24px;margin-top:8px}.contacto-items[_ngcontent-%COMP%]   .contacto-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background-color:#eef2ff;color:#4f46e5;padding:6px 15px;border-radius:10px;font-size:14px;font-weight:500}.contacto-items[_ngcontent-%COMP%]   .contacto-item[_ngcontent-%COMP%]   .contacto-link[_ngcontent-%COMP%]{color:inherit;text-decoration:none;cursor:pointer;transition:color .2s ease}.contacto-items[_ngcontent-%COMP%]   .contacto-item[_ngcontent-%COMP%]   .contacto-link[_ngcontent-%COMP%]:hover{color:#291fd9;text-decoration:underline}.info-item[_ngcontent-%COMP%]   .estado-aviso[_ngcontent-%COMP%]{font-weight:500}.info-item[_ngcontent-%COMP%]   .estado-aviso.estado-pendiente[_ngcontent-%COMP%]{color:#f59e0b!important}.info-item[_ngcontent-%COMP%]   .estado-aviso.estado-en-curso[_ngcontent-%COMP%]{color:#3b82f6!important}.info-item[_ngcontent-%COMP%]   .estado-aviso.estado-completado[_ngcontent-%COMP%]{color:#10b981!important}.info-item[_ngcontent-%COMP%]   .estado-aviso.estado-cancelado[_ngcontent-%COMP%]{color:#ef4444!important}.info-item[_ngcontent-%COMP%]   .estado-aviso.estado-pendiente-de-presupuesto[_ngcontent-%COMP%]{color:#f59e0b!important}.info-item[_ngcontent-%COMP%]   .estado-aviso.estado-listo-para-facturar[_ngcontent-%COMP%]{color:#059669!important}.info-item[_ngcontent-%COMP%]   .estado-aviso[_ngcontent-%COMP%]:not([class*=estado-]){color:#6b7280!important}.info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .estado-aviso.estado-pendiente[_ngcontent-%COMP%]{color:#f59e0b!important}.info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .estado-aviso.estado-en-curso[_ngcontent-%COMP%]{color:#3b82f6!important}.info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .estado-aviso.estado-completado[_ngcontent-%COMP%]{color:#10b981!important}.info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .estado-aviso.estado-cancelado[_ngcontent-%COMP%]{color:#ef4444!important}.info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .estado-aviso.estado-pendiente-de-presupuesto[_ngcontent-%COMP%]{color:#f59e0b!important}.info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .estado-aviso.estado-listo-para-facturar[_ngcontent-%COMP%]{color:#059669!important}.descripcion-content[_ngcontent-%COMP%]{padding:24px}.descripcion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;line-height:1.5}.gallery-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.gallery-actions[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{background:#f3f4f6;border-radius:30px;width:auto;height:auto;padding:2px 4px}.gallery-actions[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]::part(indicator){background:none}.gallery-actions[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--background: transparent;--background-checked: white;--background-hover: rgba(255,255,255,.1);--background-focused: rgba(255,255,255,.2);--border-radius: 50%;--border-width: 0;--indicator-color: transparent;--color: #6B7280;--color-checked: #4F46E5;--margin-top: 0;--margin-bottom: 0;--margin-start: 0;--margin-end: 0;--padding-top: 0;--padding-bottom: 0;--padding-start: 0;--padding-end: 0;min-height:30px;min-width:30px;transition:all .2s ease;position:relative}.gallery-actions[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]::part(native){margin:0;padding:0 6px;height:100%}.gallery-actions[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]::part(indicator){display:none}.gallery-actions[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.gallery-actions[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button.segment-button-checked[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a}.gallery-actions[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{margin-left:auto}.gallery-items[_ngcontent-%COMP%]{padding:24px;display:grid;gap:16px}.gallery-items[_ngcontent-%COMP%]   .uploading-indicator[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;color:#4f46e5}.gallery-items[_ngcontent-%COMP%]   .uploading-indicator[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:32px;margin-bottom:12px}.gallery-items[_ngcontent-%COMP%]   .uploading-indicator[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.gallery-items[_ngcontent-%COMP%]   .uploading-indicator[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:500}.gallery-items[_ngcontent-%COMP%]   .no-images[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#6b7280}.gallery-items[_ngcontent-%COMP%]   .no-images[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px;border:1px solid #E5E7EB;border-radius:6px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:48px;height:48px;object-fit:cover;border-radius:4px;margin-right:16px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   img.clickable-image[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease;position:relative}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   img.clickable-image[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #00000026}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   img.clickable-image[_ngcontent-%COMP%]:active{transform:scale(.95)}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   img.clickable-image[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#0000001a;border-radius:4px;opacity:0;transition:opacity .2s ease;pointer-events:none}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   img.clickable-image[_ngcontent-%COMP%]:hover:after{opacity:1}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]{flex:1}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500;color:#26262a}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   span.file-info[_ngcontent-%COMP%]{color:#6b7280;font-size:14px;margin-top:4px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .btn-delete[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;color:#ef4444;border-radius:4px;transition:all .2s ease}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .btn-delete[_ngcontent-%COMP%]:hover{background-color:#ef44441a;color:#eb1515}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .btn-delete[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.table-container[_ngcontent-%COMP%]{padding:0 24px 24px}.table-search[_ngcontent-%COMP%]{display:flex;gap:20px;align-items:center}.table-search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:8px;padding:7px 14px;font-size:1rem;border:none;background:#f9fbff;color:#26262a}.table-search[_ngcontent-%COMP%]   .order-by[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#26262a;font-size:14px}.table-search[_ngcontent-%COMP%]   .order-by[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#4f46e5;font-weight:500}.table-search[_ngcontent-%COMP%]   .order-by[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#4f46e5;font-size:16px}.custom-mat-table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0 8px;margin-bottom:12px}.custom-mat-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#64748b;font-size:14px;font-weight:400;text-align:left;padding:8px 16px;background:transparent}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#f9fafb}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 16px;color:#26262a;font-size:14px}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{border-top-left-radius:8px;border-bottom-left-radius:8px}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-top-right-radius:8px;border-bottom-right-radius:8px}.descripcion-trabajo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 4px;font-size:14px;line-height:1.4}.descripcion-trabajo[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#6b7280;font-size:12px}.materiales-info[_ngcontent-%COMP%]   .repuestos-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.materiales-info[_ngcontent-%COMP%]   .repuestos-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:13px;color:#4b5563;padding:2px 6px;background-color:#f3f4f6;border-radius:4px;display:inline-block;margin-right:4px;margin-bottom:4px}.materiales-info[_ngcontent-%COMP%]   .repuestos-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.badge-estado[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.badge-estado.badge-pendiente[_ngcontent-%COMP%]{background-color:var(--estado-pendiente-bg);color:var(--estado-pendiente-color)}.badge-estado.badge-en-curso[_ngcontent-%COMP%]{background-color:var(--estado-en-curso-bg);color:var(--estado-en-curso-color)}.badge-estado.badge-completado[_ngcontent-%COMP%]{background-color:var(--estado-completado-bg);color:var(--estado-completado-color)}.badge-estado.badge-cancelado[_ngcontent-%COMP%]{background-color:var(--estado-cancelado-bg);color:var(--estado-cancelado-color)}.repuestos-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.repuestos-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:14px;color:#4b5563;margin-bottom:4px}.repuestos-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.estado-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.estado-actions[_ngcontent-%COMP%]   .btn-small[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.estado-actions[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:.5px;margin-left:auto}.estado-actions[_ngcontent-%COMP%]   .estado-badge.estado-pendiente[_ngcontent-%COMP%]{background-color:#fef3c7;color:#92400e}.estado-actions[_ngcontent-%COMP%]   .estado-badge.estado-en-curso[_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534}.estado-actions[_ngcontent-%COMP%]   .estado-badge.estado-abierto[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1e40af}.estado-actions[_ngcontent-%COMP%]   .estado-badge.estado-cerrado[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#374151}.estado-actions[_ngcontent-%COMP%]   .estado-badge.estado-finalizado[_ngcontent-%COMP%]{background-color:#ecfdf5;color:#14532d}.albaran-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;margin:8px 0}.albaran-info[_ngcontent-%COMP%]   .badge-albaran[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:6px 10px;border-radius:16px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap;background:#10b981;color:#fff}.albaran-info[_ngcontent-%COMP%]   .badge-albaran[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}.albaran-info[_ngcontent-%COMP%]   .badge-albaran.badge-finalizado[_ngcontent-%COMP%]{background:#10b981;color:#fff}.albaran-info[_ngcontent-%COMP%]   .badge-albaran.badge-presupuesto-pendiente[_ngcontent-%COMP%]{background:#f59e0b;color:#fff}.albaran-info[_ngcontent-%COMP%]   .badge-albaran.badge-otra-visita[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.albaran-info[_ngcontent-%COMP%]   .albaran-details[_ngcontent-%COMP%]{font-size:10px;color:#6b7280;text-transform:capitalize}.no-trabajos[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#6b7280}.no-trabajos[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px}.no-repuestos[_ngcontent-%COMP%]{color:#6b7280;font-style:italic;font-size:14px}.flujo-container[_ngcontent-%COMP%]{padding:0 25px}.info-section[_ngcontent-%COMP%]{padding:0 25px 25px}.info-section[_ngcontent-%COMP%]   .flow-description[_ngcontent-%COMP%]{background:#f0f9ff;border:1px solid #BAE6FD;border-radius:8px;padding:16px;margin:0;color:#0c4a6e;font-size:14px;display:flex;align-items:flex-start;gap:8px;line-height:1.5}.info-section[_ngcontent-%COMP%]   .flow-description[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;color:#0ea5e9;margin-top:1px;flex-shrink:0}.info-section[_ngcontent-%COMP%]   .flow-description[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#0c4a6e}.flujo-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;font-weight:400;margin-left:12px}.card-header[_ngcontent-%COMP%]   .flujo-subtitle[_ngcontent-%COMP%]{display:block;margin-top:4px;margin-left:0}.flujo-section[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.flujo-section[_ngcontent-%COMP%]   .flujo-header[_ngcontent-%COMP%]{margin-bottom:16px}.flujo-section[_ngcontent-%COMP%]   .flujo-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1a202c;margin:0 0 4px}.flujo-section[_ngcontent-%COMP%]   .flujo-header[_ngcontent-%COMP%]   .flujo-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#64748b;font-weight:400}.section-divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:24px 0 20px}.section-divider[_ngcontent-%COMP%]:before, .section-divider[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:#e2e8f0}.section-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 16px;font-size:14px;font-weight:500;color:#64748b;background:#fff}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#64748b}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#cbd5e0;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:0 0 8px;color:#4a5568}.empty-state[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:14px;color:#a0aec0}.desktop-only[_ngcontent-%COMP%]{display:inline}.mobile-only[_ngcontent-%COMP%]{display:none}.urgent-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:12px;font-size:12px;font-weight:500}.urgent-badge.urgent[_ngcontent-%COMP%]{background-color:#fef2f2;color:#dc2626}.urgent-badge[_ngcontent-%COMP%]:not(.urgent){background-color:#f3f4f6;color:#6b7280}.cliente-nombre[_ngcontent-%COMP%]{font-weight:500;color:#111827}.direccion-texto[_ngcontent-%COMP%]{word-break:break-word;line-height:1.4}.tipo-aviso[_ngcontent-%COMP%]{font-weight:500;color:#4f46e5}.descripcion-texto[_ngcontent-%COMP%]{line-height:1.6;color:#111827;font-weight:500}.image-title[_ngcontent-%COMP%]{font-weight:500;color:#111827}.ver-cliente[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#4f46e5;text-decoration:none;font-size:14px;cursor:pointer;transition:color .2s ease}.ver-cliente[_ngcontent-%COMP%]:hover{color:#291fd9}.ver-cliente[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.no-images[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#6b7280}.no-images[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#cbd5e0;margin-bottom:16px}.no-images[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px}@media (max-width: 768px){[_nghost-%COMP%]{padding:16px}.desktop-only[_ngcontent-%COMP%]{display:none}.mobile-only[_ngcontent-%COMP%]{display:inline}.info-card[_ngcontent-%COMP%]{margin-bottom:16px;border-radius:12px}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding:20px;flex-direction:row;align-items:center;justify-content:start;gap:25px!important}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .mobile-only.title[_ngcontent-%COMP%]{display:block;font-size:18px;font-weight:500;color:#111827;margin:0}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]{width:auto;justify-content:space-between;gap:12px}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:none;width:100%;flex-direction:column;gap:8px}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;justify-content:center}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions-jobs[_ngcontent-%COMP%]{display:flex;width:100%;flex-direction:column;gap:8px}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions-jobs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;justify-content:center}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .aviso-completado-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#10b981;font-size:14px;font-weight:500}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .aviso-completado-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.info-card[_ngcontent-%COMP%]   h2.title[_ngcontent-%COMP%]{font-size:16px;padding:20px}.info-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px}.info-grid[_ngcontent-%COMP%]{padding:15px;gap:16px}.info-grid[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{gap:20px}.info-grid[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{width:auto}.info-grid[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:max-content}.info-grid[_ngcontent-%COMP%]   .cliente-info[_ngcontent-%COMP%], .info-grid[_ngcontent-%COMP%]   .direccion-info[_ngcontent-%COMP%]{flex-direction:row;align-items:center;justify-content:space-between;gap:8px}.info-grid[_ngcontent-%COMP%]   .contacto-items[_ngcontent-%COMP%]{flex-direction:row;gap:8px}.info-grid[_ngcontent-%COMP%]   .contacto-items[_ngcontent-%COMP%]   .contacto-item[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}.info-grid[_ngcontent-%COMP%]   .contacto-items[_ngcontent-%COMP%]   .contacto-item.nombre-contacto[_ngcontent-%COMP%]{display:none}.descripcion-content[_ngcontent-%COMP%]{padding:20px;gap:16px}.gallery-actions[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:stretch}.gallery-actions[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{align-self:center}.gallery-actions[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{margin-left:0;width:100%;justify-content:center}.gallery-items[_ngcontent-%COMP%]{padding:20px;gap:12px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover;border-radius:8px;margin-right:0}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]{width:100%}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .btn-delete[_ngcontent-%COMP%]{align-self:flex-end}.table-container[_ngcontent-%COMP%]{padding:0 20px 20px}.custom-mat-table[_ngcontent-%COMP%]{font-size:12px}.custom-mat-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:11px;padding:8px 12px}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;font-size:12px}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .descripcion-trabajo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .descripcion-trabajo[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:10px}.estado-actions[_ngcontent-%COMP%]{flex-direction:column;gap:6px}.estado-actions[_ngcontent-%COMP%]   .btn-small[_ngcontent-%COMP%]{width:100%;justify-content:center;padding:8px 12px;font-size:12px}.flujo-container[_ngcontent-%COMP%]{padding:0 20px 20px}.flujo-section[_ngcontent-%COMP%]{margin-bottom:0}.section-divider[_ngcontent-%COMP%]{margin:20px 0 16px}.section-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;padding:0 12px}.back-button[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]{padding:8px 12px;font-size:13px}.badge-pendiente[_ngcontent-%COMP%]{font-size:12px;padding:3px 8px}.materiales-info[_ngcontent-%COMP%]   .repuestos-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:11px;padding:2px 4px}.no-repuestos[_ngcontent-%COMP%]{font-size:12px}.empty-state[_ngcontent-%COMP%]{padding:30px 16px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:40px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px}.empty-state[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px}.urgent-badge[_ngcontent-%COMP%]{font-size:11px;padding:2px 6px}.ver-cliente[_ngcontent-%COMP%]{font-size:12px}.ver-cliente[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}.no-images[_ngcontent-%COMP%]{padding:30px 16px}.no-images[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:40px}.no-images[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px}}@media (max-width: 480px){[_nghost-%COMP%]{padding:0}.info-card[_ngcontent-%COMP%]{margin-bottom:12px;border-radius:8px}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding:16px;gap:8px}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]{gap:8px}.info-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{gap:6px}.info-card[_ngcontent-%COMP%]   h2.title[_ngcontent-%COMP%]{font-size:15px;padding:16px;display:none}.info-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px!important}.descripcion-content[_ngcontent-%COMP%]{padding:16px;gap:12px}.descripcion-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px}.descripcion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px}.gallery-actions[_ngcontent-%COMP%]{gap:8px}.gallery-actions[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{padding:8px 12px;font-size:13px}.gallery-items[_ngcontent-%COMP%]{padding:16px;gap:8px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]{gap:8px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:150px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.gallery-items[_ngcontent-%COMP%]   .gallery-item[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   span.file-info[_ngcontent-%COMP%]{font-size:11px}.table-container[_ngcontent-%COMP%]{padding:0 16px 16px}.custom-mat-table[_ngcontent-%COMP%]{font-size:11px}.custom-mat-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:10px;padding:6px 8px}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px;font-size:11px}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .descripcion-trabajo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:11px}.custom-mat-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .descripcion-trabajo[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:9px}.estado-actions[_ngcontent-%COMP%]{gap:4px}.estado-actions[_ngcontent-%COMP%]   .btn-small[_ngcontent-%COMP%]{padding:6px 8px;font-size:11px}.flujo-container[_ngcontent-%COMP%]{padding:0 16px 16px}.section-divider[_ngcontent-%COMP%]{margin:16px 0 12px}.section-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;padding:0 8px}.back-button[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px}.badge-pendiente[_ngcontent-%COMP%]{font-size:11px;padding:2px 6px}.materiales-info[_ngcontent-%COMP%]   .repuestos-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:10px;padding:1px 3px}.no-repuestos[_ngcontent-%COMP%]{font-size:11px}.empty-state[_ngcontent-%COMP%]{padding:24px 12px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:36px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px}.empty-state[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:11px}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%], .btn-danger[_ngcontent-%COMP%]{padding:8px 12px;font-size:13px}ion-icon[_ngcontent-%COMP%]{font-size:16px}.urgent-badge[_ngcontent-%COMP%]{font-size:10px;padding:1px 4px}.ver-cliente[_ngcontent-%COMP%]{font-size:11px}.ver-cliente[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:11px}.no-images[_ngcontent-%COMP%]{padding:24px 12px}.no-images[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:36px}.no-images[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px}}.no-albaranes[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#6b7280}.no-albaranes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#d1d5db;margin-bottom:16px}.no-albaranes[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;font-size:16px}.no-albaranes[_ngcontent-%COMP%]   p.info-text[_ngcontent-%COMP%]{font-size:14px;color:#9ca3af;font-style:italic}.albaranes-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.albaran-item[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:20px;transition:all .2s ease}.albaran-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid #E5E7EB}.albaran-header[_ngcontent-%COMP%]   .albaran-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;font-size:18px;font-weight:600;color:#1f2937}.albaran-header[_ngcontent-%COMP%]   .albaran-info[_ngcontent-%COMP%]   .fecha-albaran[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;font-weight:500}.albaran-header[_ngcontent-%COMP%]   .estado-albaran[_ngcontent-%COMP%]   .badge-estado[_ngcontent-%COMP%]{padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.albaran-header[_ngcontent-%COMP%]   .estado-albaran[_ngcontent-%COMP%]   .badge-estado.badge-finalizado[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.albaran-header[_ngcontent-%COMP%]   .estado-albaran[_ngcontent-%COMP%]   .badge-estado.badge-presupuesto-pendiente[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.albaran-header[_ngcontent-%COMP%]   .estado-albaran[_ngcontent-%COMP%]   .badge-estado.badge-otra-visita[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.albaran-header[_ngcontent-%COMP%]   .albaran-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.albaran-header[_ngcontent-%COMP%]   .albaran-actions[_ngcontent-%COMP%]   .btn-primary.btn-small[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;gap:4px}.albaran-header[_ngcontent-%COMP%]   .albaran-actions[_ngcontent-%COMP%]   .btn-primary.btn-small[_ngcontent-%COMP%]:hover{background:#4338ca}.albaran-header[_ngcontent-%COMP%]   .albaran-actions[_ngcontent-%COMP%]   .btn-primary.btn-small[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.header-actions[_ngcontent-%COMP%]   .btn-secondary.btn-small[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px;background:#6b7280;color:#fff;border:none;border-radius:6px;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;gap:4px}.header-actions[_ngcontent-%COMP%]   .btn-secondary.btn-small[_ngcontent-%COMP%]:hover{background:#4b5563}.header-actions[_ngcontent-%COMP%]   .btn-secondary.btn-small[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.albaran-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.albaran-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}.albaran-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.albaran-details[_ngcontent-%COMP%]   .detail-item.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.albaran-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:.5px}.albaran-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .albaran-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#1f2937;margin:0}.albaran-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{line-height:1.5;background:#f9fafb;padding:8px 12px;border-radius:6px;border:1px solid #E5E7EB}.albaran-details[_ngcontent-%COMP%]   .repuestos-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.albaran-details[_ngcontent-%COMP%]   .repuestos-tags[_ngcontent-%COMP%]   .repuesto-tag[_ngcontent-%COMP%]{background:#e0f2fe;color:#0c4a6e;padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;border:1px solid #BAE6FD}@media (max-width: 768px){.albaranes-container[_ngcontent-%COMP%]{gap:16px}.albaran-item[_ngcontent-%COMP%]{padding:16px}.albaran-header[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:flex-start}.albaran-header[_ngcontent-%COMP%]   .estado-albaran[_ngcontent-%COMP%]{align-self:flex-start}.albaran-header[_ngcontent-%COMP%]   .albaran-actions[_ngcontent-%COMP%]{align-self:flex-start;margin-top:8px}.no-albaranes[_ngcontent-%COMP%]{padding:20px 10px}.no-albaranes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:36px}.no-albaranes[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px}.no-albaranes[_ngcontent-%COMP%]   p.info-text[_ngcontent-%COMP%]{font-size:12px}.albaran-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}}.section-divider[_ngcontent-%COMP%]{position:relative;margin:32px 0;text-align:center}.section-divider[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;height:1px;background:linear-gradient(to right,transparent,#E5E7EB,transparent);margin:0}.section-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:0 16px;font-size:14px;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:.5px}.albaranes-section[_ngcontent-%COMP%]{margin-top:24px}.albaranes-section[_ngcontent-%COMP%]   .albaranes-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:16px 20px;background:#f9fafb;border-radius:8px;border:1px solid #E5E7EB}.aviso-completado-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#10b981;font-size:14px;font-weight:500;padding:8px 12px;background:#ecfdf5;border:1px solid #D1FAE5;border-radius:8px}.aviso-completado-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.factura-generada-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#3b82f6;font-size:14px;font-weight:500;padding:8px 12px;background:#eff6ff;border:1px solid #DBEAFE;border-radius:8px}.factura-generada-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.albaranes-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.albaranes-info[_ngcontent-%COMP%]   .badge-info[_ngcontent-%COMP%]{padding:6px 12px;background:#e0f2fe;color:#0c4a6e;border-radius:20px;font-size:12px;font-weight:600;border:1px solid #BAE6FD}.btn-secondary.btn-small[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px;background:#6b7280;color:#fff;border:none;border-radius:6px;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;gap:4px}.btn-secondary.btn-small[_ngcontent-%COMP%]:hover{background:#4b5563}.btn-secondary.btn-small[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.compact-albaranes-table[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;border-radius:8px;border:1px solid #E5E7EB;background:#fff;margin-bottom:16px;width:100%;overflow-x:hidden}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:1fr 1.5fr 1fr 1.5fr 1fr;font-size:12px;min-width:0;gap:0;align-items:stretch}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%], .compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:contents}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]   .header-cell[_ngcontent-%COMP%]{padding:12px 8px;background:#f9fafb;border-bottom:1px solid #E5E7EB;font-weight:500;color:#374151;font-size:12px;text-transform:uppercase;letter-spacing:.5px;display:flex;align-items:center;min-width:0;justify-content:center;text-align:center}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]{display:contents}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]{display:contents;cursor:pointer;transition:all .2s ease;-webkit-tap-highlight-color:transparent;touch-action:manipulation}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]:hover   .albaran-cell[_ngcontent-%COMP%]{background-color:#f9fafb}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]:active{transform:scale(.98)}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.finalizado[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]:first-child{border-left:4px solid #10B981}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.finalizado[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]{background-color:#ecfdf5}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.finalizado[_ngcontent-%COMP%]:hover   .albaran-cell[_ngcontent-%COMP%]{background-color:#d1fae5}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.presupuesto-pendiente[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]:first-child{border-left:4px solid #F59E0B}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.presupuesto-pendiente[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]{background-color:#fffbeb}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.presupuesto-pendiente[_ngcontent-%COMP%]:hover   .albaran-cell[_ngcontent-%COMP%]{background-color:#fef3c7}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.otra-visita[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]:first-child{border-left:4px solid #3B82F6}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.otra-visita[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]{background-color:#eff6ff}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row.otra-visita[_ngcontent-%COMP%]:hover   .albaran-cell[_ngcontent-%COMP%]{background-color:#dbeafe}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]{padding:12px 8px;border-bottom:1px solid #F3F4F6;display:flex;align-items:center;min-width:0;justify-content:center;text-align:center}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.numero-albaran[_ngcontent-%COMP%]{font-weight:600;color:#111827;font-size:14px;justify-content:center;flex-shrink:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]{justify-content:center;flex-shrink:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]   .estado-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap;max-width:120px;overflow:hidden;text-overflow:ellipsis}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]   .badge.green[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]   .badge.yellow[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]   .badge.blue[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]   .badge.badge-presupuesto[_ngcontent-%COMP%]{background:#e0f2fe;color:#0369a1;border:1px solid #BAE6FD;padding:2px 6px;border-radius:8px;font-size:9px;display:flex;align-items:center;gap:2px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]   .badge.badge-presupuesto[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:10px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.fecha-albaran[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;justify-content:center;flex-shrink:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]{justify-content:center;flex-shrink:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]   .repuestos-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]   .repuestos-info[_ngcontent-%COMP%]   .repuestos-count[_ngcontent-%COMP%]{font-size:11px;color:#059669;font-weight:600;padding:2px 6px;background:#d1fae5;border-radius:6px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]   .repuestos-info[_ngcontent-%COMP%]   .repuestos-label[_ngcontent-%COMP%]{font-size:10px;color:#6b7280;font-weight:500}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]   .repuestos-vacio[_ngcontent-%COMP%]{font-size:11px;color:#9ca3af;font-style:italic}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]{justify-content:center;gap:4px;flex-shrink:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:28px;height:28px;border:none;border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;background:transparent;-webkit-tap-highlight-color:transparent;touch-action:manipulation}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;color:#6b7280}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button.btn-ver[_ngcontent-%COMP%]:hover{background-color:#10b981}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button.btn-ver[_ngcontent-%COMP%]:hover   ion-icon[_ngcontent-%COMP%]{color:#fff}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button.btn-ver[_ngcontent-%COMP%]:active{transform:scale(.9);background-color:#059669}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button.btn-eliminar[_ngcontent-%COMP%]:hover{background-color:#ef4444}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button.btn-eliminar[_ngcontent-%COMP%]:hover   ion-icon[_ngcontent-%COMP%]{color:#fff}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button.btn-eliminar[_ngcontent-%COMP%]:active{transform:scale(.9);background-color:#dc2626}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   .mobile-info[_ngcontent-%COMP%]{display:none}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   .mobile-info[_ngcontent-%COMP%]   .presupuesto-mobile[_ngcontent-%COMP%]{font-size:11px;color:#059669;font-weight:600;padding:2px 6px;background:#d1fae5;border-radius:6px}@media (min-width: 769px){.compact-albaranes-table[_ngcontent-%COMP%]{width:100%;overflow-x:hidden;border-radius:0;border-left:none;border-right:none}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]{grid-template-columns:1fr 1.5fr 1fr 1.5fr 1fr;font-size:13px;min-width:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]   .header-cell[_ngcontent-%COMP%]{font-size:12px;padding:12px 8px;min-width:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]{padding:12px 8px;min-width:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.numero-albaran[_ngcontent-%COMP%]{font-size:14px;flex-shrink:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%], .compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.fecha-albaran[_ngcontent-%COMP%], .compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%], .compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]{flex-shrink:0}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:28px;height:28px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}}@media (max-width: 768px){.compact-albaranes-table[_ngcontent-%COMP%]{border-radius:0;border-left:none;border-right:none;max-height:none}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]{grid-template-columns:.8fr 1.2fr 1fr 1.2fr .8fr}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]   .header-cell[_ngcontent-%COMP%]{font-size:10px;padding:8px 4px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]{padding:8px 4px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.numero-albaran[_ngcontent-%COMP%]{font-size:12px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.fecha-albaran[_ngcontent-%COMP%]{font-size:11px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:24px;height:24px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   .mobile-info[_ngcontent-%COMP%]{display:block;margin-left:4px}}@media (max-width: 480px){.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]{grid-template-columns:.6fr 1fr 1fr 1fr .8fr}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]   .header-cell[_ngcontent-%COMP%]{font-size:9px;padding:6px 2px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell[_ngcontent-%COMP%]{padding:6px 2px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.numero-albaran[_ngcontent-%COMP%]{font-size:11px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.estado-albaran[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:8px;padding:2px 4px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.fecha-albaran[_ngcontent-%COMP%]{font-size:10px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]{font-size:9px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]   .repuestos-info[_ngcontent-%COMP%]   .repuestos-count[_ngcontent-%COMP%]{font-size:8px;padding:1px 3px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]   .repuestos-info[_ngcontent-%COMP%]   .repuestos-label[_ngcontent-%COMP%], .compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.repuestos-albaran[_ngcontent-%COMP%]   .repuestos-vacio[_ngcontent-%COMP%]{font-size:8px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;align-items:center}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:22px;height:22px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}.compact-albaranes-table[_ngcontent-%COMP%]   .albaranes-table[_ngcontent-%COMP%]   .table-body[_ngcontent-%COMP%]   .albaran-row[_ngcontent-%COMP%]   .albaran-cell.acciones[_ngcontent-%COMP%]   .mobile-info[_ngcontent-%COMP%]   .presupuesto-mobile[_ngcontent-%COMP%]{font-size:9px;padding:1px 4px}}@media (max-width: 768px){.section-divider[_ngcontent-%COMP%]{margin:24px 0}.section-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;padding:0 12px}.albaranes-section[_ngcontent-%COMP%]{margin-top:20px}.albaranes-section[_ngcontent-%COMP%]   .albaranes-header[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:stretch;padding:12px 16px}.albaranes-section[_ngcontent-%COMP%]   .albaranes-header[_ngcontent-%COMP%]   .albaranes-info[_ngcontent-%COMP%]{justify-content:center}.albaranes-section[_ngcontent-%COMP%]   .albaranes-header[_ngcontent-%COMP%]   .btn-secondary.btn-small[_ngcontent-%COMP%]{align-self:center;width:fit-content}}']});let c=p;return c})();export{Ja as VerAvisosComponent};
