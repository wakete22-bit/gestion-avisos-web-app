import{a as S}from"./chunk-RSAD4EEI.js";import"./chunk-RP6VPHKN.js";import"./chunk-FK6H3RFT.js";import{a as k}from"./chunk-UG5ATQHO.js";import"./chunk-XEVZMQZH.js";import"./chunk-5JOXGAFT.js";import"./chunk-5YRB7RVB.js";import"./chunk-4XNYWQEP.js";import"./chunk-KYCVJEX4.js";import"./chunk-STXSJFLK.js";import"./chunk-A72QMOGB.js";import{Eb as E,Hb as I,Ia as o,Ja as g,Ka as w,N as C,O as v,Xa as F,Za as O,_ as d,ba as u,da as M,ha as h,na as l,ra as n,sa as i,ta as f,xa as P,ya as y,za as p}from"./chunk-4AY4VQCP.js";import"./chunk-2ELISCRH.js";import"./chunk-BV4CTHEE.js";import{k as _}from"./chunk-CRC5ZNR6.js";function j(r,s){if(r&1&&(n(0,"div",12)(1,"h3"),o(2,"Informaci\xF3n de la Factura"),i(),n(3,"div",13)(4,"div",14)(5,"span",15),o(6,"Cliente:"),i(),n(7,"span",16),o(8),i()(),n(9,"div",14)(10,"span",15),o(11,"Fecha:"),i(),n(12,"span",16),o(13),F(14,"date"),i()(),n(15,"div",14)(16,"span",15),o(17,"Total:"),i(),n(18,"span",16),o(19),F(20,"currency"),i()()()()),r&2){let c=p(2);d(8),g(c.datosFactura.nombre_cliente),d(5),g(O(14,3,c.datosFactura.fecha_emision,"dd/MM/yyyy")),d(6),g(O(20,6,c.datosFactura.total,"EUR"))}}function L(r,s){r&1&&f(0,"ion-icon",17)}function U(r,s){r&1&&f(0,"ion-icon",18)}function B(r,s){if(r&1){let c=P();n(0,"div",4)(1,"div",5)(2,"h1"),o(3,"\u{1F4C4} Descarga de Factura"),i(),n(4,"p"),o(5,"Factura: "),n(6,"strong"),o(7),i()()(),h(8,j,21,9,"div",6),n(9,"div",7)(10,"button",8),y("click",function(){C(c);let t=p();return v(t.descargarPDF())}),h(11,L,1,0,"ion-icon",9)(12,U,1,0,"ion-icon",10),o(13),i()(),n(14,"div",11)(15,"p"),o(16,"T\xC9CNICOS CLIMATIZACI\xD3N S.L."),i(),n(17,"p"),o(18,"\u{1F4E7} info@tecnicosclimatizacion.es | \u{1F4DE} +34 91 123 45 67"),i()()()}if(r&2){let c=p();d(7),g(c.numeroFactura),d(),l("ngIf",c.datosFactura),d(2),l("disabled",c.descargando),d(),l("ngIf",!c.descargando),d(),l("ngIf",c.descargando),d(),w(" ",c.descargando?"Generando PDF...":"Descargar PDF"," ")}}function A(r,s){r&1&&(n(0,"div",19),f(1,"ion-icon",18),n(2,"p"),o(3,"Cargando factura..."),i()())}function z(r,s){if(r&1){let c=P();n(0,"div",20),f(1,"ion-icon",21),n(2,"h3"),o(3,"Error"),i(),n(4,"p"),o(5),i(),n(6,"button",22),y("click",function(){C(c);let t=p();return v(t.reintentar())}),o(7,"Reintentar"),i()()}if(r&2){let c=p();d(5),g(c.error)}}var G=(()=>{let s=class s{constructor(e,t,a,m){this.route=e,this.router=t,this.pdfService=a,this.facturasService=m,this.numeroFactura="",this.datosFactura=null,this.cargando=!0,this.descargando=!1,this.error=null}ngOnInit(){this.route.queryParams.subscribe(e=>{this.numeroFactura=e.factura||"";let t=e.file,a=e.name;this.numeroFactura&&t?this.descargarPDFDesdeBase64(t,a):this.numeroFactura?this.cargarFactura():(this.error="N\xFAmero de factura no proporcionado",this.cargando=!1)})}descargarPDFDesdeBase64(e,t){return _(this,null,function*(){try{this.cargando=!0,this.error=null;let a=atob(e),m=new Array(a.length);for(let x=0;x<a.length;x++)m[x]=a.charCodeAt(x);let R=new Uint8Array(m),T=new Blob([R],{type:"application/pdf"}),D=URL.createObjectURL(T),b=document.createElement("a");b.href=D,b.download=t||`factura_${this.numeroFactura}.pdf`,b.click(),URL.revokeObjectURL(D),this.datosFactura={nombre_cliente:"Cliente",fecha_emision:new Date,total:0}}catch(a){console.error("Error al descargar PDF desde base64:",a),this.error="Error al procesar el archivo PDF"}finally{this.cargando=!1}})}cargarFactura(){return _(this,null,function*(){try{this.cargando=!0,this.error=null;let e=yield this.facturasService.buscarFacturas(this.numeroFactura).toPromise(),t=e==null?void 0:e.find(a=>a.numero_factura===this.numeroFactura);t?this.datosFactura=t:this.error="Factura no encontrada"}catch(e){console.error("Error al cargar factura:",e),this.error="Error al cargar la factura"}finally{this.cargando=!1}})}descargarPDF(){return _(this,null,function*(){if(this.datosFactura)try{this.descargando=!0;let e=yield this.pdfService.generarPdfBlob(this.datosFactura,`factura_${this.numeroFactura}.pdf`),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`factura_${this.numeroFactura}.pdf`,a.click(),URL.revokeObjectURL(t)}catch(e){console.error("Error al descargar PDF:",e),this.error="Error al generar el PDF"}finally{this.descargando=!1}})}reintentar(){this.cargarFactura()}};s.\u0275fac=function(t){return new(t||s)(u(E),u(I),u(S),u(k))},s.\u0275cmp=M({type:s,selectors:[["app-descarga-publica"]],decls:4,vars:3,consts:[[1,"descarga-container"],["class","descarga-content",4,"ngIf"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],[1,"descarga-content"],[1,"header"],["class","factura-info",4,"ngIf"],[1,"download-section"],[1,"btn-download",3,"click","disabled"],["name","download-outline",4,"ngIf"],["name","refresh-outline","class","spinning",4,"ngIf"],[1,"footer"],[1,"factura-info"],[1,"info-grid"],[1,"info-item"],[1,"label"],[1,"value"],["name","download-outline"],["name","refresh-outline",1,"spinning"],[1,"loading"],[1,"error"],["name","alert-circle-outline"],[1,"btn-retry",3,"click"]],template:function(t,a){t&1&&(n(0,"div",0),h(1,B,19,6,"div",1)(2,A,4,0,"div",2)(3,z,8,1,"div",3),i()),t&2&&(d(),l("ngIf",!a.cargando&&!a.error),d(),l("ngIf",a.cargando),d(),l("ngIf",a.error))},styles:[".descarga-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}.descarga-content[_ngcontent-%COMP%]{background:#fff;border-radius:15px;padding:40px;box-shadow:0 20px 40px #0000001a;max-width:500px;width:100%;text-align:center}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#2563eb;margin-bottom:10px;font-size:28px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:16px;margin-bottom:30px}.factura-info[_ngcontent-%COMP%]{background:#f8fafc;border-radius:10px;padding:20px;margin:20px 0;text-align:left}.factura-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#2563eb;margin-bottom:15px;text-align:center}.info-grid[_ngcontent-%COMP%]{display:grid;gap:10px}.info-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #e5e7eb}.info-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.label[_ngcontent-%COMP%]{font-weight:600;color:#374151}.value[_ngcontent-%COMP%]{color:#6b7280}.download-section[_ngcontent-%COMP%]{margin:30px 0}.btn-download[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;border:none;padding:15px 30px;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:10px;margin:0 auto;transition:all .3s ease}.btn-download[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 20px #2563eb4d}.btn-download[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.footer[_ngcontent-%COMP%]{margin-top:30px;padding-top:20px;border-top:1px solid #e5e7eb;color:#6b7280;font-size:14px}.loading[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{text-align:center;color:#fff}.loading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:20px}.spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:20px 0 10px;color:#ef4444}.btn-retry[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;margin-top:15px}"]});let r=s;return r})();export{G as DescargaPublicaComponent};
