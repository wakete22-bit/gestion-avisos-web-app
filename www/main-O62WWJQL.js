import{a as Ue}from"./chunk-UEABOVCV.js";import{a as Fe}from"./chunk-73QYT6MQ.js";import{a as je}from"./chunk-WLL4S5XO.js";import{a as Oe}from"./chunk-STXSJFLK.js";import{a as Ee,b as xe,t as Ae}from"./chunk-YOFVTXCH.js";import{b as x}from"./chunk-2AI5T2ON.js";import{a as Pe,b as De,c as ke,e as Te,g as Re,h as Me,i as Le}from"./chunk-LKFRID77.js";import{a as g,b as V}from"./chunk-A72QMOGB.js";import{ea as f,xa as ye}from"./chunk-TWOPYUJN.js";import{$a as ue,C as E,D as oe,F as p,Gb as we,H as re,Hb as be,I as c,Ia as _,J as k,K as ae,Kb as Ce,Lb as Se,Mb as Ie,N as H,O as W,R as se,T as U,b as M,ba as u,c as L,d as O,da as F,f as X,g as ee,ha as ce,j as w,ka as le,la as $,mb as he,na as pe,o as te,q as I,r as b,ra as C,s as ie,sa as S,sb as me,ta as j,u as y,ub as fe,w as ne,xa as de,xb as ge,ya as G,yb as ve,z as D,za as q}from"./chunk-4AY4VQCP.js";import"./chunk-3SUPCH3T.js";import"./chunk-QUJFQN2Y.js";import"./chunk-OGR5ZLHR.js";import"./chunk-CUT3BV6K.js";import"./chunk-73IMGLZG.js";import"./chunk-G2E2NLL6.js";import"./chunk-ILJSYHS4.js";import"./chunk-OAP23YNX.js";import"./chunk-YYM7CL2V.js";import"./chunk-5LR2YXX6.js";import"./chunk-WDU4QEMV.js";import"./chunk-CKP3SGE2.js";import"./chunk-ULLEADC5.js";import"./chunk-2ELISCRH.js";import"./chunk-BV4CTHEE.js";import"./chunk-JILLMCFB.js";import"./chunk-WWN5RJW3.js";import"./chunk-H3LYBNOM.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-NBD2MYJO.js";import"./chunk-3SBX7V6R.js";import"./chunk-SQKDQBOS.js";import"./chunk-SWRJZAEI.js";import"./chunk-JCSW2JUV.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-36KMLI7A.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as J,j as P,k as l}from"./chunk-CRC5ZNR6.js";var K="Service workers are disabled or not supported by this browser",A=class{serviceWorker;worker;registration;events;constructor(t,s){if(this.serviceWorker=t,!t)this.worker=this.events=this.registration=new M(e=>e.error(new E(5601,!1)));else{let e=null,i=new L;this.worker=new M(d=>(e!==null&&d.next(e),i.subscribe(m=>d.next(m))));let o=()=>{let{controller:d}=t;d!==null&&(e=d,i.next(e))};t.addEventListener("controllerchange",o),o(),this.registration=this.worker.pipe(D(()=>t.getRegistration()));let a=new L;this.events=a.asObservable();let r=d=>{let{data:m}=d;m!=null&&m.type&&a.next(m)};t.addEventListener("message",r);let v=s==null?void 0:s.get($,null,{optional:!0});v==null||v.onDestroy(()=>{t.removeEventListener("controllerchange",o),t.removeEventListener("message",r)})}}postMessage(t,s){return new Promise(e=>{this.worker.pipe(y(1)).subscribe(i=>{i.postMessage(J({action:t},s)),e()})})}postMessageWithOperation(t,s,e){let i=this.waitForOperationCompleted(e),o=this.postMessage(t,s);return Promise.all([o,i]).then(([,a])=>a)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(t){let s;return typeof t=="string"?s=e=>e.type===t:s=e=>t.includes(e.type),this.events.pipe(b(s))}nextEventOfType(t){return this.eventsOfType(t).pipe(y(1))}waitForOperationCompleted(t){return new Promise((s,e)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(b(i=>i.nonce===t),y(1),w(i=>{if(i.result!==void 0)return i.result;throw new Error(i.error)})).subscribe({next:s,error:e})})}get isEnabled(){return!!this.serviceWorker}},nt=(()=>{let t=class t{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new L;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=I,this.notificationClicks=I,this.subscription=I;return}this.messages=this.sw.eventsOfType("PUSH").pipe(w(o=>o.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(w(o=>o.data)),this.pushManager=this.sw.registration.pipe(w(o=>o.pushManager));let i=this.pushManager.pipe(D(o=>o.getSubscription()));this.subscription=new M(o=>{let a=i.subscribe(o),r=this.subscriptionChanges.subscribe(o);return()=>{a.unsubscribe(),r.unsubscribe()}})}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(K));let i={userVisibleOnly:!0},o=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),a=new Uint8Array(new ArrayBuffer(o.length));for(let r=0;r<o.length;r++)a[r]=o.charCodeAt(r);return i.applicationServerKey=a,new Promise((r,v)=>{this.pushManager.pipe(D(d=>d.subscribe(i)),y(1)).subscribe({next:d=>{this.subscriptionChanges.next(d),r(d)},error:v})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(K));let e=i=>{if(i===null)throw new E(5602,!1);return i.unsubscribe().then(o=>{if(!o)throw new E(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((i,o)=>{this.subscription.pipe(y(1),D(e)).subscribe({next:i,error:o})})}decodeBase64(e){return atob(e)}};P(t,"\u0275fac",function(i){return new(i||t)(c(A))}),P(t,"\u0275prov",p({token:t,factory:t.\u0275fac}));let n=t;return n})(),Z=(()=>{let t=class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=I,this.unrecoverable=I;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(K));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new E(5601,!1));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}};P(t,"\u0275fac",function(i){return new(i||t)(c(A))}),P(t,"\u0275prov",p({token:t,factory:t.\u0275fac}));let n=t;return n})();var Ve=new re("");function ot(){let n=k(T);if(!("serviceWorker"in navigator&&n.enabled!==!1))return;let t=k(Ve),s=k(U),e=k($);s.runOutsideAngular(()=>{let i=navigator.serviceWorker,o=()=>{var a;return(a=i.controller)==null?void 0:a.postMessage({action:"INITIALIZE"})};i.addEventListener("controllerchange",o),e.onDestroy(()=>{i.removeEventListener("controllerchange",o)})}),s.runOutsideAngular(()=>{let i,{registrationStrategy:o}=n;if(typeof o=="function")i=new Promise(a=>o().subscribe(()=>a()));else{let[a,...r]=(o||"registerWhenStable:30000").split(":");switch(a){case"registerImmediately":i=Promise.resolve();break;case"registerWithDelay":i=_e(+r[0]||0);break;case"registerWhenStable":i=Promise.race([e.whenStable(),_e(+r[0])]);break;default:throw new E(5600,!1)}}i.then(()=>{e.destroyed||navigator.serviceWorker.register(t,{scope:n.scope}).catch(a=>console.error(oe(5604,!1)))})})}function _e(n){return new Promise(t=>setTimeout(t,n))}function rt(n,t){return new A(n.enabled!==!1?navigator.serviceWorker:void 0,t)}var T=class{enabled;scope;registrationStrategy};function ze(n,t={}){return ae([nt,Z,{provide:Ve,useValue:n},{provide:T,useValue:t},{provide:A,useFactory:rt,deps:[T,se]},le(ot)])}var Be=(()=>{let t=class t{constructor(e,i){this.authService=e,this.router=i}canActivate(){return console.log("\u{1F680} AuthGuard: canActivate() llamado"),X(this.checkAuthStatus()).pipe(w(e=>(console.log("\u{1F680} AuthGuard: Resultado de checkAuthStatus:",e),e?(console.log("\u{1F680} AuthGuard: Permitiendo acceso"),!0):(console.log("\u{1F680} AuthGuard: Redirigiendo a login"),this.router.createUrlTree(["/auth/login"])))),ie(e=>(console.error("\u274C AuthGuard: Error en canActivate:",e),ee(this.router.createUrlTree(["/auth/login"])))))}checkAuthStatus(){return l(this,null,function*(){try{console.log("\u{1F50D} AuthGuard: Verificaci\xF3n r\xE1pida de autenticaci\xF3n");let e=yield this.authService.getToken();if(console.log("\u{1F50D} AuthGuard: Token obtenido:",e?"S\xCD":"NO"),!e)return console.log("\u{1F50D} AuthGuard: No hay token, redirigiendo a login"),!1;if(this.authService.getCurrentUser())return console.log("\u{1F50D} AuthGuard: Usuario ya cargado, acceso inmediato"),!0;if(!(yield this.authService.ensureValidToken()))return console.log("\u{1F50D} AuthGuard: Token no v\xE1lido, redirigiendo a login"),!1;console.log("\u{1F50D} AuthGuard: Cargando usuario b\xE1sico...");let{data:{session:a}}=yield this.authService.getCurrentSession();return a!=null&&a.user?(yield this.authService.loadUserData(a.user.id),console.log("\u{1F50D} AuthGuard: Usuario b\xE1sico cargado, permitiendo acceso"),!0):(console.log("\u{1F50D} AuthGuard: No hay sesi\xF3n v\xE1lida"),!1)}catch(e){if(console.error("\u274C AuthGuard: Error en verificaci\xF3n r\xE1pida:",e),e instanceof Error&&e.message.includes("NavigatorLockAcquireTimeoutError")){console.log("\u{1F50D} AuthGuard: Error de lock detectado, intentando limpiar...");try{if(localStorage.setItem("supabase_lock_issue","true"),yield new Promise(o=>setTimeout(o,2e3)),yield this.checkAuthStatus())return console.log("\u{1F50D} AuthGuard: Reintento exitoso despu\xE9s de limpiar locks"),!0}catch(i){console.error("\u274C AuthGuard: Error en reintento:",i)}}return!1}})}};t.\u0275fac=function(i){return new(i||t)(c(x),c(be))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var He=[{path:"auth",children:[{path:"login",loadComponent:()=>import("./chunk-IUXABQHR.js").then(n=>n.LoginComponent),title:"Iniciar Sesi\xF3n"},{path:"register",loadComponent:()=>import("./chunk-FRDWY4ZF.js").then(n=>n.RegisterComponent),title:"Registro"},{path:"",redirectTo:"login",pathMatch:"full"}]},{path:"descarga-publica",loadComponent:()=>import("./chunk-SMMKOQCP.js").then(n=>n.DescargaPublicaComponent),title:"Descarga de Factura"},{path:"",loadComponent:()=>import("./chunk-OOCH4ACA.js").then(n=>n.MainLayoutComponent),canActivate:[Be],title:"Gesti\xF3n de Avisos",children:[{path:"home",loadComponent:()=>import("./chunk-RO34RSR3.js").then(n=>n.HomePage),title:"Inicio"},{path:"avisos",loadComponent:()=>import("./chunk-CVICRSEH.js").then(n=>n.AvisosComponent),title:"Avisos"},{path:"historial",loadComponent:()=>import("./chunk-GUVYQUAE.js").then(n=>n.HistorialComponent),title:"Historial"},{path:"inventario",loadComponent:()=>import("./chunk-YAQKYCX4.js").then(n=>n.InventarioComponent),title:"Inventario"},{path:"facturas",loadComponent:()=>import("./chunk-C6BHES5Z.js").then(n=>n.FacturasComponent),title:"Facturas"},{path:"facturas/:id",loadComponent:()=>import("./chunk-ZIPVMOQ5.js").then(n=>n.VerFacturaComponent),title:"Ver Factura"},{path:"presupuestos",loadComponent:()=>import("./chunk-QM2VWTO6.js").then(n=>n.PresupuestosComponent),title:"Presupuestos"},{path:"presupuestos/crear",loadComponent:()=>import("./chunk-WFKOUBV2.js").then(n=>n.CrearPresupuestoComponent),title:"Crear Presupuesto"},{path:"presupuestos/:id",loadComponent:()=>import("./chunk-TWGHDAEJ.js").then(n=>n.VerPresupuestoComponent),title:"Ver Presupuesto"},{path:"clientes",loadComponent:()=>import("./chunk-ZTTSFR2M.js").then(n=>n.ClientesComponent),title:"Clientes"},{path:"tecnicos",loadComponent:()=>import("./chunk-F47NTAZO.js").then(n=>n.TecnicosComponent),title:"T\xE9cnicos"},{path:"cuenta",loadComponent:()=>import("./chunk-ENETWYYL.js").then(n=>n.MiCuentaComponent),title:"Mi Cuenta"},{path:"ajustes",loadComponent:()=>import("./chunk-TYXLXXW2.js").then(n=>n.AjustesComponent),title:"Ajustes"},{path:"crear-factura",loadComponent:()=>import("./chunk-LS4KTFCY.js").then(n=>n.CrearFacturaComponent),title:"Crear Factura"},{path:"facturas/editar/:id",loadComponent:()=>import("./chunk-LS4KTFCY.js").then(n=>n.CrearFacturaComponent),title:"Editar Factura"},{path:"ver-aviso/:id-aviso",loadComponent:()=>import("./chunk-FDSU3QLA.js").then(n=>n.VerAvisosComponent),title:"Ver Aviso"},{path:"",redirectTo:"home",pathMatch:"full"}]},{path:"**",redirectTo:"auth/login"}];var z=(()=>{let t=class t{constructor(e){this.platform=e,this.initializeMobilePWA()}initializeMobilePWA(){(this.platform.is("ios")||this.platform.is("android"))&&this.setupMobilePWA()}setupMobilePWA(){document.addEventListener("gesturestart",e=>{e.preventDefault()}),document.addEventListener("touchend",e=>{let i=Date.now(),o=window.lastTouch||0,a=i-o;a<500&&a>0&&e.preventDefault(),window.lastTouch=i}),this.setupViewport(),this.addMobileStyles()}setupViewport(){let e=document.querySelector('meta[name="viewport"]');if(e){let i=["viewport-fit=cover","width=device-width","initial-scale=1.0","minimum-scale=1.0","maximum-scale=1.0","user-scalable=no"].join(", ");e.setAttribute("content",i)}}addMobileStyles(){let e=document.createElement("style");e.textContent=`
      /* Estilos espec\xEDficos para dispositivos m\xF3viles */
      
      /* Configuraci\xF3n base */
      html {
        height: 100%;
        overflow: hidden;
      }
      
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      
      /* Configuraci\xF3n para PWA standalone */
      @media all and (display-mode: standalone) {
        body {
          /* Aplicar safe areas solo en modo standalone */
          padding-top: env(safe-area-inset-top, 0px);
          padding-bottom: env(safe-area-inset-bottom, 0px);
          padding-left: env(safe-area-inset-left, 0px);
          padding-right: env(safe-area-inset-right, 0px);
        }
        
        /* Configurar ion-app */
        ion-app {
          height: 100vh;
          height: calc(100vh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
          margin: 0;
          padding: 0;
        }
        
        /* Configurar ion-content */
        ion-content {
          --offset-top: 0px;
          --offset-bottom: 0px;
          --padding-top: 0px;
          --padding-bottom: 0px;
        }
        
        /* Configurar ion-header */
        ion-header {
          padding-top: 0px;
        }
        
        /* Configurar ion-footer */
        ion-footer {
          padding-bottom: 0px;
        }
        
        /* Configurar ion-toolbar */
        ion-toolbar {
          --padding-top: 0px;
          --padding-bottom: 0px;
        }
      }
      
      /* Configuraci\xF3n espec\xEDfica para iOS */
      @supports (-webkit-touch-callout: none) {
        body {
          /* Prevenir el bounce scroll en iOS */
          position: fixed;
          width: 100%;
          height: 100%;
        }
        
        ion-content {
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
        }
      }
      
      /* Configuraci\xF3n para Android */
      @supports not (-webkit-touch-callout: none) {
        body {
          /* Configuraci\xF3n espec\xEDfica para Android */
          position: relative;
        }
      }
      
      /* Asegurar que el contenido principal ocupe todo el espacio */
      .ion-page {
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      
      /* Configurar el router outlet para que ocupe el espacio disponible */
      ion-router-outlet {
        flex: 1;
        height: 100%;
      }
    `,document.head.appendChild(e)}showIOSInstallInstructions(){window.navigator.standalone===!0||alert(`
        Para instalar esta aplicaci\xF3n en tu iPhone:
        
        1. Toca el bot\xF3n compartir (\u25A1\u2191) en Safari
        2. Despl\xE1zate hacia abajo y toca "Agregar a pantalla de inicio"
        3. Toca "Agregar"
        
        La aplicaci\xF3n aparecer\xE1 en tu pantalla de inicio como una app nativa.
      `)}isStandalone(){return window.navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches}getSafeAreaInfo(){return{top:this.getComputedValue("env(safe-area-inset-top)"),bottom:this.getComputedValue("env(safe-area-inset-bottom)"),left:this.getComputedValue("env(safe-area-inset-left)"),right:this.getComputedValue("env(safe-area-inset-right)")}}getComputedValue(e){let i=document.createElement("div");i.style.position="absolute",i.style.visibility="hidden",i.style[e]=e,document.body.appendChild(i);let o=getComputedStyle(i)[e];return document.body.removeChild(i),o||"0px"}};t.\u0275fac=function(i){return new(i||t)(c(f))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var $e=(()=>{let t=class t{constructor(e){this.platform=e}canInstall(){return"serviceWorker"in navigator&&"PushManager"in window&&this.isStandalone()===!1}isStandalone(){return window.navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches}getInstallInstructions(){let e=navigator.userAgent.toLowerCase();return this.platform.is("ios")?`Para instalar en iOS:
1. Toca el bot\xF3n compartir (\u25A1\u2191)
2. Selecciona "Agregar a pantalla de inicio"
3. Toca "Agregar"`:this.platform.is("android")?`Para instalar en Android:
1. Toca el men\xFA (\u22EE)
2. Selecciona "Agregar a pantalla de inicio"
3. Toca "Agregar"`:e.includes("chrome")?`Para instalar en Chrome:
1. Busca el \xEDcono de instalaci\xF3n (\u2B07\uFE0F) en la barra de direcciones
2. Haz clic en "Instalar"`:e.includes("edge")?`Para instalar en Edge:
1. Busca el \xEDcono de instalaci\xF3n (\u2B07\uFE0F) en la barra de direcciones
2. Haz clic en "Instalar"`:e.includes("safari")&&!e.includes("chrome")?`Para instalar en Safari:
1. Ve a Archivo > Agregar a pantalla de inicio
2. La app aparecer\xE1 en tu Launchpad`:`Para instalar la aplicaci\xF3n:
Busca el \xEDcono de instalaci\xF3n en tu navegador o usa las opciones del men\xFA para agregar a pantalla de inicio.`}isPwaSupported(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}getBrowserInfo(){let e=navigator.userAgent,i="Unknown",o="Unknown",a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e);if(e.includes("Chrome")&&!e.includes("Edg")){i="Chrome";let r=e.match(/Chrome\/(\d+)/);o=r?r[1]:"Unknown"}else if(e.includes("Safari")&&!e.includes("Chrome")){i="Safari";let r=e.match(/Version\/(\d+)/);o=r?r[1]:"Unknown"}else if(e.includes("Firefox")){i="Firefox";let r=e.match(/Firefox\/(\d+)/);o=r?r[1]:"Unknown"}else if(e.includes("Edg")){i="Edge";let r=e.match(/Edg\/(\d+)/);o=r?r[1]:"Unknown"}return{name:i,version:o,isMobile:a}}getDebugInfo(){return{isStandalone:this.isStandalone(),canInstall:this.canInstall(),isPwaSupported:this.isPwaSupported(),browser:this.getBrowserInfo(),userAgent:navigator.userAgent,platform:this.platform.platforms()}}};t.\u0275fac=function(i){return new(i||t)(c(f))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();function ct(n,t){if(n&1){let s=de();C(0,"div",1)(1,"ion-card")(2,"ion-card-content")(3,"div",2)(4,"div",3)(5,"h3"),_(6,"Instalar aplicaci\xF3n"),S(),C(7,"p"),_(8,"Agrega esta aplicaci\xF3n a tu pantalla de inicio para un acceso m\xE1s r\xE1pido"),S()(),C(9,"div",4)(10,"ion-button",5),G("click",function(){H(s);let i=q();return W(i.dismissBanner())}),j(11,"ion-icon",6),S(),C(12,"ion-button",7),G("click",function(){H(s);let i=q();return W(i.installPWA())}),_(13," Instalar "),S()()()()()()}}var Ge=(()=>{let t=class t{constructor(e,i){this.pwaIosService=e,this.pwaInstallService=i,this.showBanner=!1}ngOnInit(){this.checkPWAInstallation(),window.addEventListener("beforeinstallprompt",this.handleBeforeInstallPrompt.bind(this))}ngOnDestroy(){window.removeEventListener("beforeinstallprompt",this.handleBeforeInstallPrompt.bind(this))}checkPWAInstallation(){if(this.pwaInstallService.isStandalone()){this.showBanner=!1;return}if(!this.pwaInstallService.isPwaSupported()){this.showBanner=!1;return}if(localStorage.getItem("pwa-banner-dismissed")){this.showBanner=!1;return}setTimeout(()=>{this.showBanner=!0},3e3)}handleBeforeInstallPrompt(e){e.preventDefault(),this.deferredPrompt=e}installPWA(){return l(this,null,function*(){if(this.deferredPrompt){this.deferredPrompt.prompt();let{outcome:e}=yield this.deferredPrompt.userChoice;e==="accepted"&&console.log("Usuario acept\xF3 instalar la PWA"),this.deferredPrompt=null,this.showBanner=!1}else this.showInstallInstructions()})}dismissBanner(){this.showBanner=!1,localStorage.setItem("pwa-banner-dismissed","true")}showInstallInstructions(){let e=this.pwaInstallService.getInstallInstructions();alert(e)}};t.\u0275fac=function(i){return new(i||t)(u(z),u($e))},t.\u0275cmp=F({type:t,selectors:[["app-pwa-install-banner"]],decls:1,vars:1,consts:[["class","pwa-banner",4,"ngIf"],[1,"pwa-banner"],[1,"banner-content"],[1,"banner-text"],[1,"banner-actions"],["fill","clear",3,"click"],["name","close","slot","icon-only"],[3,"click"]],template:function(i,o){i&1&&ce(0,ct,14,0,"div",0),i&2&&pe("ngIf",o.showBanner)},dependencies:[me,he,Le,Pe,De,ke,Te],styles:[".banner-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:16px}.banner-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:600}.banner-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;opacity:.8}.banner-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}"]});let n=t;return n})();var Y=(()=>{let t=class t{constructor(e){this.platform=e,this.debugLog$=new O([]),this.maxLogs=50,this.isMobile=!1,console.log("\u{1F50D} DebugReconnectionService: Inicializado"),this.isMobile=this.platform.is("mobile")||this.platform.is("hybrid"),console.log("\u{1F50D} DebugReconnectionService: Es m\xF3vil?",this.isMobile),this.setupVisibilityDebug(),this.isMobile&&this.setupMobileDebug()}setupVisibilityDebug(){document.addEventListener("visibilitychange",()=>{this.log(`\u{1F441}\uFE0F Visibility change: ${document.visibilityState}`)}),window.addEventListener("focus",()=>{this.log("\u{1F3AF} Window focused")}),window.addEventListener("blur",()=>{this.log("\u{1F4A8} Window blurred")}),window.addEventListener("pageshow",()=>{this.log("\u{1F4C4} Page shown")}),window.addEventListener("pagehide",()=>{this.log("\u{1F4C4} Page hidden")})}setupMobileDebug(){console.log("\u{1F50D} DebugReconnectionService: Configurando debug espec\xEDfico para m\xF3viles"),window.addEventListener("orientationchange",()=>{this.log(`\u{1F4F1} Orientation change: ${window.orientation}`)}),document.addEventListener("touchstart",()=>{this.log("\u{1F446} Touch start")},{passive:!0}),document.addEventListener("touchend",()=>{this.log("\u{1F446} Touch end")},{passive:!0}),"onpagevisibilitychange"in document&&document.addEventListener("pagevisibilitychange",()=>{this.log(`\u{1F4F1} Page visibility change (m\xF3vil): ${document.visibilityState}`)}),"onfreeze"in document&&document.addEventListener("freeze",()=>{this.log("\u2744\uFE0F App congelada (m\xF3vil)")}),"onresume"in document&&document.addEventListener("resume",()=>{this.log("\u25B6\uFE0F App resumida (m\xF3vil)")}),window.addEventListener("online",()=>{this.log("\u{1F310} Network online")}),window.addEventListener("offline",()=>{this.log("\u{1F310} Network offline")}),setInterval(()=>{let e=document.visibilityState,i=document.hasFocus(),o=navigator.onLine;this.log(`\u{1F4CA} Estado: visible=${e}, focus=${i}, online=${o}`)},1e4)}log(e){let o=`[${new Date().toLocaleTimeString()}] ${e}`;console.log(o);let r=[...this.debugLog$.value,o];r.length>this.maxLogs&&r.splice(0,r.length-this.maxLogs),this.debugLog$.next(r)}getLogs(){return this.debugLog$.asObservable()}clearLogs(){this.debugLog$.next([])}getCurrentLogs(){return this.debugLog$.value}};t.\u0275fac=function(i){return new(i||t)(c(f))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Ke=(()=>{let t=class t{constructor(e,i,o){this.swUpdate=e,this.alertController=i,this.toastController=o,this.checkForUpdates()}checkForUpdates(){this.swUpdate.isEnabled&&(this.swUpdate.checkForUpdate(),setInterval(()=>{this.swUpdate.checkForUpdate()},30*60*1e3),this.swUpdate.versionUpdates.pipe(b(e=>e.type==="VERSION_READY")).subscribe(()=>{this.promptUser()}),this.swUpdate.versionUpdates.pipe(b(e=>e.type==="VERSION_INSTALLATION_FAILED")).subscribe(()=>{this.showError()}),this.swUpdate.versionUpdates.pipe(b(e=>e.type==="VERSION_DETECTED")).subscribe(()=>{console.log("Nueva versi\xF3n detectada")}))}promptUser(){return l(this,null,function*(){yield(yield this.alertController.create({header:"Nueva versi\xF3n disponible",message:"Hay una nueva versi\xF3n de la aplicaci\xF3n disponible. \xBFDeseas actualizar ahora?",buttons:[{text:"M\xE1s tarde",role:"cancel"},{text:"Actualizar",handler:()=>{this.activateUpdate()}}]})).present()})}showError(){return l(this,null,function*(){yield(yield this.toastController.create({message:"Error al actualizar la aplicaci\xF3n",duration:3e3,position:"bottom",color:"danger"})).present()})}activateUpdate(){this.swUpdate.activateUpdate().then(()=>{window.location.reload()})}checkForUpdate(){this.swUpdate.isEnabled&&this.swUpdate.checkForUpdate().then(()=>{console.log("Verificando actualizaciones...")})}forceUpdate(){this.swUpdate.isEnabled&&this.swUpdate.activateUpdate().then(()=>{window.location.reload()})}clearCache(){"caches"in window&&caches.keys().then(e=>{e.forEach(i=>{caches.delete(i)}),console.log("Cache limpiado"),window.location.reload()})}};t.\u0275fac=function(i){return new(i||t)(c(Z),c(Re),c(Me))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Ze=(()=>{let t=class t{constructor(e){this.cacheService=e,this.cleanupInterval=setInterval(()=>{this.performCleanup()},3e4)}performCleanup(){this.cacheService.clearAllDataCache(),this.cleanupTemporaryElements(),this.forceGarbageCollection()}cleanupTemporaryElements(){try{document.querySelectorAll("[data-temp], [data-temp-listener]").forEach(o=>o.remove()),document.querySelectorAll(".temp-element, .temp-listener").forEach(o=>o.remove())}catch{}}forceGarbageCollection(){if("gc"in window)try{window.gc()}catch{}}forceCleanup(){this.performCleanup()}ngOnDestroy(){this.cleanupInterval&&clearInterval(this.cleanupInterval)}};t.\u0275fac=function(i){return new(i||t)(c(Oe))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Ye=(()=>{let t=class t{constructor(e,i,o){this.platform=e,this.supabaseClientService=i,this.authService=o,this.isInitialized=!1}ngOnInit(){this.initializeApp()}initializeApp(){return l(this,null,function*(){if(this.isInitialized){console.log("\u{1F527} AppInitService: App ya inicializada");return}try{console.log("\u{1F680} AppInitService: Iniciando aplicaci\xF3n..."),yield this.platform.ready(),console.log("\u{1F4F1} Plataforma lista:",this.platform.is("mobile")?"M\xF3vil":"Web");let e=this.supabaseClientService.getClient();console.log("\u{1F527} Cliente Supabase inicializado"),yield this.restoreUserSession(),this.isInitialized=!0,console.log("\u2705 AppInitService: Aplicaci\xF3n inicializada correctamente")}catch(e){console.error("\u274C AppInitService: Error en inicializaci\xF3n:",e)}})}restoreUserSession(){return l(this,null,function*(){try{if(console.log("\u{1F510} AppInitService: Verificando sesi\xF3n existente..."),yield this.supabaseClientService.restoreSession()){console.log("\u2705 Sesi\xF3n encontrada en almacenamiento, restaurando...");let i=yield this.supabaseClientService.getCurrentSession();i&&i.user?(console.log("\u2705 Sesi\xF3n v\xE1lida en Supabase, cargando datos del usuario..."),yield this.authService.loadUserData(i.user.id),console.log("\u2705 Usuario restaurado exitosamente")):(console.log("\u26A0\uFE0F Sesi\xF3n en almacenamiento pero no v\xE1lida en Supabase, limpiando..."),yield this.supabaseClientService.clearSessionFromPreferences())}else console.log("\u2139\uFE0F No hay sesi\xF3n almacenada para restaurar")}catch(e){console.error("\u274C AppInitService: Error restaurando sesi\xF3n:",e),yield this.supabaseClientService.clearSessionFromPreferences()}})}isAppInitialized(){return this.isInitialized}reinitializeApp(){return l(this,null,function*(){console.log("\u{1F504} AppInitService: Reinicializando aplicaci\xF3n..."),this.isInitialized=!1,yield this.initializeApp()})}};t.\u0275fac=function(i){return new(i||t)(c(f),c(V),c(x))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Qe=(()=>{let t=class t{constructor(e,i){this.ngZone=e,this.supabaseService=i,this.connectionHealth$=new O(!0),this.isReconnecting=!1,this.healthCheckInterval=null,this.lastSuccessfulConnection=Date.now(),this.consecutiveFailures=0,this.maxFailures=3,this.lastHealthCheck=0,this.minHealthCheckInterval=3e4,console.log("\u{1F9E0} SmartReconnectionService: Inicializando (modo silencioso)..."),this.startHealthMonitoring()}startHealthMonitoring(){this.healthCheckInterval=te(3e4).subscribe(()=>l(this,null,function*(){yield this.checkConnectionHealth()}))}checkConnectionHealth(){return l(this,null,function*(){try{let e=Date.now();if(e-this.lastHealthCheck<this.minHealthCheckInterval||(this.lastHealthCheck=e,document.visibilityState!=="visible"||!document.hasFocus()||this.isReconnecting)||e-this.lastSuccessfulConnection<12e4)return;console.log("\u{1F9E0} SmartReconnectionService: Verificaci\xF3n de salud programada..."),(yield this.supabaseService.testConnection(3e3))?this.handleHealthyConnection():this.handleUnhealthyConnection()}catch(e){console.error("\u274C Error en health check:",e),this.handleUnhealthyConnection()}})}handleHealthyConnection(){this.consecutiveFailures=0,this.lastSuccessfulConnection=Date.now(),this.connectionHealth$.value||(console.log("\u2705 SmartReconnectionService: Conexi\xF3n restaurada"),this.connectionHealth$.next(!0))}handleUnhealthyConnection(){this.consecutiveFailures++,this.consecutiveFailures>=this.maxFailures&&(console.log(`\u274C SmartReconnectionService: ${this.consecutiveFailures} fallos consecutivos, iniciando reconexi\xF3n silenciosa`),this.connectionHealth$.next(!1),this.attemptSilentReconnection())}attemptSilentReconnection(){return l(this,null,function*(){if(this.isReconnecting){console.log("\u{1F504} SmartReconnectionService: Ya se est\xE1 reconectando, saltando...");return}try{this.isReconnecting=!0,console.log("\u{1F9E0} SmartReconnectionService: Iniciando reconexi\xF3n silenciosa..."),yield this.clearExistingConnections(),yield new Promise(i=>setTimeout(i,1e3)),(yield this.supabaseService.testConnection(5e3))?(console.log("\u2705 SmartReconnectionService: Reconexi\xF3n silenciosa exitosa"),this.handleHealthyConnection()):(console.log("\u274C SmartReconnectionService: Reconexi\xF3n silenciosa fall\xF3, notificando a la app"),this.connectionHealth$.next(!1))}catch(e){console.error("\u274C Error en reconexi\xF3n silenciosa:",e),this.connectionHealth$.next(!1)}finally{this.isReconnecting=!1}})}clearExistingConnections(){return l(this,null,function*(){try{this.supabaseService.getClient().removeAllChannels(),console.log("\u{1F9E0} SmartReconnectionService: Conexiones existentes limpiadas")}catch(e){console.warn("\u26A0\uFE0F Error limpiando conexiones:",e)}})}forceConnectionCheck(){return l(this,null,function*(){console.log("\u{1F9E0} SmartReconnectionService: Verificaci\xF3n forzada solicitada...");try{let e=yield this.supabaseService.testConnection(5e3);return e?this.handleHealthyConnection():this.handleUnhealthyConnection(),e}catch(e){return console.error("\u274C Error en verificaci\xF3n forzada:",e),this.handleUnhealthyConnection(),!1}})}get connectionHealth(){return this.connectionHealth$.asObservable()}get isConnectionHealthy(){return this.connectionHealth$.value}cleanup(){this.healthCheckInterval&&this.healthCheckInterval.unsubscribe(),console.log("\u{1F9E0} SmartReconnectionService: Recursos limpiados")}};t.\u0275fac=function(i){return new(i||t)(c(U),c(V))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Je=(()=>{let t=class t{constructor(e,i,o,a,r,v,d,m,tt,it){this.pwaUpdateService=e,this.pwaIosService=i,this.viewportService=o,this.authService=a,this.performanceFix=r,this.appInitService=v,this.safeAreaService=d,this.reconnectionService=m,this.debugReconnectionService=tt,this.smartReconnectionService=it}ngOnInit(){return l(this,null,function*(){try{console.log("\u{1F680} AppComponent: Iniciando aplicaci\xF3n..."),yield this.appInitService.initializeApp();let e=this.safeAreaService.getPlatformInfo();console.log("\u{1F4F1} Informaci\xF3n de plataforma:",e),this.authService.isAuthenticated$.subscribe(i=>{console.log("Estado de autenticaci\xF3n:",i)}),this.isDevMode()||setInterval(()=>{this.performanceFix.forceCleanup()},2*60*1e3),console.log("\u2705 AppComponent: Aplicaci\xF3n iniciada correctamente")}catch(e){console.error("\u274C AppComponent: Error en inicializaci\xF3n:",e)}})}isDevMode(){return!g.production}};t.\u0275fac=function(i){return new(i||t)(u(Ke),u(z),u(je),u(x),u(Ze),u(Ye),u(Ue),u(Fe),u(Y),u(Qe))},t.\u0275cmp=F({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(i,o){i&1&&(C(0,"ion-app"),j(1,"ion-router-outlet")(2,"app-pwa-install-banner"),S())},dependencies:[xe,Ee,Ge],encapsulation:2});let n=t;return n})();var Q=0,mt=5,Xe=[];function et(n,t){return Q>=mt&&console.warn("\u26A0\uFE0F Demasiadas peticiones concurrentes, limitando requests"),Q++,t(n).pipe(ne(()=>{if(Q--,Xe.length>0){let s=Xe.shift();s&&s()}}))}var N=class{static initialize(){g.production&&(this.disableConsoleLogs(),this.setupErrorHandling(),this.optimizePerformance())}static disableConsoleLogs(){let t=console.log,s=console.debug,e=console.info,i=console.warn,o=console.error;console.log=()=>{},console.debug=()=>{},console.info=()=>{},console.warn=()=>{},console.error=(...a)=>{let r=a[0];typeof r=="string"&&(r.includes("ERROR")||r.includes("CRITICAL")||r.includes("FATAL"))&&o(...a)},console.clear()}static setupErrorHandling(){window.addEventListener("error",t=>{t.error&&t.error.message&&t.error.message.includes("CRITICAL")&&console.error("Error cr\xEDtico:",t.error)}),window.addEventListener("unhandledrejection",t=>{t.reason&&t.reason.message&&t.reason.message.includes("CRITICAL")&&console.error("Promesa rechazada cr\xEDtica:",t.reason)})}static optimizePerformance(){if(window.performance&&window.performance.getEntriesByType){let t=window.performance.getEntriesByType;window.performance.getEntriesByType=s=>s==="navigation"||s==="resource"?t.call(window.performance,s):[]}}};var B=class{static initialize(){g.production?this.setupProductionLogging():this.setupDevelopmentLogging()}static setupProductionLogging(){let t=()=>{};console.log=t,console.debug=t,console.info=t,console.warn=t;let s=console.error;if(console.error=(...e)=>{let i=e[0];typeof i=="string"&&(i.includes("ERROR")||i.includes("CRITICAL")||i.includes("FATAL"))&&s(...e)},console.clear(),window.performance&&window.performance.getEntriesByType){let e=window.performance.getEntriesByType;window.performance.getEntriesByType=i=>i==="navigation"||i==="resource"?e.call(window.performance,i):[]}window.addEventListener("error",e=>{e.error&&e.error.message&&e.error.message.includes("CRITICAL")&&console.error("Error cr\xEDtico:",e.error)}),window.addEventListener("unhandledrejection",e=>{e.reason&&e.reason.message&&e.reason.message.includes("CRITICAL")&&console.error("Promesa rechazada cr\xEDtica:",e.reason)})}static setupDevelopmentLogging(){console.log("\u{1F6E0}\uFE0F Modo desarrollo: Logging habilitado"),console.debug("\u{1F50D} Debug habilitado"),console.info("\u2139\uFE0F Info habilitado"),console.warn("\u26A0\uFE0F Warning habilitado"),console.error("\u274C Error habilitado")}};if(g.production){N.initialize(),B.initialize(),console.clear(),console.log=()=>{},console.debug=()=>{},console.info=()=>{},console.warn=()=>{};let n=console.error;console.error=(...t)=>{t[0]&&typeof t[0]=="string"&&(t[0].includes("ERROR")||t[0].includes("CRITICAL")||t[0].includes("FATAL"))&&n(...t)}}fe(Je,{providers:[{provide:we,useClass:ye},Ae(),Se(He,Ie(Ce)),ge(ve([et])),ze("ngsw-worker.js",{enabled:!ue(),registrationStrategy:"registerWhenStable:30000"})]});
