import{C as E,a as n,q as h,y as l}from"./chunk-JSLDYZN7.js";var r={CACHE:{DEFAULT_TTL:12e4,MAX_SIZE:25,CLEANUP_INTERVAL:3e4},MEMORY:{CLEANUP_INTERVAL:3e4,FORCE_CLEANUP_INTERVAL:12e4},OBSERVABLES:{MAX_SUBSCRIPTIONS:20,CLEANUP_INTERVAL:45e3},HTTP:{MAX_CONCURRENT_REQUESTS:5,REQUEST_TIMEOUT:3e4},SUPABASE:{EVENTS_PER_SECOND:2,MAX_RETRIES:2},PAGINATION:{DEFAULT_PAGE_SIZE:15,MAX_PAGE_SIZE:25}};var f=(()=>{let c=class c{constructor(){this.cache=new Map,this.DEFAULT_TTL=r.CACHE.DEFAULT_TTL,this.MAX_CACHE_SIZE=r.CACHE.MAX_SIZE,this.startAutoCleanup()}startAutoCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},r.CACHE.CLEANUP_INTERVAL)}stopAutoCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}getOrSet(e,t,s=this.DEFAULT_TTL){let i=this.get(e);return i?(console.log(`\u2705 Cache hit: ${e}`),new n(a=>{a.next(i),a.complete()})):(console.log(`\u{1F504} Cache miss: ${e}`),t().pipe(l(a=>{this.set(e,a,s)}),h(a=>{throw console.error(`\u274C Error fetching data for key ${e}:`,a),a})))}set(e,t,s=this.DEFAULT_TTL){this.cache.size>this.MAX_CACHE_SIZE&&this.cleanup(),this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}get(e){let t=this.cache.get(e);return t&&!this.isExpired(t)?t.data:null}delete(e){this.cache.delete(e)}clear(){this.cache.clear(),console.log("\u{1F5D1}\uFE0F Cache completamente limpiado")}clearCache(e){let t=[];for(let s of this.cache.keys())s.startsWith(e)&&t.push(s);t.forEach(s=>this.cache.delete(s)),console.log(`\u{1F5D1}\uFE0F Cleared cache for prefix: ${e} (${t.length} items)`)}clearMultipleCaches(e){e.forEach(t=>this.clearCache(t)),console.log(`\u{1F5D1}\uFE0F Cleared multiple caches: ${e.join(", ")}`)}clearAllDataCache(){let e=["avisos","presupuestos","facturas","inventario","clientes","tecnicos","dashboard"];this.clearMultipleCaches(e)}cleanup(){let e=Date.now();for(let[t,s]of this.cache.entries())this.isExpired(s)&&this.cache.delete(t);if(this.cache.size>this.MAX_CACHE_SIZE){let t=Array.from(this.cache.entries());t.sort((i,a)=>i[1].timestamp-a[1].timestamp),t.slice(0,t.length-this.MAX_CACHE_SIZE).forEach(([i])=>this.cache.delete(i))}}isExpired(e){return Date.now()-e.timestamp>e.ttl}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}generateKey(e,t){let s=JSON.stringify(t);return`${e}:${s}`}ngOnDestroy(){this.stopAutoCleanup(),this.clear()}};c.\u0275fac=function(t){return new(t||c)},c.\u0275prov=E({token:c,factory:c.\u0275fac,providedIn:"root"});let o=c;return o})();export{f as a};
