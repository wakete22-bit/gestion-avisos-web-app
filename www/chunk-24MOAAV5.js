import{b}from"./chunk-GDHKTYOW.js";import{F as p,I as _,d as h,f as a,j as l,m as d,s as t,z as u}from"./chunk-4AY4VQCP.js";import{a as c,b as s,k as g}from"./chunk-CRC5ZNR6.js";var z=(()=>{let f=class f{constructor(o){this.supabaseClientService=o,this.ajustesSubject=new h(null),this.ajustes$=this.ajustesSubject.asObservable(),this.supabase=this.supabaseClientService.getClient()}getAjustesCompletos(){return d({empresa:this.getConfiguracionEmpresa(),facturacion:this.getConfiguracionFacturacion(),notificaciones:this.getConfiguracionNotificaciones(),avisos:this.getConfiguracionAvisos(),sistema:this.getConfiguracionSistema()}).pipe(l(o=>(this.ajustesSubject.next(o),o)),t(o=>{throw console.error("Error al obtener ajustes completos:",o),o}))}getConfiguracionEmpresa(){return a(this.supabase.from("configuracion_empresa").select("*").limit(1)).pipe(u(({data:o,error:i})=>{if(i)throw console.error("Error al obtener configuraci\xF3n de empresa:",i),i;return!o||o.length===0?(console.log("No hay configuraci\xF3n de empresa, creando por defecto..."),a(this.crearConfiguracionEmpresaPorDefecto())):a(Promise.resolve(o[0]))}),t(o=>(console.error("Error al obtener configuraci\xF3n de empresa:",o),a(this.crearConfiguracionEmpresaPorDefecto()))))}getConfiguracionFacturacion(){return a(this.supabase.from("configuracion_facturacion").select("*").limit(1)).pipe(u(({data:o,error:i})=>{if(i)throw console.error("Error al obtener configuraci\xF3n de facturaci\xF3n:",i),i;return!o||o.length===0?(console.log("No hay configuraci\xF3n de facturaci\xF3n, creando por defecto..."),a(this.crearConfiguracionFacturacionPorDefecto())):a(Promise.resolve(o[0]))}),t(o=>(console.error("Error al obtener configuraci\xF3n de facturaci\xF3n:",o),a(this.crearConfiguracionFacturacionPorDefecto()))))}getConfiguracionNotificaciones(){return a(this.supabase.from("configuracion_notificaciones").select("*").limit(1)).pipe(u(({data:o,error:i})=>{if(i)throw console.error("Error al obtener configuraci\xF3n de notificaciones:",i),i;return!o||o.length===0?(console.log("No hay configuraci\xF3n de notificaciones, creando por defecto..."),a(this.crearConfiguracionNotificacionesPorDefecto())):a(Promise.resolve(o[0]))}),t(o=>(console.error("Error al obtener configuraci\xF3n de notificaciones:",o),a(this.crearConfiguracionNotificacionesPorDefecto()))))}getConfiguracionAvisos(){return a(this.supabase.from("configuracion_avisos").select("*").limit(1)).pipe(u(({data:o,error:i})=>{if(i)throw console.error("Error al obtener configuraci\xF3n de avisos:",i),i;return!o||o.length===0?(console.log("No hay configuraci\xF3n de avisos, creando por defecto..."),a(this.crearConfiguracionAvisosPorDefecto())):a(Promise.resolve(o[0]))}),t(o=>(console.error("Error al obtener configuraci\xF3n de avisos:",o),a(this.crearConfiguracionAvisosPorDefecto()))))}getConfiguracionSistema(){return a(this.supabase.from("configuracion_sistema").select("*").limit(1)).pipe(u(({data:o,error:i})=>{if(i)throw console.error("Error al obtener configuraci\xF3n del sistema:",i),i;return!o||o.length===0?(console.log("No hay configuraci\xF3n del sistema, creando por defecto..."),a(this.crearConfiguracionSistemaPorDefecto())):a(Promise.resolve(o[0]))}),t(o=>(console.error("Error al obtener configuraci\xF3n del sistema:",o),a(this.crearConfiguracionSistemaPorDefecto()))))}actualizarConfiguracionEmpresa(o){let i=s(c({},o),{fecha_actualizacion:new Date().toISOString()});return console.log("\u{1F504} Actualizando configuraci\xF3n de empresa:",i),a(this.supabase.from("configuracion_empresa").select("id").limit(1)).pipe(u(({data:e,error:n})=>{if(n)throw console.error("\u274C Error verificando configuraci\xF3n existente:",n),n;if(console.log("\u{1F4CA} Datos existentes encontrados:",e),e&&e.length>0){let r=e[0].id;return console.log("\u2705 Actualizando configuraci\xF3n existente con ID:",r),a(this.supabase.from("configuracion_empresa").update(i).eq("id",r).select("*").single())}else return console.log("\u{1F195} Creando nueva configuraci\xF3n de empresa"),a(this.supabase.from("configuracion_empresa").insert([s(c({},i),{fecha_creacion:new Date().toISOString()})]).select("*").single())}),l(({data:e,error:n})=>{if(n)throw console.error("\u274C Error en operaci\xF3n de base de datos:",n),n;console.log("\u2705 Configuraci\xF3n actualizada exitosamente:",e);let r=e;return this.actualizarAjustesLocales("empresa",r),r}),t(e=>{throw console.error("\u274C Error al actualizar configuraci\xF3n de empresa:",e),e}))}actualizarConfiguracionFacturacion(o){let i=s(c({},o),{fecha_actualizacion:new Date().toISOString()});return a(this.supabase.from("configuracion_facturacion").select("id").limit(1)).pipe(u(({data:e,error:n})=>{if(n)throw console.error("Error verificando configuraci\xF3n existente:",n),n;if(e&&e.length>0){let r=e[0].id;return console.log("Actualizando configuraci\xF3n de facturaci\xF3n existente con ID:",r),a(this.supabase.from("configuracion_facturacion").update(i).eq("id",r).select("*").single())}else return console.log("Creando nueva configuraci\xF3n de facturaci\xF3n"),a(this.supabase.from("configuracion_facturacion").insert([s(c({},i),{fecha_creacion:new Date().toISOString()})]).select("*").single())}),l(({data:e,error:n})=>{if(n)throw n;let r=e;return this.actualizarAjustesLocales("facturacion",r),r}),t(e=>{throw console.error("Error al actualizar configuraci\xF3n de facturaci\xF3n:",e),e}))}actualizarConfiguracionNotificaciones(o){let i=s(c({},o),{fecha_actualizacion:new Date().toISOString()});return a(this.supabase.from("configuracion_notificaciones").select("id").limit(1)).pipe(u(({data:e,error:n})=>{if(n)throw console.error("Error verificando configuraci\xF3n existente:",n),n;if(e&&e.length>0){let r=e[0].id;return console.log("Actualizando configuraci\xF3n de notificaciones existente con ID:",r),a(this.supabase.from("configuracion_notificaciones").update(i).eq("id",r).select("*").single())}else return console.log("Creando nueva configuraci\xF3n de notificaciones"),a(this.supabase.from("configuracion_notificaciones").insert([s(c({},i),{fecha_creacion:new Date().toISOString()})]).select("*").single())}),l(({data:e,error:n})=>{if(n)throw n;let r=e;return this.actualizarAjustesLocales("notificaciones",r),r}),t(e=>{throw console.error("Error al actualizar configuraci\xF3n de notificaciones:",e),e}))}actualizarConfiguracionAvisos(o){let i=s(c({},o),{fecha_actualizacion:new Date().toISOString()});return a(this.supabase.from("configuracion_avisos").select("id").limit(1)).pipe(u(({data:e,error:n})=>{if(n)throw console.error("Error verificando configuraci\xF3n existente:",n),n;if(e&&e.length>0){let r=e[0].id;return console.log("Actualizando configuraci\xF3n de avisos existente con ID:",r),a(this.supabase.from("configuracion_avisos").update(i).eq("id",r).select("*").single())}else return console.log("Creando nueva configuraci\xF3n de avisos"),a(this.supabase.from("configuracion_avisos").insert([s(c({},i),{fecha_creacion:new Date().toISOString()})]).select("*").single())}),l(({data:e,error:n})=>{if(n)throw n;let r=e;return this.actualizarAjustesLocales("avisos",r),r}),t(e=>{throw console.error("Error al actualizar configuraci\xF3n de avisos:",e),e}))}actualizarConfiguracionSistema(o){let i=s(c({},o),{fecha_actualizacion:new Date().toISOString()});return a(this.supabase.from("configuracion_sistema").select("id").limit(1)).pipe(u(({data:e,error:n})=>{if(n)throw console.error("Error verificando configuraci\xF3n existente:",n),n;if(e&&e.length>0){let r=e[0].id;return console.log("Actualizando configuraci\xF3n del sistema existente con ID:",r),a(this.supabase.from("configuracion_sistema").update(i).eq("id",r).select("*").single())}else return console.log("Creando nueva configuraci\xF3n del sistema"),a(this.supabase.from("configuracion_sistema").insert([s(c({},i),{fecha_creacion:new Date().toISOString()})]).select("*").single())}),l(({data:e,error:n})=>{if(n)throw n;let r=e;return this.actualizarAjustesLocales("sistema",r),r}),t(e=>{throw console.error("Error al actualizar configuraci\xF3n del sistema:",e),e}))}actualizarAjustesLocales(o,i){let e=this.ajustesSubject.value;e&&(e[o]=i,this.ajustesSubject.next(c({},e)),console.log("\u2705 Ajustes locales actualizados:",o,i))}crearConfiguracionEmpresaPorDefecto(){return g(this,null,function*(){let o={nombre_empresa:"Mi Empresa",cif:"",direccion:"",telefono:"",email:"",web:"",logo_url:"",precio_hora_mano_obra:50,fecha_creacion:new Date().toISOString(),fecha_actualizacion:new Date().toISOString()},{data:i,error:e}=yield this.supabase.from("configuracion_empresa").insert([o]).select().single();if(e)throw e;return i})}crearConfiguracionFacturacionPorDefecto(){return g(this,null,function*(){let o={iva_por_defecto:21,moneda:"EUR",formato_numero_factura:"FAC-{YEAR}-{NUMBER}",dias_vencimiento:30,texto_pie_factura:"Gracias por confiar en nuestros servicios",condiciones_pago:"Pago a 30 d\xEDas",fecha_creacion:new Date().toISOString(),fecha_actualizacion:new Date().toISOString()},{data:i,error:e}=yield this.supabase.from("configuracion_facturacion").insert([o]).select().single();if(e)throw e;return i})}crearConfiguracionNotificacionesPorDefecto(){return g(this,null,function*(){let o={email_notificaciones:!0,email_avisos_nuevos:!0,email_facturas_generadas:!0,email_recordatorios:!1,sms_notificaciones:!1,sms_avisos_urgentes:!1,fecha_creacion:new Date().toISOString(),fecha_actualizacion:new Date().toISOString()},{data:i,error:e}=yield this.supabase.from("configuracion_notificaciones").insert([o]).select().single();if(e)throw e;return i})}crearConfiguracionAvisosPorDefecto(){return g(this,null,function*(){let o={tipos_urgencia:["Baja","Media","Alta","Cr\xEDtica"],estados_disponibles:["Pendiente","En curso","Completado","Cancelado"],tiempo_maximo_respuesta:24,asignacion_automatica:!1,fecha_creacion:new Date().toISOString(),fecha_actualizacion:new Date().toISOString()},{data:i,error:e}=yield this.supabase.from("configuracion_avisos").insert([o]).select().single();if(e)throw e;return i})}crearConfiguracionSistemaPorDefecto(){return g(this,null,function*(){let o={backup_automatico:!0,frecuencia_backup:"diario",retencion_backup_dias:30,modo_mantenimiento:!1,mensaje_mantenimiento:"Sistema en mantenimiento. Volveremos pronto.",fecha_creacion:new Date().toISOString(),fecha_actualizacion:new Date().toISOString()},{data:i,error:e}=yield this.supabase.from("configuracion_sistema").insert([o]).select().single();if(e)throw e;return i})}getAjustesActuales(){return this.ajustesSubject.value}limpiarAjustes(){this.ajustesSubject.next(null)}};f.\u0275fac=function(i){return new(i||f)(_(b))},f.\u0275prov=p({token:f,factory:f.\u0275fac,providedIn:"root"});let m=f;return m})();export{z as a};
