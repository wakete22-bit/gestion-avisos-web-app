import{A as n,E as o,r as h}from"./chunk-QQQKELKR.js";var i={CACHE:{DEFAULT_TTL:12e4,MAX_SIZE:25,CLEANUP_INTERVAL:3e4},MEMORY:{CLEANUP_INTERVAL:3e4,FORCE_CLEANUP_INTERVAL:12e4},OBSERVABLES:{MAX_SUBSCRIPTIONS:20,CLEANUP_INTERVAL:45e3},HTTP:{MAX_CONCURRENT_REQUESTS:5,REQUEST_TIMEOUT:3e4},SUPABASE:{EVENTS_PER_SECOND:2,MAX_RETRIES:2},PAGINATION:{DEFAULT_PAGE_SIZE:15,MAX_PAGE_SIZE:25}};var u=(()=>{let r=class r{constructor(){this.cache=new Map,this.DEFAULT_TTL=i.CACHE.DEFAULT_TTL,this.MAX_CACHE_SIZE=i.CACHE.MAX_SIZE,this.startAutoCleanup()}startAutoCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},i.CACHE.CLEANUP_INTERVAL)}stopAutoCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}getOrSet(e,t,s=this.DEFAULT_TTL){return t().pipe(n(a=>{this.set(e,a,s)}),h(a=>{throw console.error(`\u274C Error fetching data for key ${e}:`,a),a}))}set(e,t,s=this.DEFAULT_TTL){this.cache.size>this.MAX_CACHE_SIZE&&this.cleanup(),this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}get(e){let t=this.cache.get(e);return t&&!this.isExpired(t)?t.data:null}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}clearCache(e){let t=[];for(let s of this.cache.keys())s.startsWith(e)&&t.push(s);t.forEach(s=>this.cache.delete(s))}clearMultipleCaches(e){e.forEach(t=>this.clearCache(t))}clearAllDataCache(){let e=["avisos","presupuestos","facturas","inventario","clientes","tecnicos","dashboard"];this.clearMultipleCaches(e)}cleanup(){let e=Date.now();for(let[t,s]of this.cache.entries())this.isExpired(s)&&this.cache.delete(t);if(this.cache.size>this.MAX_CACHE_SIZE){let t=Array.from(this.cache.entries());t.sort((a,E)=>a[1].timestamp-E[1].timestamp),t.slice(0,t.length-this.MAX_CACHE_SIZE).forEach(([a])=>this.cache.delete(a))}}isExpired(e){return Date.now()-e.timestamp>e.ttl}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}generateKey(e,t){let s=JSON.stringify(t);return`${e}:${s}`}ngOnDestroy(){this.stopAutoCleanup(),this.clear()}};r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=o({token:r,factory:r.\u0275fac,providedIn:"root"});let c=r;return c})();export{u as a};
