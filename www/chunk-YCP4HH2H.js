import{a as U,y as W}from"./chunk-YLXVY5X4.js";import{a as X}from"./chunk-AXRRPIFT.js";import{e as J,h as K,j as Q}from"./chunk-CENH7PAC.js";import{b as H}from"./chunk-EZQHEP6E.js";import{$b as T,B as j,E as F,P as I,Rb as N,Sb as D,U as C,Ub as u,V as x,Vb as L,Wb as G,X as z,Ya as q,c as k,cc as $,dc as V,e as g,ea as P,ha as i,i as h,ia as n,ja as p,lc as B,nc as R,oa as _,p as E,xa as l,ya as S,za as A}from"./chunk-YCXETNVK.js";import{a as v,b as M,k as O}from"./chunk-CRC5ZNR6.js";var ce=(()=>{let c=class c{constructor(t,o,e,r){this.fb=t,this.modalController=o,this.viewportService=e,this.elementRef=r,this.modo="crear",this.clienteForm=this.fb.group({nombreContacto:["",u.required],telefono:["",u.required],correoElectronico:["",[u.required,u.email]],direccionLocal:["",u.required],codigoPostal:["",u.required],localidad:["",u.required],esActivo:[!0,u.required]})}ngOnInit(){U({closeOutline:W}),this.modo==="editar"&&this.cliente&&this.cargarDatosCliente()}ngAfterViewInit(){setTimeout(()=>{let t=this.elementRef.nativeElement.querySelector(".modal-container");t&&this.viewportService.applySafeAreaToModal(t)},100)}cargarDatosCliente(){var d;if(!this.cliente)return;let t=this.cliente.direccion||"",o=t.split(", "),e="",r="",s="";if(o.length>=2){e=o[0];let a=o[o.length-1],m=a.split(" ");m.length>=2?(r=m[0],s=m.slice(1).join(" ")):s=a}else e=t;this.clienteForm.patchValue({nombreContacto:this.cliente.nombre_completo||"",telefono:this.cliente.telefono_contacto||"",email:this.cliente.email||"",direccionLocal:e,codigoPostal:r,localidad:s,esActivo:(d=this.cliente.es_activo)!=null?d:!0})}guardarCliente(){return O(this,null,function*(){var t;if(this.clienteForm.valid){let o={nombre_completo:this.clienteForm.value.nombreContacto,telefono_contacto:this.clienteForm.value.telefono,email:this.clienteForm.value.correoElectronico,direccion:`${this.clienteForm.value.direccionLocal}, ${this.clienteForm.value.codigoPostal} ${this.clienteForm.value.localidad}`,nivel_urgencia_habitual:((t=this.cliente)==null?void 0:t.nivel_urgencia_habitual)||"Media",es_activo:this.clienteForm.value.esActivo};yield this.modalController.dismiss(o,"confirm")}})}cerrarModal(){return O(this,null,function*(){yield this.modalController.dismiss(null,"cancel")})}get tituloModal(){return this.modo==="editar"?"Editar cliente":"A\xF1adir nuevo cliente"}get subtituloModal(){return this.modo==="editar"?"Modifica los datos del cliente":"A\xF1ade un nuevo cliente"}get textoBotonGuardar(){return this.modo==="editar"?"Guardar cambios":"Guardar cliente"}};c.\u0275fac=function(o){return new(o||c)(x(B),x(K),x(X),x(I))},c.\u0275cmp=z({type:c,selectors:[["app-crear-cliente-modal"]],inputs:{modo:"modo",cliente:"cliente"},decls:57,vars:5,consts:[[1,"modal-container"],[1,"modal-header"],[1,"header-content"],[1,"close-button",3,"click"],["name","close-outline"],[1,"subtitle"],[1,"modal-content"],[3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-group"],["type","text","formControlName","nombreContacto","placeholder","Ej: Luis P\xE9rez",1,"form-control"],[1,"form-row"],[1,"form-group","half"],["type","tel","formControlName","telefono","placeholder","Ej: +34 569 23 56 89",1,"form-control"],["type","email","formControlName","correoElectronico","placeholder","Ej: ejemplo@dominio.es",1,"form-control"],[1,"required"],["type","text","formControlName","direccionLocal","placeholder","Ej: Calle Azorin",1,"form-control"],["type","text","formControlName","codigoPostal","placeholder","28004",1,"form-control"],["type","text","formControlName","localidad","placeholder","Ej: Madrid",1,"form-control"],[1,"checkbox-label"],["type","checkbox","formControlName","esActivo",1,"form-checkbox"],[1,"checkmark"],[1,"form-help"],[1,"modal-footer"],[1,"button-group"],["type","button",1,"btn","btn-outline",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(o,e){o&1&&(i(0,"div",0)(1,"header",1)(2,"div",2)(3,"h2"),l(4),n(),i(5,"button",3),_("click",function(){return e.cerrarModal()}),p(6,"ion-icon",4),n()(),i(7,"p",5),l(8),n()(),i(9,"div",6)(10,"form",7),_("ngSubmit",function(){return e.guardarCliente()}),i(11,"div",8)(12,"div",9)(13,"label"),l(14,"Nombre de contacto"),n(),p(15,"input",10),n(),i(16,"div",11)(17,"div",12)(18,"label"),l(19,"Tel\xE9fono"),n(),p(20,"input",13),n(),i(21,"div",12)(22,"label"),l(23,"Correo electr\xF3nico"),n(),p(24,"input",14),n()(),i(25,"div",9)(26,"label"),l(27,"Direccion local "),i(28,"span",15),l(29,"*"),n()(),p(30,"input",16),n(),i(31,"div",11)(32,"div",12)(33,"label"),l(34,"C\xF3digo Postal "),i(35,"span",15),l(36,"*"),n()(),p(37,"input",17),n(),i(38,"div",12)(39,"label"),l(40,"Localidad "),i(41,"span",15),l(42,"*"),n()(),p(43,"input",18),n()(),i(44,"div",9)(45,"label",19),p(46,"input",20)(47,"span",21),l(48," Cliente activo "),n(),i(49,"small",22),l(50,"Los clientes inactivos no aparecer\xE1n en las b\xFAsquedas principales"),n()()()()(),i(51,"footer",23)(52,"div",24)(53,"button",25),_("click",function(){return e.cerrarModal()}),l(54," Cancelar "),n(),i(55,"button",26),_("click",function(){return e.guardarCliente()}),l(56),n()()()()),o&2&&(C(4),S(e.tituloModal),C(4),S(e.subtituloModal),C(2),P("formGroup",e.clienteForm),C(45),P("disabled",!e.clienteForm.valid),C(),A(" ",e.textoBotonGuardar," "))},dependencies:[Q,J,q,R,T,D,N,L,G,$,V],styles:[".modal-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:0;max-height:85vh;background:#fff}.modal-header[_ngcontent-%COMP%]{padding:16px 24px;border-bottom:1px solid #e5e7eb;flex-shrink:0}.modal-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.modal-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;color:#111827}.modal-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:8px 0 0;color:#6b7280;font-size:14px}.modal-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;color:#6b7280;display:flex;align-items:center;justify-content:center}.modal-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]:hover{color:#111827}.modal-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.modal-content[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto}.modal-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{height:100%}.form-section[_ngcontent-%COMP%]{padding:24px;max-height:calc(85vh - 140px)}.form-group[_ngcontent-%COMP%]{position:relative;margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-size:14px;font-weight:500;color:#374151}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:#dc2626}.form-control[_ngcontent-%COMP%]{position:relative;width:100%;padding:10px 12px;background-color:#fafafb;border:1px solid transparent;border-radius:6px;font-size:14px;color:#111827;transition:border-color .2s}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb}.form-control[_ngcontent-%COMP%]::placeholder{color:#9ca3af}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.character-count[_ngcontent-%COMP%]{position:absolute;bottom:13px;right:13px;font-size:12px;color:#6b7280}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;font-weight:500;color:#374151;margin-bottom:4px}.checkbox-label[_ngcontent-%COMP%]   .form-checkbox[_ngcontent-%COMP%]{width:16px;height:16px;accent-color:#4F46E5;cursor:pointer}.checkbox-label[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]{display:none}.form-help[_ngcontent-%COMP%]{display:block;font-size:12px;color:#6b7280;margin-top:4px}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:0;flex:1}.modal-footer[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e5e7eb;background-color:#fff;flex-shrink:0}.modal-footer[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end}.modal-footer[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-size:14px;font-weight:500;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s}.modal-footer[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.modal-footer[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-outline[_ngcontent-%COMP%]{background:none;border:1px solid #d1d5db;color:#374151}.modal-footer[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f8fafc;border-color:#9ca3af}.modal-footer[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background-color:#4f46e5;border:1px solid #4F46E5;color:#fff}.modal-footer[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#4338ca;border-color:#4338ca}@media (max-width: 768px){.modal-container[_ngcontent-%COMP%]{max-height:none;height:100vh}.modal-body[_ngcontent-%COMP%]{overflow-y:auto}.modal-content[_ngcontent-%COMP%]{height:auto;overflow:auto}.form-control[_ngcontent-%COMP%]{font-size:16px;padding:12px}textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{font-size:14px!important;padding:12px}.input-with-button[_ngcontent-%COMP%]{flex-direction:column}.input-with-button[_ngcontent-%COMP%]   .add-button[_ngcontent-%COMP%]{position:static;margin-top:8px;width:100%;justify-content:center}}@media (display-mode: standalone) and (max-width: 768px){.modal-container[_ngcontent-%COMP%]{height:calc(100vh - var(--safe-area-top, 0px) - var(--safe-area-bottom, 0px));max-height:calc(100vh - var(--safe-area-top, 0px) - var(--safe-area-bottom, 0px))}.modal-header[_ngcontent-%COMP%]{padding-top:calc(16px + var(--safe-area-top, 0px))}.modal-footer[_ngcontent-%COMP%]{padding-bottom:calc(16px + var(--safe-area-bottom, 0px))}}@supports (-webkit-touch-callout: none){@media (display-mode: standalone) and (max-width: 768px){.modal-container[_ngcontent-%COMP%]{height:calc(100vh - var(--safe-area-top, 0px) - var(--safe-area-bottom, 0px));max-height:calc(100vh - var(--safe-area-top, 0px) - var(--safe-area-bottom, 0px))}.modal-header[_ngcontent-%COMP%]{padding-top:calc(16px + var(--safe-area-top, 0px))}.modal-footer[_ngcontent-%COMP%]{padding-bottom:calc(16px + var(--safe-area-bottom, 0px))}}}@supports not (padding-top: env(safe-area-inset-top)){@media (display-mode: standalone) and (max-width: 768px){.modal-container[_ngcontent-%COMP%]{height:calc(100vh - 40px);max-height:calc(100vh - 40px)}.modal-header[_ngcontent-%COMP%]{padding-top:36px}.modal-footer[_ngcontent-%COMP%]{padding-bottom:36px}}}"]});let f=c;return f})();var fe=(()=>{let c=class c{constructor(t){this.supabaseClientService=t,this.clientesSubject=new k([]),this.clientes$=this.clientesSubject.asObservable(),this.supabase=this.supabaseClientService.getClient()}getClientes(t=1,o=10,e,r,s,d=!1){let a=this.supabase.from("clientes").select("*",{count:"exact"});e&&(a=a.or(`nombre_completo.ilike.%${e}%,email.ilike.%${e}%`)),d&&(a=a.eq("es_activo",!0));let m=(t-1)*o;return a=a.range(m,m+o-1).order(r||"fecha_creacion",{ascending:s==="asc"}),g(a).pipe(h(({data:b,error:y,count:Y})=>{if(y)throw y;let w=b;return this.clientesSubject.next(w),{clientes:w,total:Y||0,pagina:t,por_pagina:o}}),E(b=>{throw console.error("Error al obtener clientes:",b),b}))}getCliente(t){return g(this.supabase.from("clientes").select("*").eq("id",t).single()).pipe(h(({data:o,error:e})=>{if(e)throw e;return o}))}crearCliente(t){var e;let o=M(v({},t),{fecha_creacion:new Date().toISOString(),es_activo:(e=t.es_activo)!=null?e:!0});return g(this.supabase.from("clientes").insert([o]).select().single()).pipe(h(({data:r,error:s})=>{if(s)throw s;let d=r,a=this.clientesSubject.value;return this.clientesSubject.next([d,...a]),d}))}actualizarCliente(t,o){let e=M(v({},o),{fecha_actualizacion:new Date().toISOString()});return g(this.supabase.from("clientes").update(e).eq("id",t).select().single()).pipe(h(({data:r,error:s})=>{if(s)throw s;let d=r,a=this.clientesSubject.value,m=a.findIndex(b=>b.id===t);return m!==-1&&(a[m]=d,this.clientesSubject.next([...a])),d}))}eliminarCliente(t){return g(this.supabase.from("clientes").update({es_activo:!1,fecha_actualizacion:new Date().toISOString()}).eq("id",t)).pipe(h(({error:o})=>{if(o)throw o;let e=this.clientesSubject.value,r=e.findIndex(s=>s.id===t);r!==-1&&(e[r].es_activo=!1,this.clientesSubject.next([...e]))}))}buscarClientes(t){return g(this.supabase.from("clientes").select("*").or(`nombre_completo.ilike.%${t}%,email.ilike.%${t}%`).eq("es_activo",!0).limit(10)).pipe(h(({data:o,error:e})=>{if(e)throw e;return o}))}getClientesActuales(){return this.clientesSubject.value}limpiarClientes(){this.clientesSubject.next([])}};c.\u0275fac=function(o){return new(o||c)(F(H))},c.\u0275prov=j({token:c,factory:c.\u0275fac,providedIn:"root"});let f=c;return f})();export{ce as a,fe as b};
