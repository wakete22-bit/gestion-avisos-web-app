import{E as v,H as D}from"./chunk-QQQKELKR.js";import{a as b,k as m}from"./chunk-CRC5ZNR6.js";var g=class{constructor(t=0,n="Network Error"){this.status=t,this.text=n}};var j=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}};var d={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:j()};var _=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{};var A=(e,t="https://api.emailjs.com")=>{if(!e)return;let n=_(e);d.publicKey=n.publicKey,d.blockHeadless=n.blockHeadless,d.storageProvider=n.storageProvider,d.blockList=n.blockList,d.limitRate=n.limitRate,d.origin=n.origin||t};var I=(a,r,...o)=>m(null,[a,r,...o],function*(e,t,n={}){let s=yield fetch(d.origin+e,{method:"POST",headers:n,body:t}),i=yield s.text(),c=new g(s.status,i);if(s.ok)return c;throw c});var L=(e,t,n)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!n||typeof n!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"};var R=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"};var S=e=>e.webdriver||!e.languages||e.languages.length===0;var w=()=>new g(451,"Unavailable For Headless Browser");var k=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"};var O=e=>{var t;return!((t=e.list)!=null&&t.length)||!e.watchVariable},V=(e,t)=>e instanceof FormData?e.get(t):e[t],P=(e,t)=>{if(O(e))return!1;k(e.list,e.watchVariable);let n=V(t,e.watchVariable);return typeof n!="string"?!1:e.list.includes(n)};var C=()=>new g(403,"Forbidden");var x=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"};var U=(e,t,n)=>m(null,null,function*(){let a=Number((yield n.get(e))||0);return t-Date.now()+a}),y=(e,t,n)=>m(null,null,function*(){if(!t.throttle||!n)return!1;x(t.throttle,t.id);let a=t.id||e;return(yield U(a,t.throttle,n))>0?!0:(yield n.set(a,Date.now().toString()),!1)});var T=()=>new g(429,"Too Many Requests");var F=(e,t,n,a)=>m(null,null,function*(){let r=_(a),o=r.publicKey||d.publicKey,s=r.blockHeadless||d.blockHeadless,i=r.storageProvider||d.storageProvider,c=b(b({},d.blockList),r.blockList),f=b(b({},d.limitRate),r.limitRate);return s&&S(navigator)?Promise.reject(w()):(L(o,e,t),R(n),n&&P(c,n)?Promise.reject(C()):(yield y(location.pathname,f,i))?Promise.reject(T()):I("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:o,service_id:e,template_id:t,template_params:n}),{"Content-type":"application/json"}))});var N=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"};var z=e=>typeof e=="string"?document.querySelector(e):e,M=(e,t,n,a)=>m(null,null,function*(){let r=_(a),o=r.publicKey||d.publicKey,s=r.blockHeadless||d.blockHeadless,i=d.storageProvider||r.storageProvider,c=b(b({},d.blockList),r.blockList),f=b(b({},d.limitRate),r.limitRate);if(s&&S(navigator))return Promise.reject(w());let u=z(n);L(o,e,t),N(u);let p=new FormData(u);return P(c,p)?Promise.reject(C()):(yield y(location.pathname,f,i))?Promise.reject(T()):(p.append("lib_version","4.4.1"),p.append("service_id",e),p.append("template_id",t),p.append("user_id",o),I("/api/v1.0/email/send-form",p))});var h={init:A,send:F,sendForm:M,EmailJSResponseStatus:g};var $=(()=>{let t=class t{constructor(){this.DOWNLOAD_BASE_URL="https://gestion-avisos-web-app.vercel.app/descarga-publica"}crearEnlaceDescargaPublico(a,r){return m(this,null,function*(){try{return yield this.crearEnlaceConParametros(a,r)}catch(o){return console.error("\u274C Error al crear enlace p\xFAblico:",o),yield this.crearEnlaceDirecto(a,r)}})}crearEnlaceConParametros(a,r){return m(this,null,function*(){return new Promise((o,s)=>{let i=new FileReader;i.onload=()=>{try{let c=i.result.split(",")[1],f=this.extraerIdFactura(r),u=`${this.DOWNLOAD_BASE_URL}?factura=${f}&file=${encodeURIComponent(c)}&name=${encodeURIComponent(r)}`;console.log("\u{1F4C4} Enlace p\xFAblico creado:",u),o(u)}catch(c){s(c)}},i.onerror=s,i.readAsDataURL(a)})})}crearEnlaceDirecto(a,r){return m(this,null,function*(){return new Promise((o,s)=>{let i=new FileReader;i.onload=()=>{let c=i.result;console.log("\u{1F4C4} Enlace directo creado:",c.substring(0,100)+"..."),o(c)},i.onerror=s,i.readAsDataURL(a)})})}extraerIdFactura(a){let r=a.match(/factura_(.+)\.pdf$/);return r?r[1]:a.replace(".pdf","")}crearEnlaceTemporalLocal(a,r){let o=URL.createObjectURL(a);return console.log("\u{1F4C4} Enlace temporal local creado:",o),o}esEnlaceValido(a){try{return new URL(a),!0}catch{return!1}}obtenerTipoEnlace(a){return this.esEnlaceValido(a)?a.startsWith("data:")?"directo":a.includes("/descarga-publica")?"publico":a.startsWith("blob:")?"temporal":"invalido":"invalido"}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=v({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Xe=(()=>{let t=class t{constructor(a){this.publicDownloadService=a,this.SERVICE_ID="service_ylignlb",this.TEMPLATE_ID="template_s8jrauj",this.PUBLIC_KEY="hSwFP37-p0NR3D4wV",h.init(this.PUBLIC_KEY)}enviarFacturaPorCorreo(a,r,o,s,i,c,f){return m(this,null,function*(){try{console.log("\u{1F4E7} Iniciando env\xEDo de factura por correo con enlace de descarga...");let u=`factura_${o}.pdf`,p=yield this.crearEnlaceDescargaPublico(s,u),l={to_email:a,to_name:r,from_name:"T\xC9CNICOS CLIMATIZACI\xD3N S.L.",subject:c||`Factura ${o} - T\xC9CNICOS CLIMATIZACI\xD3N S.L.`,message:f||this.crearMensajeSimple(r,o,p,i,"factura"),factura_numero:o,fecha_factura:new Date().toLocaleDateString("es-ES"),total_factura:"\u20AC"+(i||0).toFixed(2),link_descarga:p,pdf_url:p,documento_tipo:"factura",documento_titulo:"Factura",documento_descripcion:"factura con todos los detalles de los servicios realizados"};console.log("\u{1F4E7} Par\xE1metros del template:",{to_email:l.to_email,to_name:l.to_name,from_name:l.from_name,subject:l.subject,factura_numero:l.factura_numero,total_factura:l.total_factura,link_descarga:l.link_descarga});let E=yield h.send(this.SERVICE_ID,this.TEMPLATE_ID,l);return console.log("\u2705 Factura enviada exitosamente con enlace de descarga:",E),{success:!0,message:"Factura enviada correctamente con enlace de descarga"}}catch(u){return console.error("\u274C Error al enviar factura por correo:",u),{success:!1,message:"Error al enviar la factura. Int\xE9ntelo de nuevo."}}})}enviarCorreoSimple(a,r,o,s){return m(this,null,function*(){try{console.log("\u{1F4E7} Enviando correo simple de prueba..."),console.log("\u{1F4E7} Datos:",{emailDestino:a,asunto:r,mensaje:o,nombreDestinatario:s});let i={to_email:a,to_name:s||"Cliente",from_name:"T\xC9CNICOS CLIMATIZACI\xD3N S.L.",subject:r,message:o};console.log("\u{1F4E7} Par\xE1metros del template (formato 1):",i);try{let c=yield h.send(this.SERVICE_ID,this.TEMPLATE_ID,i);return console.log("\u2705 Correo simple enviado exitosamente:",c),{success:!0,message:"Correo enviado correctamente"}}catch{console.log("\u274C Error con formato 1, probando formato 2...");let f={to:a,name:s||"Cliente",from:"T\xC9CNICOS CLIMATIZACI\xD3N S.L.",subject:r,message:o};console.log("\u{1F4E7} Par\xE1metros del template (formato 2):",f);let u=yield h.send(this.SERVICE_ID,this.TEMPLATE_ID,f);return console.log("\u2705 Correo simple enviado exitosamente (formato 2):",u),{success:!0,message:"Correo enviado correctamente"}}}catch(i){return console.error("\u274C Error al enviar correo:",i),{success:!1,message:"Error al enviar el correo. Verifica la configuraci\xF3n del template en EmailJS."}}})}crearEnlaceDescargaPublico(a,r){return m(this,null,function*(){try{return r.includes("albaran_")?yield this.publicDownloadService.crearEnlaceDirecto(a,r):yield this.publicDownloadService.crearEnlaceDescargaPublico(a,r)}catch(o){return console.error("\u274C Error al crear enlace p\xFAblico, usando fallback:",o),yield this.publicDownloadService.crearEnlaceDirecto(a,r)}})}crearMensajeConEnlace(a,r,o,s){return`Hola ${a},

Le enviamos la factura ${r} con todos los detalles de los servicios realizados.

DETALLES DE LA FACTURA:
- N\xFAmero: ${r}
- Fecha: ${new Date().toLocaleDateString("es-ES")}
- Total: \u20AC${(s||0).toFixed(2)}

Puede descargar la factura en PDF haciendo clic en el siguiente enlace:
${o}

Si tiene alguna pregunta sobre esta factura o necesita asistencia, no dude en contactarnos.

Gracias por confiar en nuestros servicios de climatizaci\xF3n profesional.

Saludos,
T\xC9CNICOS CLIMATIZACI\xD3N S.L.

\u{1F4E7} info@tecnicosclimatizacion.es
\u{1F4DE} +34 91 123 45 67
\u{1F310} www.tecnicosclimatizacion.es`}crearMensajeTexto(a,r,o){return`Hola ${a},

Adjunto encontrar\xE1 la factura ${r} con todos los detalles de los servicios realizados.

DETALLES DE LA FACTURA:
- N\xFAmero: ${r}
- Fecha: ${new Date().toLocaleDateString("es-ES")}
- Total: \u20AC${(o||0).toFixed(2)}

El archivo PDF est\xE1 adjunto a este correo electr\xF3nico.

Si tiene alguna pregunta sobre esta factura o necesita asistencia, no dude en contactarnos.

Gracias por confiar en nuestros servicios de climatizaci\xF3n profesional.

Saludos,
T\xC9CNICOS CLIMATIZACI\xD3N S.L.

\u{1F4E7} info@tecnicosclimatizacion.es
\u{1F4DE} +34 91 123 45 67
\u{1F310} www.tecnicosclimatizacion.es`}crearMensajeSimple(a,r,o,s,i="factura"){let c=i==="factura"?{descripcion:"factura con todos los detalles de los servicios realizados",mensajeAdicional:"Si tiene alguna pregunta sobre esta factura o necesita asistencia, no dude en contactarnos."}:i==="albaran"?{descripcion:"albar\xE1n con todos los detalles del trabajo realizado",mensajeAdicional:"Este albar\xE1n contiene el detalle del trabajo realizado, materiales utilizados y tiempo invertido. Si tiene alguna pregunta sobre este trabajo o necesita asistencia adicional, no dude en contactarnos."}:{descripcion:"presupuesto con la estimaci\xF3n detallada de materiales, mano de obra y desplazamientos",mensajeAdicional:"Este presupuesto incluye todos los materiales estimados, trabajo t\xE9cnico especializado, desplazamientos y condiciones del trabajo. Si tiene alguna pregunta sobre este presupuesto o desea realizar alguna modificaci\xF3n, no dude en contactarnos."};return`Le enviamos el ${c.descripcion}.

${c.mensajeAdicional}

Gracias por confiar en nuestros servicios de climatizaci\xF3n profesional.`}crearEnlaceDescargaPDF(a,r){return m(this,null,function*(){try{let o=URL.createObjectURL(a),s=document.createElement("a");return s.href=o,s.download=`factura_${r}.pdf`,console.log("\u{1F4C4} Enlace de descarga creado:",o),o}catch(o){return console.error("\u274C Error al crear enlace de descarga:",o),`data:application/pdf;base64,${yield this.convertirBlobABase64(a)}`}})}convertirBlobABase64(a){return m(this,null,function*(){return new Promise((r,o)=>{let s=new FileReader;s.onload=()=>{let c=s.result.split(",")[1];r(c)},s.onerror=o,s.readAsDataURL(a)})})}enviarAlbaranPorCorreo(a,r,o,s,i,c,f){return m(this,null,function*(){try{console.log("\u{1F4E7} Iniciando env\xEDo de albar\xE1n por correo con enlace de descarga...");let u=`albaran_${o}.pdf`,p=yield this.crearEnlaceDescargaPublico(s,u),l={to_email:a,to_name:r,from_name:"T\xC9CNICOS CLIMATIZACI\xD3N S.L.",subject:c||`Albar\xE1n ${o} - T\xC9CNICOS CLIMATIZACI\xD3N S.L.`,message:f||this.crearMensajeSimple(r,o,p,i,"albaran"),factura_numero:o,fecha_factura:new Date().toLocaleDateString("es-ES"),total_factura:"\u20AC"+(i||0).toFixed(2),link_descarga:p,pdf_url:p,documento_tipo:"albaran",documento_titulo:"Albar\xE1n",documento_descripcion:"albar\xE1n con todos los detalles del trabajo realizado"};console.log("\u{1F4E7} Par\xE1metros del template (albar\xE1n):",{to_email:l.to_email,to_name:l.to_name,from_name:l.from_name,subject:l.subject,factura_numero:l.factura_numero,total_factura:l.total_factura,link_descarga:l.link_descarga});let E=yield h.send(this.SERVICE_ID,this.TEMPLATE_ID,l);return console.log("\u2705 Albar\xE1n enviado exitosamente con enlace de descarga:",E),{success:!0,message:"Albar\xE1n enviado correctamente con enlace de descarga"}}catch(u){return console.error("\u274C Error al enviar albar\xE1n por correo:",u),{success:!1,message:"Error al enviar el albar\xE1n. Int\xE9ntelo de nuevo."}}})}enviarPresupuestoPorCorreo(a,r,o,s,i,c,f){return m(this,null,function*(){try{console.log("\u{1F4E7} Iniciando env\xEDo de presupuesto por correo con enlace de descarga...");let u=`presupuesto_${o}.pdf`,p=yield this.crearEnlaceDescargaPublico(s,u),l={to_email:a,to_name:r,from_name:"T\xC9CNICOS CLIMATIZACI\xD3N S.L.",subject:c||`Presupuesto ${o} - T\xC9CNICOS CLIMATIZACI\xD3N S.L.`,message:f||this.crearMensajeSimple(r,o,p,i,"presupuesto"),factura_numero:o,fecha_factura:new Date().toLocaleDateString("es-ES"),total_factura:"\u20AC"+(i||0).toFixed(2),link_descarga:p,pdf_url:p,documento_tipo:"presupuesto",documento_titulo:"Presupuesto",documento_descripcion:"presupuesto con la estimaci\xF3n detallada de materiales, mano de obra y desplazamientos"};console.log("\u{1F4E7} Par\xE1metros del template (presupuesto):",{to_email:l.to_email,to_name:l.to_name,from_name:l.from_name,subject:l.subject,factura_numero:l.factura_numero,total_factura:l.total_factura,link_descarga:l.link_descarga});let E=yield h.send(this.SERVICE_ID,this.TEMPLATE_ID,l);return console.log("\u2705 Presupuesto enviado exitosamente con enlace de descarga:",E),{success:!0,message:"Presupuesto enviado correctamente con enlace de descarga"}}catch(u){return console.error("\u274C Error al enviar presupuesto por correo:",u),{success:!1,message:"Error al enviar el presupuesto. Int\xE9ntelo de nuevo."}}})}verificarConfiguracion(){return!!(this.SERVICE_ID&&this.TEMPLATE_ID&&this.PUBLIC_KEY)}};t.\u0275fac=function(r){return new(r||t)(D($))},t.\u0275prov=v({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();export{Xe as a};
