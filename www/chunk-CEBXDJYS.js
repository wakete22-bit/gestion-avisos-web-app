import{a as x}from"./chunk-5YRB7RVB.js";import{b as w}from"./chunk-A72QMOGB.js";import{F as C,I as b,d as v,f as r,j as o,s as j}from"./chunk-4AY4VQCP.js";import{a as h,b as d}from"./chunk-CRC5ZNR6.js";var U=(()=>{let a=class a{constructor(e,t){this.supabaseClientService=e,this.dataUpdateService=t,this.clientesSubject=new v([]),this.clientes$=this.clientesSubject.asObservable(),this.supabase=this.supabaseClientService.getClient()}getClientes(e=1,t=10,i,n,c,l=!1){let s=this.supabase.from("clientes").select("*",{count:"exact"});i&&(s=s.or(`nombre_completo.ilike.%${i}%,email.ilike.%${i}%`)),l&&(s=s.eq("es_activo",!0));let p=(e-1)*t;return s=s.range(p,p+t-1).order(n||"fecha_creacion",{ascending:c==="asc"}),r(s).pipe(o(({data:u,error:m,count:g})=>{if(m)throw m;let S=u;return this.clientesSubject.next(S),{clientes:S,total:g||0,pagina:e,por_pagina:t}}),j(u=>{throw console.error("Error al obtener clientes:",u),u}))}getCliente(e){return r(this.supabase.from("clientes").select("*").eq("id",e).single()).pipe(o(({data:t,error:i})=>{if(i)throw i;return t}))}crearCliente(e){var i;let t=d(h({},e),{fecha_creacion:new Date().toISOString(),es_activo:(i=e.es_activo)!=null?i:!0});return r(this.supabase.from("clientes").insert([t]).select().single()).pipe(o(({data:n,error:c})=>{if(c)throw c;let l=n,s=this.clientesSubject.value;return this.clientesSubject.next([l,...s]),this.dataUpdateService.notifyCreated("clientes"),l}))}actualizarCliente(e,t){let i=d(h({},t),{fecha_actualizacion:new Date().toISOString()});return r(this.supabase.from("clientes").update(i).eq("id",e).select().single()).pipe(o(({data:n,error:c})=>{if(c)throw c;let l=n,s=this.clientesSubject.value,p=s.findIndex(u=>u.id===e);return p!==-1&&(s[p]=l,this.clientesSubject.next([...s])),this.dataUpdateService.notifyUpdated("clientes"),l}))}eliminarCliente(e){return r(this.supabase.from("clientes").update({es_activo:!1,fecha_actualizacion:new Date().toISOString()}).eq("id",e)).pipe(o(({error:t})=>{if(t)throw t;let i=this.clientesSubject.value,n=i.findIndex(c=>c.id===e);n!==-1&&(i[n].es_activo=!1,this.clientesSubject.next([...i])),this.dataUpdateService.notifyDeleted("clientes")}))}buscarClientes(e){return r(this.supabase.from("clientes").select("*").or(`nombre_completo.ilike.%${e}%,email.ilike.%${e}%`).eq("es_activo",!0).limit(10)).pipe(o(({data:t,error:i})=>{if(i)throw i;return t}))}getClientesActuales(){return this.clientesSubject.value}limpiarClientes(){this.clientesSubject.next([])}};a.\u0275fac=function(t){return new(t||a)(b(w),b(x))},a.\u0275prov=C({token:a,factory:a.\u0275fac,providedIn:"root"});let f=a;return f})();export{U as a};
