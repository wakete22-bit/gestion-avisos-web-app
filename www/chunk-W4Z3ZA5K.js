import{a as ue}from"./chunk-RVUXLX2V.js";import{a as Q}from"./chunk-I4V5EUSG.js";import"./chunk-L7R4HPYP.js";import{a as ee}from"./chunk-X25QJQMB.js";import{a as X}from"./chunk-52VVF7TW.js";import{a as G}from"./chunk-JNUN2KTT.js";import"./chunk-3NJZR3TT.js";import"./chunk-N4FKO75N.js";import{Ba as de,Ea as pe,J as ie,P as ce,U as le,a as ne,f as ae,h as oe,ha as se,m as re}from"./chunk-CPCGS7XX.js";import"./chunk-KYCVJEX4.js";import"./chunk-FK6H3RFT.js";import"./chunk-7FW4253V.js";import{a as te}from"./chunk-ZLE3SS2Y.js";import{h as Y,w as Z}from"./chunk-7RXHQH5K.js";import"./chunk-ZFUZ5UD4.js";import{$a as A,Ca as n,Da as p,Ea as f,Ha as N,Ia as T,Ja as j,L as O,M as v,Ra as _,Ua as C,X as i,Y as x,_ as k,_a as R,c as I,ca as P,eb as D,fb as L,fc as $,ha as u,ja as z,ka as V,kc as H,la as t,ma as e,na as m,ob as B,ra as S,rb as U,rc as W,sa as b,sc as q,ta as g,tc as J,u as F,z as E,zc as K}from"./chunk-QQQKELKR.js";import"./chunk-FMBN6UXO.js";import"./chunk-QUJFQN2Y.js";import"./chunk-T4LV2MRW.js";import"./chunk-QZ7DKK3O.js";import"./chunk-7NXYYB6M.js";import"./chunk-G2E2NLL6.js";import"./chunk-HZSDEEV2.js";import"./chunk-AO65UGJX.js";import"./chunk-MYMWTHTI.js";import"./chunk-YNWT2DLU.js";import"./chunk-ULLEADC5.js";import"./chunk-2ELISCRH.js";import"./chunk-BV4CTHEE.js";import"./chunk-XPQFWPU3.js";import"./chunk-6SS6CZRK.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-CGQGPWKF.js";import"./chunk-CKP3SGE2.js";import"./chunk-FAIKFHLE.js";import"./chunk-NBD2MYJO.js";import"./chunk-3SBX7V6R.js";import"./chunk-SQKDQBOS.js";import"./chunk-SWRJZAEI.js";import"./chunk-JCSW2JUV.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-36KMLI7A.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{k as y}from"./chunk-CRC5ZNR6.js";function fe(l,s){l&1&&m(0,"ion-icon",25)}function me(l,s){l&1&&m(0,"ion-icon",26)}function _e(l,s){if(l&1){let o=S();t(0,"div",8)(1,"div",9)(2,"div",10)(3,"label",11),n(4,"Estado:"),e(),t(5,"select",12),j("ngModelChange",function(r){O(o);let c=g();return T(c.factura.factura.estado,r)||(c.factura.factura.estado=r),v(r)}),b("change",function(r){O(o);let c=g();return v(c.cambiarEstado(r))}),t(6,"option",13),n(7,"Pendiente"),e(),t(8,"option",14),n(9,"En curso"),e(),t(10,"option",15),n(11,"Completado"),e()()(),t(12,"button",16),b("click",function(){O(o);let r=g();return v(r.imprimirFactura())}),m(13,"ion-icon",17),n(14," Imprimir "),e(),t(15,"button",16),b("click",function(){O(o);let r=g();return v(r.editarFactura())}),m(16,"ion-icon",18),n(17," Editar "),e(),t(18,"div",19)(19,"button",20),b("click",function(){O(o);let r=g();return v(r.enviarFacturaPorCorreo())}),P(20,fe,1,0,"ion-icon",21)(21,me,1,0,"ion-icon",22),n(22),e()(),t(23,"button",23),b("click",function(){O(o);let r=g();return v(r.descargarFactura())}),m(24,"ion-icon",24),n(25," Descargar PDF "),e()()()}if(l&2){let o=g();i(5),N("ngModel",o.factura.factura.estado),i(14),z("loading",o.enviandoCorreo),u("disabled",o.enviandoCorreo||!(!(o.factura==null||o.factura.factura==null)&&o.factura.factura.email_cliente)),i(),u("ngIf",!o.enviandoCorreo),i(),u("ngIf",o.enviandoCorreo),i(),f(" ",o.enviandoCorreo?"Enviando...":"Enviar con PDF"," ")}}function Ce(l,s){l&1&&(t(0,"div",27)(1,"div",28),m(2,"ion-icon",26),t(3,"p"),n(4,"Cargando factura..."),e()()())}function xe(l,s){if(l&1){let o=S();t(0,"div",29)(1,"div",30),m(2,"ion-icon",31),t(3,"p"),n(4),e(),t(5,"button",32),b("click",function(){O(o);let r=g();return v(r.cargarFactura())}),m(6,"ion-icon",33),n(7," Reintentar "),e()()()}if(l&2){let o=g();i(4),p(o.error)}}function Oe(l,s){if(l&1&&(t(0,"tr")(1,"td"),n(2),e(),t(3,"td"),n(4),e(),t(5,"td"),n(6),_(7,"currency"),e(),t(8,"td"),n(9),_(10,"currency"),e()()),l&2){let o=s.$implicit;i(2),p(o.nombre),i(2),p(o.cantidad),i(2),p(C(7,4,o.precio_neto,"EUR","symbol","1.2-2")),i(3),p(C(10,9,o.precio_pvp,"EUR","symbol","1.2-2"))}}function ve(l,s){if(l&1&&(t(0,"div",55)(1,"div",56),n(2,"Repuestos utilizados"),e(),t(3,"table")(4,"thead")(5,"tr")(6,"th"),n(7,"Repuestos utilizados"),e(),t(8,"th"),n(9,"CANTIDAD"),e(),t(10,"th"),n(11,"NETO"),e(),t(12,"th"),n(13,"PVP"),e()()(),t(14,"tbody"),P(15,Oe,11,14,"tr",57),t(16,"tr",58)(17,"td")(18,"b"),n(19,"TOTAL"),e()(),m(20,"td"),t(21,"td",59),n(22),_(23,"currency"),e(),t(24,"td",59),n(25),_(26,"currency"),e()()()()()),l&2){let o=g(2);i(15),u("ngForOf",o.repuestos),i(7),f(" ",C(23,3,o.totalRepuestosNeto,"EUR","symbol","1.2-2")," "),i(3),f(" ",C(26,8,o.totalRepuestosPvp,"EUR","symbol","1.2-2")," ")}}function Pe(l,s){if(l&1&&(t(0,"tr")(1,"td"),n(2),e(),t(3,"td"),n(4),e(),t(5,"td"),n(6),_(7,"currency"),e()()),l&2){let o=s.$implicit;i(2),p(o.nombre),i(2),f("",o.cantidad,"h"),i(2),p(C(7,3,o.precio_pvp,"EUR","symbol","1.2-2"))}}function be(l,s){if(l&1&&(t(0,"tr")(1,"td"),n(2),e(),t(3,"td"),n(4),e(),t(5,"td"),n(6),_(7,"currency"),e()()),l&2){let o=s.$implicit;i(2),p(o.nombre),i(2),p(o.cantidad),i(2),p(C(7,3,o.precio_pvp,"EUR","symbol","1.2-2"))}}function Me(l,s){if(l&1&&(t(0,"div",55)(1,"div",56),n(2,"Mano de obra/Kilometraje"),e(),t(3,"table")(4,"thead")(5,"tr")(6,"th"),n(7,"Mano de obra/Kilometraje"),e(),t(8,"th"),n(9,"CANTIDAD"),e(),t(10,"th"),n(11,"PVP"),e()()(),t(12,"tbody"),P(13,Pe,8,8,"tr",57)(14,be,8,8,"tr",57),t(15,"tr",58)(16,"td",60)(17,"b"),n(18,"TOTAL"),e()(),t(19,"td",59),n(20),_(21,"currency"),e()()()()()),l&2){let o=g(2);i(13),u("ngForOf",o.manoObra),i(),u("ngForOf",o.desplazamientos),i(6),f(" ",C(21,3,o.totalManoObraDesplazamiento,"EUR","symbol","1.2-2")," ")}}function he(l,s){if(l&1&&(t(0,"div",61)(1,"b"),n(2,"Notas"),e(),t(3,"div",62),n(4),e()()),l&2){let o=g(2);i(4),f(" ",o.factura.factura.notas," ")}}function we(l,s){if(l&1&&(t(0,"div",34)(1,"div",35)(2,"h2"),n(3),e(),t(4,"div",36)(5,"span",37),n(6),e()()(),t(7,"div",38)(8,"div",39),m(9,"img",40),e(),t(10,"div",41)(11,"div")(12,"span",42),n(13,"Datos de empresa"),e(),t(14,"span"),n(15,"Nombre de empresa"),e(),t(16,"address"),n(17,"Direcci\xF3n de empresa"),e(),t(18,"span"),n(19,"Ciudad de empresa"),e(),t(20,"span"),n(21,"CIF de empresa"),e(),t(22,"span",43),n(23,"ejemplodominio.es"),e(),t(24,"span"),n(25,"+34 123 45 56 65"),e()(),t(26,"div",44)(27,"label",45),n(28,"Factura"),e(),t(29,"label",46),n(30,"N\xBA FACTURA"),e(),t(31,"label"),n(32),e(),t(33,"label",46),n(34,"FECHA DE EMISI\xD3N"),e(),t(35,"label"),n(36),e()()()(),t(37,"div",47)(38,"h3"),n(39,"Datos del Cliente"),e(),t(40,"div",48)(41,"p")(42,"strong"),n(43,"Nombre:"),e(),n(44),e(),t(45,"p")(46,"strong"),n(47,"Direcci\xF3n:"),e(),n(48),e(),t(49,"p")(50,"strong"),n(51,"CIF:"),e(),n(52),e(),t(53,"p")(54,"strong"),n(55,"Email:"),e(),n(56),e()()(),P(57,ve,27,13,"div",49)(58,Me,22,8,"div",49),t(59,"div",50)(60,"div",51)(61,"span"),n(62,"Subtotal"),e(),t(63,"span"),n(64),_(65,"currency"),e()(),t(66,"div",51)(67,"span"),n(68),e(),t(69,"span"),n(70),_(71,"currency"),e()(),t(72,"div",52)(73,"span"),n(74,"TOTAL"),e(),t(75,"span"),n(76),_(77,"currency"),e()()(),P(78,he,5,1,"div",53),t(79,"div",54)(80,"span"),n(81,"Nombre de empresa"),e(),t(82,"span"),n(83,"+34 698 12 12 12"),e(),t(84,"span"),n(85,"ejemploemail.com"),e()()()),l&2){let o=g();i(3),f("Factura ",o.factura.factura.numero_factura,""),i(2),V(o.getEstadoClass(o.factura.factura.estado)),i(),f(" ",o.factura.factura.estado," "),i(26),p(o.factura.factura.numero_factura),i(4),p(o.formatearFecha(o.factura.factura.fecha_emision)),i(8),f(" ",o.factura.factura.nombre_cliente,""),i(4),f(" ",o.factura.factura.direccion_cliente,""),i(4),f(" ",o.factura.factura.cif_cliente,""),i(4),f(" ",o.factura.factura.email_cliente,""),i(),u("ngIf",o.repuestos.length>0),i(),u("ngIf",o.manoObra.length>0||o.desplazamientos.length>0),i(6),p(C(65,17,o.factura.factura.subtotal,"EUR","symbol","1.2-2")),i(4),f("IVA (",o.ivaPorcentaje,"%)"),i(2),p(C(71,22,o.factura.factura.iva,"EUR","symbol","1.2-2")),i(6),p(C(77,27,o.factura.factura.total,"EUR","symbol","1.2-2")),i(2),u("ngIf",o.factura.factura.notas)}}var $e=(()=>{let s=class s{constructor(a,r,c,d,M,h,w,ge){this.route=a,this.router=r,this.facturasService=c,this.pdfService=d,this.avisosService=M,this.configuracionService=h,this.emailService=w,this.unifiedReconnectionService=ge,this.factura=null,this.loading=!1,this.error=null,this.facturaId=null,this.modoEdicion=!1,this.ivaPorcentaje=21,this.enviandoCorreo=!1,this.repuestos=[],this.manoObra=[],this.desplazamientos=[],this.destroy$=new I,ne({arrowBackOutline:oe,printOutline:de,createOutline:ie,downloadOutline:ce,bugOutline:re,refreshOutline:pe,alertCircleOutline:ae,eyeOutline:le,mailOutline:se})}ngOnInit(){this.unifiedReconnectionService.appResumed.pipe(E(this.destroy$),F()).subscribe(a=>{a&&this.facturaId&&(console.log("\u{1F504} VerFacturaComponent: App reanudada, recargando factura..."),this.cargarFactura())}),this.unifiedReconnectionService.connectionState.pipe(E(this.destroy$)).subscribe(a=>{console.log("\u{1F504} VerFacturaComponent: Estado de conexi\xF3n:",a),a==="connected"&&this.error&&this.facturaId&&this.cargarFactura()}),this.route.params.subscribe(a=>{this.facturaId=a.id,this.facturaId&&this.cargarFactura()}),this.route.queryParams.subscribe(a=>{this.modoEdicion=a.edit==="true"}),this.configuracionService.getIvaPorDefecto().pipe(E(this.destroy$)).subscribe(a=>{this.ivaPorcentaje=a})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarFactura(){this.facturaId&&(this.loading=!0,this.error=null,this.facturasService.getFacturaDirect(this.facturaId).subscribe({next:a=>{console.log("\u{1F50D} Factura completa recibida del servicio:",a),console.log("\u{1F50D} L\xEDneas de la factura:",a.lineas),this.factura=a,this.procesarLineasFactura(a.lineas),this.loading=!1},error:a=>{console.error("Error al cargar factura:",a),this.error="Error al cargar la factura",this.loading=!1}}))}volver(){this.router.navigate(["/facturas"])}procesarLineasFactura(a){if(!a||!Array.isArray(a)){this.repuestos=[],this.manoObra=[],this.desplazamientos=[];return}let r=a.map(c=>this.parsearLinea(c)).filter(c=>c!==null);this.repuestos=r.filter(c=>c.tipo==="repuesto"),this.manoObra=r.filter(c=>c.tipo==="mano_obra"),this.desplazamientos=r.filter(c=>c.tipo==="desplazamiento"),console.log("\u2705 L\xEDneas procesadas:",{total:r.length,repuestos:this.repuestos.length,manoObra:this.manoObra.length,desplazamientos:this.desplazamientos.length})}editarFactura(){this.facturaId&&this.router.navigate(["/facturas/editar",this.facturaId])}cambiarEstado(a){if(!this.facturaId||!this.factura)return;let r=a.target.value;this.facturasService.cambiarEstado(this.facturaId,r).subscribe({next:c=>{var d,M,h,w;console.log("\u2705 Estado de factura actualizado:",c),this.factura&&(this.factura.factura.estado=c.estado),r==="Completado"&&((M=(d=this.factura)==null?void 0:d.factura)!=null&&M.aviso_id)&&(console.log("\u{1F504} Actualizando estado del aviso asociado..."),this.actualizarEstadoAvisoAsociado((w=(h=this.factura)==null?void 0:h.factura)==null?void 0:w.aviso_id))},error:c=>{console.error("\u274C Error al cambiar estado:",c),this.factura&&(this.factura.factura.estado=a.target.defaultValue)}})}actualizarEstadoAvisoAsociado(a){this.avisosService.actualizarEstadoAutomatico(a).subscribe({next:r=>{console.log("\u2705 Estado del aviso actualizado autom\xE1ticamente:",r.estado),r.estado==="Completado"&&console.log("\u{1F389} El aviso se ha marcado autom\xE1ticamente como completado")},error:r=>{console.error("\u274C Error al actualizar estado del aviso:",r)}})}imprimirFactura(){window.print()}descargarFactura(){if(!this.factura){console.error("No hay factura para descargar");return}try{console.log("\u{1F527} Iniciando descarga de factura...");let r=`factura_${this.factura.factura.numero_factura||"factura"}.pdf`,c={numero_factura:this.factura.factura.numero_factura,fecha_emision:this.factura.factura.fecha_emision,nombre_cliente:this.factura.factura.nombre_cliente,direccion_cliente:this.factura.factura.direccion_cliente,cif_cliente:this.factura.factura.cif_cliente,email_cliente:this.factura.factura.email_cliente,cliente_id:this.factura.factura.cliente_id,subtotal:this.factura.factura.subtotal,iva:this.factura.factura.iva,total:this.factura.factura.total,estado:this.factura.factura.estado,notas:this.factura.factura.notas,lineas:this.factura.lineas};this.pdfService.generarPdfHtml(c,r),console.log("\u2705 Factura descargada exitosamente")}catch(a){console.error("\u274C Error al descargar factura:",a)}}probarEnvioCorreo(){return y(this,null,function*(){if(!this.factura){console.error("No hay factura para probar");return}if(!this.factura.factura.email_cliente){console.error("No hay email del cliente"),alert("Error: No se encontr\xF3 email del cliente.");return}try{this.enviandoCorreo=!0,console.log("\u{1F4E7} Probando env\xEDo de correo simple...");let a=yield this.emailService.enviarCorreoSimple(this.factura.factura.email_cliente,`Prueba - Factura ${this.factura.factura.numero_factura}`,`Hola ${this.factura.factura.nombre_cliente},

Esta es una prueba de env\xEDo de correo para la factura ${this.factura.factura.numero_factura}.

Saludos,
T\xC9CNICOS CLIMATIZACI\xD3N S.L.`,this.factura.factura.nombre_cliente);a.success?(console.log("\u2705 Correo de prueba enviado exitosamente"),alert("\u2705 Correo de prueba enviado correctamente")):(console.error("\u274C Error al enviar correo de prueba:",a.message),alert("\u274C Error al enviar correo de prueba: "+a.message))}catch(a){console.error("\u274C Error al probar env\xEDo de correo:",a),alert("\u274C Error inesperado al probar el env\xEDo de correo.")}finally{this.enviandoCorreo=!1}})}enviarFacturaPorCorreo(){return y(this,null,function*(){if(!this.factura){console.error("No hay factura para enviar");return}if(!this.factura.factura.email_cliente){console.error("No hay email del cliente"),alert("Error: No se encontr\xF3 email del cliente. Por favor, verifica que la factura tenga un email v\xE1lido.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.factura.factura.email_cliente)){console.error("Email del cliente no es v\xE1lido:",this.factura.factura.email_cliente),alert("Error: El email del cliente no tiene un formato v\xE1lido.");return}try{this.enviandoCorreo=!0,console.log("\u{1F4E7} Iniciando env\xEDo de factura por correo..."),console.log("\u{1F4E7} Datos de la factura:",{email_cliente:this.factura.factura.email_cliente,nombre_cliente:this.factura.factura.nombre_cliente,numero_factura:this.factura.factura.numero_factura,total:this.factura.factura.total});let r={numero_factura:this.factura.factura.numero_factura,fecha_emision:this.factura.factura.fecha_emision,nombre_cliente:this.factura.factura.nombre_cliente,direccion_cliente:this.factura.factura.direccion_cliente,cif_cliente:this.factura.factura.cif_cliente,email_cliente:this.factura.factura.email_cliente,cliente_id:this.factura.factura.cliente_id,subtotal:this.factura.factura.subtotal,iva:this.factura.factura.iva,total:this.factura.factura.total,estado:this.factura.factura.estado,notas:this.factura.factura.notas,lineas:this.factura.lineas},c=yield this.pdfService.generarPdfBlob(r,`factura_${this.factura.factura.numero_factura}.pdf`);console.log("\u{1F4E7} Enviando correo con datos:",{emailCliente:this.factura.factura.email_cliente,nombreCliente:this.factura.factura.nombre_cliente,numeroFactura:this.factura.factura.numero_factura,totalFactura:this.factura.factura.total});let d=yield this.emailService.enviarFacturaPorCorreo(this.factura.factura.email_cliente,this.factura.factura.nombre_cliente,this.factura.factura.numero_factura,c,this.factura.factura.total);d.success?(console.log("\u2705 Factura enviada exitosamente"),alert("\u2705 Factura enviada correctamente al cliente")):(console.error("\u274C Error al enviar factura:",d.message),alert("\u274C Error al enviar la factura: "+d.message))}catch(r){console.error("\u274C Error al enviar factura por correo:",r),alert("\u274C Error inesperado al enviar la factura. Por favor, int\xE9ntelo de nuevo.")}finally{this.enviandoCorreo=!1}})}formatearMoneda(a){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(a)}formatearFecha(a){return new Date(a).toLocaleDateString("es-ES")}getEstadoClass(a){switch(a.toLowerCase()){case"pendiente":return"estado-pendiente";case"en curso":return"estado-en-curso";case"completado":return"estado-completado";default:return"estado-default"}}parsearLinea(a){if(!a)return null;let r;if(typeof a=="string")try{r=JSON.parse(a)}catch(d){return console.warn("\u26A0\uFE0F Error al parsear l\xEDnea JSON:",d),null}else if(typeof a=="object"&&a!==null)r=a;else return console.warn("\u26A0\uFE0F L\xEDnea no es string ni objeto:",a),null;return{id:r.id||"",tipo:r.tipo||"repuesto",nombre:r.nombre||"Sin nombre",cantidad:Number(r.cantidad)||0,precio_neto:Number(r.precio_neto)||0,precio_pvp:Number(r.precio_pvp)||0,descripcion:r.descripcion||"",fecha_creacion:r.fecha_creacion||""}}get totalRepuestosNeto(){return this.repuestos.reduce((a,r)=>{let c=Number(r.cantidad)||0,d=Number(r.precio_neto)||0;return a+c*d},0)}get totalRepuestosPvp(){return this.repuestos.reduce((a,r)=>{let c=Number(r.cantidad)||0,d=Number(r.precio_pvp)||0;return a+c*d},0)}get totalManoObraDesplazamiento(){return[...this.manoObra,...this.desplazamientos].reduce((r,c)=>{let d=Number(c.cantidad)||0,M=Number(c.precio_pvp)||0;return r+d*M},0)}};s.\u0275fac=function(r){return new(r||s)(x(B),x(U),x(ee),x(Q),x(X),x(G),x(ue),x(te))},s.\u0275cmp=k({type:s,selectors:[["app-ver-factura"]],decls:10,vars:4,consts:[[1,"factura-container"],[1,"page-header"],[1,"btn-back",3,"click"],["name","arrow-back-outline"],["class","header-actions",4,"ngIf"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","factura-preview active",4,"ngIf"],[1,"header-actions"],[1,"action-buttons"],[1,"estado-selector"],["for","estado-factura"],["id","estado-factura",1,"estado-select",3,"ngModelChange","change","ngModel"],["value","Pendiente"],["value","En curso"],["value","Completado"],[1,"btn-secondary",3,"click"],["name","print-outline"],["name","create-outline"],[1,"email-buttons"],[1,"btn-email",3,"click","disabled"],["name","mail-outline",4,"ngIf"],["name","refresh-outline","class","spinning",4,"ngIf"],[1,"btn-primary",3,"click"],["name","download-outline"],["name","mail-outline"],["name","refresh-outline",1,"spinning"],[1,"loading-state"],[1,"loading-spinner"],[1,"error-state"],[1,"error-message"],["name","alert-circle-outline"],[1,"btn-retry",3,"click"],["name","refresh-outline"],[1,"factura-preview","active"],[1,"header-container"],[1,"estado-badge"],[1,"badge"],[1,"preview-header"],[1,"logo-box"],["src","assets/icon/favicon.png","alt","Logo"],[1,"empresa-datos"],[1,"empresa-nombre"],[2,"margin-top","20px"],[1,"factura-info"],[1,"factura-label"],[2,"color","#111827","font-weight","500"],[1,"cliente-datos"],[1,"cliente-info"],["class","preview-tabla",4,"ngIf"],[1,"preview-totales-box"],[1,"totales-row"],[1,"totales-row","total-final"],["class","preview-notas",4,"ngIf"],[1,"preview-footer"],[1,"preview-tabla"],[1,"tabla-titulo"],[4,"ngFor","ngForOf"],[1,"total-row"],[1,"success"],["colspan","2"],[1,"preview-notas"],[1,"notas-texto"]],template:function(r,c){r&1&&(t(0,"ion-content")(1,"div",0)(2,"div",1)(3,"button",2),b("click",function(){return c.volver()}),m(4,"ion-icon",3),n(5," Volver a Facturas "),e(),P(6,_e,26,7,"div",4),e(),P(7,Ce,5,0,"div",5)(8,xe,8,1,"div",6)(9,we,86,32,"div",7),e()()),r&2&&(i(6),u("ngIf",c.factura),i(),u("ngIf",c.loading),i(),u("ngIf",c.error&&!c.loading),i(),u("ngIf",c.factura&&!c.loading))},dependencies:[L,R,A,D,K,q,J,W,$,H,Y,Z],styles:["ion-content[_ngcontent-%COMP%]{--background: #fff}.factura-container[_ngcontent-%COMP%]{margin:0 auto;padding:20px;gap:0;display:block;background-color:#fff}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #e2e8f0}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.page-header[_ngcontent-%COMP%]   .pdf-options[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.page-header[_ngcontent-%COMP%]   .pdf-options[_ngcontent-%COMP%]   .pdf-template-selector[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;font-size:14px;background:#fff;color:#4a5568;cursor:pointer;transition:all .2s}.page-header[_ngcontent-%COMP%]   .pdf-options[_ngcontent-%COMP%]   .pdf-template-selector[_ngcontent-%COMP%]:hover{border-color:#cbd5e0}.page-header[_ngcontent-%COMP%]   .pdf-options[_ngcontent-%COMP%]   .pdf-template-selector[_ngcontent-%COMP%]:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px #4f46e51a}.page-header[_ngcontent-%COMP%]   .estado-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.page-header[_ngcontent-%COMP%]   .estado-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#4a5568;white-space:nowrap}.page-header[_ngcontent-%COMP%]   .estado-selector[_ngcontent-%COMP%]   .estado-select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;font-size:14px;background:#fff;color:#4a5568;cursor:pointer;transition:all .2s;min-width:120px}.page-header[_ngcontent-%COMP%]   .estado-selector[_ngcontent-%COMP%]   .estado-select[_ngcontent-%COMP%]:hover{border-color:#cbd5e0}.page-header[_ngcontent-%COMP%]   .estado-selector[_ngcontent-%COMP%]   .estado-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px #4f46e51a}.btn-back[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;color:#4a5568;text-decoration:none;cursor:pointer;transition:all .2s}.btn-back[_ngcontent-%COMP%]:hover{background:#edf2f7;border-color:#cbd5e0}.btn-back[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.btn-secondary[_ngcontent-%COMP%]{background:#fff;color:#4a5568;border:1px solid #e2e8f0}.btn-secondary[_ngcontent-%COMP%]:hover{background:#f7fafc;border-color:#cbd5e0}.btn-primary[_ngcontent-%COMP%]{background:#4f46e5;color:#fff;border:1px solid #4f46e5}.btn-primary[_ngcontent-%COMP%]:hover{background:#4338ca;border-color:#4338ca}.email-buttons[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}.btn-email[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:none;padding:12px 20px;border-radius:8px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all .3s ease;font-size:14px;flex:1;min-width:140px;justify-content:center}.btn-email[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#059669,#047857);transform:translateY(-1px);box-shadow:0 4px 12px #10b9814d}.btn-email[_ngcontent-%COMP%]:disabled{background:#9ca3af;cursor:not-allowed;transform:none;box-shadow:none}.btn-email.loading[_ngcontent-%COMP%]{background:#6b7280}.btn-email.btn-test[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb)}.btn-email.btn-test[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#2563eb,#1d4ed8);box-shadow:0 4px 12px #3b82f64d}.btn-email[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:300px}.loading-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{text-align:center;color:#64748b}.loading-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:16px;color:#cbd5e0}.loading-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   ion-icon.spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;margin:0}.loading-state[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]{margin-top:16px;padding:8px 16px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:8px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.factura-preview[_ngcontent-%COMP%]{background:#fff;border-radius:24px;padding:32px;display:flex;flex-direction:column;gap:24px;border:1px solid #e2e8f0}.factura-preview.active[_ngcontent-%COMP%]{display:flex}.factura-preview[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.factura-preview[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#111827;margin:0}.factura-preview[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:6px 12px;border-radius:16px;font-size:12px;font-weight:600;text-transform:uppercase}.factura-preview[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]   .badge.estado-pendiente[_ngcontent-%COMP%]{background:var(--estado-pendiente-bg);color:var(--estado-pendiente-color)}.factura-preview[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]   .badge.estado-en-curso[_ngcontent-%COMP%]{background:var(--estado-en-curso-bg);color:var(--estado-en-curso-color)}.factura-preview[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]   .estado-badge[_ngcontent-%COMP%]   .badge.estado-completado[_ngcontent-%COMP%]{background:var(--estado-completado-bg);color:var(--estado-completado-color)}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:32px}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .logo-box[_ngcontent-%COMP%]{border-radius:12px;display:flex;align-items:center;justify-content:center}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .logo-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:44px}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .empresa-datos[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:space-between}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .empresa-datos[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .empresa-datos[_ngcontent-%COMP%]   address[_ngcontent-%COMP%]{display:block;color:#6b7280;font-size:13px;margin-bottom:2px;font-style:normal}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .empresa-datos[_ngcontent-%COMP%]   .empresa-nombre[_ngcontent-%COMP%]{color:#4f46e5;font-weight:600;font-size:14px;margin-bottom:8px;text-transform:capitalize}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .factura-info[_ngcontent-%COMP%]{text-align:right}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .factura-info[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:13px;color:#6b7280;margin-bottom:2px}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .factura-info[_ngcontent-%COMP%]   .factura-label[_ngcontent-%COMP%]{color:#4f46e5;font-weight:600;font-size:14px;margin-bottom:8px}.factura-preview[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]{background:#f8fafc;border-radius:12px;padding:20px;margin:16px 0}.factura-preview[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#4f46e5;font-size:16px;font-weight:600;margin:0 0 12px}.factura-preview[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]   .cliente-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;color:#4a5568}.factura-preview[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]   .cliente-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#2d3748}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   .tabla-titulo[_ngcontent-%COMP%]{font-weight:600;color:#6b7280;margin-bottom:8px;font-size:1rem}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:8px}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 12px;font-size:13px;text-align:left}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#9ca3af;font-weight:400;background:none;border-bottom:1px solid #E5E7EB}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:#111827;border-bottom:1px solid #F3F4F6}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{color:#27c26c;font-weight:600}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;color:#4f46e5;border-bottom:none}.factura-preview[_ngcontent-%COMP%]   .preview-totales-box[_ngcontent-%COMP%]{margin:24px 0 0;background:#eef2ff;border-radius:16px;padding:15px;width:300px;align-self:flex-end}.factura-preview[_ngcontent-%COMP%]   .preview-totales-box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#4f46e5}.factura-preview[_ngcontent-%COMP%]   .preview-totales-box[_ngcontent-%COMP%]   .totales-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:14px;margin-bottom:8px}.factura-preview[_ngcontent-%COMP%]   .preview-totales-box[_ngcontent-%COMP%]   .totales-row.total-final[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#fff;background:#4f46e5;border-radius:12px;padding:10px 16px;margin-top:12px;margin-bottom:0}.factura-preview[_ngcontent-%COMP%]   .preview-totales-box[_ngcontent-%COMP%]   .totales-row.total-final[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff!important}.factura-preview[_ngcontent-%COMP%]   .preview-notas[_ngcontent-%COMP%]{margin-top:24px}.factura-preview[_ngcontent-%COMP%]   .preview-notas[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:#4f46e5;font-size:1rem}.factura-preview[_ngcontent-%COMP%]   .preview-notas[_ngcontent-%COMP%]   .notas-texto[_ngcontent-%COMP%]{color:#6b7280;font-size:.95rem;margin-top:4px}.factura-preview[_ngcontent-%COMP%]   .preview-footer[_ngcontent-%COMP%]{margin-top:32px;display:flex;justify-content:space-between;color:#6b7280;font-size:.95rem;border-top:1px solid #E5E7EB;padding-top:12px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:12px}@media (max-width: 768px){.factura-container[_ngcontent-%COMP%]{padding:16px}.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-end}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .pdf-options[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .pdf-options[_ngcontent-%COMP%]   .pdf-template-selector[_ngcontent-%COMP%]{width:100%;text-align:center}.factura-preview[_ngcontent-%COMP%]{padding:16px;border-radius:12px}.factura-preview[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.factura-preview[_ngcontent-%COMP%]   .header-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px}.factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%], .factura-preview[_ngcontent-%COMP%]   .preview-header[_ngcontent-%COMP%]   .empresa-datos[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.factura-preview[_ngcontent-%COMP%]   .preview-totales-box[_ngcontent-%COMP%]{width:100%}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{font-size:12px}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px 8px}}@media (max-width: 480px){.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .estado-selector[_ngcontent-%COMP%]{width:100%;justify-content:center}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .estado-selector[_ngcontent-%COMP%]   .estado-select[_ngcontent-%COMP%]{min-width:120px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .pdf-options[_ngcontent-%COMP%]{width:100%;justify-content:center}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .pdf-options[_ngcontent-%COMP%]   .pdf-template-selector[_ngcontent-%COMP%]{min-width:120px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:8px;width:100%}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;justify-content:center;padding:10px 12px;font-size:13px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.factura-preview[_ngcontent-%COMP%]{padding:12px}.factura-preview[_ngcontent-%COMP%]   .preview-tabla[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{display:block;overflow-x:auto;white-space:nowrap}}.pdf-preview-section[_ngcontent-%COMP%]{margin:20px 0;padding:20px;background-color:#f8f9fa;border-radius:8px;border:1px solid #e9ecef}.pdf-preview-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 20px;color:#495057;font-size:18px;font-weight:600}"]});let l=s;return l})();export{$e as VerFacturaComponent};
