import{a as N}from"./chunk-5GNRMPFJ.js";import{a as Ue}from"./chunk-PY25U45N.js";import{a as ye,b as Se,c as Ae,e as Pe,g as Me,i as Te,j as ke}from"./chunk-RYV6EKVZ.js";import{a as xe}from"./chunk-F6DTYNTW.js";import{a as Ce,b as Ie,n as Ee}from"./chunk-5Q3G5WFB.js";import{a as F}from"./chunk-QYHMYRPA.js";import{$a as pe,A as J,C as l,E as ee,F as c,G as g,H as te,J as L,K as _,Lc as be,N as ne,P as oe,Qa as ce,W as d,Wa as le,Y as O,a as k,aa as re,b as x,bb as de,ca as ie,da as W,e as Q,eb as ue,f as Y,fa as ae,fb as he,g as $,i as X,ia as v,j as h,ja as w,jb as me,ka as D,kb as fe,nb as ge,o as I,oa as se,ob as ve,p as m,pa as G,pb as we,q as U,qa as z,s as E,tc as j,w as f,ya as R,z as y}from"./chunk-JSLDYZN7.js";import"./chunk-WSRQKSRN.js";import"./chunk-QUJFQN2Y.js";import"./chunk-K4IZC2RK.js";import"./chunk-XEKAQYZJ.js";import"./chunk-3PHZVRGI.js";import"./chunk-67GB35HJ.js";import"./chunk-ULLEADC5.js";import"./chunk-2ELISCRH.js";import"./chunk-MSFXF37Z.js";import"./chunk-55RMRGVQ.js";import"./chunk-G2E2NLL6.js";import"./chunk-CFQAPMCR.js";import"./chunk-CW65YK7W.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-VAE5WQLH.js";import"./chunk-CKP3SGE2.js";import"./chunk-I2N4S4X5.js";import"./chunk-GS3KTSYS.js";import"./chunk-LBJ2JVNN.js";import"./chunk-5ZZWK7YK.js";import"./chunk-QXK7JUJJ.js";import"./chunk-JCSW2JUV.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-36KMLI7A.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as Z,j as P,k as u}from"./chunk-CRC5ZNR6.js";var q="Service workers are disabled or not supported by this browser",S=class{serviceWorker;worker;registration;events;constructor(t,s){if(this.serviceWorker=t,!t)this.worker=this.events=this.registration=new k(e=>e.error(new y(5601,!1)));else{let e=null,n=new x;this.worker=new k(p=>(e!==null&&p.next(e),n.subscribe(C=>p.next(C))));let r=()=>{let{controller:p}=t;p!==null&&(e=p,n.next(e))};t.addEventListener("controllerchange",r),r(),this.registration=this.worker.pipe(f(()=>t.getRegistration()));let i=new x;this.events=i.asObservable();let a=p=>{let{data:C}=p;C!=null&&C.type&&i.next(C)};t.addEventListener("message",a);let A=s==null?void 0:s.get(W,null,{optional:!0});A==null||A.onDestroy(()=>{t.removeEventListener("controllerchange",r),t.removeEventListener("message",a)})}}postMessage(t,s){return new Promise(e=>{this.worker.pipe(E(1)).subscribe(n=>{n.postMessage(Z({action:t},s)),e()})})}postMessageWithOperation(t,s,e){let n=this.waitForOperationCompleted(e),r=this.postMessage(t,s);return Promise.all([r,n]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(t){let s;return typeof t=="string"?s=e=>e.type===t:s=e=>t.includes(e.type),this.events.pipe(m(s))}nextEventOfType(t){return this.eventsOfType(t).pipe(E(1))}waitForOperationCompleted(t){return new Promise((s,e)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(m(n=>n.nonce===t),E(1),h(n=>{if(n.result!==void 0)return n.result;throw new Error(n.error)})).subscribe({next:s,error:e})})}get isEnabled(){return!!this.serviceWorker}},Ge=(()=>{let t=class t{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new x;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=I,this.notificationClicks=I,this.subscription=I;return}this.messages=this.sw.eventsOfType("PUSH").pipe(h(r=>r.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(h(r=>r.data)),this.pushManager=this.sw.registration.pipe(h(r=>r.pushManager));let n=this.pushManager.pipe(f(r=>r.getSubscription()));this.subscription=new k(r=>{let i=n.subscribe(r),a=this.subscriptionChanges.subscribe(r);return()=>{i.unsubscribe(),a.unsubscribe()}})}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(q));let n={userVisibleOnly:!0},r=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),i=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return n.applicationServerKey=i,new Promise((a,A)=>{this.pushManager.pipe(f(p=>p.subscribe(n)),E(1)).subscribe({next:p=>{this.subscriptionChanges.next(p),a(p)},error:A})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(q));let e=n=>{if(n===null)throw new y(5602,!1);return n.unsubscribe().then(r=>{if(!r)throw new y(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((n,r)=>{this.subscription.pipe(E(1),f(e)).subscribe({next:n,error:r})})}decodeBase64(e){return atob(e)}};P(t,"\u0275fac",function(n){return new(n||t)(c(S))}),P(t,"\u0275prov",l({token:t,factory:t.\u0275fac}));let o=t;return o})(),H=(()=>{let t=class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=I,this.unrecoverable=I;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(q));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new y(5601,!1));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}};P(t,"\u0275fac",function(n){return new(n||t)(c(S))}),P(t,"\u0275prov",l({token:t,factory:t.\u0275fac}));let o=t;return o})();var De=new ee("");function ze(){let o=g(M);if(!("serviceWorker"in navigator&&o.enabled!==!1))return;let t=g(De),s=g(oe),e=g(W);s.runOutsideAngular(()=>{let n=navigator.serviceWorker,r=()=>{var i;return(i=n.controller)==null?void 0:i.postMessage({action:"INITIALIZE"})};n.addEventListener("controllerchange",r),e.onDestroy(()=>{n.removeEventListener("controllerchange",r)})}),s.runOutsideAngular(()=>{let n,{registrationStrategy:r}=o;if(typeof r=="function")n=new Promise(i=>r().subscribe(()=>i()));else{let[i,...a]=(r||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":n=Promise.resolve();break;case"registerWithDelay":n=Oe(+a[0]||0);break;case"registerWhenStable":n=Promise.race([e.whenStable(),Oe(+a[0])]);break;default:throw new y(5600,!1)}}n.then(()=>{e.destroyed||navigator.serviceWorker.register(t,{scope:o.scope}).catch(i=>console.error(J(5604,!1)))})})}function Oe(o){return new Promise(t=>setTimeout(t,o))}function qe(o,t){return new S(o.enabled!==!1?navigator.serviceWorker:void 0,t)}var M=class{enabled;scope;registrationStrategy};function Re(o,t={}){return te([Ge,H,{provide:De,useValue:o},{provide:M,useValue:t},{provide:S,useFactory:qe,deps:[M,ne]},ie(ze)])}var je=(()=>{let t=class t{constructor(e,n){this.authService=e,this.router=n}canActivate(){return console.log("\u{1F680} AuthGuard: canActivate() llamado"),Q(this.checkAuthStatus()).pipe(h(e=>(console.log("\u{1F680} AuthGuard: Resultado de checkAuthStatus:",e),e?(console.log("\u{1F680} AuthGuard: Permitiendo acceso"),!0):(console.log("\u{1F680} AuthGuard: Redirigiendo a login"),this.router.createUrlTree(["/auth/login"])))),U(e=>(console.error("\u274C AuthGuard: Error en canActivate:",e),Y(this.router.createUrlTree(["/auth/login"])))))}checkAuthStatus(){return u(this,null,function*(){try{console.log("\u{1F50D} AuthGuard: Verificaci\xF3n r\xE1pida de autenticaci\xF3n");let e=yield this.authService.getToken();if(console.log("\u{1F50D} AuthGuard: Token obtenido:",e?"S\xCD":"NO"),!e)return console.log("\u{1F50D} AuthGuard: No hay token, redirigiendo a login"),!1;if(this.authService.getCurrentUser())return console.log("\u{1F50D} AuthGuard: Usuario ya cargado, acceso inmediato"),!0;if(!(yield this.authService.ensureValidToken()))return console.log("\u{1F50D} AuthGuard: Token no v\xE1lido, redirigiendo a login"),!1;console.log("\u{1F50D} AuthGuard: Cargando usuario b\xE1sico...");let{data:{session:i}}=yield this.authService.getCurrentSession();return i!=null&&i.user?(yield this.authService.loadUserData(i.user.id),console.log("\u{1F50D} AuthGuard: Usuario b\xE1sico cargado, permitiendo acceso"),!0):(console.log("\u{1F50D} AuthGuard: No hay sesi\xF3n v\xE1lida"),!1)}catch(e){if(console.error("\u274C AuthGuard: Error en verificaci\xF3n r\xE1pida:",e),e instanceof Error&&e.message.includes("NavigatorLockAcquireTimeoutError")){console.log("\u{1F50D} AuthGuard: Error de lock detectado, intentando limpiar...");try{if(localStorage.setItem("supabase_lock_issue","true"),yield new Promise(r=>setTimeout(r,2e3)),yield this.checkAuthStatus())return console.log("\u{1F50D} AuthGuard: Reintento exitoso despu\xE9s de limpiar locks"),!0}catch(n){console.error("\u274C AuthGuard: Error en reintento:",n)}}return!1}})}};t.\u0275fac=function(n){return new(n||t)(c(N),c(fe))},t.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var Fe=[{path:"auth",children:[{path:"login",loadComponent:()=>import("./chunk-TFTLJW2B.js").then(o=>o.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-CLQSY2EJ.js").then(o=>o.RegisterComponent)},{path:"",redirectTo:"login",pathMatch:"full"}]},{path:"",loadComponent:()=>import("./chunk-CI7O6JXL.js").then(o=>o.MainLayoutComponent),canActivate:[je],children:[{path:"home",loadComponent:()=>import("./chunk-X5GTTIJU.js").then(o=>o.HomePage)},{path:"avisos",loadComponent:()=>import("./chunk-2BPR724Q.js").then(o=>o.AvisosComponent)},{path:"historial",loadComponent:()=>import("./chunk-4HJL4JJM.js").then(o=>o.HistorialComponent)},{path:"inventario",loadComponent:()=>import("./chunk-WVWE2KNY.js").then(o=>o.InventarioComponent)},{path:"facturas",loadComponent:()=>import("./chunk-EIKJZ2Y3.js").then(o=>o.FacturasComponent)},{path:"facturas/:id",loadComponent:()=>import("./chunk-P6P763PG.js").then(o=>o.VerFacturaComponent)},{path:"presupuestos",loadComponent:()=>import("./chunk-NPOI2JLW.js").then(o=>o.PresupuestosComponent)},{path:"presupuestos/crear",loadComponent:()=>import("./chunk-F4TKZWKE.js").then(o=>o.CrearPresupuestoComponent)},{path:"presupuestos/:id",loadComponent:()=>import("./chunk-FQ7FZXFI.js").then(o=>o.VerPresupuestoComponent)},{path:"clientes",loadComponent:()=>import("./chunk-RDHCYQB6.js").then(o=>o.ClientesComponent)},{path:"tecnicos",loadComponent:()=>import("./chunk-IPGVG44E.js").then(o=>o.TecnicosComponent)},{path:"cuenta",loadComponent:()=>import("./chunk-UOL3POPJ.js").then(o=>o.MiCuentaComponent)},{path:"ajustes",loadComponent:()=>import("./chunk-RUDK6NIH.js").then(o=>o.AjustesComponent)},{path:"crear-factura",loadComponent:()=>import("./chunk-T76Y66PU.js").then(o=>o.CrearFacturaComponent)},{path:"facturas/editar/:id",loadComponent:()=>import("./chunk-T76Y66PU.js").then(o=>o.CrearFacturaComponent)},{path:"ver-aviso/:id-aviso",loadComponent:()=>import("./chunk-CXT4NC2Z.js").then(o=>o.VerAvisosComponent)},{path:"",redirectTo:"home",pathMatch:"full"}]},{path:"**",redirectTo:"auth/login"}];var V=(()=>{let t=class t{constructor(e){this.platform=e,this.initializeMobilePWA()}initializeMobilePWA(){(this.platform.is("ios")||this.platform.is("android"))&&this.setupMobilePWA()}setupMobilePWA(){document.addEventListener("gesturestart",e=>{e.preventDefault()}),document.addEventListener("touchend",e=>{let n=Date.now(),r=window.lastTouch||0,i=n-r;i<500&&i>0&&e.preventDefault(),window.lastTouch=n}),this.setupViewport(),this.addMobileStyles()}setupViewport(){let e=document.querySelector('meta[name="viewport"]');if(e){let n=["viewport-fit=cover","width=device-width","initial-scale=1.0","minimum-scale=1.0","maximum-scale=1.0","user-scalable=no"].join(", ");e.setAttribute("content",n)}}addMobileStyles(){let e=document.createElement("style");e.textContent=`
      /* Estilos espec\xEDficos para dispositivos m\xF3viles */
      
      /* Configuraci\xF3n base */
      html {
        height: 100%;
        overflow: hidden;
      }
      
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      
      /* Configuraci\xF3n para PWA standalone */
      @media all and (display-mode: standalone) {
        body {
          /* Aplicar safe areas solo en modo standalone */
          padding-top: env(safe-area-inset-top, 0px);
          padding-bottom: env(safe-area-inset-bottom, 0px);
          padding-left: env(safe-area-inset-left, 0px);
          padding-right: env(safe-area-inset-right, 0px);
        }
        
        /* Configurar ion-app */
        ion-app {
          height: 100vh;
          height: calc(100vh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
          margin: 0;
          padding: 0;
        }
        
        /* Configurar ion-content */
        ion-content {
          --offset-top: 0px;
          --offset-bottom: 0px;
          --padding-top: 0px;
          --padding-bottom: 0px;
        }
        
        /* Configurar ion-header */
        ion-header {
          padding-top: 0px;
        }
        
        /* Configurar ion-footer */
        ion-footer {
          padding-bottom: 0px;
        }
        
        /* Configurar ion-toolbar */
        ion-toolbar {
          --padding-top: 0px;
          --padding-bottom: 0px;
        }
      }
      
      /* Configuraci\xF3n espec\xEDfica para iOS */
      @supports (-webkit-touch-callout: none) {
        body {
          /* Prevenir el bounce scroll en iOS */
          position: fixed;
          width: 100%;
          height: 100%;
        }
        
        ion-content {
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
        }
      }
      
      /* Configuraci\xF3n para Android */
      @supports not (-webkit-touch-callout: none) {
        body {
          /* Configuraci\xF3n espec\xEDfica para Android */
          position: relative;
        }
      }
      
      /* Asegurar que el contenido principal ocupe todo el espacio */
      .ion-page {
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      
      /* Configurar el router outlet para que ocupe el espacio disponible */
      ion-router-outlet {
        flex: 1;
        height: 100%;
      }
    `,document.head.appendChild(e)}showIOSInstallInstructions(){window.navigator.standalone===!0||alert(`
        Para instalar esta aplicaci\xF3n en tu iPhone:
        
        1. Toca el bot\xF3n compartir (\u25A1\u2191) en Safari
        2. Despl\xE1zate hacia abajo y toca "Agregar a pantalla de inicio"
        3. Toca "Agregar"
        
        La aplicaci\xF3n aparecer\xE1 en tu pantalla de inicio como una app nativa.
      `)}isStandalone(){return window.navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches}getSafeAreaInfo(){return{top:this.getComputedValue("env(safe-area-inset-top)"),bottom:this.getComputedValue("env(safe-area-inset-bottom)"),left:this.getComputedValue("env(safe-area-inset-left)"),right:this.getComputedValue("env(safe-area-inset-right)")}}getComputedValue(e){let n=document.createElement("div");n.style.position="absolute",n.style.visibility="hidden",n.style[e]=e,document.body.appendChild(n);let r=getComputedStyle(n)[e];return document.body.removeChild(n),r||"0px"}};t.\u0275fac=function(n){return new(n||t)(c(j))},t.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var Ve=(()=>{let t=class t{constructor(e){this.platform=e}canInstall(){return"serviceWorker"in navigator&&"PushManager"in window&&this.isStandalone()===!1}isStandalone(){return window.navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches}getInstallInstructions(){let e=navigator.userAgent.toLowerCase();return this.platform.is("ios")?`Para instalar en iOS:
1. Toca el bot\xF3n compartir (\u25A1\u2191)
2. Selecciona "Agregar a pantalla de inicio"
3. Toca "Agregar"`:this.platform.is("android")?`Para instalar en Android:
1. Toca el men\xFA (\u22EE)
2. Selecciona "Agregar a pantalla de inicio"
3. Toca "Agregar"`:e.includes("chrome")?`Para instalar en Chrome:
1. Busca el \xEDcono de instalaci\xF3n (\u2B07\uFE0F) en la barra de direcciones
2. Haz clic en "Instalar"`:e.includes("edge")?`Para instalar en Edge:
1. Busca el \xEDcono de instalaci\xF3n (\u2B07\uFE0F) en la barra de direcciones
2. Haz clic en "Instalar"`:e.includes("safari")&&!e.includes("chrome")?`Para instalar en Safari:
1. Ve a Archivo > Agregar a pantalla de inicio
2. La app aparecer\xE1 en tu Launchpad`:`Para instalar la aplicaci\xF3n:
Busca el \xEDcono de instalaci\xF3n en tu navegador o usa las opciones del men\xFA para agregar a pantalla de inicio.`}isPwaSupported(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}getBrowserInfo(){let e=navigator.userAgent,n="Unknown",r="Unknown",i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e);if(e.includes("Chrome")&&!e.includes("Edg")){n="Chrome";let a=e.match(/Chrome\/(\d+)/);r=a?a[1]:"Unknown"}else if(e.includes("Safari")&&!e.includes("Chrome")){n="Safari";let a=e.match(/Version\/(\d+)/);r=a?a[1]:"Unknown"}else if(e.includes("Firefox")){n="Firefox";let a=e.match(/Firefox\/(\d+)/);r=a?a[1]:"Unknown"}else if(e.includes("Edg")){n="Edge";let a=e.match(/Edg\/(\d+)/);r=a?a[1]:"Unknown"}return{name:n,version:r,isMobile:i}}getDebugInfo(){return{isStandalone:this.isStandalone(),canInstall:this.canInstall(),isPwaSupported:this.isPwaSupported(),browser:this.getBrowserInfo(),userAgent:navigator.userAgent,platform:this.platform.platforms()}}};t.\u0275fac=function(n){return new(n||t)(c(j))},t.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();function Qe(o,t){if(o&1){let s=se();v(0,"div",1)(1,"ion-card")(2,"ion-card-content")(3,"div",2)(4,"div",3)(5,"h3"),R(6,"Instalar aplicaci\xF3n"),w(),v(7,"p"),R(8,"Agrega esta aplicaci\xF3n a tu pantalla de inicio para un acceso m\xE1s r\xE1pido"),w()(),v(9,"div",4)(10,"ion-button",5),G("click",function(){L(s);let n=z();return _(n.dismissBanner())}),D(11,"ion-icon",6),w(),v(12,"ion-button",7),G("click",function(){L(s);let n=z();return _(n.installPWA())}),R(13," Instalar "),w()()()()()()}}var Be=(()=>{let t=class t{constructor(e,n){this.pwaIosService=e,this.pwaInstallService=n,this.showBanner=!1}ngOnInit(){this.checkPWAInstallation(),window.addEventListener("beforeinstallprompt",this.handleBeforeInstallPrompt.bind(this))}ngOnDestroy(){window.removeEventListener("beforeinstallprompt",this.handleBeforeInstallPrompt.bind(this))}checkPWAInstallation(){if(this.pwaInstallService.isStandalone()){this.showBanner=!1;return}if(!this.pwaInstallService.isPwaSupported()){this.showBanner=!1;return}if(localStorage.getItem("pwa-banner-dismissed")){this.showBanner=!1;return}setTimeout(()=>{this.showBanner=!0},3e3)}handleBeforeInstallPrompt(e){e.preventDefault(),this.deferredPrompt=e}installPWA(){return u(this,null,function*(){if(this.deferredPrompt){this.deferredPrompt.prompt();let{outcome:e}=yield this.deferredPrompt.userChoice;e==="accepted"&&console.log("Usuario acept\xF3 instalar la PWA"),this.deferredPrompt=null,this.showBanner=!1}else this.showInstallInstructions()})}dismissBanner(){this.showBanner=!1,localStorage.setItem("pwa-banner-dismissed","true")}showInstallInstructions(){let e=this.pwaInstallService.getInstallInstructions();alert(e)}};t.\u0275fac=function(n){return new(n||t)(d(V),d(Ve))},t.\u0275cmp=O({type:t,selectors:[["app-pwa-install-banner"]],decls:1,vars:1,consts:[["class","pwa-banner",4,"ngIf"],[1,"pwa-banner"],[1,"banner-content"],[1,"banner-text"],[1,"banner-actions"],["fill","clear",3,"click"],["name","close","slot","icon-only"],[3,"click"]],template:function(n,r){n&1&&re(0,Qe,14,0,"div",0),n&2&&ae("ngIf",r.showBanner)},dependencies:[pe,le,ke,ye,Se,Ae,Pe],styles:[".banner-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:16px}.banner-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:600}.banner-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;opacity:.8}.banner-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}"]});let o=t;return o})();var Le=(()=>{let t=class t{constructor(e,n,r){this.swUpdate=e,this.alertController=n,this.toastController=r,this.checkForUpdates()}checkForUpdates(){this.swUpdate.isEnabled&&(this.swUpdate.checkForUpdate(),setInterval(()=>{this.swUpdate.checkForUpdate()},30*60*1e3),this.swUpdate.versionUpdates.pipe(m(e=>e.type==="VERSION_READY")).subscribe(()=>{this.promptUser()}),this.swUpdate.versionUpdates.pipe(m(e=>e.type==="VERSION_INSTALLATION_FAILED")).subscribe(()=>{this.showError()}),this.swUpdate.versionUpdates.pipe(m(e=>e.type==="VERSION_DETECTED")).subscribe(()=>{console.log("Nueva versi\xF3n detectada")}))}promptUser(){return u(this,null,function*(){yield(yield this.alertController.create({header:"Nueva versi\xF3n disponible",message:"Hay una nueva versi\xF3n de la aplicaci\xF3n disponible. \xBFDeseas actualizar ahora?",buttons:[{text:"M\xE1s tarde",role:"cancel"},{text:"Actualizar",handler:()=>{this.activateUpdate()}}]})).present()})}showError(){return u(this,null,function*(){yield(yield this.toastController.create({message:"Error al actualizar la aplicaci\xF3n",duration:3e3,position:"bottom",color:"danger"})).present()})}activateUpdate(){this.swUpdate.activateUpdate().then(()=>{window.location.reload()})}checkForUpdate(){this.swUpdate.isEnabled&&this.swUpdate.checkForUpdate().then(()=>{console.log("Verificando actualizaciones...")})}forceUpdate(){this.swUpdate.isEnabled&&this.swUpdate.activateUpdate().then(()=>{window.location.reload()})}clearCache(){"caches"in window&&caches.keys().then(e=>{e.forEach(n=>{caches.delete(n)}),console.log("Cache limpiado"),window.location.reload()})}};t.\u0275fac=function(n){return new(n||t)(c(H),c(Me),c(Te))},t.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var B=(()=>{let t=class t{constructor(e){this.cacheService=e,this.cleanupInterval=setInterval(()=>{this.performCleanup()},3e4)}performCleanup(){this.cacheService.clearAllDataCache(),this.cleanupTemporaryElements(),this.forceGarbageCollection()}cleanupTemporaryElements(){try{document.querySelectorAll("[data-temp], [data-temp-listener]").forEach(r=>r.remove()),document.querySelectorAll(".temp-element, .temp-listener").forEach(r=>r.remove())}catch{}}forceGarbageCollection(){if("gc"in window)try{window.gc()}catch{}}forceCleanup(){this.performCleanup()}ngOnDestroy(){this.cleanupInterval&&clearInterval(this.cleanupInterval)}};t.\u0275fac=function(n){return new(n||t)(c(xe))},t.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var _e=(()=>{let t=class t{constructor(e,n,r,i,a){this.pwaUpdateService=e,this.pwaIosService=n,this.viewportService=r,this.authService=i,this.performanceFix=a}ngOnInit(){this.authService.isAuthenticated$.subscribe(e=>{console.log("Estado de autenticaci\xF3n:",e)}),this.isDevMode()||setInterval(()=>{this.performanceFix.forceCleanup()},2*60*1e3)}isDevMode(){return!F.production}};t.\u0275fac=function(n){return new(n||t)(d(Le),d(V),d(Ue),d(N),d(B))},t.\u0275cmp=O({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(n,r){n&1&&(v(0,"ion-app"),D(1,"ion-router-outlet")(2,"app-pwa-install-banner"),w())},dependencies:[Ie,Ce,Be],encapsulation:2});let o=t;return o})();var T=0,Xe=5,Je=3e4;function We(o,t){let s=g(B);return T++,T>Xe&&(s.forceCleanup(),T=0),t(o).pipe(X(Je),U(e=>(T--,e.name==="TimeoutError"&&s.forceCleanup(),$(()=>e))),f(e=>(T--,[e])))}F.production&&void 0;de(_e,{providers:[{provide:me,useClass:be},Ee(),ve(Fe,we(ge)),ue(he([We])),Re("ngsw-worker.js",{enabled:!ce(),registrationStrategy:"registerWhenStable:30000"})]});
