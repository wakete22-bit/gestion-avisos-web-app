// ============================================================================
// MODAL SAFE AREAS - Zonas seguras para modales en Ionic
// ============================================================================
// Este archivo maneja las zonas seguras específicamente para modales
// Soluciona el problema de toolbars y footers cortados en modales

// ============================================================================
// CONFIGURACIÓN BASE PARA MODALES
// ============================================================================

// Configuración global para todos los modales
ion-modal {
  // Asegurar que el modal respete las zonas seguras
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  // Configurar el contenido del modal
  ion-content {
    --offset-top: 0;
    --offset-bottom: 0;
    --padding-top: 0;
    --padding-bottom: 0;
  }
  
  // Configurar el header del modal - con padding mínimo para zonas seguras
  ion-header {
    padding-top: var(--safe-area-top); // Necesario para respetar zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  // Configurar el footer del modal - con padding mínimo para zonas seguras
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Necesario para respetar zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// ============================================================================
// CONFIGURACIÓN ESPECÍFICA PARA iOS
// ============================================================================

// Configuración específica para iOS (notch, Dynamic Island)
.ios {
  ion-modal {
    // Asegurar que el modal respete las zonas seguras en iOS
    --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    
    ion-header {
      // En iOS, padding mínimo para el notch/Dynamic Island
      padding-top: var(--safe-area-top);
      
      ion-toolbar {
        --padding-top: 0;
        --padding-bottom: 0;
        --min-height: 56px;
        --height: 56px;
      }
    }
    
    ion-footer {
      // En iOS, padding mínimo para la home indicator
      padding-bottom: var(--safe-area-bottom);
      
      ion-toolbar {
        --padding-top: 0;
        --padding-bottom: 0;
        --min-height: 56px;
        --height: 56px;
      }
    }
    
    ion-content {
      // Configurar offsets mínimos para iOS
      --offset-top: 0;
      --offset-bottom: 0;
      --padding-top: 0;
      --padding-bottom: 0;
    }
  }
  
  // Header móvil en iOS - altura estándar
  .mobile-header {
    ion-toolbar {
      --min-height: 60px;
      --height: 60px;
      --padding-top: 0;
    }
  }
}

// ============================================================================
// CONFIGURACIÓN ESPECÍFICA PARA ANDROID
// ============================================================================

// Configuración específica para Android
.android {
  ion-modal {
    ion-header {
      padding-top: var(--safe-area-top); // Padding mínimo para zonas seguras
      
      ion-toolbar {
        --padding-top: 0;
        --min-height: 56px;
        --height: 56px;
      }
    }
    
    ion-footer {
      padding-bottom: var(--safe-area-bottom); // Padding mínimo para zonas seguras
      
      ion-toolbar {
        --padding-bottom: 0;
        --min-height: 56px;
        --height: 56px;
      }
    }
  }
  
  // Header móvil en Android - altura estándar
  .mobile-header {
    ion-toolbar {
      --min-height: 60px;
      --height: 60px;
      --padding-top: 0;
    }
  }
}

// ============================================================================
// MODALES ESPECÍFICOS
// ============================================================================

// Modal para crear aviso - ajuste específico para el problema visual
ion-modal.modal-crear-aviso {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// Modal para crear cliente
ion-modal.modal-crear-cliente {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// Modal para ver albarán
ion-modal.modal-ver-albaran {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// Modal para hacer albarán
ion-modal.modal-hacer-albaran {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// Modal para crear factura
ion-modal.modal-crear-factura {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// Modal para crear presupuesto
ion-modal.modal-crear-presupuesto {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// Modal para crear técnico
ion-modal.modal-crear-tecnico {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// Modal para crear producto
ion-modal.modal-crear-producto {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// ============================================================================
// MODALES FULLSCREEN
// ============================================================================

// Modal fullscreen para móviles
ion-modal.modal-fullscreen {
  --width: 100vw;
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-width: 100vw;
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --min-width: 100vw;
  --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --border-radius: 0;
  --box-shadow: none;
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// ============================================================================
// MODALES LATERALES
// ============================================================================

// Modal lateral para escritorio
ion-modal.side-modal {
  --width: 420px;
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --border-radius: 0;
  --box-shadow: -4px 0 24px rgba(0,0,0,0.08);
  align-items: flex-end;
  justify-content: flex-end;
  
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
      --height: 56px;
    }
  }
}

// ============================================================================
// CONFIGURACIÓN PARA PWA STANDALONE
// ============================================================================

@media all and (display-mode: standalone) {
  ion-modal {
    --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    
    ion-header {
      padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    }
    
    ion-footer {
      padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    }
  }
  
  // Header móvil en modo standalone - altura estándar
  .mobile-header {
    ion-toolbar {
      --min-height: 60px;
      --height: 60px;
      --padding-top: 0;
    }
  }
}

// ============================================================================
// FALLBACKS PARA NAVEGADORES ANTIGUOS
// ============================================================================

@supports not (padding-top: env(safe-area-inset-top)) {
  ion-modal {
    --height: calc(100vh - 40px);
    --max-height: calc(100vh - 40px);
    --min-height: calc(100vh - 40px);
    
    ion-header {
      padding-top: 20px; // Fallback para navegadores antiguos
    }
    
    ion-footer {
      padding-bottom: 20px; // Fallback para navegadores antiguos
    }
  }
  
  // Header móvil fallback - altura estándar
  .mobile-header {
    ion-toolbar {
      --min-height: 60px;
      --height: 60px;
      --padding-top: 24px;
    }
  }
}

// ============================================================================
// UTILIDADES PARA MODALES
// ============================================================================

// Clase para modales con zonas seguras
.modal-safe {
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
  }
  
  ion-content {
    --offset-top: 0;
    --offset-bottom: 0;
  }
}

// Clase para modales con header seguro
.modal-header-safe {
  ion-header {
    padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
  }
  
  ion-content {
    --offset-top: 0;
  }
}

// Clase para modales con footer seguro
.modal-footer-safe {
  ion-footer {
    padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
  }
  
  ion-content {
    --offset-bottom: 0;
  }
}

// ============================================================================
// RESPONSIVE PARA MODALES
// ============================================================================

@media (max-width: 768px) {
  ion-modal {
    --width: 100vw !important;
    --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom)) !important;
    --max-width: 100vw !important;
    --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom)) !important;
    --min-width: 100vw !important;
    --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom)) !important;
    --border-radius: 0 !important;
    --box-shadow: none !important;
  }
  
  ion-modal.side-modal {
    --width: 100vw !important;
    --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom)) !important;
  }
}

@media (max-width: 480px) {
  ion-modal {
    ion-header {
      padding-top: var(--safe-area-top); // Solo el padding necesario para zonas seguras
    }
    
    ion-footer {
      padding-bottom: var(--safe-area-bottom); // Solo el padding necesario para zonas seguras
    }
  }
}
