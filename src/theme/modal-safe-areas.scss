// ============================================================================
// MODAL SAFE AREAS - Zonas seguras para modales en Ionic
// ============================================================================
// Este archivo maneja las zonas seguras específicamente para modales
// Soluciona el problema de toolbars y footers cortados en modales

// ============================================================================
// CONFIGURACIÓN BASE PARA MODALES
// ============================================================================

// Configuración global para todos los modales
ion-modal {
  // Asegurar que el modal respete las zonas seguras
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  // Configurar el contenido del modal
  ion-content {
    --offset-top: var(--safe-area-top);
    --offset-bottom: var(--safe-area-bottom);
    --padding-top: 0;
    --padding-bottom: 0;
  }
  
  // Configurar el header del modal
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
  
  // Configurar el footer del modal
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-top: 0;
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// ============================================================================
// CONFIGURACIÓN ESPECÍFICA PARA iOS
// ============================================================================

// Configuración específica para iOS (notch, Dynamic Island)
.ios {
  ion-modal {
    // Asegurar que el modal respete las zonas seguras en iOS
    --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    
    ion-header {
      // En iOS, necesitamos padding adicional para el notch/Dynamic Island
      padding-top: calc(var(--safe-area-top) + 8px);
      
      ion-toolbar {
        --padding-top: 0;
        --padding-bottom: 0;
        --min-height: 56px;
        // Asegurar que el toolbar tenga altura suficiente
        --height: calc(56px + var(--safe-area-top));
        --min-height: calc(56px + var(--safe-area-top));
      }
    }
    
    ion-footer {
      // En iOS, padding adicional para la home indicator
      padding-bottom: calc(var(--safe-area-bottom) + 8px);
      
      ion-toolbar {
        --padding-top: 0;
        --padding-bottom: 0;
        --min-height: 56px;
        // Asegurar que el toolbar tenga altura suficiente
        --height: calc(56px + var(--safe-area-bottom));
        --min-height: calc(56px + var(--safe-area-bottom));
      }
    }
    
    ion-content {
      // Configurar offsets para iOS
      --offset-top: calc(var(--safe-area-top) + 8px);
      --offset-bottom: calc(var(--safe-area-bottom) + 8px);
      --padding-top: 0;
      --padding-bottom: 0;
    }
  }
  
  // Header móvil en iOS
  .mobile-header {
    ion-toolbar {
      --min-height: calc(60px + var(--safe-area-top));
      --height: calc(60px + var(--safe-area-top));
      --padding-top: var(--safe-area-top);
    }
  }
}

// ============================================================================
// CONFIGURACIÓN ESPECÍFICA PARA ANDROID
// ============================================================================

// Configuración específica para Android
.android {
  ion-modal {
    ion-header {
      padding-top: calc(var(--safe-area-top) + 4px);
      
      ion-toolbar {
        --padding-top: 0;
        --min-height: 56px;
      }
    }
    
    ion-footer {
      padding-bottom: calc(var(--safe-area-bottom) + 4px);
      
      ion-toolbar {
        --padding-bottom: 0;
        --min-height: 56px;
      }
    }
  }
  
  // Header móvil en Android
  .mobile-header {
    ion-toolbar {
      --min-height: calc(60px + var(--safe-area-top));
      --height: calc(60px + var(--safe-area-top));
      --padding-top: var(--safe-area-top);
    }
  }
}

// ============================================================================
// MODALES ESPECÍFICOS
// ============================================================================

// Modal para crear cliente
ion-modal.modal-crear-cliente {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// Modal para ver albarán
ion-modal.modal-ver-albaran {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// Modal para hacer albarán
ion-modal.modal-hacer-albaran {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// Modal para crear factura
ion-modal.modal-crear-factura {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// Modal para crear presupuesto
ion-modal.modal-crear-presupuesto {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// Modal para crear aviso
ion-modal.modal-crear-aviso {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// Modal para crear cliente
ion-modal.modal-crear-cliente {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// Modal para crear técnico
ion-modal.modal-crear-tecnico {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// Modal para crear producto
ion-modal.modal-crear-producto {
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// ============================================================================
// MODALES FULLSCREEN
// ============================================================================

// Modal fullscreen para móviles
ion-modal.modal-fullscreen {
  --width: 100vw;
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --max-width: 100vw;
  --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --min-width: 100vw;
  --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --border-radius: 0;
  --box-shadow: none;
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// ============================================================================
// MODALES LATERALES
// ============================================================================

// Modal lateral para escritorio
ion-modal.side-modal {
  --width: 420px;
  --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
  --border-radius: 0;
  --box-shadow: -4px 0 24px rgba(0,0,0,0.08);
  align-items: flex-end;
  justify-content: flex-end;
  
  ion-header {
    padding-top: var(--safe-area-top);
    
    ion-toolbar {
      --padding-top: 0;
      --min-height: 56px;
    }
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
    
    ion-toolbar {
      --padding-bottom: 0;
      --min-height: 56px;
    }
  }
}

// ============================================================================
// CONFIGURACIÓN PARA PWA STANDALONE
// ============================================================================

@media all and (display-mode: standalone) {
  ion-modal {
    --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    
    ion-header {
      padding-top: calc(var(--safe-area-top) + 8px);
    }
    
    ion-footer {
      padding-bottom: calc(var(--safe-area-bottom) + 8px);
    }
  }
  
  // Header móvil en modo standalone
  .mobile-header {
    ion-toolbar {
      --min-height: calc(60px + var(--safe-area-top));
      --height: calc(60px + var(--safe-area-top));
      --padding-top: var(--safe-area-top);
    }
  }
}

// ============================================================================
// FALLBACKS PARA NAVEGADORES ANTIGUOS
// ============================================================================

@supports not (padding-top: env(safe-area-inset-top)) {
  ion-modal {
    --height: calc(100vh - 40px);
    --max-height: calc(100vh - 40px);
    --min-height: calc(100vh - 40px);
    
    ion-header {
      padding-top: 20px;
    }
    
    ion-footer {
      padding-bottom: 20px;
    }
  }
  
  // Header móvil fallback
  .mobile-header {
    ion-toolbar {
      --min-height: 84px;
      --height: 84px;
      --padding-top: 24px;
    }
  }
}

// ============================================================================
// UTILIDADES PARA MODALES
// ============================================================================

// Clase para modales con zonas seguras
.modal-safe {
  ion-header {
    padding-top: var(--safe-area-top);
  }
  
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
  }
  
  ion-content {
    --offset-top: var(--safe-area-top);
    --offset-bottom: var(--safe-area-bottom);
  }
}

// Clase para modales con header seguro
.modal-header-safe {
  ion-header {
    padding-top: var(--safe-area-top);
  }
  
  ion-content {
    --offset-top: var(--safe-area-top);
  }
}

// Clase para modales con footer seguro
.modal-footer-safe {
  ion-footer {
    padding-bottom: var(--safe-area-bottom);
  }
  
  ion-content {
    --offset-bottom: var(--safe-area-bottom);
  }
}

// ============================================================================
// RESPONSIVE PARA MODALES
// ============================================================================

@media (max-width: 768px) {
  ion-modal {
    --width: 100vw !important;
    --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom)) !important;
    --max-width: 100vw !important;
    --max-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom)) !important;
    --min-width: 100vw !important;
    --min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom)) !important;
    --border-radius: 0 !important;
    --box-shadow: none !important;
  }
  
  ion-modal.side-modal {
    --width: 100vw !important;
    --height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom)) !important;
  }
}

@media (max-width: 480px) {
  ion-modal {
    ion-header {
      padding-top: calc(var(--safe-area-top) + 4px);
    }
    
    ion-footer {
      padding-bottom: calc(var(--safe-area-bottom) + 4px);
    }
  }
}
