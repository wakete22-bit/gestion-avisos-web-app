<!-- <ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Blank
    </ion-title>
  </ion-toolbar>
</ion-header> -->


<ion-content>
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner">
      <ion-icon name="refresh-outline" class="spinning"></ion-icon>
      <p>Cargando productos...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-message">
      <ion-icon name="alert-circle-outline"></ion-icon>
      <p>{{ error }}</p>
      <button class="btn-retry" (click)="refrescarInventario()">
        <ion-icon name="refresh-outline"></ion-icon>
        Reintentar
      </button>
    </div>
  </div>

  <!-- Contenido principal -->
  <section *ngIf="!loading && !error" class="dashboard-table">
    <!-- Header Section -->
    <div class="table-header">
      <div class="table-header-left">
        <div class="table-title">Tabla de inventario</div>
        <div class="table-meta">Productos: {{ totalProductos }}</div>
      </div>
      
      <!-- Mobile Search Bar -->
      <div class="mobile-search">
        <input type="text" placeholder="Buscar producto..." [formControl]="searchControl" />
        <ion-icon name="search-outline"></ion-icon>
      </div>

      <!-- Desktop Search and Actions -->
      <div class="table-search desktop-only">
        <input type="text" placeholder="Buscar..." [formControl]="searchControl" />
        <select>
          <option>Ordenar por: Recientes</option>
        </select>
        <div class="header-actions">
          <button class="btn-refresh" (click)="refrescarInventario()" title="Refrescar">
            <ion-icon name="refresh-outline"></ion-icon>
          </button>
          <button class="btn-add" (click)="abrirModalCrearProducto()">
            <ion-icon name="add-circle"></ion-icon>
            Añadir producto
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Actions -->
    <div class="mobile-actions">
      <select class="mobile-filter">
        <option>Ordenar: Recientes</option>
        <option>Ordenar: Antiguos</option>
        <option>Ordenar: Stock</option>
      </select>
      <div class="mobile-buttons">
        <button class="btn-refresh" (click)="refrescarInventario()" title="Refrescar">
          <ion-icon name="refresh-outline"></ion-icon>
        </button>
        <button class="btn-add" (click)="abrirModalCrearProducto()">
          <ion-icon name="add-circle"></ion-icon>
        </button>
      </div>
    </div>

      <!-- Compact Table View (grid, igual que avisos) -->
      <div *ngIf="!loading && !error && productosFiltrados.length > 0" class="compact-inventario-table">
        <div class="inventario-table">
          <div class="table-header">
            <div class="header-row">
              <div class="header-cell">Código</div>
              <div class="header-cell">Nombre</div>
              <div class="header-cell">Descripción</div>
              <div class="header-cell">Cantidad</div>
              <div class="header-cell">Unidad</div>
              <div class="header-cell">Stock</div>
              <div class="header-cell">Precio Neto</div>
              <div class="header-cell">PVP</div>
              <div class="header-cell">Acciones</div>
            </div>
          </div>
          <div class="table-body">
            <div *ngFor="let producto of productosFiltrados"
                 class="aviso-row"
                 [ngClass]="{ 'no-visitado': !getEnStock(producto.cantidad_disponible), 'completado': getEnStock(producto.cantidad_disponible) }">
              <div class="aviso-cell numero-aviso">{{ producto.codigo }}</div>
              <div class="aviso-cell nombre-cliente">{{ producto.nombre }}</div>
              <div class="aviso-cell detalle-servicio">
                <div class="detalle-texto" [title]="producto.descripcion">{{ producto.descripcion || 'Sin descripción' }}</div>
              </div>
              <div class="aviso-cell cantidad-aviso">{{ producto.cantidad_disponible }}</div>
              <div class="aviso-cell unidad-aviso">{{ producto.unidad }}</div>
              <div class="aviso-cell estado-aviso">
                <span class="badge" [ngClass]="{ 'yellow': getEnStock(producto.cantidad_disponible), 'red': !getEnStock(producto.cantidad_disponible) }">
                  {{ getEnStock(producto.cantidad_disponible) ? 'En Stock' : 'Sin Stock' }}
                </span>
              </div>
              <div class="aviso-cell precio-neto-aviso">{{ getPrecioNetoFormateado(producto.precio_neto) }}</div>
              <div class="aviso-cell pvp-aviso">{{ getPvpFormateado(producto.pvp) }}</div>
              <div class="aviso-cell acciones">
                <button class="btn-editar" title="Editar producto" (click)="editarProducto(producto)">
                  <ion-icon name="create-outline"></ion-icon>
                </button>
                <button class="btn-eliminar" title="Eliminar producto" (click)="confirmarEliminarProducto(producto)">
                  <ion-icon name="trash-outline"></ion-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Estado de datos vacíos -->
      <div *ngIf="productosFiltrados.length === 0 && !loading && !error" class="no-data-container">
        <div class="no-data-message">
          <ion-icon name="cube-outline"></ion-icon>
          <h3>No hay productos</h3>
          <p>Aún no se han creado productos en el inventario. Crea el primero para comenzar.</p>
          <button class="btn-create" (click)="abrirModalCrearProducto()">
            <ion-icon name="add-circle"></ion-icon>
            Crear producto
          </button>
        </div>
      </div>

      <!-- Pagination -->
      <div *ngIf="productosFiltrados.length > 0 && totalProductos > 0 && !loading && !error" class="table-pagination">
        <span class="pagination-info">
          Mostrando datos {{ ((paginaActual - 1) * porPagina) + 1 }} a {{ Math.min(paginaActual * porPagina, totalProductos) }} de {{ totalProductos }} productos
        </span>
        <div class="pagination">
          <!-- Botón Primera Página -->
          <button 
            class="pagination-btn" 
            [disabled]="!puedeAnterior()"
            (click)="primeraPagina()"
            title="Primera página">
            <ion-icon name="chevron-back-outline"></ion-icon>
            <ion-icon name="chevron-back-outline"></ion-icon>
          </button>

          <!-- Botón Página Anterior -->
          <button 
            class="pagination-btn" 
            [disabled]="!puedeAnterior()"
            (click)="paginaAnterior()"
            title="Página anterior">
            <ion-icon name="chevron-back-outline"></ion-icon>
          </button>

          <!-- Páginas -->
          <ng-container *ngFor="let pagina of obtenerRangoPaginas()">
            <button 
              class="pagination-btn" 
              [class.active]="pagina === paginaActual"
              (click)="cambiarPagina(pagina)">
              {{ pagina }}
            </button>
          </ng-container>

          <!-- Botón Página Siguiente -->
          <button 
            class="pagination-btn" 
            [disabled]="!puedeSiguiente()"
            (click)="paginaSiguiente()"
            title="Página siguiente">
            <ion-icon name="chevron-forward-outline"></ion-icon>
          </button>

          <!-- Botón Última Página -->
          <button 
            class="pagination-btn" 
            [disabled]="!puedeSiguiente()"
            (click)="ultimaPagina()"
            title="Última página">
            <ion-icon name="chevron-forward-outline"></ion-icon>
            <ion-icon name="chevron-forward-outline"></ion-icon>
          </button>
        </div>
      </div>
    </section>
</ion-content>