<div class="modal-container">
  <header class="modal-header">
    <div class="header-content">
      <h2>{{ tituloModal }}</h2>
      <button class="close-button" (click)="onClose()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    <p class="subtitle">{{ subtituloModal }}</p>
  </header>

  <form (ngSubmit)="crearTecnico()" class="modal-body">
    <div class="modal-content">
      <!-- Mensaje de error -->
      <div *ngIf="error" class="error-message">
        <ion-icon name="alert-circle-outline"></ion-icon>
        {{ error }}
      </div>

      <div class="modal-grid">
        <!-- Sección Izquierda - Información Personal -->
        <div class="form-section">
          <h3>Información Personal</h3>
          
          <div class="form-group">
            <label>Nombre Completo <span class="required">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="tecnicoData.nombre_completo"
              name="nombre_completo"
              placeholder="Ingresa el nombre completo"
              class="form-control"
              (input)="onInputChange()"
              required>
          </div>

          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input 
              type="email" 
              [(ngModel)]="tecnicoData.email"
              name="email"
              placeholder="Ingresa el email"
              class="form-control"
              (input)="onInputChange()"
              required>
          </div>

          <div class="form-group">
            <label>Teléfono</label>
            <input 
              type="tel" 
              [(ngModel)]="tecnicoData.telefono"
              name="telefono"
              placeholder="Ingresa el teléfono"
              class="form-control"
              (input)="onInputChange()">
          </div>

          <div class="form-group">
            <label>Rol <span class="required">*</span></label>
            
            <!-- Estado de carga de roles -->
            <div *ngIf="loadingRoles" class="loading-roles">
              <ion-icon name="refresh-outline" class="spinning"></ion-icon>
              <span>Cargando roles disponibles...</span>
            </div>
            
            <!-- Selector de rol -->
            <select 
              *ngIf="!loadingRoles"
              [(ngModel)]="tecnicoData.rol_id"
              name="rol_id"
              class="form-control"
              (change)="onInputChange()"
              required>
              <option value="">Selecciona el rol</option>
              <option 
                *ngFor="let rol of rolesDisponibles" 
                [value]="rol.value"
                [disabled]="rol.value === 'admin-uuid-placeholder'">
                {{ rol.label }}
                <span *ngIf="rol.value === 'admin-uuid-placeholder'"> (Requiere configuración)</span>
              </option>
            </select>
            
            <!-- Mensaje de advertencia para rol de administrador no configurado -->
            <div *ngIf="!loadingRoles && tecnicoData.rol_id === 'admin-uuid-placeholder'" class="warning-message">
              <ion-icon name="alert-circle-outline"></ion-icon>
              <p>El rol de Administrador requiere configuración adicional en la base de datos. Contacta al administrador del sistema.</p>
            </div>

            <!-- Información adicional del rol -->
            <div class="role-info" *ngIf="tecnicoData.rol_id && !loadingRoles">
              <div class="role-card">
                <div class="role-header">
                  <ion-icon name="shield-outline"></ion-icon>
                  <span class="role-title">{{ getRolLabel(tecnicoData.rol_id) }}</span>
                </div>
                <div class="role-description">
                  <p *ngIf="tecnicoData.rol_id">
                    <strong>Permisos:</strong> {{ getRolDescripcion(tecnicoData.rol_id) }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sección Derecha - Información de Acceso -->
        <div class="images-section">
          <div class="repuestos-container">
            <h3>Credenciales de Acceso</h3>
            
            <!-- Mensaje informativo -->
            <div class="info-message" *ngIf="!modoEdicion">
              <ion-icon name="information-circle-outline"></ion-icon>
              <p>El técnico recibirá un email con sus credenciales de acceso al sistema.</p>
            </div>

            <div class="form-group" *ngIf="!modoEdicion">
              <label>Contraseña <span class="required">*</span></label>
              <input 
                type="password" 
                [(ngModel)]="tecnicoData.password"
                name="password"
                placeholder="Ingresa la contraseña"
                class="form-control"
                (input)="onInputChange()"
                required>
              <div class="password-hint">Mínimo 6 caracteres</div>
            </div>



            <!-- Estado de validación -->
            <div class="validation-status">
              <div class="validation-item" [class.valid]="tecnicoData.nombre_completo.trim()">
                <ion-icon name="checkmark-circle-outline" *ngIf="tecnicoData.nombre_completo.trim()"></ion-icon>
                <ion-icon name="ellipse-outline" *ngIf="!tecnicoData.nombre_completo.trim()"></ion-icon>
                <span>Nombre completo</span>
              </div>
              <div class="validation-item" [class.valid]="validarEmail(tecnicoData.email)">
                <ion-icon name="checkmark-circle-outline" *ngIf="validarEmail(tecnicoData.email)"></ion-icon>
                <ion-icon name="ellipse-outline" *ngIf="!validarEmail(tecnicoData.email)"></ion-icon>
                <span>Email válido</span>
              </div>
                          <div class="validation-item" [class.valid]="modoEdicion || tecnicoData.password.length >= 6" *ngIf="!modoEdicion">
              <ion-icon name="checkmark-circle-outline" *ngIf="tecnicoData.password.length >= 6"></ion-icon>
              <ion-icon name="ellipse-outline" *ngIf="tecnicoData.password.length < 6"></ion-icon>
              <span>Contraseña (mín. 6 caracteres)</span>
            </div>
              <div class="validation-item" [class.valid]="tecnicoData.rol_id">
                <ion-icon name="checkmark-circle-outline" *ngIf="tecnicoData.rol_id"></ion-icon>
                <ion-icon name="ellipse-outline" *ngIf="!tecnicoData.rol_id"></ion-icon>
                <span>Rol seleccionado</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>

  <footer class="modal-footer">
    <div class="button-group">
      <button type="button" class="btn btn-outline" (click)="onClose()">
        Cancelar
      </button>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="crearTecnico()"
        [disabled]="loading || !isFormValid()">
        <ion-icon name="save-outline" *ngIf="!loading"></ion-icon>
        <ion-icon name="refresh-outline" class="spinning" *ngIf="loading"></ion-icon>
        {{ textoBotonGuardar }}
      </button>
    </div>
  </footer>
</div> 